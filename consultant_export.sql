-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Sep 20, 2025 at 03:01 PM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.2.12

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `consultant`
--
CREATE DATABASE IF NOT EXISTS `consultant` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `consultant`;

-- --------------------------------------------------------

--
-- Table structure for table `activity_logs`
--

DROP TABLE IF EXISTS `activity_logs`;
CREATE TABLE `activity_logs` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `user_id` bigint(20) UNSIGNED DEFAULT NULL,
  `action` varchar(255) NOT NULL,
  `subject_type` varchar(255) DEFAULT NULL,
  `subject_id` bigint(20) UNSIGNED DEFAULT NULL,
  `properties` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`properties`)),
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `activity_logs`
--

INSERT INTO `activity_logs` (`id`, `user_id`, `action`, `subject_type`, `subject_id`, `properties`, `created_at`, `updated_at`) VALUES
(1, 1, 'topic.created', 'App\\Models\\Topic', 1, '{\"status\":\"draft\",\"slug\":\"post-transplant-aki-rejection\"}', '2025-09-18 13:46:28', '2025-09-18 13:46:28'),
(2, 1, 'topic.created', 'App\\Models\\Topic', 2, '{\"status\":\"draft\",\"slug\":\"post-transplant-acute-rejection\"}', '2025-09-18 19:12:39', '2025-09-18 19:12:39'),
(3, 1, 'topic.updated', 'App\\Models\\Topic', 2, '{\"status\":\"published\",\"slug\":\"post-transplant-acute-rejection\"}', '2025-09-18 19:13:17', '2025-09-18 19:13:17'),
(4, 1, 'topic.created', 'App\\Models\\Topic', 3, '{\"status\":\"published\",\"slug\":\"rtxpost-transplant-aki-rejection\"}', '2025-09-18 20:10:16', '2025-09-18 20:10:16'),
(5, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:08', '2025-09-19 00:58:08'),
(6, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:11', '2025-09-19 00:58:11'),
(7, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:20', '2025-09-19 00:58:20'),
(8, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:22', '2025-09-19 00:58:22'),
(9, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:29', '2025-09-19 00:58:29'),
(10, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 2, '{\"slug\":\"post-transplant-acute-rejection\",\"method\":\"wysiwyg\"}', '2025-09-19 00:58:47', '2025-09-19 00:58:47'),
(11, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 6, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(12, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 10, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(13, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 11, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(14, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 12, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(15, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 13, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(16, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 14, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(17, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 15, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(18, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 16, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(19, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 17, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(20, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 18, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(21, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 19, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(22, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 20, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(23, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 21, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(24, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 22, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":4,\"new_category_id\":\"3\"}', '2025-09-19 01:12:02', '2025-09-19 01:12:02'),
(25, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 1, '{\"action\":\"change_category\",\"old_status\":\"draft\",\"new_status\":\"draft\",\"old_category_id\":null,\"new_category_id\":\"2\"}', '2025-09-19 01:13:07', '2025-09-19 01:13:07'),
(26, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 2, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":null,\"new_category_id\":\"2\"}', '2025-09-19 01:13:07', '2025-09-19 01:13:07'),
(27, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 4, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"4\"}', '2025-09-19 01:13:36', '2025-09-19 01:13:36'),
(28, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 7, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"4\"}', '2025-09-19 01:13:36', '2025-09-19 01:13:36'),
(29, 1, 'topic.bulk_updated', 'App\\Models\\Topic', 8, '{\"action\":\"change_category\",\"old_status\":\"published\",\"new_status\":\"published\",\"old_category_id\":1,\"new_category_id\":\"4\"}', '2025-09-19 01:13:36', '2025-09-19 01:13:36'),
(30, 1, 'topic.created', 'App\\Models\\Topic', 24, '{\"status\":\"published\",\"slug\":\"hypokalemia\"}', '2025-09-19 01:28:18', '2025-09-19 01:28:18'),
(31, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:27:19', '2025-09-19 02:27:19'),
(32, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:27:39', '2025-09-19 02:27:39'),
(33, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:28:49', '2025-09-19 02:28:49'),
(34, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:28:59', '2025-09-19 02:28:59'),
(35, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:29:50', '2025-09-19 02:29:50'),
(36, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:32:35', '2025-09-19 02:32:35'),
(37, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 15, '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"method\":\"wysiwyg\"}', '2025-09-19 02:33:10', '2025-09-19 02:33:10'),
(38, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 24, '{\"slug\":\"hypokalemia\",\"method\":\"wysiwyg\"}', '2025-09-19 02:33:33', '2025-09-19 02:33:33'),
(39, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 10, '{\"slug\":\"pd-catheter-no-outflow\",\"method\":\"wysiwyg\"}', '2025-09-19 02:46:42', '2025-09-19 02:46:42'),
(40, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 10, '{\"slug\":\"pd-catheter-no-outflow\",\"method\":\"wysiwyg\"}', '2025-09-19 02:47:57', '2025-09-19 02:47:57'),
(41, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 10, '{\"slug\":\"pd-catheter-no-outflow\",\"method\":\"wysiwyg\"}', '2025-09-19 02:48:07', '2025-09-19 02:48:07'),
(42, 1, 'topic.wysiwyg_updated', 'App\\Models\\Topic', 10, '{\"slug\":\"pd-catheter-no-outflow\",\"method\":\"wysiwyg\"}', '2025-09-19 02:48:08', '2025-09-19 02:48:08'),
(43, 1, 'user.updated', 'App\\Models\\User', 4, '{\"role\":\"member\",\"is_active\":false}', '2025-09-19 16:14:22', '2025-09-19 16:14:22'),
(44, 1, 'user.updated', 'App\\Models\\User', 4, '{\"role\":\"member\",\"is_active\":true}', '2025-09-19 16:14:38', '2025-09-19 16:14:38');

-- --------------------------------------------------------

--
-- Table structure for table `auth_settings`
--

DROP TABLE IF EXISTS `auth_settings`;
CREATE TABLE `auth_settings` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `allow_email_registration` tinyint(1) NOT NULL DEFAULT 1,
  `allow_google_auth` tinyint(1) NOT NULL DEFAULT 0,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `auth_settings`
--

INSERT INTO `auth_settings` (`id`, `allow_email_registration`, `allow_google_auth`, `created_at`, `updated_at`) VALUES
(1, 1, 1, '2025-09-18 21:17:18', '2025-09-19 15:48:47');

-- --------------------------------------------------------

--
-- Table structure for table `cache`
--

DROP TABLE IF EXISTS `cache`;
CREATE TABLE `cache` (
  `key` varchar(255) NOT NULL,
  `value` mediumtext NOT NULL,
  `expiration` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `cache`
--

INSERT INTO `cache` (`key`, `value`, `expiration`) VALUES
('laravel-cache-content.footer_text', 's:39:\"© 2024 NephroApp. All rights reserved.\";', 1758346387),
('laravel-cache-content.hero_cta_primary', 's:11:\"Get Started\";', 1758356416),
('laravel-cache-content.hero_cta_secondary', 's:11:\"View Topics\";', 1758356416),
('laravel-cache-content.hero_subtitle', 's:131:\"Real-world nephrology cases with interactive scenarios designed by  experts. Perfect your clinical reasoning and diagnostic skills.\";', 1758356416),
('laravel-cache-content.hero_title', 's:56:\"Master Clinical Nephrology with Expert-Crafted Scenarios\";', 1758356416),
('laravel-cache-content.site_tagline', 's:32:\"Expert Medical Training Platform\";', 1758356416),
('laravel-cache-content.topics_all_categories_option', 's:14:\"All Categories\";', 1758356416),
('laravel-cache-content.topics_category_label', 's:8:\"Category\";', 1758356416),
('laravel-cache-content.topics_search_filter_placeholder', 's:27:\"Search by title, content...\";', 1758356416),
('laravel-cache-content.topics_search_label', 's:13:\"Search Topics\";', 1758356416),
('laravel-cache-content.topics_search_placeholder', 's:28:\"Search topics, categories...\";', 1758356416),
('laravel-cache-settings', 'a:8:{s:8:\"app_name\";s:9:\"NephroApp\";s:7:\"app_url\";s:21:\"http://127.0.0.1:8000\";s:8:\"timezone\";s:3:\"UTC\";s:6:\"locale\";s:2:\"en\";s:16:\"google_client_id\";s:73:\"1020872479914-ps3bhckd02rh9p5vr2fq2lsnv9jek6a2.apps.googleusercontent.com\";s:20:\"google_client_secret\";s:35:\"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\";s:19:\"google_redirect_uri\";s:42:\"http://127.0.0.1:8000/auth/google/callback\";s:19:\"template_assignment\";s:24:\"{\"profile\\/favorites\":9}\";}', 1758376136);

-- --------------------------------------------------------

--
-- Table structure for table `cache_locks`
--

DROP TABLE IF EXISTS `cache_locks`;
CREATE TABLE `cache_locks` (
  `key` varchar(255) NOT NULL,
  `owner` varchar(255) NOT NULL,
  `expiration` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `categories`
--

DROP TABLE IF EXISTS `categories`;
CREATE TABLE `categories` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `name` varchar(255) NOT NULL,
  `slug` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `categories`
--

INSERT INTO `categories` (`id`, `name`, `slug`, `description`, `created_at`, `updated_at`) VALUES
(1, 'Uncategorized', 'uncategorized', NULL, '2025-09-18 19:40:17', '2025-09-18 19:40:17'),
(2, 'Renal Transplant', 'renal-transplant', NULL, '2025-09-18 19:40:17', '2025-09-18 19:40:17'),
(3, 'Peritoneal Dialysis', 'peritoneal-dialysis', NULL, '2025-09-19 00:07:10', '2025-09-19 01:14:07'),
(4, 'Transplantation', 'transplantation', NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47'),
(5, 'Hypokalemia', 'hypokalemia', NULL, '2025-09-19 01:27:36', '2025-09-19 01:27:36');

-- --------------------------------------------------------

--
-- Table structure for table `failed_jobs`
--

DROP TABLE IF EXISTS `failed_jobs`;
CREATE TABLE `failed_jobs` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `uuid` varchar(255) NOT NULL,
  `connection` text NOT NULL,
  `queue` text NOT NULL,
  `payload` longtext NOT NULL,
  `exception` longtext NOT NULL,
  `failed_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `jobs`
--

DROP TABLE IF EXISTS `jobs`;
CREATE TABLE `jobs` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `queue` varchar(255) NOT NULL,
  `payload` longtext NOT NULL,
  `attempts` tinyint(3) UNSIGNED NOT NULL,
  `reserved_at` int(10) UNSIGNED DEFAULT NULL,
  `available_at` int(10) UNSIGNED NOT NULL,
  `created_at` int(10) UNSIGNED NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `job_batches`
--

DROP TABLE IF EXISTS `job_batches`;
CREATE TABLE `job_batches` (
  `id` varchar(255) NOT NULL,
  `name` varchar(255) NOT NULL,
  `total_jobs` int(11) NOT NULL,
  `pending_jobs` int(11) NOT NULL,
  `failed_jobs` int(11) NOT NULL,
  `failed_job_ids` longtext NOT NULL,
  `options` mediumtext DEFAULT NULL,
  `cancelled_at` int(11) DEFAULT NULL,
  `created_at` int(11) NOT NULL,
  `finished_at` int(11) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `layout_templates`
--

DROP TABLE IF EXISTS `layout_templates`;
CREATE TABLE `layout_templates` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `name` varchar(255) NOT NULL,
  `slug` varchar(255) NOT NULL,
  `description` text DEFAULT NULL,
  `html_content` longtext NOT NULL,
  `css_content` longtext DEFAULT NULL,
  `js_content` longtext DEFAULT NULL,
  `variables` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`variables`)),
  `category` varchar(255) NOT NULL DEFAULT 'general',
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `is_default` tinyint(1) NOT NULL DEFAULT 0,
  `order` int(11) NOT NULL DEFAULT 0,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `layout_templates`
--

INSERT INTO `layout_templates` (`id`, `name`, `slug`, `description`, `html_content`, `css_content`, `js_content`, `variables`, `category`, `is_active`, `is_default`, `order`, `created_at`, `updated_at`) VALUES
(1, 'Modern Profile Layout', 'modern-profile', 'A modern, animated profile layout with sidebar and main content area', '\n                <div class=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50\">\n                    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n                        <div class=\"flex flex-col lg:flex-row gap-8\">\n                            <!-- Sidebar -->\n                            <div class=\"lg:w-64 flex-shrink-0\">\n                                <div class=\"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-6\">\n                                    <div class=\"text-center mb-6\">\n                                        <div class=\"relative inline-block\">\n                                            <div class=\"w-20 h-20 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white text-2xl font-bold shadow-lg\">\n                                                {{user_initial}}\n                                            </div>\n                                            <div class=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full border-2 border-white\"></div>\n                                        </div>\n                                        <h3 class=\"mt-4 text-lg font-semibold text-gray-900\">{{user_name}}</h3>\n                                        <p class=\"text-sm text-gray-600\">{{user_email}}</p>\n                                    </div>\n                                    \n                                    <nav class=\"space-y-2\">\n                                        <a href=\"/profile\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-blue-50 transition-colors\">\n                                            <svg class=\"w-5 h-5 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/>\n                                            </svg>\n                                            Profile\n                                        </a>\n                                        <a href=\"/profile/favorites\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-red-50 transition-colors\">\n                                            <svg class=\"w-5 h-5 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/>\n                                            </svg>\n                                            Favorites\n                                            <span class=\"ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full\">{{favorites_count}}</span>\n                                        </a>\n                                        <a href=\"/profile/completed\" class=\"flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-green-50 transition-colors\">\n                                            <svg class=\"w-5 h-5 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/>\n                                            </svg>\n                                            Completed\n                                            <span class=\"ml-auto bg-green-500 text-white text-xs px-2 py-1 rounded-full\">{{completed_count}}</span>\n                                        </a>\n                                    </nav>\n                                </div>\n                            </div>\n\n                            <!-- Main Content -->\n                            <div class=\"flex-1\">\n                                <div class=\"bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 p-8\">\n                                    {{content}}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ', '\n                .animate-fade-in {\n                    animation: fadeIn 0.6s ease-in-out;\n                }\n                \n                @keyframes fadeIn {\n                    from { opacity: 0; transform: translateY(20px); }\n                    to { opacity: 1; transform: translateY(0); }\n                }\n                \n                .hover-lift {\n                    transition: transform 0.2s ease-in-out;\n                }\n                \n                .hover-lift:hover {\n                    transform: translateY(-2px);\n                }\n            ', '\n                // Add some interactive animations\n                document.addEventListener(\"DOMContentLoaded\", function() {\n                    const cards = document.querySelectorAll(\".bg-white\");\n                    cards.forEach((card, index) => {\n                        card.style.animationDelay = `${index * 0.1}s`;\n                        card.classList.add(\"animate-fade-in\");\n                    });\n                });\n            ', '{\"user_name\":\"John Doe\",\"user_email\":\"john@example.com\",\"user_initial\":\"J\",\"favorites_count\":\"4\",\"completed_count\":\"12\",\"content\":\"<h1 class=\\\"text-3xl font-bold text-gray-900 mb-6\\\">Welcome to your profile!<\\/h1><p class=\\\"text-gray-600\\\">This is a sample template that can be customized through the admin panel.<\\/p>\"}', 'profile', 1, 1, 1, '2025-09-19 18:28:50', '2025-09-19 18:28:50'),
(2, 'Clean Admin Layout', 'clean-admin', 'A clean, professional admin layout', '\n                <div class=\"min-h-screen bg-gray-100\">\n                    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n                        <div class=\"bg-white shadow rounded-lg\">\n                            <div class=\"px-6 py-4 border-b border-gray-200\">\n                                <h1 class=\"text-2xl font-semibold text-gray-900\">{{page_title}}</h1>\n                                <p class=\"text-gray-600\">{{page_description}}</p>\n                            </div>\n                            <div class=\"p-6\">\n                                {{content}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ', '\n                .admin-card {\n                    transition: box-shadow 0.2s ease-in-out;\n                }\n                \n                .admin-card:hover {\n                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n                }\n            ', '', '{\"page_title\":\"Admin Dashboard\",\"page_description\":\"Manage your application\",\"content\":\"<p>Admin content goes here<\\/p>\"}', 'admin', 1, 1, 1, '2025-09-19 18:28:50', '2025-09-19 18:28:50'),
(3, 'Hero Landing Page', 'hero-landing', 'A modern hero-style landing page template', '\n                <div class=\"min-h-screen bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800\">\n                    <div class=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16\">\n                        <div class=\"text-center\">\n                            <h1 class=\"text-4xl md:text-6xl font-bold text-white mb-6\">\n                                {{hero_title}}\n                            </h1>\n                            <p class=\"text-xl text-blue-100 mb-8 max-w-3xl mx-auto\">\n                                {{hero_subtitle}}\n                            </p>\n                            <div class=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                                <a href=\"{{cta_primary_link}}\" class=\"bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors\">\n                                    {{cta_primary_text}}\n                                </a>\n                                <a href=\"{{cta_secondary_link}}\" class=\"border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition-colors\">\n                                    {{cta_secondary_text}}\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            ', '\n                .hero-animation {\n                    animation: heroFadeIn 1s ease-out;\n                }\n                \n                @keyframes heroFadeIn {\n                    from { opacity: 0; transform: translateY(30px); }\n                    to { opacity: 1; transform: translateY(0); }\n                }\n            ', '\n                document.addEventListener(\"DOMContentLoaded\", function() {\n                    const hero = document.querySelector(\".text-center\");\n                    hero.classList.add(\"hero-animation\");\n                });\n            ', '{\"hero_title\":\"Welcome to Our Platform\",\"hero_subtitle\":\"Discover amazing features and start your journey with us today.\",\"cta_primary_text\":\"Get Started\",\"cta_primary_link\":\"\\/register\",\"cta_secondary_text\":\"Learn More\",\"cta_secondary_link\":\"\\/about\"}', 'landing', 1, 1, 1, '2025-09-19 18:28:50', '2025-09-19 18:28:50'),
(9, 'Standard General Page', 'standard-general-page', 'A versatile, clean template for general content pages like \'About Us\' or \'Contact\'. Includes a responsive header, main content area, and footer.', '<div class=\"bg-gray-50 min-h-screen font-sans text-gray-800\">\n  <header class=\"bg-white shadow-md sticky top-0 z-50\">\n    <div class=\"container mx-auto px-4 sm:px-6 lg:px-8\">\n      <div class=\"flex items-center justify-between h-20\">\n        <div class=\"flex-shrink-0\">\n          <a href=\"/\" class=\"flex items-center space-x-2\">\n            <img class=\"h-10 w-auto\" src=\"{{logo_url}}\" alt=\"{{site_name}} Logo\">\n            <span class=\"text-xl font-bold text-gray-900\">{{site_name}}</span>\n          </a>\n        </div>\n        <nav class=\"hidden md:flex space-x-8\">\n          {{nav_items}}\n        </nav>\n        <div class=\"md:hidden flex items-center\">\n          <button id=\"mobile-menu-button\" class=\"inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500\" aria-expanded=\"false\">\n            <span class=\"sr-only\">Open main menu</span>\n            <svg id=\"menu-closed-icon\" class=\"block h-6 w-6\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\"></path>\n            </svg>\n            <svg id=\"menu-open-icon\" class=\"hidden h-6 w-6\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" aria-hidden=\"true\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n    </div>\n    <div id=\"mobile-menu\" class=\"hidden md:hidden\">\n      <div class=\"px-2 pt-2 pb-3 space-y-1 sm:px-3\">\n        {{nav_items}}\n      </div>\n    </div>\n  </header>\n\n  <main class=\"animate-fade-in\">\n    <div class=\"bg-gradient-to-r from-indigo-500 to-purple-600\">\n      <div class=\"container mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center\">\n        <h1 class=\"text-4xl md:text-5xl font-extrabold text-white tracking-tight\">{{page_title}}</h1>\n        <div class=\"mt-4 text-indigo-200\">{{breadcrumbs}}</div>\n      </div>\n    </div>\n    <div class=\"container mx-auto px-4 sm:px-6 lg:px-8 py-12\">\n      <div class=\"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-lg\">\n        {{content}}\n      </div>\n    </div>\n  </main>\n\n  <footer class=\"bg-gray-800 text-white mt-12\">\n    <div class=\"container mx-auto px-4 sm:px-6 lg:px-8 py-10\">\n      <div class=\"grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left\">\n        <div>\n          <h3 class=\"text-lg font-semibold mb-3\">{{site_name}}</h3>\n          <div class=\"text-gray-400\">{{footer_content}}</div>\n        </div>\n        <div>\n          <h3 class=\"text-lg font-semibold mb-3\">Quick Links</h3>\n          <ul class=\"space-y-2 text-gray-400\">\n            {{nav_items}}\n          </ul>\n        </div>\n        <div>\n          <h3 class=\"text-lg font-semibold mb-3\">Contact Us</h3>\n          <p class=\"text-gray-400\">{{contact_address}}</p>\n          <p class=\"text-gray-400\">{{contact_email}}</p>\n        </div>\n      </div>\n      <div class=\"mt-8 border-t border-gray-700 pt-6 text-center text-gray-500 text-sm\">\n        <p>&copy; {{current_year}} {{site_name}}. All Rights Reserved.</p>\n      </div>\n    </div>\n  </footer>\n</div>', '@keyframes fadeIn {\r\n  from { opacity: 0; transform: translateY(15px); }\r\n  to { opacity: 1; transform: translateY(0); }\r\n}\r\n\r\n.animate-fade-in {\r\n  animation: fadeIn 0.7s ease-out forwards;\r\n}\r\n\r\n/* Styling for nav items in different contexts */\r\nheader .desktop-nav a, #mobile-menu .mobile-nav a, footer ul a {\r\n  transition: color 0.2s ease-in-out;\r\n}\r\nheader .desktop-nav a:hover, footer ul a:hover {\r\n  color: #6366f1; /* indigo-500 */\r\n}\r\n#mobile-menu .mobile-nav a {\r\n  display: block;\r\n  padding: 0.75rem 1rem;\r\n  border-radius: 0.375rem;\r\n}\r\n#mobile-menu .mobile-nav a:hover {\r\n  background-color: #4f46e5; /* indigo-600 */\r\n  color: white;\r\n}\r\nfooter ul a {\r\n   display: inline-block;\r\n}', 'document.addEventListener(\'DOMContentLoaded\', function () {\r\n  const mobileMenuButton = document.getElementById(\'mobile-menu-button\');\r\n  const mobileMenu = document.getElementById(\'mobile-menu\');\r\n  const menuClosedIcon = document.getElementById(\'menu-closed-icon\');\r\n  const menuOpenIcon = document.getElementById(\'menu-open-icon\');\r\n\r\n  if (mobileMenuButton) {\r\n    mobileMenuButton.addEventListener(\'click\', function () {\r\n      const isExpanded = mobileMenuButton.getAttribute(\'aria-expanded\') === \'true\';\r\n      mobileMenuButton.setAttribute(\'aria-expanded\', !isExpanded);\r\n      mobileMenu.classList.toggle(\'hidden\');\r\n      menuClosedIcon.classList.toggle(\'hidden\');\r\n      menuOpenIcon.classList.toggle(\'hidden\');\r\n    });\r\n  }\r\n});', '{\"site_url\":\"http:\\/\\/127.0.0.1:8000\",\"site_name\":\"MyWebsite\",\"page_title\":\"About Our Company\",\"user_name\":\"John Doe\",\"content\":\"<h2 class=\\\"text-3xl font-bold text-gray-900 mb-4\\\">Our Mission<\\/h2><p class=\\\"text-gray-600 mb-6\\\">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.<\\/p><h2 class=\\\"text-3xl font-bold text-gray-900 mb-4\\\">Our Team<\\/h2><p class=\\\"text-gray-600\\\">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<\\/p>\",\"sidebar_content\":\"<nav class=\\\"sample-sidebar\\\">\\n                <ul>\\n                    <li><a href=\\\"#\\\">Dashboard<\\/a><\\/li>\\n                    <li><a href=\\\"#\\\">Users<\\/a><\\/li>\\n                    <li><a href=\\\"#\\\">Settings<\\/a><\\/li>\\n                <\\/ul>\\n            <\\/nav>\",\"footer_content\":\"Providing quality solutions and services to our clients worldwide.\",\"header_content\":\"<h1>Sample Header<\\/h1>\",\"logo_url\":\"https:\\/\\/tailwindui.com\\/img\\/logos\\/workflow-logo-indigo-600-mark-gray-800-text.svg\",\"nav_items\":\"<div class=\\\"desktop-nav flex space-x-8\\\">  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Home<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">About<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Services<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Contact<\\/a><\\/div><div class=\\\"mobile-nav md:hidden\\\">  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Home<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">About<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Services<\\/a>  <a href=\\\"#\\\" class=\\\"font-medium text-gray-500 hover:text-gray-900\\\">Contact<\\/a><\\/div>\",\"breadcrumbs\":\"<a href=\\\"\\/\\\" class=\\\"hover:underline\\\">Home<\\/a> \\u00bb <span>About Us<\\/span>\",\"current_year\":\"2025\",\"contact_address\":\"123 Main Street, Anytown, USA\",\"contact_email\":\"contact@mywebsite.com\"}', 'general', 1, 0, 1, '2025-09-19 20:24:16', '2025-09-19 20:41:11');

-- --------------------------------------------------------

--
-- Table structure for table `menu_items`
--

DROP TABLE IF EXISTS `menu_items`;
CREATE TABLE `menu_items` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `title` varchar(255) NOT NULL,
  `url` varchar(255) NOT NULL,
  `icon` varchar(255) DEFAULT NULL,
  `order` int(11) NOT NULL DEFAULT 0,
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `opens_in_new_tab` tinyint(1) NOT NULL DEFAULT 0,
  `permission` varchar(255) NOT NULL DEFAULT 'public',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `menu_items`
--

INSERT INTO `menu_items` (`id`, `title`, `url`, `icon`, `order`, `is_active`, `opens_in_new_tab`, `permission`, `created_at`, `updated_at`) VALUES
(1, 'Home', '/', 'home', 1, 1, 0, 'public', '2025-09-19 09:41:33', '2025-09-19 09:41:33'),
(2, 'Topics', '/topics', 'book', 2, 1, 0, 'public', '2025-09-19 09:41:33', '2025-09-19 09:41:33'),
(5, 'Admin', '/admin', 'settings', 6, 1, 1, 'admin', '2025-09-19 15:38:16', '2025-09-19 15:38:16'),
(6, 'Templates', '/admin/templates', NULL, 6, 0, 0, 'admin', '2025-09-19 18:30:13', '2025-09-19 21:05:22'),
(7, 'Assign Templates', '/admin/templates/assign', NULL, 7, 0, 0, 'admin', '2025-09-19 18:30:17', '2025-09-19 21:05:16');

-- --------------------------------------------------------

--
-- Table structure for table `migrations`
--

DROP TABLE IF EXISTS `migrations`;
CREATE TABLE `migrations` (
  `id` int(10) UNSIGNED NOT NULL,
  `migration` varchar(255) NOT NULL,
  `batch` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `migrations`
--

INSERT INTO `migrations` (`id`, `migration`, `batch`) VALUES
(1, '0001_01_01_000000_create_users_table', 1),
(2, '0001_01_01_000001_create_cache_table', 1),
(3, '0001_01_01_000002_create_jobs_table', 1),
(4, '2025_09_18_153209_add_role_fields_to_users_table', 2),
(5, '2025_09_18_153212_create_templates_table', 2),
(6, '2025_09_18_153219_create_topics_table', 2),
(7, '2025_09_18_153224_create_activity_logs_table', 2),
(8, '2025_09_18_221632_create_categories_table', 3),
(9, '2025_09_18_221645_add_category_id_to_topics_table', 3),
(10, '2025_09_18_235441_create_auth_settings_table', 4),
(11, '2025_09_18_235459_add_social_auth_columns_to_users_table', 4),
(12, '2025_09_19_030012_create_page_contents_table', 5),
(13, '2025_09_19_030629_add_description_to_categories_table', 6),
(14, '2025_09_19_031824_create_settings_table', 7),
(15, '2025_09_19_043107_create_user_favorites_table', 8),
(16, '2025_09_19_043108_create_user_completed_table', 8),
(18, '2025_09_19_123955_create_menu_items_table', 9),
(19, '2025_09_19_183447_add_permission_to_menu_items_table', 10),
(20, '2025_09_19_191340_add_mobile_number_to_users_table', 11),
(21, '2025_09_19_205922_create_layout_templates_table', 12),
(22, '2025_09_20_011029_create_navigation_sections_table', 13),
(23, '2025_09_20_012314_create_navigation_sections_table', 14),
(24, '2025_09_20_033832_create_navigation_menu_items_table', 15),
(25, '2025_09_20_034303_update_navigation_menu_items_icon_field', 16),
(26, '2025_09_20_034619_create_navigation_header_buttons_table', 17),
(27, '2025_09_20_040845_add_permissions_to_navigation_tables', 18),
(28, '2025_09_20_042100_add_description_to_page_contents_table', 19);

-- --------------------------------------------------------

--
-- Table structure for table `navigation_header_buttons`
--

DROP TABLE IF EXISTS `navigation_header_buttons`;
CREATE TABLE `navigation_header_buttons` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `title` varchar(255) NOT NULL,
  `icon` text DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL,
  `route_name` varchar(255) DEFAULT NULL,
  `type` varchar(255) NOT NULL DEFAULT 'button',
  `dropdown_items` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`dropdown_items`)),
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `sort_order` int(11) NOT NULL DEFAULT 0,
  `target` varchar(255) NOT NULL DEFAULT '_self',
  `css_class` varchar(255) DEFAULT NULL,
  `permission` varchar(255) NOT NULL DEFAULT 'public',
  `badge_text` varchar(255) DEFAULT NULL,
  `badge_color` varchar(255) NOT NULL DEFAULT 'red',
  `show_badge` tinyint(1) NOT NULL DEFAULT 0,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `navigation_header_buttons`
--

INSERT INTO `navigation_header_buttons` (`id`, `title`, `icon`, `url`, `route_name`, `type`, `dropdown_items`, `is_active`, `sort_order`, `target`, `css_class`, `permission`, `badge_text`, `badge_color`, `show_badge`, `created_at`, `updated_at`) VALUES
(1, 'Notificationsss', '<svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 17h5l-5-5-5 5h5zm0 0v1a3 3 0 01-6 0v-1m6 0V9a3 3 0 00-6 0v8\"/></svg>', '/admin', NULL, 'button', NULL, 1, 1, '_self', NULL, 'public', NULL, 'red', 1, '2025-09-20 00:49:30', '2025-09-20 00:59:59'),
(2, 'Settings', '<svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/></svg>', NULL, 'profile.edit', 'button', NULL, 1, 2, '_self', NULL, 'public', NULL, 'red', 0, '2025-09-20 00:49:30', '2025-09-20 00:49:30');

-- --------------------------------------------------------

--
-- Table structure for table `navigation_menu_items`
--

DROP TABLE IF EXISTS `navigation_menu_items`;
CREATE TABLE `navigation_menu_items` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `title` varchar(255) NOT NULL,
  `icon` text DEFAULT NULL,
  `url` varchar(255) DEFAULT NULL,
  `route_name` varchar(255) DEFAULT NULL,
  `type` varchar(255) NOT NULL DEFAULT 'link',
  `dropdown_items` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`dropdown_items`)),
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `sort_order` int(11) NOT NULL DEFAULT 0,
  `target` varchar(255) NOT NULL DEFAULT '_self',
  `css_class` varchar(255) DEFAULT NULL,
  `permission` varchar(255) NOT NULL DEFAULT 'public',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `navigation_menu_items`
--

INSERT INTO `navigation_menu_items` (`id`, `title`, `icon`, `url`, `route_name`, `type`, `dropdown_items`, `is_active`, `sort_order`, `target`, `css_class`, `permission`, `created_at`, `updated_at`) VALUES
(1, 'Topics', '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253\"/></svg>', NULL, 'topics.index', 'link', NULL, 1, 1, '_self', NULL, 'public', '2025-09-20 00:43:28', '2025-09-20 00:43:28'),
(2, 'Profile', '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"/></svg>', NULL, 'profile.edit', 'link', NULL, 1, 2, '_self', NULL, 'public', '2025-09-20 00:43:28', '2025-09-20 00:43:28'),
(3, 'Favorites', '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"/></svg>', NULL, 'profile.favorites', 'link', NULL, 1, 3, '_self', NULL, 'public', '2025-09-20 00:43:28', '2025-09-20 00:43:28'),
(4, 'Completed', '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"/></svg>', NULL, 'profile.completed', 'link', NULL, 1, 4, '_self', NULL, 'public', '2025-09-20 00:43:28', '2025-09-20 01:15:34'),
(5, 'Settingss', '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"/><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"/></svg>', NULL, 'profile.edit', 'link', NULL, 0, 5, '_self', NULL, 'public', '2025-09-20 00:43:28', '2025-09-20 01:08:53');

-- --------------------------------------------------------

--
-- Table structure for table `navigation_sections`
--

DROP TABLE IF EXISTS `navigation_sections`;
CREATE TABLE `navigation_sections` (
  `id` varchar(50) NOT NULL,
  `title` varchar(255) NOT NULL,
  `icon` varchar(255) NOT NULL,
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `sort_order` int(11) NOT NULL DEFAULT 0,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `navigation_sections`
--

INSERT INTO `navigation_sections` (`id`, `title`, `icon`, `is_active`, `sort_order`, `created_at`, `updated_at`) VALUES
('additional', 'Additional', '➕', 1, 14, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('additional-resources', 'Resources', '📚', 1, 15, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('aiChat', 'AI Chat', '🤖', 1, 22, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('answer-structure', 'Structure', '📝', 1, 18, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('cases', 'Cases', '📁', 1, 12, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('diagnosis', 'Diagnosis', '🔍', 1, 4, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('emergency', 'Emergency', '🚨', 1, 7, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('evidence', 'Evidence', '📄', 1, 20, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('flowchart', 'Flowchart', '📈', 1, 19, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('guidelines', 'Guidelines', '📖', 1, 21, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('investigations', 'Investigations', '🔬', 1, 6, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('management', 'Management', '⚙️', 1, 8, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('overview', 'Overview', '📋', 1, 2, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('pitfalls', 'Pitfalls', '⚠️', 1, 16, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('priorities', 'Priorities', '⭐', 1, 3, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('quality-metrics', 'Quality', '📊', 1, 10, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('quick-reference', 'Quick Ref', '⚡', 1, 5, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('safety-leadership', 'Safety', '🛡️', 1, 11, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('teaching-points', 'Teaching', '🎓', 1, 17, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('topic-blocks', 'Topic Blocks', '🧩', 1, 9, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('topic-header', 'Top', '🏠', 1, 1, '2025-09-20 09:46:45', '2025-09-20 09:46:45'),
('viva', 'Viva', '💬', 1, 13, '2025-09-20 09:46:45', '2025-09-20 09:46:45');

-- --------------------------------------------------------

--
-- Table structure for table `page_contents`
--

DROP TABLE IF EXISTS `page_contents`;
CREATE TABLE `page_contents` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `key` varchar(255) NOT NULL,
  `value` text NOT NULL,
  `type` varchar(255) NOT NULL DEFAULT 'text',
  `group` varchar(255) NOT NULL DEFAULT 'general',
  `description` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `page_contents`
--

INSERT INTO `page_contents` (`id`, `key`, `value`, `type`, `group`, `description`, `created_at`, `updated_at`) VALUES
(1, 'site_name', 'Nephro.App', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(2, 'site_tagline', 'Expert Medical Training Platform', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(3, 'footer_text', '© 2024 NephroApp. All rights reserved.', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(4, 'about_text', 'NephroCoach provides comprehensive medical training scenarios for nephrology professionals. Our expert-crafted content helps you master complex clinical situations.', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(5, 'hero_title', 'Master Clinical Nephrology with Expert-Crafted Scenarios', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(6, 'hero_subtitle', 'Real-world nephrology cases with interactive scenarios designed by  experts. Perfect your clinical reasoning and diagnostic skills.', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-20 00:07:04'),
(7, 'hero_cta_primary', 'Get Started', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(8, 'hero_cta_secondary', 'View Topics', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(9, 'contact_email', 'habohassan88@gmail.com', 'text', 'general', NULL, '2025-09-19 00:08:20', '2025-09-19 00:08:20'),
(10, 'topics_search_placeholder', 'Search topics, categories...', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(11, 'topics_search_filter_placeholder', 'Search by title, content...', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(12, 'topics_total_label', 'Total Topics', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(13, 'topics_categories_label', 'Categories', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(14, 'topics_success_rate_label', 'Success Rate', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(15, 'topics_support_label', 'Support', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(16, 'topics_library_title', 'Topic Library', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(17, 'topics_library_description', 'Explore and filter through our comprehensive collection of nephrology topics', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(18, 'topics_search_label', 'Search Topics', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(19, 'topics_category_label', 'Category', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(20, 'topics_all_categories_option', 'All Categories', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(21, 'topics_date_range_label', 'Date Range', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(22, 'topics_all_time_option', 'All Time', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(23, 'topics_today_option', 'Today', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(24, 'topics_this_week_option', 'This Week', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(25, 'topics_this_month_option', 'This Month', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(26, 'topics_this_year_option', 'This Year', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(27, 'topics_sort_by_label', 'Sort By', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(28, 'topics_newest_first_option', 'Newest First', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(29, 'topics_oldest_first_option', 'Oldest First', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(30, 'topics_alphabetical_option', 'Alphabetical', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(31, 'topics_most_popular_option', 'Most Popular', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(32, 'topics_no_results_title', 'No topics found', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(33, 'topics_no_results_description', 'Get started by creating your first topic.', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(34, 'welcome_title', 'Let\'s get started', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(35, 'welcome_description', 'Laravel has an incredibly rich ecosystem. We suggest starting with the following.', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(36, 'welcome_documentation_link', 'Documentation', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(37, 'welcome_laracasts_link', 'Laracasts', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(38, 'welcome_deploy_button', 'Deploy now', 'text', 'general', NULL, '2025-09-20 00:07:04', '2025-09-20 00:07:04'),
(39, 'landing_page_html', '<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>NephroMap - Ace Your Oral Exam</title>\r\n    <script src=\"https://cdn.tailwindcss.com\"></script>\r\n    <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\r\n    <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\r\n    <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\" rel=\"stylesheet\">\r\n    <style>\r\n        body {\r\n            font-family: \'Inter\', sans-serif;\r\n            scroll-behavior: smooth;\r\n        }\r\n        \r\n        .hero-bg {\r\n            background: linear-gradient(-45deg, #1e1b4b, #4c1d95, #4f46e5, #be185d);\r\n            background-size: 400% 400%;\r\n            animation: gradient-animation 15s ease infinite;\r\n            position: relative;\r\n            overflow: hidden;\r\n        }\r\n\r\n        /* Aurora effect for hero background */\r\n        .hero-bg::before,\r\n        .hero-bg::after {\r\n            content: \'\';\r\n            position: absolute;\r\n            width: 600px;\r\n            height: 600px;\r\n            background-image: radial-gradient(circle, rgba(192, 132, 252, 0.3) 0%, transparent 70%);\r\n            border-radius: 50%;\r\n            filter: blur(100px);\r\n            z-index: 0;\r\n        }\r\n\r\n        .hero-bg::before {\r\n            top: -200px;\r\n            left: -200px;\r\n            animation: aurora-one 20s infinite alternate;\r\n        }\r\n\r\n        .hero-bg::after {\r\n            bottom: -200px;\r\n            right: -200px;\r\n            animation: aurora-two 20s infinite alternate-reverse;\r\n        }\r\n\r\n        @keyframes aurora-one {\r\n            from { transform: translateX(-100px) translateY(50px) scale(0.8); }\r\n            to { transform: translateX(100px) translateY(-50px) scale(1.2); }\r\n        }\r\n\r\n        @keyframes aurora-two {\r\n            from { transform: translateX(50px) translateY(-80px) scale(0.8); }\r\n            to { transform: translateX(-50px) translateY(80px) scale(1.2); }\r\n        }\r\n\r\n        @keyframes gradient-animation {\r\n            0% { background-position: 0% 50%; }\r\n            50% { background-position: 100% 50%; }\r\n            100% { background-position: 0% 50%; }\r\n        }\r\n\r\n        .glass-card {\r\n            background: rgba(15, 23, 42, 0.3);\r\n            backdrop-filter: blur(12px);\r\n            -webkit-backdrop-filter: blur(12px);\r\n            border: 1px solid rgba(255, 255, 255, 0.1);\r\n            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);\r\n        }\r\n\r\n        .cta-pulse {\r\n            animation: pulse 2s infinite;\r\n        }\r\n\r\n        @keyframes pulse {\r\n            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(217, 70, 239, 0.7); }\r\n            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(217, 70, 239, 0); }\r\n            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(217, 70, 239, 0); }\r\n        }\r\n        \r\n        .animate-on-scroll {\r\n            opacity: 0;\r\n            transition: opacity 0.8s ease-out, transform 0.8s ease-out;\r\n            transform: translateY(20px);\r\n        }\r\n        \r\n        .animate-on-scroll.visible {\r\n            opacity: 1;\r\n            transform: translateY(0);\r\n        }\r\n        \r\n        /* Typing animation styles */\r\n        .blinking-cursor::after {\r\n            content: \'_\';\r\n            font-weight: 700;\r\n            display: inline-block;\r\n            animation: blink 0.7s infinite;\r\n            position: relative;\r\n            top: -5px;\r\n            left: 5px;\r\n        }\r\n\r\n        @keyframes blink {\r\n            0%, 100% { opacity: 1; }\r\n            50% { opacity: 0; }\r\n        }\r\n        \r\n        #hero-title-container {\r\n            min-height: 150px; /* Prevents layout shift during typing */\r\n        }\r\n        \r\n        @media (min-width: 768px) {\r\n            #hero-title-container {\r\n                min-height: 200px;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body class=\"antialiased bg-slate-950 text-slate-200\">\r\n\r\n    <!-- Header -->\r\n    <header class=\"bg-slate-900/60 backdrop-blur-sm sticky top-0 z-50 border-b border-white/10\">\r\n        <div class=\"container mx-auto px-6 py-4 flex justify-between items-center\">\r\n            <a href=\"#\" class=\"flex items-center gap-3 text-white\">\r\n                <svg class=\"h-8 w-8 text-indigo-400\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke-width=\"1.5\" stroke=\"currentColor\">\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 4.5c-3.866 0-7 3.134-7 7 0 1.933.784 3.683 2.05 4.95a5.99 5.99 0 00-.413 2.321V21a.75.75 0 00.75.75h.75c.621 0 1.222-.22 1.684-.613.462-.393.84-.863 1.13-1.392a11.19 11.19 0 004.98-.012c.29.53.668 1 1.13 1.392.462.393 1.063.613 1.684.613h.75a.75.75 0 00.75-.75v-2.229c0-.859-.148-1.686-.413-2.471A6.974 6.974 0 0019 11.5c0-3.866-3.134-7-7-7z\" />\r\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 9v6m3-3H9\" />\r\n                </svg>\r\n                <span class=\"text-2xl font-bold\">NephroMap</span>\r\n            </a>\r\n\r\n            <a href=\"{{ route(\'login\') }}\" class=\"bg-gradient-to-r from-indigo-500 to-fuchsia-500 text-white font-semibold py-2 px-6 rounded-lg hover:from-indigo-600 hover:to-fuchsia-600 transition-all duration-300 transform hover:scale-105 shadow-lg shadow-indigo-500/30\">\r\n                Login\r\n            </a>\r\n        </div>\r\n    </header>\r\n\r\n    <!-- Main Content -->\r\n    <main>\r\n        <!-- Hero Section -->\r\n        <section class=\"hero-bg py-24 md:py-32 text-white\">\r\n            <div class=\"container mx-auto px-6 text-center relative z-10\">\r\n                <div id=\"hero-title-container\">\r\n                    <h2 id=\"hero-title\" class=\"text-4xl md:text-6xl font-extrabold leading-tight tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400\">\r\n                        <!-- Text injected by JS -->\r\n                    </h2>\r\n                </div>\r\n                <p class=\"mt-6 text-lg md:text-xl text-slate-300 max-w-3xl mx-auto\">\r\n                    The fastest way to prepare for the SCHS consultant exam. Master high-yield scenarios with expert guidance.\r\n                </p>\r\n                <div class=\"mt-12\">\r\n                    <div class=\"glass-card p-8 rounded-2xl max-w-lg mx-auto\">\r\n                        <h3 class=\"text-3xl font-bold mb-4 text-white\">Start Training Now</h3>\r\n                        <p class=\"text-slate-300 mb-6\">Log in to unlock exclusive content and begin your path to success.</p>\r\n                        <a href=\"{{ route(\'login\') }}\" class=\"inline-block w-full bg-fuchsia-600 text-white font-bold py-4 px-8 rounded-lg text-lg hover:bg-fuchsia-500 transition-transform duration-300 transform hover:scale-105 cta-pulse shadow-lg shadow-fuchsia-500/40\">\r\n                            Log in to Start Studying\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n\r\n        <!-- Mentor Section -->\r\n        <section id=\"mentor\" class=\"py-24 bg-slate-950 relative overflow-hidden\">\r\n             <div class=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[60rem] h-[60rem] bg-indigo-500/20 rounded-full blur-3xl\" aria-hidden=\"true\"></div>\r\n            <div class=\"container mx-auto px-6 relative\">\r\n                <div class=\"max-w-4xl mx-auto flex flex-col md:flex-row items-center gap-8 md:gap-12 bg-slate-900/80 backdrop-blur-md rounded-2xl shadow-2xl shadow-black/30 p-8 border border-white/10 overflow-hidden\">\r\n                    <div class=\"flex-shrink-0 animate-on-scroll relative\">\r\n                         <div class=\"absolute -inset-2 rounded-full bg-gradient-to-br from-indigo-500 to-fuchsia-500 blur opacity-60\"></div>\r\n                        <img src=\"https://placehold.co/600x600/3B82F6/FFFFFF?text=Dr.+Hossam&font=sans\" alt=\"Dr. Hossam Abohassan\" class=\"relative w-48 h-48 md:w-56 md:h-56 rounded-full object-cover shadow-2xl border-4 border-slate-700\">\r\n                    </div>\r\n                    <div class=\"text-center md:text-left animate-on-scroll\" style=\"transition-delay: 200ms;\">\r\n                        <h2 class=\"text-3xl font-bold text-white\">Meet Your Mentor</h2>\r\n                        <p class=\"text-xl font-semibold text-indigo-400 mt-1\">Dr. Hossam Abohassan</p>\r\n                        <p class=\"mt-4 text-slate-300 leading-relaxed\">\r\n                            \"I designed this platform to give you the practical wisdom and insider knowledge that textbooks miss. My goal is to help you internalize the mindset of a confident consultant before exam day. Let\'s get you certified.\"\r\n                        </p>\r\n                        <div class=\"mt-6\">\r\n                             <a href=\"https://wa.me/966539873567\" target=\"_blank\" class=\"inline-flex items-center gap-2 text-md font-semibold text-emerald-400 hover:text-emerald-300 transition-colors\">\r\n                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5\" fill=\"currentColor\" viewBox=\"0 0 16 16\">\r\n                                  <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\r\n                                </svg>\r\n                                Contact on WhatsApp: +966 53 987 3567\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    </main>\r\n\r\n    <!-- Footer -->\r\n    <footer class=\"bg-slate-950 border-t border-white/10 py-10\">\r\n        <div class=\"container mx-auto px-6 text-center text-slate-500 text-sm\">\r\n            <p>&copy; 2024 NephroMap. All rights reserved.</p>\r\n            <p class=\"mt-2\">Designed for Saudi nephrologists determined to lead.</p>\r\n        </div>\r\n    </footer>\r\n\r\n    <script>\r\n        document.addEventListener(\'DOMContentLoaded\', () => {\r\n            const observer = new IntersectionObserver((entries) => {\r\n                entries.forEach(entry => {\r\n                    if (entry.isIntersecting) {\r\n                        entry.target.classList.add(\'visible\');\r\n                        observer.unobserve(entry.target);\r\n                    }\r\n                });\r\n            }, {\r\n                threshold: 0.1\r\n            });\r\n\r\n            const elementsToAnimate = document.querySelectorAll(\'.animate-on-scroll\');\r\n            elementsToAnimate.forEach(el => {\r\n                observer.observe(el);\r\n            });\r\n\r\n            // --- Continuous Typing Animation ---\r\n            const heroTitle = document.getElementById(\'hero-title\');\r\n            const phrases = [\r\n                \"Ace Your Nephrology Oral Exam\",\r\n                \"Master Clinical Scenarios\",\r\n                \"Conquer the SCHS Boards\"\r\n            ];\r\n            let phraseIndex = 0;\r\n            let charIndex = 0;\r\n            let isDeleting = false;\r\n\r\n            function typeLoop() {\r\n                heroTitle.classList.add(\'blinking-cursor\');\r\n                const currentPhrase = phrases[phraseIndex];\r\n\r\n                if (isDeleting) {\r\n                    // Deleting text\r\n                    heroTitle.textContent = currentPhrase.substring(0, charIndex - 1);\r\n                    charIndex--;\r\n                } else {\r\n                    // Typing text\r\n                    heroTitle.textContent = currentPhrase.substring(0, charIndex + 1);\r\n                    charIndex++;\r\n                }\r\n\r\n                let typingSpeed = isDeleting ? 60 : 120;\r\n\r\n                if (!isDeleting && charIndex === currentPhrase.length) {\r\n                    // Pause at end of phrase\r\n                    typingSpeed = 2000;\r\n                    isDeleting = true;\r\n                    heroTitle.classList.add(\'blinking-cursor\');\r\n                } else if (isDeleting && charIndex === 0) {\r\n                    // Move to next phrase\r\n                    isDeleting = false;\r\n                    phraseIndex = (phraseIndex + 1) % phrases.length;\r\n                    typingSpeed = 500;\r\n                }\r\n                \r\n                setTimeout(typeLoop, typingSpeed);\r\n            }\r\n\r\n            // Start the animation\r\n            setTimeout(typeLoop, 500);\r\n        });\r\n    </script>\r\n\r\n</body>\r\n</html>', 'html', 'pages', 'Full HTML content for the landing page', '2025-09-20 01:21:13', '2025-09-20 01:56:50');

-- --------------------------------------------------------

--
-- Table structure for table `password_reset_tokens`
--

DROP TABLE IF EXISTS `password_reset_tokens`;
CREATE TABLE `password_reset_tokens` (
  `email` varchar(255) NOT NULL,
  `token` varchar(255) NOT NULL,
  `created_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- --------------------------------------------------------

--
-- Table structure for table `sessions`
--

DROP TABLE IF EXISTS `sessions`;
CREATE TABLE `sessions` (
  `id` varchar(255) NOT NULL,
  `user_id` bigint(20) UNSIGNED DEFAULT NULL,
  `ip_address` varchar(45) DEFAULT NULL,
  `user_agent` text DEFAULT NULL,
  `payload` longtext NOT NULL,
  `last_activity` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `sessions`
--

INSERT INTO `sessions` (`id`, `user_id`, `ip_address`, `user_agent`, `payload`, `last_activity`) VALUES
('s0ni9obhhz1Z3bGiyi5CT0T0xG8YHSiHpS9zgPGP', NULL, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', 'YTo0OntzOjY6Il90b2tlbiI7czo0MDoiUHhMalNhVFNjd0duN1I5b3JLZG9xc29BZDZxYk8zSzZaVjlOeXhUOCI7czo5OiJfcHJldmlvdXMiO2E6MTp7czozOiJ1cmwiO3M6Mjc6Imh0dHA6Ly8xMjcuMC4wLjE6ODAwMC9sb2dpbiI7fXM6NjoiX2ZsYXNoIjthOjI6e3M6Mzoib2xkIjthOjA6e31zOjM6Im5ldyI7YTowOnt9fXM6MzoidXJsIjthOjE6e3M6ODoiaW50ZW5kZWQiO3M6NDQ6Imh0dHA6Ly8xMjcuMC4wLjE6ODAwMC9hZG1pbi90ZW1wbGF0ZXMvY3JlYXRlIjt9fQ==', 1758373131),
('yPtw7oqFyE1xSV63ppC7EkgXSJugpCTMZ9T4ETG7', 1, '127.0.0.1', 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36', 'YTo0OntzOjY6Il90b2tlbiI7czo0MDoia1FaR2NkYmsyMDU1UVRwd2Zhb0R2bElqaHFpQU9jeHFjQlVyazY3OCI7czo5OiJfcHJldmlvdXMiO2E6MTp7czozOiJ1cmwiO3M6NDY6Imh0dHA6Ly8xMjcuMC4wLjE6ODAwMC9hcGkvdXNlci90b3BpY3MvMi9zdGF0dXMiO31zOjY6Il9mbGFzaCI7YToyOntzOjM6Im9sZCI7YTowOnt9czozOiJuZXciO2E6MDp7fX1zOjUwOiJsb2dpbl93ZWJfNTliYTM2YWRkYzJiMmY5NDAxNTgwZjAxNGM3ZjU4ZWE0ZTMwOTg5ZCI7aToxO30=', 1758352830);

-- --------------------------------------------------------

--
-- Table structure for table `settings`
--

DROP TABLE IF EXISTS `settings`;
CREATE TABLE `settings` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `key` varchar(255) NOT NULL,
  `value` text NOT NULL,
  `type` varchar(255) NOT NULL DEFAULT 'text',
  `group` varchar(255) NOT NULL DEFAULT 'general',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `settings`
--

INSERT INTO `settings` (`id`, `key`, `value`, `type`, `group`, `created_at`, `updated_at`) VALUES
(1, 'app_name', 'NephroApp', 'text', 'general', '2025-09-19 00:22:09', '2025-09-19 00:22:09'),
(2, 'app_url', 'http://127.0.0.1:8000', 'text', 'general', '2025-09-19 00:22:09', '2025-09-19 15:55:14'),
(3, 'timezone', 'UTC', 'text', 'general', '2025-09-19 00:22:09', '2025-09-19 00:22:09'),
(4, 'locale', 'en', 'text', 'general', '2025-09-19 00:22:09', '2025-09-19 00:22:09'),
(5, 'google_client_id', '1020872479914-ps3bhckd02rh9p5vr2fq2lsnv9jek6a2.apps.googleusercontent.com', 'text', 'google_auth', '2025-09-19 15:48:34', '2025-09-19 15:48:34'),
(6, 'google_client_secret', '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', 'text', 'google_auth', '2025-09-19 15:48:34', '2025-09-19 15:48:34'),
(7, 'google_redirect_uri', 'http://127.0.0.1:8000/auth/google/callback', 'text', 'google_auth', '2025-09-19 15:48:34', '2025-09-19 15:52:04'),
(11, 'template_assignment', '{\"profile\\/favorites\":9}', 'text', 'general', '2025-09-19 20:22:11', '2025-09-19 20:28:31');

-- --------------------------------------------------------

--
-- Table structure for table `templates`
--

DROP TABLE IF EXISTS `templates`;
CREATE TABLE `templates` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `name` varchar(255) NOT NULL,
  `slug` varchar(255) NOT NULL,
  `view` varchar(255) NOT NULL DEFAULT 'topics.templates.viva',
  `description` varchar(255) DEFAULT NULL,
  `is_default` tinyint(1) NOT NULL DEFAULT 0,
  `meta` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`meta`)),
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `templates`
--

INSERT INTO `templates` (`id`, `name`, `slug`, `view`, `description`, `is_default`, `meta`, `created_at`, `updated_at`) VALUES
(1, 'Viva Default', 'viva-default', 'topics.templates.viva', 'Default renderer for viva cases imported from ChatGPT JSON.', 1, NULL, '2025-09-18 12:55:56', '2025-09-18 12:55:56');

-- --------------------------------------------------------

--
-- Table structure for table `topics`
--

DROP TABLE IF EXISTS `topics`;
CREATE TABLE `topics` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `template_id` bigint(20) UNSIGNED DEFAULT NULL,
  `category_id` bigint(20) UNSIGNED DEFAULT NULL,
  `created_by` bigint(20) UNSIGNED DEFAULT NULL,
  `updated_by` bigint(20) UNSIGNED DEFAULT NULL,
  `slug` varchar(255) NOT NULL,
  `title` varchar(255) NOT NULL,
  `subtitle` varchar(255) DEFAULT NULL,
  `status` varchar(32) NOT NULL DEFAULT 'draft',
  `summary` text DEFAULT NULL,
  `data` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NOT NULL CHECK (json_valid(`data`)),
  `meta` longtext CHARACTER SET utf8mb4 COLLATE utf8mb4_bin DEFAULT NULL CHECK (json_valid(`meta`)),
  `rendered_html` longtext DEFAULT NULL,
  `rendered_at` timestamp NULL DEFAULT NULL,
  `published_at` timestamp NULL DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `topics`
--

INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(1, NULL, 2, 1, 1, 'post-transplant-aki-rejection', 'Acute Allograft Dysfunction: Banff IIB Cellular Rejection', NULL, 'draft', 'A patient presenting with acute kidney injury (AKI) one week post-kidney transplantation requires a systematic and urgent evaluation. The differential diagnosis is broad, spanning vascular, immunological, drug-induced, and obstructive causes. A creatinine of 200 µmol/L in this context is a significant concern. While the patient is hemodynamically stable, prompt investigation is crucial to preserve graft function. The gold standard for diagnosis is an allograft biopsy. This case focuses on the management of a specific, severe form of T-cell mediated rejection: Banff Class IIB.', '{\"slug\":\"post-transplant-aki-rejection\",\"TOPIC\":\"Acute Allograft Dysfunction: Banff IIB Cellular Rejection\",\"CHIP_1\":\"Post-Transplant AKI\",\"CHIP_2\":\"Acute Cellular Rejection\",\"CHIP_3\":\"Banff IIB Management\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A patient presenting with acute kidney injury (AKI) one week post-kidney transplantation requires a systematic and urgent evaluation. The differential diagnosis is broad, spanning vascular, immunological, drug-induced, and obstructive causes. A creatinine of 200 \\u00b5mol\\/L in this context is a significant concern. While the patient is hemodynamically stable, prompt investigation is crucial to preserve graft function. The gold standard for diagnosis is an allograft biopsy. This case focuses on the management of a specific, severe form of T-cell mediated rejection: Banff Class IIB.\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u2705 Assess and secure airway, breathing, and circulation (ABCDE), even if initially stable.\",\"\\u2705 Establish dual large-bore intravenous access.\",\"\\u2705 Obtain a complete set of vital signs, including orthostatic measurements and temperature.\",\"\\ud83d\\udd0e Conduct a focused history: inquire about the transplant center, donor type (living\\/deceased), induction\\/maintenance immunosuppression, surgical complications, urine output, fever, local graft site symptoms (pain, swelling), and adherence to medications.\",\"\\ud83d\\udd0e Perform a thorough physical examination: assess volume status (JVP, edema, lung sounds), palpate the allograft for tenderness or swelling, and inspect the surgical wound.\",\"\\ud83e\\uddea Perform bedside urinalysis to check for proteinuria, hematuria, and signs of infection.\",\"\\ud83e\\uddea Send urgent laboratory investigations: complete blood count, urea and electrolytes, liver function tests, C-reactive protein, and coagulation profile.\",\"\\ud83d\\udc8a Send urgent trough levels of calcineurin inhibitors (Tacrolimus or Cyclosporine).\",\"\\ud83e\\uddea Send viral screening: BK virus and CMV PCR in blood.\",\"\\ud83d\\udd2c Arrange an urgent Doppler ultrasound of the renal allograft to assess graft perfusion, rule out renal artery or vein thrombosis, identify hydronephrosis, and exclude perinephric collections (hematoma, urinoma). A resistive index should be calculated.\",\"\\u26a0\\ufe0f Prepare for an urgent ultrasound-guided allograft biopsy as the definitive diagnostic step.\",\"\\ud83d\\udc8a Withhold any potentially nephrotoxic medications (e.g., NSAIDs, certain antibiotics) until a diagnosis is established.\",\"\\ud83d\\udcde Consult the primary transplant nephrology service immediately for guidance.\",\"\\ud83d\\udcdd Plan for admission to a specialized renal or transplant unit for further management.\"],\"ANSWER_STEPS_OL\":[\"\\\"This is a case of a patient presenting one week post-kidney transplantation from abroad with acute graft dysfunction, evidenced by a creatinine of 200 \\u00b5mol\\/L.\\\"\",\"\\\"First, I will perform a rapid ABCDE assessment to ensure the patient is hemodynamically stable. I will secure IV access and place the patient on continuous monitoring.\\\"\",\"\\\"Next, I will take a detailed history focusing on the transplant surgery, immunosuppressive regimen, medication adherence, and symptoms of rejection or infection. I will also perform a focused physical examination, paying close attention to the allograft site and the patient\'s volume status.\\\"\",\"\\\"My immediate investigations will include urgent blood tests for a full blood count, renal and liver profiles, CRP, calcineurin inhibitor trough levels, and PCR for BK virus and CMV.\\\"\",\"\\\"I will immediately request an urgent Doppler ultrasound of the allograft to rule out critical vascular complications such as renal artery stenosis or thrombosis, and to exclude obstruction or perinephric collections.\\\"\",\"\\\"The definitive investigation is an urgent allograft biopsy. The results here indicate Banff Class IIB acute cellular rejection, which is a moderate-to-severe T-cell mediated rejection involving significant tubulitis and potentially endarteritis.\\\"\",\"\\\"My management plan for Banff IIB rejection involves immediate initiation of high-dose corticosteroids. I will start with intravenous methylprednisolone, typically 500mg to 1g daily for 3 days.\\\"\",\"\\\"Given the severity of Banff IIB rejection, I will also initiate treatment with a T-cell depleting agent. My choice would be rabbit Anti-Thymocyte Globulin (ATG), administered at a dose of 1.5 mg\\/kg daily. The duration is typically 5 to 10 days, guided by the clinical response and monitoring of lymphocyte counts.\\\"\",\"\\\"Throughout treatment, I will monitor for side effects of immunosuppression, including cytokine release syndrome, leukopenia, thrombocytopenia, and opportunistic infections, for which I will provide appropriate prophylaxis (e.g., for Pneumocystis jirovecii).\\\"\",\"\\\"I will also ensure Donor-Specific Antibody (DSA) testing is performed using a Luminex-based assay to rule out a concurrent antibody-mediated component, which would require additional therapies such as plasmapheresis or IVIG.\\\"\"],\"DDX_BUCKET_1_TITLE\":\"Vascular & Perfusion Issues\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Renal artery thrombosis\",\"Renal vein thrombosis\",\"Transplant renal artery stenosis (TRAS)\",\"Severe hypovolemia \\/ Pre-renal azotemia\",\"External compression of the graft (e.g., hematoma, lymphocele)\"],\"DDX_BUCKET_2_TITLE\":\"Parenchymal (Allograft) Injury\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Acute T-cell mediated rejection (ACR)\",\"Acute antibody-mediated rejection (AMR)\",\"Calcineurin inhibitor (CNI) toxicity\",\"BK virus-associated nephropathy (BKVN)\",\"Acute tubular necrosis (ATN) from ischemia-reperfusion injury\",\"Recurrence of primary kidney disease (e.g., FSGS, IgA nephropathy)\",\"Drug-induced acute interstitial nephritis (AIN)\",\"Thrombotic microangiopathy (TMA)\"],\"DDX_BUCKET_3_TITLE\":\"Urological & Post-Renal Issues\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Ureteral obstruction (e.g., clot, stricture, stone)\",\"Urine leak from ureteric anastomosis\",\"Bladder outlet obstruction\"],\"DIFFERENTIAL_FOCUS_HTML\":\"<div class=\'accordion\' id=\'ddxFocusAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOne\' aria-expanded=\'true\' aria-controls=\'collapseOne\'>ACR vs. AMR vs. CNI Toxicity vs. BKVN<\\/button><\\/h2><div id=\'collapseOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingOne\' data-bs-parent=\'#ddxFocusAccordion\'><div class=\'accordion-body\'><table class=\'table table-bordered\'><thead><tr><th>Feature<\\/th><th>Acute Cellular Rejection (ACR)<\\/th><th>Antibody-Mediated Rejection (AMR)<\\/th><th>CNI Toxicity<\\/th><th>BK Virus Nephropathy (BKVN)<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Pathophysiology<\\/b><\\/td><td>T-lymphocyte infiltration of tubules and interstitium.<\\/td><td>Donor-specific antibodies (DSA) causing endothelial injury.<\\/td><td>Afferent arteriolar vasoconstriction and direct tubular toxicity.<\\/td><td>Polyomavirus replication in tubular epithelial cells.<\\/td><\\/tr><tr><td><b>Key Biopsy Findings<\\/b><\\/td><td>Tubulitis (t-lesion), interstitial inflammation (i-lesion), endarteritis (v-lesion). C4d negative.<\\/td><td>Microvascular inflammation (glomerulitis, peritubular capillaritis), C4d deposition in peritubular capillaries, DSA positive.<\\/td><td>Isometric tubular vacuolization, arteriolar hyalinosis, thrombotic microangiopathy (in severe cases). Minimal inflammation.<\\/td><td>Intranuclear viral inclusion bodies, positive SV40 staining, interstitial inflammation.<\\/td><\\/tr><tr><td><b>Clinical Clues<\\/b><\\/td><td>Often occurs early post-transplant. May have fever, graft tenderness.<\\/td><td>Can occur anytime, higher risk in sensitized patients. Can be very aggressive.<\\/td><td>High CNI trough levels. Dose-dependent. Often a diagnosis of exclusion.<\\/td><td>Usually >1 month post-transplant. Often associated with over-immunosuppression. Screen with urine\\/serum PCR.<\\/td><\\/tr><tr><td><b>Treatment<\\/b><\\/td><td>Corticosteroids, Anti-thymocyte globulin (ATG) for severe cases.<\\/td><td>Plasmapheresis, IVIG, Rituximab, Bortezomib.<\\/td><td>Reduce CNI dose. Switch to another agent if necessary.<\\/td><td>Reduce overall immunosuppression. Agents like cidofovir or leflunomide are of unproven benefit.<\\/td><\\/tr><\\/tbody><\\/table><\\/div><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<b>Bedside:<\\/b> Urinalysis (dipstick and microscopy).\",\"<b>Bloods:<\\/b> FBC, U&E, LFT, CRP, Tacrolimus\\/Cyclosporine level, Bone profile, Glucose.\",\"<b>Immunology:<\\/b> Donor-Specific Antibodies (DSA) by Luminex single antigen bead assay.\",\"<b>Virology:<\\/b> BK Virus PCR (blood and urine), CMV PCR (blood).\",\"<b>Imaging:<\\/b> Urgent Doppler ultrasound of the renal allograft.\",\"<b>Definitive:<\\/b> Urgent ultrasound-guided allograft biopsy for light microscopy, immunofluorescence (including C4d), and electron microscopy.\"],\"PILLAR_1\":\"Treating Rejection\",\"STEP_1_TITLE\":\"Pulse Corticosteroid Therapy\",\"STEP_1_LI\":[\"\\ud83d\\udc8a Administer high-dose intravenous methylprednisolone.\",\"<b>Dose:<\\/b> Typically 500mg to 1g daily for 3 consecutive days.\",\"This is the first-line treatment for all significant cellular rejection.\"],\"STEP_2_TITLE\":\"T-Cell Depleting Therapy for Severe Rejection\",\"STEP_2_LI\":[\"\\u26a0\\ufe0f For Banff Grade IIB or higher, or steroid-resistant rejection, initiate lymphocyte-depleting antibody therapy.\",\"<b>Drug of Choice:<\\/b> Rabbit Anti-Thymocyte Globulin (Thymoglobulin\\u00ae).\",\"<b>Dose:<\\/b> 1.5 mg\\/kg\\/day intravenously. Dose is adjusted based on total lymphocyte or CD3+ cell count.\",\"<b>Duration:<\\/b> Typically 5-10 days, depending on clinical response and side effects.\",\"<b>Monitoring:<\\/b> Daily FBC. Monitor for cytokine release syndrome (fever, chills, hypotension) with the first doses and provide premedication (paracetamol, antihistamine, hydrocortisone).\"],\"PILLAR_2\":\"Supportive Care & Monitoring\",\"STEP_3_TITLE\":\"Infection Prophylaxis\",\"STEP_3_LI\":[\"\\u2705 Start prophylaxis against Pneumocystis jirovecii (PJP) with co-trimoxazole.\",\"\\u2705 Start prophylaxis against CMV (e.g., valganciclovir), especially during ATG therapy.\",\"\\u2705 Consider antifungal and oral candidiasis prophylaxis (e.g., nystatin).\"],\"STEP_4_TITLE\":\"Follow-up and Adjustment\",\"STEP_4_LI\":[\"\\ud83e\\uddea Monitor creatinine daily to assess response to therapy.\",\"\\ud83e\\uddea Monitor lymphocyte counts daily during ATG therapy to guide dosing.\",\"\\ud83d\\udd0e Adjust maintenance immunosuppression. Often, the baseline CNI and antiproliferative agent doses are maintained or cautiously increased after the acute phase.\",\"\\ud83d\\udd2c Consider a follow-up biopsy after 2-3 weeks if the response is suboptimal to assess for persistent rejection or concurrent AMR.\"],\"PHARMACOLOGY_TABLE_HTML\":\"<table class=\'table table-striped\'><thead><tr><th>Drug<\\/th><th>Mechanism<\\/th><th>Dose & Administration<\\/th><th>Key Monitoring \\/ Side Effects<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Methylprednisolone<\\/b><\\/td><td>Broad anti-inflammatory and immunosuppressive effects. Inhibits cytokine gene transcription.<\\/td><td>500mg - 1g IV daily for 3 days.<\\/td><td>Hyperglycemia, hypertension, fluid retention, mood changes, increased infection risk, avascular necrosis (long-term).<\\/td><\\/tr><tr><td><b>Anti-thymocyte Globulin (ATG, Rabbit)<\\/b><\\/td><td>Polyclonal antibody that depletes circulating T-lymphocytes by complement-dependent lysis and apoptosis.<\\/td><td>1.5 mg\\/kg IV daily for 5-10 days. Administer via a central line if possible. Pre-medicate with corticosteroids, antihistamines, and paracetamol.<\\/td><td><b>Monitoring:<\\/b> FBC (for leukopenia, thrombocytopenia), CD3+ lymphocyte counts. <br><b>Side Effects:<\\/b> Cytokine release syndrome, serum sickness, increased risk of infection (CMV, PJP) and PTLD.<\\/td><\\/tr><\\/tbody><\\/table>\",\"TOPIC_BLOCK_A_TITLE\":\"Banff Classification of T-Cell Mediated Rejection (Abbreviated)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<b>Grade I (A\\/B):<\\/b> Significant interstitial inflammation and tubulitis. IA: >25% inflammation (i2\\/3) and moderate tubulitis (t2). IB: >25% inflammation (i2\\/3) and severe tubulitis (t3).\",\"<b>Grade II (A\\/B):<\\/b> Intimal arteritis (endothelialitis). IIA: Mild-to-moderate arteritis (v1). IIB: Severe arteritis (v2).\",\"<b>Grade III:<\\/b> Transmural arteritis or arterial fibrinoid necrosis (v3).\",\"<b>Borderline:<\\/b> Foci of tubulitis (t1) and mild interstitial inflammation (i1) or vice versa. Does not meet criteria for full rejection.\"],\"TOPIC_BLOCK_B_TITLE\":\"Donor-Specific Antibody (DSA) Testing\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<b>Method:<\\/b> Luminex Single Antigen Bead (SAB) assay is the gold standard.\",\"<b>Principle:<\\/b> Patient\'s serum is incubated with microbeads, each coated with a single, specific HLA antigen.\",\"<b>Detection:<\\/b> If DSAs are present, they bind to the corresponding beads. A fluorescently-labeled secondary antibody detects this binding.\",\"<b>Result:<\\/b> The intensity of the fluorescence is measured as Mean Fluorescence Intensity (MFI). Higher MFI correlates with higher antibody strength.\",\"<b>Significance:<\\/b> Crucial to identify concurrent antibody-mediated rejection (AMR), which requires different treatment.\"],\"TOPIC_BLOCK_C_TITLE\":\"ATG Administration Pearls\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<b>Administration:<\\/b> Infuse over 4-6 hours. A central line is preferred to reduce risk of phlebitis.\",\"<b>Pre-medication:<\\/b> Essential for the first 1-2 doses to mitigate cytokine release syndrome. Typically includes IV hydrocortisone (e.g., 100mg), an antihistamine (e.g., chlorpheniramine), and an antipyretic (e.g., paracetamol).\",\"<b>Dose Adjustment:<\\/b> Daily dose is often adjusted based on lymphocyte count. Hold if WBC <span class=\'hl-symbol\'><<\\/span> 2.0x10\\u2079\\/L or Platelets <span class=\'hl-symbol\'><<\\/span> 50x10\\u2079\\/L. Resume at 50% dose when counts recover.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-header\'>Post-Transplant AKI Workup<\\/div><div class=\'card-body\'><p><b>\'PRUNES\' Mnemonic for DDx:<\\/b><\\/p><ul><li><b>P<\\/b>erfusion (Thrombosis, Stenosis, Hypotension)<\\/li><li><b>R<\\/b>ejection (ACR\\/AMR)<\\/li><li><b>U<\\/b>rology (Obstruction, Leak)<\\/li><li><b>N<\\/b>ephrotoxicity (CNI, Drugs) \\/ BKV<b>N<\\/b><\\/li><li><b>E<\\/b>tiology (Recurrent\\/De Novo Disease)<\\/li><li><b>S<\\/b>epsis<\\/li><\\/ul><\\/div><\\/div>\",\"EMERGENCY_ALGORITHM_HTML\":\"<div><h4>Management of Severe (Banff IIB) ACR<\\/h4><ol><li>Confirm diagnosis with biopsy.<\\/li><li>Rule out concurrent AMR with DSA\\/C4d staining.<\\/li><li>Administer IV Methylprednisolone Pulse (500mg-1g x 3 days).<\\/li><li>Initiate Anti-Thymocyte Globulin (ATG) at 1.5 mg\\/kg\\/day.<\\/li><li>Provide PJP and antiviral prophylaxis.<\\/li><li>Monitor FBC and lymphocyte counts daily.<\\/li><li>Adjust ATG dose based on counts.<\\/li><li>Monitor creatinine for response. If no improvement, re-evaluate for steroid resistance or mixed rejection.<\\/li><\\/ol><\\/div>\",\"ASCII_FLOWCHART_PRE\":\"Patient 1 week post-KTX, Creatinine 200\\n          |\\n      [Stable? -> Yes]\\n          |\\n  [Urgent Doppler US]\\n          |            |\\n[No Vascular Issue]  [Vascular Issue -> Interventional Radiology\\/Surgery]\\n          |\\n  [Urgent Allograft Biopsy]\\n          |            \\n [Banff IIB ACR Found]\\n          |\\n  [Start IV Methylprednisolone Pulse]\\n          |\\n  [Start Anti-Thymocyte Globulin (ATG)]\\n          |\\n  [Monitor Daily: Creatinine, FBC, Lymphocytes]\\n          |                                  |\\n[Response -> Complete course]   [No Response -> Re-evaluate\\/Consider repeat biopsy]\",\"CONCEPT_DIAGRAM_HTML\":\"\",\"QUALITY_PROCESS_LI\":[\"Time to Doppler ultrasound from presentation <span class=\'hl-symbol\'><<\\/span> 4 hours.\",\"Time to allograft biopsy from decision <span class=\'hl-symbol\'><<\\/span> 24 hours.\",\"Prophylaxis for PJP and CMV initiated with ATG therapy.\",\"Daily monitoring of FBC and lymphocyte counts during ATG therapy.\"],\"QUALITY_OUTCOME_LI\":[\"Return of serum creatinine to within 25% of baseline within 14 days of starting treatment.\",\"Avoidance of major infectious complications during treatment.\",\"Avoidance of ATG-related severe leukopenia (<1.0x10\\u2079\\/L) or thrombocytopenia (<50x10\\u2079\\/L).\",\"Graft survival at 1 year post-rejection episode.\"],\"QUALITY_SAFETY_LI\":[\"Allergy check before administering ATG.\",\"Use of pre-medication for ATG to prevent cytokine release syndrome.\",\"Central line preferred for ATG administration.\",\"Patient education on signs of infection and importance of prophylaxis adherence.\"],\"PITFALLS_LI\":[\"\\u26a0\\ufe0f Attributing allograft dysfunction solely to CNI toxicity without a biopsy.\",\"\\u26a0\\ufe0f Missing a concurrent antibody-mediated rejection component.\",\"\\u26a0\\ufe0f Under-dosing or prematurely stopping ATG in severe rejection.\",\"\\u26a0\\ufe0f Failing to provide adequate antimicrobial prophylaxis during intensive immunosuppression.\",\"\\u26a0\\ufe0f Delaying biopsy in a \'stable\' patient, allowing irreversible damage to occur.\"],\"SAFETY_LI\":[\"\\ud83d\\udea8 Be vigilant for signs of Cytokine Release Syndrome (CRS) after the first ATG dose (fever, rigors, hypotension, hypoxia).\",\"\\ud83d\\udea8 Monitor for profound leukopenia and thrombocytopenia with ATG.\",\"\\ud83d\\udea8 Ensure adequate hydration and glycemic control during high-dose steroid therapy.\",\"\\ud83d\\udea8 Counsel patients about the heightened risk of infection and to report any symptoms promptly.\"],\"COMMUNICATION_LI\":[\"\\ud83d\\udcac Explain to the patient that their new kidney is being \'attacked\' by their own immune system, and that strong medicines are needed to stop this.\",\"\\ud83d\\udcac Clearly outline the treatment plan, duration, and potential side effects of steroids and ATG.\",\"\\ud83d\\udcac Emphasize the critical importance of adhering to the intensive monitoring schedule and prophylactic medications.\",\"\\ud83d\\udcac Discuss the prognosis for graft recovery while managing expectations, explaining that this is a serious but often treatable complication.\"],\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseScenariosAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseOne\' aria-expanded=\'true\' aria-controls=\'caseCollapseOne\'>Scenario 1: Post-ATG Fever and Hypotension<\\/button><\\/h2><div id=\'caseCollapseOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'caseHeadingOne\'><div class=\'accordion-body\'><b>Situation:<\\/b> 4 hours into the first infusion of ATG, the patient develops a fever of 39.1\\u00b0C, rigors, and their blood pressure drops to 85\\/50 mmHg. <br><b>Management:<\\/b> 1. Stop the ATG infusion immediately. 2. Administer IV fluids. 3. Give additional IV hydrocortisone and antihistamines. 4. Perform a sepsis workup (blood cultures, etc.) to rule out infection, but the primary diagnosis is Cytokine Release Syndrome. 5. Once stable, the ATG infusion can be cautiously restarted at a slower rate. Subsequent doses will require robust pre-medication.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingTwo\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseTwo\' aria-expanded=\'false\' aria-controls=\'caseCollapseTwo\'>Scenario 2: Rising Creatinine Despite 3 Days of Treatment<\\/button><\\/h2><div id=\'caseCollapseTwo\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><b>Situation:<\\/b> After 3 days of methylprednisolone and 2 doses of ATG, the creatinine has risen from 200 to 250 \\u00b5mol\\/L. DSA results return positive with a high MFI against a donor HLA antigen. The biopsy C4d stain was negative. <br><b>Management:<\\/b> This suggests a component of C4d-negative, DSA-positive antibody-mediated rejection. The treatment plan must be augmented to target the humoral response. Start plasmapheresis or immunoadsorption immediately. Administer IVIG after plasmapheresis. Continue ATG as planned for the cellular component.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingThree\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseThree\' aria-expanded=\'false\' aria-controls=\'caseCollapseThree\'>Scenario 3: Profound Leukopenia on Day 4 of ATG<\\/button><\\/h2><div id=\'caseCollapseThree\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><b>Situation:<\\/b> On day 4 of ATG therapy, the patient\'s WBC count drops to 1.5x10\\u2079\\/L and the absolute lymphocyte count is 0.01x10\\u2079\\/L. <br><b>Management:<\\/b> 1. Hold today\'s dose of ATG. 2. Also hold the maintenance anti-proliferative agent (e.g., mycophenolate). 3. Consider giving G-CSF if neutropenia is severe or prolonged. 4. Monitor FBC daily. Once the WBC count recovers to >2.0-2.5x10\\u2079\\/L, ATG can be cautiously restarted, typically at 50% of the previous dose.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the mechanism of action of Anti-Thymocyte Globulin (ATG)?\",\"a\":\"ATG is a polyclonal antibody derived from rabbits immunized with human thymocytes. It works primarily by causing profound depletion of circulating T-lymphocytes through complement-dependent cytotoxicity and apoptosis. It also modulates T-cell surface molecules, impairing their function.\"},{\"q\":\"What are the main toxicities of ATG?\",\"a\":\"The main toxicities are: 1. Cytokine Release Syndrome with first doses. 2. Hematological effects like leukopenia and thrombocytopenia. 3. Increased risk of opportunistic infections, particularly CMV and PJP. 4. Increased long-term risk of post-transplant lymphoproliferative disorder (PTLD). 5. Serum sickness, a delayed hypersensitivity reaction.\"},{\"q\":\"How would you differentiate CNI toxicity from acute cellular rejection on a biopsy?\",\"a\":\"CNI toxicity classically shows isometric vacuolization of proximal tubular cells and arteriolar hyalinosis with minimal or no inflammation. In contrast, acute cellular rejection is an inflammatory process characterized by interstitial inflammation (i-lesion) and tubulitis (t-lesion), with lymphocytes invading the tubular epithelium. Endarteritis (v-lesion) can also be seen in ACR.\"},{\"q\":\"The user asks you to explain how a Luminex assay for DSA works. How do you respond?\",\"a\":\"\\\"The Luminex Single Antigen Bead assay is our most sensitive method for detecting donor-specific antibodies. It uses tiny colour-coded beads, where each colour corresponds to a bead coated with a single, specific HLA protein. We mix the patient\'s serum with this panel of beads. If the patient has an antibody against a specific HLA protein, it will bind to the corresponding bead. We then add a second antibody that is fluorescent, which binds to the patient\'s antibody. A laser-based instrument then identifies the bead\'s colour and measures the amount of fluorescence. This is reported as the Mean Fluorescence Intensity, or MFI, which tells us the strength of that particular antibody.\\\"\"},{\"q\":\"What MFI level do you consider clinically significant?\",\"a\":\"There is no universal MFI threshold, and it varies between centers and clinical contexts. However, an MFI >1000-2000 is often considered potentially significant and requires careful clinical correlation. Very high MFIs (>5000-10000) are strongly associated with antibody-mediated rejection.\"},{\"q\":\"Why is C4d staining important in a transplant biopsy?\",\"a\":\"C4d is a breakdown product of the classical complement pathway. Its deposition in peritubular capillaries is a key marker of antibody-mediated rejection. It indicates that circulating donor-specific antibodies have bound to the graft endothelium and activated the complement cascade, leading to tissue injury.\"},{\"q\":\"Can you have antibody-mediated rejection with a negative C4d stain?\",\"a\":\"Yes. This is known as C4d-negative AMR. It can be mediated by antibodies that do not efficiently fix complement or by other mechanisms of endothelial injury. The diagnosis in these cases relies on the presence of circulating DSA and histological evidence of microvascular inflammation (glomerulitis and peritubular capillaritis).\"},{\"q\":\"What are the indications for dialysis (AEIOU)?\",\"a\":\"The classic AEIOU mnemonic stands for: Acidosis (severe, refractory metabolic acidosis), Electrolyte abnormalities (refractory hyperkalemia), Intoxication (with a dialyzable toxin), Overload (refractory fluid overload), and Uremia (symptomatic uremia, e.g., pericarditis, encephalopathy).\"},{\"q\":\"What are the typical sonographic features of transplant renal artery stenosis (TRAS)?\",\"a\":\"Doppler US findings suggesting TRAS include high peak systolic velocity (PSV) at the site of stenosis (typically >200-250 cm\\/s), a renal-aortic ratio (RAR) of PSV > 3.5, and a \'parvus et tardus\' waveform (slow and delayed systolic upstroke) in the intra-renal arteries.\"},{\"q\":\"What is the management of BK virus nephropathy?\",\"a\":\"The mainstay of treatment is reduction of overall immunosuppression to allow the host immune system to clear the virus. This typically involves reducing or stopping the anti-proliferative agent (mycophenolate) first, followed by a reduction in the CNI dose. There are no proven effective antiviral agents, although cidofovir, leflunomide, and IVIG have been used in some cases with anecdotal success.\"}],\"TEACHING_CONCEPTS_LI\":[\"<b>Systematic Approach:<\\/b> A structured approach to post-transplant AKI using the \'PRUNES\' mnemonic helps ensure all major causes are considered.\",\"<b>Biopsy is Gold Standard:<\\/b> Clinical signs and non-invasive tests can be suggestive, but an allograft biopsy is essential for a definitive diagnosis and to guide specific therapy.\",\"<b>Rejection is a Spectrum:<\\/b> Rejection is not a single entity. It can be T-cell mediated, antibody-mediated, or mixed. The treatment differs significantly for each type.\",\"<b>Balancing Immunosuppression:<\\/b> The core challenge in transplant medicine is balancing the need to suppress the immune system enough to prevent rejection, without over-suppressing it and causing infection or malignancy. Treatment for rejection is a period of intentionally high risk.\"],\"TEACHING_MISTAKES_LI\":[\"<b>\'Dialysis-level Creatinine\':<\\/b> Avoid anchoring on a specific creatinine value to start treatment. The trajectory and clinical context are more important than the absolute number.\",\"<b>Ignoring the Doppler:<\\/b> A Doppler ultrasound is not just for \'ruling out obstruction.\' It provides vital information on graft perfusion and vascular integrity that is crucial in the first few weeks.\",\"<b>Treating the CNI level, not the patient:<\\/b> A \'therapeutic\' tacrolimus level does not rule out rejection, and a \'high\' level does not automatically mean CNI toxicity is the sole cause of AKI.\",\"<b>Delaying Rejection Treatment:<\\/b> Delaying potent therapy for severe rejection while \'waiting to see\' if creatinine improves with fluids can lead to irreversible fibrosis and graft loss.\"],\"EVIDENCE_STUDIES_LI\":[\"<b>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009):<\\/b> Provides comprehensive recommendations on the diagnosis and management of rejection.\",\"<b>Brennan DC, et al. N Engl J Med 2006:<\\/b> A key trial comparing ATG vs. Basiliximab for induction, showing ATG\'s potency in high-risk patients.\",\"<b>Pascual J, et al. J Am Soc Nephrol 2018:<\\/b> TRANSFORM study showing everolimus with reduced CNI is non-inferior to standard CNI\\/MPA for efficacy, with less viral infection.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"For severe T-cell mediated rejection (Banff IIA or higher), treatment with a lymphocyte-depleting antibody is recommended over simply increasing corticosteroid doses (KDIGO).\",\"Screening for BK virus by monitoring plasma nucleic acid testing is recommended post-transplant to allow for pre-emptive reduction in immunosuppression (KDIGO).\",\"Ruling out AMR is crucial in any case of graft dysfunction, particularly if there is a suboptimal response to standard cellular rejection therapy.\"],\"GUIDELINE_ANCHORS_LI\":[\"<b>KDIGO (Kidney Disease: Improving Global Outcomes):<\\/b> Provides the international standard for diagnosis and management of kidney transplant complications, including rejection.\",\"<b>American Society of Transplantation (AST):<\\/b> Offers updated guidelines and consensus statements on various aspects of transplant care, including management of infections and rejection.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extraHeadingOne\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extraCollapseOne\' aria-expanded=\'false\' aria-controls=\'extraCollapseOne\'>Schema Omission Log<\\/button><\\/h2><div id=\'extraCollapseOne\' class=\'accordion-collapse collapse\' aria-labelledby=\'extraHeadingOne\'><div class=\'accordion-body\'><ul><li><b>CONCEPT_DIAGRAM_HTML:<\\/b> Left empty as a simple text-based flowchart in ASCII_FLOWCHART_PRE was deemed more clear and direct for this clinical pathway.<\\/li><li><b>ADDITIONAL_SECTIONS_HTML:<\\/b> No significant unmapped content remained after populating the primary schema fields. All relevant information was integrated into the main sections.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '[]', NULL, NULL, NULL, '2025-09-18 13:46:28', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(2, NULL, 2, 1, 1, 'post-transplant-acute-rejection', 'Acute Graft Dysfunction Post-Kidney Transplantation', NULL, 'published', 'Acute graft dysfunction in a kidney transplant recipient, particularly within the first few weeks, is a clinical emergency requiring immediate and systematic evaluation. The differential diagnosis is broad, spanning immunologic, infectious, toxic, and surgical causes. The primary goals are to ensure hemodynamic stability, perform a rapid non-invasive workup including therapeutic drug monitoring and ultrasound Doppler imaging, and proceed to a definitive diagnosis via allograft biopsy if indicated. This structured approach is crucial to preserving graft function and patient health.', '{\"slug\":\"post-transplant-acute-rejection\",\"TOPIC\":\"Acute Graft Dysfunction Post-Kidney Transplantation\",\"CHIP_1\":\"Acute Rejection\",\"CHIP_2\":\"Calcineurin Inhibitor Toxicity\",\"CHIP_3\":\"Vascular Complications\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Acute graft dysfunction in a kidney transplant recipient, particularly within the first few weeks, is a clinical emergency requiring immediate and systematic evaluation. The differential diagnosis is broad, spanning immunologic, infectious, toxic, and surgical causes. The primary goals are to ensure hemodynamic stability, perform a rapid non-invasive workup including therapeutic drug monitoring and ultrasound Doppler imaging, and proceed to a definitive diagnosis via allograft biopsy if indicated. This structured approach is crucial to preserving graft function and patient health.\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u2705 Assess and secure Airway, Breathing, and Circulation (ABC).\",\"\\u2705 Obtain IV access and draw initial bloods (FBC, U&E, LFTs, Coagulation, Group & Save).\",\"\\u2705 Request urgent trough level of calcineurin inhibitor (Tacrolimus or Cyclosporine).\",\"\\u2705 Obtain a focused history: details of transplant surgery, donor (living\\/deceased), induction\\/maintenance immunosuppression, baseline creatinine, urine output, and any symptoms (fever, graft pain, hematuria).\",\"\\u2705 Perform a targeted physical examination: assess vital signs, volume status, graft tenderness, and for surgical wound complications.\",\"\\u2705 Order bedside urine dipstick to check for proteinuria and hematuria.\",\"\\ud83e\\uddea Send urgent blood and urine samples for CMV and BKV PCR (quantitative).\",\"\\ud83d\\udd0e Arrange an urgent Ultrasound Doppler of the transplant kidney and collecting system to rule out vascular thrombosis, stenosis, and urinary obstruction.\",\"\\ud83d\\udcc4 Review all available documentation from the transplanting center.\",\"\\u260e\\ufe0f Place an urgent consultation with the on-call Transplant Nephrology service.\",\"\\ud83d\\udc8a Withhold any potentially nephrotoxic medications (e.g., NSAIDs, ACE-inhibitors) until a diagnosis is clear.\",\"\\ud83d\\udc89 Prepare the patient for a potential urgent allograft biopsy, the gold standard for diagnosis.\",\"\\ud83c\\udfe5 Ensure the patient is admitted to a specialized renal or transplant unit for close monitoring.\",\"\\u26a0\\ufe0f Monitor urine output and fluid balance strictly.\",\"\\ud83d\\udcac Explain the situation and the initial plan to the patient and their family.\"],\"ANSWER_STEPS_OL\":[\"This is a case of a patient presenting with acute graft dysfunction, with a creatinine of 200 \\u00b5mol\\/L, one week after receiving a kidney transplant abroad.\",\"First, I will perform an immediate ABCDE assessment to ensure the patient is hemodynamically stable.\",\"I will then take a focused history covering the specifics of the transplant, immunosuppressive regimen, and current symptoms, followed by a physical exam focusing on volume status and for graft tenderness.\",\"My immediate investigations will include a full lab workup: FBC, renal profile, LFTs, and crucially, an urgent trough tacrolimus (or other CNI) level. I will also send quantitative PCR for BK virus and CMV.\",\"The single most important initial imaging test I will order is an urgent renal allograft Ultrasound Doppler. This is critical to exclude surgical or vascular emergencies like renal artery stenosis, vein thrombosis, or a urinary tract obstruction.\",\"My main differential diagnoses in this early post-operative period are: 1) Acute T-cell mediated or antibody-mediated rejection, 2) Calcineurin inhibitor toxicity, and 3) A surgical complication.\",\"Once urgent vascular and urological issues are ruled out by the Doppler scan, I will proceed to an urgent, ultrasound-guided allograft biopsy to establish a definitive diagnosis.\",\"The viva states the biopsy shows Banff classification IIB acute cellular rejection. This is a severe form of rejection characterized by significant intimal arteritis (\'v2\' lesion).\",\"My first-line treatment for this is high-dose intravenous methylprednisolone, typically 500 mg daily for 3 to 5 days.\",\"Given the severity of Banff IIB rejection, steroid therapy alone is often insufficient. Therefore, I will add a lymphocyte-depleting agent. My choice is anti-thymocyte globulin (ATG).\",\"The standard dose for rabbit ATG (Thymoglobulin) is 1.5 mg\\/kg daily. The duration is typically 7 to 10 days, and I will monitor the CD3+ lymphocyte count daily to guide therapy, aiming for profound depletion.\",\"Before starting ATG, I will ensure the patient has no active infection and administer premedication with corticosteroids, antihistamines, and paracetamol to mitigate cytokine release syndrome.\",\"Finally, I will also test for donor-specific antibodies (DSA) using a Luminex-based assay to rule out a concurrent antibody-mediated component, which would require additional treatment like plasmapheresis or IVIG.\"],\"DDX_BUCKET_1_TITLE\":\"Immunologic Causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Acute T-Cell Mediated Rejection (ACR)\",\"Acute Antibody-Mediated Rejection (AMR)\",\"Mixed Acute Rejection (ACR + AMR)\",\"Recurrent Glomerulonephritis (less likely this early)\"],\"DDX_BUCKET_2_TITLE\":\"Drug-Related & Infectious Causes\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Calcineurin Inhibitor (CNI) Toxicity (Tacrolimus\\/Cyclosporine)\",\"BK Virus Nephropathy (BKVN) - usually later but can occur early\",\"CMV Nephritis\",\"Other drug-induced Acute Interstitial Nephritis (AIN)\"],\"DDX_BUCKET_3_TITLE\":\"Vascular & Surgical Causes\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Renal Artery Stenosis (TRAS) or Thrombosis\",\"Renal Vein Thrombosis\",\"Ureteral Obstruction (e.g., clot, stricture)\",\"Urine Leak\",\"Compressive Lymphocele\"],\"DIFFERENTIAL_FOCUS_HTML\":\"<div class=\'accordion\' id=\'diffFocusAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOneDF\'><strong>Acute Cellular Rejection (ACR) vs. CNI Toxicity vs. BKVN<\\/strong><\\/button><\\/h2><div id=\'collapseOneDF\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#diffFocusAccordion\'><div class=\'accordion-body\'>A deep dive into the top 3 non-surgical causes of early graft dysfunction.<table class=\'table table-bordered\'><thead><tr><th>Feature<\\/th><th>Acute Cellular Rejection<\\/th><th>CNI Toxicity<\\/th><th>BK Virus Nephropathy<\\/th><\\/tr><\\/thead><tbody><tr><td><strong>Pathophysiology<\\/strong><\\/td><td>Host T-cell mediated attack on graft tubulointerstitium and\\/or vasculature.<\\/td><td>Afferent arteriolar vasoconstriction and direct tubular injury.<\\/td><td>Polyomavirus reactivation leading to viral replication in tubular epithelial cells and subsequent cell lysis.<\\/td><\\/tr><tr><td><strong>Key Biopsy Findings<\\/strong><\\/td><td>Interstitial inflammation (i-lesions), tubulitis (t-lesions), intimal arteritis (v-lesions).<\\/td><td>Isometric vacuolization of tubular cells, thrombotic microangiopathy (TMA) in severe cases. Minimal inflammation.<\\/td><td>Tubulointerstitial inflammation, viral cytopathic changes, and positive immunohistochemistry (SV40 Large T antigen).<\\/td><\\/tr><tr><td><strong>Management<\\/strong><\\/td><td>Increase immunosuppression: Pulse steroids, ATG for severe cases.<\\/td><td>Reduce CNI dose. Temporarily hold or switch agent.<\\/td><td>Reduce immunosuppression to allow for viral clearance. May use IVIG or leflunomide in severe cases.<\\/td><\\/tr><\\/tbody><\\/table><\\/div><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<strong>Bloods:<\\/strong> Full blood count, urea & electrolytes, liver function tests, bone profile, C-reactive protein.\",\"<strong>Therapeutic Drug Levels:<\\/strong> Urgent Tacrolimus or Cyclosporine trough level.\",\"<strong>Virology:<\\/strong> Quantitative PCR for BK Virus (blood and urine) and Cytomegalovirus (CMV) (blood).\",\"<strong>Immunology:<\\/strong> Donor-Specific Antibody (DSA) screen and identification via Luminex Single Antigen Bead assay.\",\"<strong>Urine:<\\/strong> Urinalysis, urine microscopy for cells\\/casts, urine culture.\",\"<strong>Imaging:<\\/strong> Urgent Ultrasound Doppler of the renal allograft is mandatory to assess parenchyma, perfusion, and rule out obstruction or vascular compromise.\",\"<strong>Histology:<\\/strong> Ultrasound-guided renal allograft biopsy for light microscopy, immunofluorescence, and C4d staining. Electron microscopy if indicated.\"],\"PILLAR_1\":\"Diagnosis of Graft Dysfunction\",\"STEP_1_TITLE\":\"Initial Non-Invasive Workup\",\"STEP_1_LI\":[\"Exclude pre-renal causes (assess volume status).\",\"Exclude post-renal causes with Ultrasound Doppler.\",\"Check CNI levels to rule out toxicity.\",\"Send virology screening (BKV, CMV).\"],\"STEP_2_TITLE\":\"Definitive Diagnosis via Biopsy\",\"STEP_2_LI\":[\"Perform allograft biopsy once vascular\\/urologic causes are excluded.\",\"Submit tissue for comprehensive analysis (LM, IF, C4d).\",\"Interpret histology using the Banff classification system.\",\"Banff IIB TCMR is defined by severe intimal arteritis (v2) in at least one artery.\"],\"PILLAR_2\":\"Management of Acute Cellular Rejection (Banff IIB)\",\"STEP_3_TITLE\":\"First-Line: High-Dose Corticosteroids\",\"STEP_3_LI\":[\"Administer IV methylprednisolone 500-1000 mg daily.\",\"Typical course is for 3 consecutive days.\",\"Monitor for side effects: hyperglycemia, hypertension, mood changes.\"],\"STEP_4_TITLE\":\"Second-Line: Lymphocyte Depletion\",\"STEP_4_LI\":[\"Indicated for steroid-resistant or severe rejection (Banff \\u2265IIA).\",\"Use Anti-thymocyte Globulin (rATG, Thymoglobulin) at 1.5 mg\\/kg\\/day.\",\"Administer via a central line for 7-10 days.\",\"Requires premedication (steroids, antihistamine, antipyretic).\",\"Monitor daily FBC and lymphocyte subsets (CD3 count).\",\"Provide PJP and antiviral\\/antifungal prophylaxis.\"],\"PHARMACOLOGY_TABLE_HTML\":\"<table class=\'table table-striped\'><thead><tr><th>Drug<\\/th><th>Mechanism<\\/th><th>Dose for Rejection<\\/th><th>Key Monitoring\\/Side Effects<\\/th><\\/tr><\\/thead><tbody><tr><td>\\ud83d\\udc8a <strong>Methylprednisolone<\\/strong><\\/td><td>Broad anti-inflammatory and immunosuppressive effects.<\\/td><td>500-1000 mg IV daily for 3-5 days.<\\/td><td>Hyperglycemia, hypertension, psychosis, infection risk.<\\/td><\\/tr><tr><td>\\ud83d\\udc8a <strong>Anti-thymocyte Globulin (ATG)<\\/strong><\\/td><td>Polyclonal antibody causing depletion of T-lymphocytes.<\\/td><td>1.5 mg\\/kg IV daily for 7-10 days.<\\/td><td>\\u26a0\\ufe0f Cytokine Release Syndrome, leukopenia, thrombocytopenia, serum sickness, increased infection risk. Requires central line.<\\/td><\\/tr><tr><td>\\ud83d\\udc8a <strong>Tacrolimus<\\/strong><\\/td><td>Calcineurin inhibitor; blocks T-cell activation by inhibiting IL-2 production.<\\/td><td>Dose adjusted to trough levels (typically 5-10 ng\\/mL early post-transplant).<\\/td><td>Nephrotoxicity, neurotoxicity, hypertension, post-transplant diabetes mellitus (PTDM).<\\/td><\\/tr><tr><td>\\ud83d\\udc8a <strong>Mycophenolate Mofetil (MMF)<\\/strong><\\/td><td>Inhibits purine synthesis in lymphocytes, blocking their proliferation.<\\/td><td>Maintenance dose (e.g., 1g BID). Dose may be adjusted during rejection treatment.<\\/td><td>GI upset (diarrhea), leukopenia, teratogenicity.<\\/td><\\/tr><\\/tbody><\\/table>\",\"TOPIC_BLOCK_A_TITLE\":\"Banff Classification for T-Cell Mediated Rejection (TCMR)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<strong>Standardized system:<\\/strong> The Banff score is the international standard for grading rejection in solid organ transplants.\",\"<strong>Core lesions:<\\/strong> TCMR is primarily scored on three lesions: \'i\' for interstitial inflammation, \'t\' for tubulitis, and \'v\' for intimal arteritis (vasculitis).\",\"<strong>Grading:<\\/strong> The severity is graded based on the extent of these lesions.\",\"<strong>Banff Grade I (A\\/B):<\\/strong> Significant interstitial inflammation and tubulitis.\",\"<strong>Banff Grade II (A\\/B):<\\/strong> Involves mild-to-moderate (IIA) or severe (IIB) intimal arteritis.\",\"<strong>Banff Grade III:<\\/strong> Transmural arteritis and\\/or arterial fibrinoid necrosis.\"],\"TOPIC_BLOCK_B_TITLE\":\"Donor-Specific Antibody (DSA) Testing\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<strong>Purpose:<\\/strong> To detect antibodies in the recipient\'s serum that target the donor\'s specific HLA molecules.\",\"<strong>Luminex Technology:<\\/strong> The standard method is the single antigen bead (SAB) assay. Recipient serum is mixed with beads, each coated with a single, known HLA antigen.\",\"<strong>Detection:<\\/strong> If DSA are present, they bind to the corresponding beads. A fluorescently-labeled secondary antibody is added, and a laser detects the signal.\",\"<strong>Mean Fluorescence Intensity (MFI):<\\/strong> The strength of the signal is quantified as MFI. Higher MFI values (e.g., <span class=\'hl-symbol\'>><\\/span>1000-3000, depending on the lab) indicate a higher concentration and\\/or avidity of the antibody, suggesting a higher immunologic risk.\"],\"TOPIC_BLOCK_C_TITLE\":\"ATG (Thymoglobulin) Administration Protocol\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<strong>Premedication:<\\/strong> Administer IV hydrocortisone (e.g., 100mg), chlorpheniramine, and paracetamol 30-60 minutes prior to infusion to reduce risk of cytokine release syndrome (CRS).\",\"<strong>Administration:<\\/strong> Must be given via a high-flow central venous catheter over 6-8 hours.\",\"<strong>First Dose Monitoring:<\\/strong> Closely monitor vital signs every 30 minutes for the first 2 hours, then hourly. Be vigilant for fever, chills, rigors, hypotension, or dyspnea.\",\"<strong>Daily Labs:<\\/strong> Monitor daily FBC and differential. Dose may need to be adjusted or held for severe leukopenia (WBC <span class=\'hl-symbol\'><<\\/span>2.0 x 10^9\\/L) or thrombocytopenia (Platelets <span class=\'hl-symbol\'><<\\/span>50 x 10^9\\/L).\",\"<strong>Prophylaxis:<\\/strong> Start PJP prophylaxis (e.g., Co-trimoxazole) and antiviral\\/fungal prophylaxis as per local protocol.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-header\'><strong>Acute Graft Dysfunction (<3 Months)<\\/strong><\\/div><div class=\'card-body\'><p><strong>1. URGENT Triage:<\\/strong> ABCs, IV access, Labs (add CNI level, BKV\\/CMV PCR).<\\/p><p><strong>2. URGENT Imaging:<\\/strong> STAT Ultrasound Doppler to R\\/O vascular\\/urologic cause.<\\/p><p><strong>3. URGENT Consult:<\\/strong> Call Transplant Nephrology immediately.<\\/p><p><strong>4. Differential:<\\/strong> Think \'Rejection, Rocks, Roads, or Regimen\' (Rejection, Obstruction, Vascular, Drugs\\/Bugs).<\\/p><p><strong>5. Biopsy:<\\/strong> Low threshold for urgent biopsy once surgical causes are excluded.<\\/p><\\/div><\\/div>\",\"EMERGENCY_ALGORITHM_HTML\":\"\",\"ASCII_FLOWCHART_PRE\":\"Patient with KTX < 1 month ago + Rising Creatinine\\n          |\\n          V\\n   [ Assess ABCs, Vitals, Volume Status ]\\n          |\\n          V\\n   [ STAT Labs: U&E, FBC, CNI Trough Level, BKV\\/CMV PCR ]\\n          |\\n          V\\n   [ STAT Renal Allograft Ultrasound Doppler ]\\n          |                                 |\\n          +---------------------------------+\\n          |\\n          V\\n[ Obstruction \\/ Vascular Issue Found? ] --(YES)--> [ Urgent Urology \\/ IR \\/ Surgical Consult ]\\n          |\\n         (NO)\\n          |\\n          V\\n[ CNI Level High? ] --(YES)--> [ Reduce\\/Hold CNI, Recheck level, consider biopsy if no improvement ]\\n          |\\n         (NO)\\n          |\\n          V\\n[ BKV\\/CMV PCR Positive? ] --(YES)--> [ Consider reducing immunosuppression, consult on antivirals, Biopsy to confirm ]\\n          |\\n         (NO)\\n          |\\n          V\\n[ High Suspicion for Rejection ]\\n          |\\n          V\\n   [ **Proceed to Urgent Allograft Biopsy** ]\\n          |\\n          V\\n   [ Treat based on Banff Classification ]\",\"CONCEPT_DIAGRAM_HTML\":\"\",\"QUALITY_PROCESS_LI\":[\"Time to ultrasound doppler from presentation should be < 2 hours.\",\"Time to allograft biopsy (when indicated) should be < 24 hours.\",\"Appropriate premedication and monitoring protocols are followed for ATG administration.\",\"Documentation of discussion with the transplant team and patient regarding risks\\/benefits of treatment.\"],\"QUALITY_OUTCOME_LI\":[\"Recovery of graft function (fall in serum creatinine) within 7-14 days of initiating treatment.\",\"Avoidance of graft loss.\",\"Absence of severe adverse effects from treatment (e.g., opportunistic infections, ATG-related complications).\",\"Successful clearance of viremia in cases of BKVN or CMV.\"],\"QUALITY_SAFETY_LI\":[\"Confirming negative viral serologies and ruling out active infection before administering ATG.\",\"Dose adjustment of ATG for leukopenia or thrombocytopenia.\",\"Ensuring appropriate PJP and viral prophylaxis is prescribed with potent immunosuppression.\",\"Patient education on the signs of infection and the importance of adherence.\"],\"PITFALLS_LI\":[\"\\u26a0\\ufe0f Delaying ultrasound doppler and missing a correctable surgical cause.\",\"\\u26a0\\ufe0f Attributing graft dysfunction solely to high CNI levels without ruling out concurrent rejection.\",\"\\u26a0\\ufe0f Under-treating severe rejection (e.g., using steroids alone for Banff IIB).\",\"\\u26a0\\ufe0f Failing to check for and treat concurrent antibody-mediated rejection.\",\"\\u26a0\\ufe0f Delaying the reduction of immunosuppression in proven BK Virus Nephropathy.\"],\"SAFETY_LI\":[\"\\u2757\\ufe0f Be aware of the high risk of cytokine release syndrome with the first dose of ATG.\",\"\\u2757\\ufe0f Potent immunosuppression significantly increases the risk of opportunistic infections (PJP, CMV, fungal).\",\"\\u2757\\ufe0f Over-immunosuppression can lead to malignancy and life-threatening infections long-term.\",\"\\u2757\\ufe0f Always check for pregnancy potential before using teratogenic drugs like mycophenolate.\"],\"COMMUNICATION_LI\":[\"\\ud83d\\udcac Clearly explain to the patient that a rising creatinine is serious and requires urgent investigation.\",\"\\ud83d\\udcac Discuss the rationale for a kidney biopsy, including the risks (bleeding, infection) and benefits (definitive diagnosis).\",\"\\ud83d\\udcac When explaining a rejection diagnosis, be empathetic but clear about the need for aggressive treatment to save the kidney.\",\"\\ud83d\\udcac Counsel the patient on the side effects of intensive immunosuppressive therapy and the importance of monitoring and prophylaxis.\"],\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseScenariosAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseCase1\'>Scenario 1: Banff IIB Cellular Rejection (Index Case)<\\/button><\\/h2><div id=\'collapseCase1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> 1 week post-transplant, creatinine rises from 150 to 200. Doppler is normal. Tacrolimus level is therapeutic.<br><strong>Biopsy:<\\/strong> Reveals diffuse interstitial inflammation, moderate tubulitis (t2), and severe intimal arteritis (v2).<br><strong>Diagnosis:<\\/strong> Acute T-Cell Mediated Rejection, Banff IIB.<br><strong>Management:<\\/strong> Pulse IV methylprednisolone followed by a 7-10 day course of ATG. Check for DSA.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseCase2\'>Scenario 2: CNI Toxicity<\\/button><\\/h2><div id=\'collapseCase2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> 10 days post-transplant, creatinine rises from 130 to 190. Patient reports mild tremor. Doppler is normal.<br><strong>Labs:<\\/strong> Tacrolimus trough level is high at 18 ng\\/mL (target 8-10).<br><strong>Biopsy:<\\/strong> Shows prominent isometric vacuolization in proximal tubular cells with no significant inflammation or arteritis.<br><strong>Diagnosis:<\\/strong> Calcineurin Inhibitor Toxicity.<br><strong>Management:<\\/strong> Hold tacrolimus for 24 hours and restart at a lower dose. Monitor levels and creatinine closely.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseCase3\'>Scenario 3: BK Virus Nephropathy<\\/button><\\/h2><div id=\'collapseCase3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> 3 months post-transplant, insidious rise in creatinine from 120 to 180 over 4 weeks.<br><strong>Labs:<\\/strong> Serum BKV PCR is high at 50,000 copies\\/mL.<br><strong>Biopsy:<\\/strong> Shows interstitial inflammation, tubular injury, and viral cytopathic changes with positive SV40 staining.<br><strong>Diagnosis:<\\/strong> BK Virus Nephropathy.<br><strong>Management:<\\/strong> Reduce immunosuppression (typically by reducing or stopping the anti-metabolite, MMF). Monitor viral load and creatinine. Consider IVIG or leflunomide if severe or non-responsive.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What are your top 3 differential diagnoses for graft dysfunction 1 week post-transplant?\",\"a\":\"My top three differentials are 1) Acute rejection (cellular or antibody-mediated), 2) A vascular or surgical complication like renal artery stenosis or urine leak, and 3) Calcineurin inhibitor toxicity.\"},{\"q\":\"What is the single most important initial imaging investigation?\",\"a\":\"An urgent Ultrasound Doppler of the allograft is the most critical initial imaging test to rule out time-sensitive surgical and vascular causes, which require immediate intervention.\"},{\"q\":\"The biopsy shows a \'v\' lesion. What does this signify and how does it impact your treatment?\",\"a\":\"A \'v\' lesion signifies intimal arteritis, or vasculitis, which is the hallmark of more severe T-cell mediated rejection. Its presence (v1 or greater) defines at least a Banff Grade II rejection and mandates more aggressive therapy than steroids alone, typically requiring ATG.\"},{\"q\":\"What is the mechanism of action of Anti-thymocyte Globulin (ATG)?\",\"a\":\"ATG is a polyclonal antibody derived from rabbits or horses immunized against human thymocytes. It works by binding to multiple surface molecules on T-lymphocytes, leading to their depletion via complement-dependent lysis and apoptosis.\"},{\"q\":\"What are the main side effects of ATG therapy?\",\"a\":\"The most immediate side effect is cytokine release syndrome. Other major side effects include profound leukopenia, thrombocytopenia, increased risk of opportunistic infections (CMV, PJP), and serum sickness.\"},{\"q\":\"The DSA test comes back positive for donor-specific antibodies with a high MFI. What does this mean?\",\"a\":\"A positive DSA with high Mean Fluorescence Intensity (MFI) indicates a strong antibody response against the donor\'s HLA antigens. This suggests a concurrent antibody-mediated rejection process, which requires additional therapies like plasmapheresis and\\/or IVIG.\"},{\"q\":\"How do you histologically differentiate CNI toxicity from acute rejection?\",\"a\":\"The key feature of CNI toxicity is isometric vacuolization of proximal tubular cells and potentially signs of thrombotic microangiopathy, with minimal inflammation. In contrast, acute rejection is characterized by significant inflammatory infiltrates, including tubulitis and vasculitis.\"},{\"q\":\"What is virtual crossmatch?\",\"a\":\"Virtual crossmatch refers to using high-resolution HLA typing of both donor and recipient and Luminex single antigen bead analysis of the recipient\'s serum to predict the outcome of a laboratory crossmatch without physically mixing the cells. A positive virtual crossmatch identifies pre-formed DSA.\"},{\"q\":\"The patient\'s platelet count drops to 40 x 10^9\\/L after the third dose of ATG. What is your action?\",\"a\":\"I would immediately hold the next dose of ATG. I would monitor the FBC daily and only resume ATG, perhaps at a reduced dose (e.g., 50% dose), once the platelet count recovers to a safer level, typically above 75 x 10^9\\/L.\"},{\"q\":\"What is the Banff classification?\",\"a\":\"The Banff classification is the international standardized system used for reporting the pathology of transplanted organs. It provides criteria and grading for diagnosing and classifying rejection, CNI toxicity, and other pathologic conditions in the allograft.\"},{\"q\":\"How does the management of Banff Grade IIA rejection differ from IIB?\",\"a\":\"Banff IIA involves mild-to-moderate arteritis (v1), while IIB is severe arteritis (v2). While both often require more than steroids, some centers might treat IIA with a very high dose of pulse steroids and only add ATG if there\'s no response. For IIB, ATG is almost always used upfront along with steroids due to the high risk of graft loss.\"}],\"TEACHING_CONCEPTS_LI\":[\"The \'4T\'s\' of early graft dysfunction: Thrombosis (vascular), Technical (surgical leak\\/obstruction), Toxicity (drugs), and Transplant Rejection.\",\"The critical importance of the allograft biopsy as the gold standard for differentiating causes of intrinsic graft failure.\",\"The concept of tailoring immunosuppression: increasing it for rejection, and decreasing it for infection (like BKVN).\",\"Understanding the Banff score is key to risk-stratifying and managing acute rejection appropriately.\"],\"TEACHING_MISTAKES_LI\":[\"Mistake: Assuming a high CNI level is the sole cause of graft dysfunction without performing a biopsy. A patient can have both CNI toxicity and rejection.\",\"Mistake: Not performing an ultrasound Doppler first and proceeding straight to biopsy, potentially missing a surgical emergency.\",\"Mistake: Treating severe (Banff II) rejection with steroids alone, leading to smoldering rejection and chronic damage.\",\"Mistake: Forgetting to implement PJP and antiviral prophylaxis when starting potent anti-rejection therapy.\"],\"EVIDENCE_STUDIES_LI\":[\"Thymoglobulin Induction therapy studies: Various trials have established the efficacy of rATG for induction and treatment of acute rejection, showing superiority over IL-2 receptor antagonists for high-risk patients.\",\"TOLERANCE trial: Explored withdrawal of immunosuppression, reinforcing the need for ongoing therapy.\",\"Banff Working Groups publications: These consensus papers periodically update the histologic criteria for diagnosing rejection and other transplant pathologies.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Initial treatment for acute T-cell mediated rejection should be with high-dose pulse corticosteroids.\",\"For severe or steroid-resistant cellular rejection, treatment with a lymphocyte-depleting antibody is recommended.\",\"Routine monitoring for BK virus and CMV is recommended in the early post-transplant period.\"],\"GUIDELINE_ANCHORS_LI\":[\"KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009): Provides comprehensive recommendations for diagnosis and management of rejection.\",\"The American Society of Transplantation (AST) guidelines on infectious disease and immunosuppression management.\",\"Local center-specific protocols for the management of rejection and administration of medications like ATG.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'2\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtra1\'>Edge Cases & Special Populations<\\/button><\\/h2><div id=\'collapseExtra1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><strong>De Novo DSA:<\\/strong> If DSA are newly positive and C4d staining is positive on biopsy, this indicates a new-onset antibody-mediated rejection process requiring therapies like plasmapheresis, IVIG, or Rituximab.<br><strong>Thrombotic Microangiopathy (TMA):<\\/strong> Can be a manifestation of severe AMR or CNI toxicity. Requires urgent differentiation and management.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtra2\'>Local Policy Notes<\\/button><\\/h2><div id=\'collapseExtra2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'>Many transplant centers have specific protocols for ATG administration, including dosing strategies (e.g., fixed dose vs. weight-based) and criteria for dose-holding based on hematological parameters. Always consult local guidelines.<\\/div><\\/div><\\/div><\\/div>\"}', '[]', NULL, NULL, '2025-09-18 19:13:17', '2025-09-18 19:12:39', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(3, NULL, 2, 1, 1, 'rtxpost-transplant-aki-rejection', 'Acute Allograft Dysfunction: Banff IIB Cellular Rejection H', NULL, 'published', 'A patient presenting with acute kidney injury (AKI) one week post-kidney transplantation requires a systematic and urgent evaluation. The differential diagnosis is broad, spanning vascular, immunological, drug-induced, and obstructive causes. A creatinine of 200 µmol/L in this context is a significant concern. While the patient is hemodynamically stable, prompt investigation is crucial to preserve graft function. The gold standard for diagnosis is an allograft biopsy. This case focuses on the management of a specific, severe form of T-cell mediated rejection: Banff Class IIB.', '{\"slug\":\"post-transplant-aki-rejection\",\"TOPIC\":\"Acute Allograft Dysfunction: Banff IIB Cellular Rejection\",\"CHIP_1\":\"Post-Transplant AKI\",\"CHIP_2\":\"Acute Cellular Rejection\",\"CHIP_3\":\"Banff IIB Management\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A patient presenting with acute kidney injury (AKI) one week post-kidney transplantation requires a systematic and urgent evaluation. The differential diagnosis is broad, spanning vascular, immunological, drug-induced, and obstructive causes. A creatinine of 200 \\u00b5mol\\/L in this context is a significant concern. While the patient is hemodynamically stable, prompt investigation is crucial to preserve graft function. The gold standard for diagnosis is an allograft biopsy. This case focuses on the management of a specific, severe form of T-cell mediated rejection: Banff Class IIB.\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u2705 Assess and secure airway, breathing, and circulation (ABCDE), even if initially stable.\",\"\\u2705 Establish dual large-bore intravenous access.\",\"\\u2705 Obtain a complete set of vital signs, including orthostatic measurements and temperature.\",\"\\ud83d\\udd0e Conduct a focused history: inquire about the transplant center, donor type (living\\/deceased), induction\\/maintenance immunosuppression, surgical complications, urine output, fever, local graft site symptoms (pain, swelling), and adherence to medications.\",\"\\ud83d\\udd0e Perform a thorough physical examination: assess volume status (JVP, edema, lung sounds), palpate the allograft for tenderness or swelling, and inspect the surgical wound.\",\"\\ud83e\\uddea Perform bedside urinalysis to check for proteinuria, hematuria, and signs of infection.\",\"\\ud83e\\uddea Send urgent laboratory investigations: complete blood count, urea and electrolytes, liver function tests, C-reactive protein, and coagulation profile.\",\"\\ud83d\\udc8a Send urgent trough levels of calcineurin inhibitors (Tacrolimus or Cyclosporine).\",\"\\ud83e\\uddea Send viral screening: BK virus and CMV PCR in blood.\",\"\\ud83d\\udd2c Arrange an urgent Doppler ultrasound of the renal allograft to assess graft perfusion, rule out renal artery or vein thrombosis, identify hydronephrosis, and exclude perinephric collections (hematoma, urinoma). A resistive index should be calculated.\",\"\\u26a0\\ufe0f Prepare for an urgent ultrasound-guided allograft biopsy as the definitive diagnostic step.\",\"\\ud83d\\udc8a Withhold any potentially nephrotoxic medications (e.g., NSAIDs, certain antibiotics) until a diagnosis is established.\",\"\\ud83d\\udcde Consult the primary transplant nephrology service immediately for guidance.\",\"\\ud83d\\udcdd Plan for admission to a specialized renal or transplant unit for further management.\"],\"ANSWER_STEPS_OL\":[\"\\\"This is a case of a patient presenting one week post-kidney transplantation from abroad with acute graft dysfunction, evidenced by a creatinine of 200 \\u00b5mol\\/L.\\\"\",\"\\\"First, I will perform a rapid ABCDE assessment to ensure the patient is hemodynamically stable. I will secure IV access and place the patient on continuous monitoring.\\\"\",\"\\\"Next, I will take a detailed history focusing on the transplant surgery, immunosuppressive regimen, medication adherence, and symptoms of rejection or infection. I will also perform a focused physical examination, paying close attention to the allograft site and the patient\'s volume status.\\\"\",\"\\\"My immediate investigations will include urgent blood tests for a full blood count, renal and liver profiles, CRP, calcineurin inhibitor trough levels, and PCR for BK virus and CMV.\\\"\",\"\\\"I will immediately request an urgent Doppler ultrasound of the allograft to rule out critical vascular complications such as renal artery stenosis or thrombosis, and to exclude obstruction or perinephric collections.\\\"\",\"\\\"The definitive investigation is an urgent allograft biopsy. The results here indicate Banff Class IIB acute cellular rejection, which is a moderate-to-severe T-cell mediated rejection involving significant tubulitis and potentially endarteritis.\\\"\",\"\\\"My management plan for Banff IIB rejection involves immediate initiation of high-dose corticosteroids. I will start with intravenous methylprednisolone, typically 500mg to 1g daily for 3 days.\\\"\",\"\\\"Given the severity of Banff IIB rejection, I will also initiate treatment with a T-cell depleting agent. My choice would be rabbit Anti-Thymocyte Globulin (ATG), administered at a dose of 1.5 mg\\/kg daily. The duration is typically 5 to 10 days, guided by the clinical response and monitoring of lymphocyte counts.\\\"\",\"\\\"Throughout treatment, I will monitor for side effects of immunosuppression, including cytokine release syndrome, leukopenia, thrombocytopenia, and opportunistic infections, for which I will provide appropriate prophylaxis (e.g., for Pneumocystis jirovecii).\\\"\",\"\\\"I will also ensure Donor-Specific Antibody (DSA) testing is performed using a Luminex-based assay to rule out a concurrent antibody-mediated component, which would require additional therapies such as plasmapheresis or IVIG.\\\"\"],\"DDX_BUCKET_1_TITLE\":\"Vascular & Perfusion Issues\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Renal artery thrombosis\",\"Renal vein thrombosis\",\"Transplant renal artery stenosis (TRAS)\",\"Severe hypovolemia \\/ Pre-renal azotemia\",\"External compression of the graft (e.g., hematoma, lymphocele)\"],\"DDX_BUCKET_2_TITLE\":\"Parenchymal (Allograft) Injury\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Acute T-cell mediated rejection (ACR)\",\"Acute antibody-mediated rejection (AMR)\",\"Calcineurin inhibitor (CNI) toxicity\",\"BK virus-associated nephropathy (BKVN)\",\"Acute tubular necrosis (ATN) from ischemia-reperfusion injury\",\"Recurrence of primary kidney disease (e.g., FSGS, IgA nephropathy)\",\"Drug-induced acute interstitial nephritis (AIN)\",\"Thrombotic microangiopathy (TMA)\"],\"DDX_BUCKET_3_TITLE\":\"Urological & Post-Renal Issues\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Ureteral obstruction (e.g., clot, stricture, stone)\",\"Urine leak from ureteric anastomosis\",\"Bladder outlet obstruction\"],\"DIFFERENTIAL_FOCUS_HTML\":\"<div class=\'accordion\' id=\'ddxFocusAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOne\' aria-expanded=\'true\' aria-controls=\'collapseOne\'>ACR vs. AMR vs. CNI Toxicity vs. BKVN<\\/button><\\/h2><div id=\'collapseOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingOne\' data-bs-parent=\'#ddxFocusAccordion\'><div class=\'accordion-body\'><table class=\'table table-bordered\'><thead><tr><th>Feature<\\/th><th>Acute Cellular Rejection (ACR)<\\/th><th>Antibody-Mediated Rejection (AMR)<\\/th><th>CNI Toxicity<\\/th><th>BK Virus Nephropathy (BKVN)<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Pathophysiology<\\/b><\\/td><td>T-lymphocyte infiltration of tubules and interstitium.<\\/td><td>Donor-specific antibodies (DSA) causing endothelial injury.<\\/td><td>Afferent arteriolar vasoconstriction and direct tubular toxicity.<\\/td><td>Polyomavirus replication in tubular epithelial cells.<\\/td><\\/tr><tr><td><b>Key Biopsy Findings<\\/b><\\/td><td>Tubulitis (t-lesion), interstitial inflammation (i-lesion), endarteritis (v-lesion). C4d negative.<\\/td><td>Microvascular inflammation (glomerulitis, peritubular capillaritis), C4d deposition in peritubular capillaries, DSA positive.<\\/td><td>Isometric tubular vacuolization, arteriolar hyalinosis, thrombotic microangiopathy (in severe cases). Minimal inflammation.<\\/td><td>Intranuclear viral inclusion bodies, positive SV40 staining, interstitial inflammation.<\\/td><\\/tr><tr><td><b>Clinical Clues<\\/b><\\/td><td>Often occurs early post-transplant. May have fever, graft tenderness.<\\/td><td>Can occur anytime, higher risk in sensitized patients. Can be very aggressive.<\\/td><td>High CNI trough levels. Dose-dependent. Often a diagnosis of exclusion.<\\/td><td>Usually >1 month post-transplant. Often associated with over-immunosuppression. Screen with urine\\/serum PCR.<\\/td><\\/tr><tr><td><b>Treatment<\\/b><\\/td><td>Corticosteroids, Anti-thymocyte globulin (ATG) for severe cases.<\\/td><td>Plasmapheresis, IVIG, Rituximab, Bortezomib.<\\/td><td>Reduce CNI dose. Switch to another agent if necessary.<\\/td><td>Reduce overall immunosuppression. Agents like cidofovir or leflunomide are of unproven benefit.<\\/td><\\/tr><\\/tbody><\\/table><\\/div><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<b>Bedside:<\\/b> Urinalysis (dipstick and microscopy).\",\"<b>Bloods:<\\/b> FBC, U&E, LFT, CRP, Tacrolimus\\/Cyclosporine level, Bone profile, Glucose.\",\"<b>Immunology:<\\/b> Donor-Specific Antibodies (DSA) by Luminex single antigen bead assay.\",\"<b>Virology:<\\/b> BK Virus PCR (blood and urine), CMV PCR (blood).\",\"<b>Imaging:<\\/b> Urgent Doppler ultrasound of the renal allograft.\",\"<b>Definitive:<\\/b> Urgent ultrasound-guided allograft biopsy for light microscopy, immunofluorescence (including C4d), and electron microscopy.\"],\"PILLAR_1\":\"Treating Rejection\",\"STEP_1_TITLE\":\"Pulse Corticosteroid Therapy\",\"STEP_1_LI\":[\"\\ud83d\\udc8a Administer high-dose intravenous methylprednisolone.\",\"<b>Dose:<\\/b> Typically 500mg to 1g daily for 3 consecutive days.\",\"This is the first-line treatment for all significant cellular rejection.\"],\"STEP_2_TITLE\":\"T-Cell Depleting Therapy for Severe Rejection\",\"STEP_2_LI\":[\"\\u26a0\\ufe0f For Banff Grade IIB or higher, or steroid-resistant rejection, initiate lymphocyte-depleting antibody therapy.\",\"<b>Drug of Choice:<\\/b> Rabbit Anti-Thymocyte Globulin (Thymoglobulin\\u00ae).\",\"<b>Dose:<\\/b> 1.5 mg\\/kg\\/day intravenously. Dose is adjusted based on total lymphocyte or CD3+ cell count.\",\"<b>Duration:<\\/b> Typically 5-10 days, depending on clinical response and side effects.\",\"<b>Monitoring:<\\/b> Daily FBC. Monitor for cytokine release syndrome (fever, chills, hypotension) with the first doses and provide premedication (paracetamol, antihistamine, hydrocortisone).\"],\"PILLAR_2\":\"Supportive Care & Monitoring\",\"STEP_3_TITLE\":\"Infection Prophylaxis\",\"STEP_3_LI\":[\"\\u2705 Start prophylaxis against Pneumocystis jirovecii (PJP) with co-trimoxazole.\",\"\\u2705 Start prophylaxis against CMV (e.g., valganciclovir), especially during ATG therapy.\",\"\\u2705 Consider antifungal and oral candidiasis prophylaxis (e.g., nystatin).\"],\"STEP_4_TITLE\":\"Follow-up and Adjustment\",\"STEP_4_LI\":[\"\\ud83e\\uddea Monitor creatinine daily to assess response to therapy.\",\"\\ud83e\\uddea Monitor lymphocyte counts daily during ATG therapy to guide dosing.\",\"\\ud83d\\udd0e Adjust maintenance immunosuppression. Often, the baseline CNI and antiproliferative agent doses are maintained or cautiously increased after the acute phase.\",\"\\ud83d\\udd2c Consider a follow-up biopsy after 2-3 weeks if the response is suboptimal to assess for persistent rejection or concurrent AMR.\"],\"PHARMACOLOGY_TABLE_HTML\":\"<table class=\'table table-striped\'><thead><tr><th>Drug<\\/th><th>Mechanism<\\/th><th>Dose & Administration<\\/th><th>Key Monitoring \\/ Side Effects<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Methylprednisolone<\\/b><\\/td><td>Broad anti-inflammatory and immunosuppressive effects. Inhibits cytokine gene transcription.<\\/td><td>500mg - 1g IV daily for 3 days.<\\/td><td>Hyperglycemia, hypertension, fluid retention, mood changes, increased infection risk, avascular necrosis (long-term).<\\/td><\\/tr><tr><td><b>Anti-thymocyte Globulin (ATG, Rabbit)<\\/b><\\/td><td>Polyclonal antibody that depletes circulating T-lymphocytes by complement-dependent lysis and apoptosis.<\\/td><td>1.5 mg\\/kg IV daily for 5-10 days. Administer via a central line if possible. Pre-medicate with corticosteroids, antihistamines, and paracetamol.<\\/td><td><b>Monitoring:<\\/b> FBC (for leukopenia, thrombocytopenia), CD3+ lymphocyte counts. <br><b>Side Effects:<\\/b> Cytokine release syndrome, serum sickness, increased risk of infection (CMV, PJP) and PTLD.<\\/td><\\/tr><\\/tbody><\\/table>\",\"TOPIC_BLOCK_A_TITLE\":\"Banff Classification of T-Cell Mediated Rejection (Abbreviated)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<b>Grade I (A\\/B):<\\/b> Significant interstitial inflammation and tubulitis. IA: >25% inflammation (i2\\/3) and moderate tubulitis (t2). IB: >25% inflammation (i2\\/3) and severe tubulitis (t3).\",\"<b>Grade II (A\\/B):<\\/b> Intimal arteritis (endothelialitis). IIA: Mild-to-moderate arteritis (v1). IIB: Severe arteritis (v2).\",\"<b>Grade III:<\\/b> Transmural arteritis or arterial fibrinoid necrosis (v3).\",\"<b>Borderline:<\\/b> Foci of tubulitis (t1) and mild interstitial inflammation (i1) or vice versa. Does not meet criteria for full rejection.\"],\"TOPIC_BLOCK_B_TITLE\":\"Donor-Specific Antibody (DSA) Testing\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<b>Method:<\\/b> Luminex Single Antigen Bead (SAB) assay is the gold standard.\",\"<b>Principle:<\\/b> Patient\'s serum is incubated with microbeads, each coated with a single, specific HLA antigen.\",\"<b>Detection:<\\/b> If DSAs are present, they bind to the corresponding beads. A fluorescently-labeled secondary antibody detects this binding.\",\"<b>Result:<\\/b> The intensity of the fluorescence is measured as Mean Fluorescence Intensity (MFI). Higher MFI correlates with higher antibody strength.\",\"<b>Significance:<\\/b> Crucial to identify concurrent antibody-mediated rejection (AMR), which requires different treatment.\"],\"TOPIC_BLOCK_C_TITLE\":\"ATG Administration Pearls\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<b>Administration:<\\/b> Infuse over 4-6 hours. A central line is preferred to reduce risk of phlebitis.\",\"<b>Pre-medication:<\\/b> Essential for the first 1-2 doses to mitigate cytokine release syndrome. Typically includes IV hydrocortisone (e.g., 100mg), an antihistamine (e.g., chlorpheniramine), and an antipyretic (e.g., paracetamol).\",\"<b>Dose Adjustment:<\\/b> Daily dose is often adjusted based on lymphocyte count. Hold if WBC <span class=\'hl-symbol\'><<\\/span> 2.0x10\\u2079\\/L or Platelets <span class=\'hl-symbol\'><<\\/span> 50x10\\u2079\\/L. Resume at 50% dose when counts recover.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-header\'>Post-Transplant AKI Workup<\\/div><div class=\'card-body\'><p><b>\'PRUNES\' Mnemonic for DDx:<\\/b><\\/p><ul><li><b>P<\\/b>erfusion (Thrombosis, Stenosis, Hypotension)<\\/li><li><b>R<\\/b>ejection (ACR\\/AMR)<\\/li><li><b>U<\\/b>rology (Obstruction, Leak)<\\/li><li><b>N<\\/b>ephrotoxicity (CNI, Drugs) \\/ BKV<b>N<\\/b><\\/li><li><b>E<\\/b>tiology (Recurrent\\/De Novo Disease)<\\/li><li><b>S<\\/b>epsis<\\/li><\\/ul><\\/div><\\/div>\",\"EMERGENCY_ALGORITHM_HTML\":\"<div><h4>Management of Severe (Banff IIB) ACR<\\/h4><ol><li>Confirm diagnosis with biopsy.<\\/li><li>Rule out concurrent AMR with DSA\\/C4d staining.<\\/li><li>Administer IV Methylprednisolone Pulse (500mg-1g x 3 days).<\\/li><li>Initiate Anti-Thymocyte Globulin (ATG) at 1.5 mg\\/kg\\/day.<\\/li><li>Provide PJP and antiviral prophylaxis.<\\/li><li>Monitor FBC and lymphocyte counts daily.<\\/li><li>Adjust ATG dose based on counts.<\\/li><li>Monitor creatinine for response. If no improvement, re-evaluate for steroid resistance or mixed rejection.<\\/li><\\/ol><\\/div>\",\"ASCII_FLOWCHART_PRE\":\"Patient 1 week post-KTX, Creatinine 200\\n          |\\n      [Stable? -> Yes]\\n          |\\n  [Urgent Doppler US]\\n          |            |\\n[No Vascular Issue]  [Vascular Issue -> Interventional Radiology\\/Surgery]\\n          |\\n  [Urgent Allograft Biopsy]\\n          |            \\n [Banff IIB ACR Found]\\n          |\\n  [Start IV Methylprednisolone Pulse]\\n          |\\n  [Start Anti-Thymocyte Globulin (ATG)]\\n          |\\n  [Monitor Daily: Creatinine, FBC, Lymphocytes]\\n          |                                  |\\n[Response -> Complete course]   [No Response -> Re-evaluate\\/Consider repeat biopsy]\",\"CONCEPT_DIAGRAM_HTML\":\"\",\"QUALITY_PROCESS_LI\":[\"Time to Doppler ultrasound from presentation <span class=\'hl-symbol\'><<\\/span> 4 hours.\",\"Time to allograft biopsy from decision <span class=\'hl-symbol\'><<\\/span> 24 hours.\",\"Prophylaxis for PJP and CMV initiated with ATG therapy.\",\"Daily monitoring of FBC and lymphocyte counts during ATG therapy.\"],\"QUALITY_OUTCOME_LI\":[\"Return of serum creatinine to within 25% of baseline within 14 days of starting treatment.\",\"Avoidance of major infectious complications during treatment.\",\"Avoidance of ATG-related severe leukopenia (<1.0x10\\u2079\\/L) or thrombocytopenia (<50x10\\u2079\\/L).\",\"Graft survival at 1 year post-rejection episode.\"],\"QUALITY_SAFETY_LI\":[\"Allergy check before administering ATG.\",\"Use of pre-medication for ATG to prevent cytokine release syndrome.\",\"Central line preferred for ATG administration.\",\"Patient education on signs of infection and importance of prophylaxis adherence.\"],\"PITFALLS_LI\":[\"\\u26a0\\ufe0f Attributing allograft dysfunction solely to CNI toxicity without a biopsy.\",\"\\u26a0\\ufe0f Missing a concurrent antibody-mediated rejection component.\",\"\\u26a0\\ufe0f Under-dosing or prematurely stopping ATG in severe rejection.\",\"\\u26a0\\ufe0f Failing to provide adequate antimicrobial prophylaxis during intensive immunosuppression.\",\"\\u26a0\\ufe0f Delaying biopsy in a \'stable\' patient, allowing irreversible damage to occur.\"],\"SAFETY_LI\":[\"\\ud83d\\udea8 Be vigilant for signs of Cytokine Release Syndrome (CRS) after the first ATG dose (fever, rigors, hypotension, hypoxia).\",\"\\ud83d\\udea8 Monitor for profound leukopenia and thrombocytopenia with ATG.\",\"\\ud83d\\udea8 Ensure adequate hydration and glycemic control during high-dose steroid therapy.\",\"\\ud83d\\udea8 Counsel patients about the heightened risk of infection and to report any symptoms promptly.\"],\"COMMUNICATION_LI\":[\"\\ud83d\\udcac Explain to the patient that their new kidney is being \'attacked\' by their own immune system, and that strong medicines are needed to stop this.\",\"\\ud83d\\udcac Clearly outline the treatment plan, duration, and potential side effects of steroids and ATG.\",\"\\ud83d\\udcac Emphasize the critical importance of adhering to the intensive monitoring schedule and prophylactic medications.\",\"\\ud83d\\udcac Discuss the prognosis for graft recovery while managing expectations, explaining that this is a serious but often treatable complication.\"],\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseScenariosAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseOne\' aria-expanded=\'true\' aria-controls=\'caseCollapseOne\'>Scenario 1: Post-ATG Fever and Hypotension<\\/button><\\/h2><div id=\'caseCollapseOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'caseHeadingOne\'><div class=\'accordion-body\'><b>Situation:<\\/b> 4 hours into the first infusion of ATG, the patient develops a fever of 39.1\\u00b0C, rigors, and their blood pressure drops to 85\\/50 mmHg. <br><b>Management:<\\/b> 1. Stop the ATG infusion immediately. 2. Administer IV fluids. 3. Give additional IV hydrocortisone and antihistamines. 4. Perform a sepsis workup (blood cultures, etc.) to rule out infection, but the primary diagnosis is Cytokine Release Syndrome. 5. Once stable, the ATG infusion can be cautiously restarted at a slower rate. Subsequent doses will require robust pre-medication.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingTwo\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseTwo\' aria-expanded=\'false\' aria-controls=\'caseCollapseTwo\'>Scenario 2: Rising Creatinine Despite 3 Days of Treatment<\\/button><\\/h2><div id=\'caseCollapseTwo\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><b>Situation:<\\/b> After 3 days of methylprednisolone and 2 doses of ATG, the creatinine has risen from 200 to 250 \\u00b5mol\\/L. DSA results return positive with a high MFI against a donor HLA antigen. The biopsy C4d stain was negative. <br><b>Management:<\\/b> This suggests a component of C4d-negative, DSA-positive antibody-mediated rejection. The treatment plan must be augmented to target the humoral response. Start plasmapheresis or immunoadsorption immediately. Administer IVIG after plasmapheresis. Continue ATG as planned for the cellular component.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'caseHeadingThree\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#caseCollapseThree\' aria-expanded=\'false\' aria-controls=\'caseCollapseThree\'>Scenario 3: Profound Leukopenia on Day 4 of ATG<\\/button><\\/h2><div id=\'caseCollapseThree\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><b>Situation:<\\/b> On day 4 of ATG therapy, the patient\'s WBC count drops to 1.5x10\\u2079\\/L and the absolute lymphocyte count is 0.01x10\\u2079\\/L. <br><b>Management:<\\/b> 1. Hold today\'s dose of ATG. 2. Also hold the maintenance anti-proliferative agent (e.g., mycophenolate). 3. Consider giving G-CSF if neutropenia is severe or prolonged. 4. Monitor FBC daily. Once the WBC count recovers to >2.0-2.5x10\\u2079\\/L, ATG can be cautiously restarted, typically at 50% of the previous dose.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the mechanism of action of Anti-Thymocyte Globulin (ATG)?\",\"a\":\"ATG is a polyclonal antibody derived from rabbits immunized with human thymocytes. It works primarily by causing profound depletion of circulating T-lymphocytes through complement-dependent cytotoxicity and apoptosis. It also modulates T-cell surface molecules, impairing their function.\"},{\"q\":\"What are the main toxicities of ATG?\",\"a\":\"The main toxicities are: 1. Cytokine Release Syndrome with first doses. 2. Hematological effects like leukopenia and thrombocytopenia. 3. Increased risk of opportunistic infections, particularly CMV and PJP. 4. Increased long-term risk of post-transplant lymphoproliferative disorder (PTLD). 5. Serum sickness, a delayed hypersensitivity reaction.\"},{\"q\":\"How would you differentiate CNI toxicity from acute cellular rejection on a biopsy?\",\"a\":\"CNI toxicity classically shows isometric vacuolization of proximal tubular cells and arteriolar hyalinosis with minimal or no inflammation. In contrast, acute cellular rejection is an inflammatory process characterized by interstitial inflammation (i-lesion) and tubulitis (t-lesion), with lymphocytes invading the tubular epithelium. Endarteritis (v-lesion) can also be seen in ACR.\"},{\"q\":\"The user asks you to explain how a Luminex assay for DSA works. How do you respond?\",\"a\":\"\\\"The Luminex Single Antigen Bead assay is our most sensitive method for detecting donor-specific antibodies. It uses tiny colour-coded beads, where each colour corresponds to a bead coated with a single, specific HLA protein. We mix the patient\'s serum with this panel of beads. If the patient has an antibody against a specific HLA protein, it will bind to the corresponding bead. We then add a second antibody that is fluorescent, which binds to the patient\'s antibody. A laser-based instrument then identifies the bead\'s colour and measures the amount of fluorescence. This is reported as the Mean Fluorescence Intensity, or MFI, which tells us the strength of that particular antibody.\\\"\"},{\"q\":\"What MFI level do you consider clinically significant?\",\"a\":\"There is no universal MFI threshold, and it varies between centers and clinical contexts. However, an MFI >1000-2000 is often considered potentially significant and requires careful clinical correlation. Very high MFIs (>5000-10000) are strongly associated with antibody-mediated rejection.\"},{\"q\":\"Why is C4d staining important in a transplant biopsy?\",\"a\":\"C4d is a breakdown product of the classical complement pathway. Its deposition in peritubular capillaries is a key marker of antibody-mediated rejection. It indicates that circulating donor-specific antibodies have bound to the graft endothelium and activated the complement cascade, leading to tissue injury.\"},{\"q\":\"Can you have antibody-mediated rejection with a negative C4d stain?\",\"a\":\"Yes. This is known as C4d-negative AMR. It can be mediated by antibodies that do not efficiently fix complement or by other mechanisms of endothelial injury. The diagnosis in these cases relies on the presence of circulating DSA and histological evidence of microvascular inflammation (glomerulitis and peritubular capillaritis).\"},{\"q\":\"What are the indications for dialysis (AEIOU)?\",\"a\":\"The classic AEIOU mnemonic stands for: Acidosis (severe, refractory metabolic acidosis), Electrolyte abnormalities (refractory hyperkalemia), Intoxication (with a dialyzable toxin), Overload (refractory fluid overload), and Uremia (symptomatic uremia, e.g., pericarditis, encephalopathy).\"},{\"q\":\"What are the typical sonographic features of transplant renal artery stenosis (TRAS)?\",\"a\":\"Doppler US findings suggesting TRAS include high peak systolic velocity (PSV) at the site of stenosis (typically >200-250 cm\\/s), a renal-aortic ratio (RAR) of PSV > 3.5, and a \'parvus et tardus\' waveform (slow and delayed systolic upstroke) in the intra-renal arteries.\"},{\"q\":\"What is the management of BK virus nephropathy?\",\"a\":\"The mainstay of treatment is reduction of overall immunosuppression to allow the host immune system to clear the virus. This typically involves reducing or stopping the anti-proliferative agent (mycophenolate) first, followed by a reduction in the CNI dose. There are no proven effective antiviral agents, although cidofovir, leflunomide, and IVIG have been used in some cases with anecdotal success.\"}],\"TEACHING_CONCEPTS_LI\":[\"<b>Systematic Approach:<\\/b> A structured approach to post-transplant AKI using the \'PRUNES\' mnemonic helps ensure all major causes are considered.\",\"<b>Biopsy is Gold Standard:<\\/b> Clinical signs and non-invasive tests can be suggestive, but an allograft biopsy is essential for a definitive diagnosis and to guide specific therapy.\",\"<b>Rejection is a Spectrum:<\\/b> Rejection is not a single entity. It can be T-cell mediated, antibody-mediated, or mixed. The treatment differs significantly for each type.\",\"<b>Balancing Immunosuppression:<\\/b> The core challenge in transplant medicine is balancing the need to suppress the immune system enough to prevent rejection, without over-suppressing it and causing infection or malignancy. Treatment for rejection is a period of intentionally high risk.\"],\"TEACHING_MISTAKES_LI\":[\"<b>\'Dialysis-level Creatinine\':<\\/b> Avoid anchoring on a specific creatinine value to start treatment. The trajectory and clinical context are more important than the absolute number.\",\"<b>Ignoring the Doppler:<\\/b> A Doppler ultrasound is not just for \'ruling out obstruction.\' It provides vital information on graft perfusion and vascular integrity that is crucial in the first few weeks.\",\"<b>Treating the CNI level, not the patient:<\\/b> A \'therapeutic\' tacrolimus level does not rule out rejection, and a \'high\' level does not automatically mean CNI toxicity is the sole cause of AKI.\",\"<b>Delaying Rejection Treatment:<\\/b> Delaying potent therapy for severe rejection while \'waiting to see\' if creatinine improves with fluids can lead to irreversible fibrosis and graft loss.\"],\"EVIDENCE_STUDIES_LI\":[\"<b>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009):<\\/b> Provides comprehensive recommendations on the diagnosis and management of rejection.\",\"<b>Brennan DC, et al. N Engl J Med 2006:<\\/b> A key trial comparing ATG vs. Basiliximab for induction, showing ATG\'s potency in high-risk patients.\",\"<b>Pascual J, et al. J Am Soc Nephrol 2018:<\\/b> TRANSFORM study showing everolimus with reduced CNI is non-inferior to standard CNI\\/MPA for efficacy, with less viral infection.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"For severe T-cell mediated rejection (Banff IIA or higher), treatment with a lymphocyte-depleting antibody is recommended over simply increasing corticosteroid doses (KDIGO).\",\"Screening for BK virus by monitoring plasma nucleic acid testing is recommended post-transplant to allow for pre-emptive reduction in immunosuppression (KDIGO).\",\"Ruling out AMR is crucial in any case of graft dysfunction, particularly if there is a suboptimal response to standard cellular rejection therapy.\"],\"GUIDELINE_ANCHORS_LI\":[\"<b>KDIGO (Kidney Disease: Improving Global Outcomes):<\\/b> Provides the international standard for diagnosis and management of kidney transplant complications, including rejection.\",\"<b>American Society of Transplantation (AST):<\\/b> Offers updated guidelines and consensus statements on various aspects of transplant care, including management of infections and rejection.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extraHeadingOne\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extraCollapseOne\' aria-expanded=\'false\' aria-controls=\'extraCollapseOne\'>Schema Omission Log<\\/button><\\/h2><div id=\'extraCollapseOne\' class=\'accordion-collapse collapse\' aria-labelledby=\'extraHeadingOne\'><div class=\'accordion-body\'><ul><li><b>CONCEPT_DIAGRAM_HTML:<\\/b> Left empty as a simple text-based flowchart in ASCII_FLOWCHART_PRE was deemed more clear and direct for this clinical pathway.<\\/li><li><b>ADDITIONAL_SECTIONS_HTML:<\\/b> No significant unmapped content remained after populating the primary schema fields. All relevant information was integrated into the main sections.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '[]', NULL, NULL, '2025-09-18 20:10:16', '2025-09-18 20:10:16', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(4, NULL, 4, 1, 1, 'acute-allograft-dysfunction-banff-2b', 'Acute Kidney Allograft Dysfunction', 'Post-Transplant AKI • Acute Cellular Rejection • Banff Grade IIB', 'published', 'A patient presenting with a rise in serum creatinine one week post-kidney transplantation requires urgent and systematic evaluation. The differential diagnosis is broad, spanning pre-renal, intrinsic renal, and post-renal causes, with acute rejection and calcineurin inhibitor (CNI) toxicity being primary concerns. The goal is to rapidly identify and treat reversible causes to preserve long-term graft function.', '{\"slug\":\"acute-allograft-dysfunction-banff-2b\",\"TOPIC\":\"Acute Kidney Allograft Dysfunction\",\"CHIP_1\":\"Post-Transplant AKI\",\"CHIP_2\":\"Acute Cellular Rejection\",\"CHIP_3\":\"Banff Grade IIB\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p>A patient presenting with a rise in serum creatinine one week post-kidney transplantation requires urgent and systematic evaluation. The differential diagnosis is broad, spanning pre-renal, intrinsic renal, and post-renal causes, with acute rejection and calcineurin inhibitor (CNI) toxicity being primary concerns. The goal is to rapidly identify and treat reversible causes to preserve long-term graft function.<\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u2705 Confirm patient stability using an ABCDE approach.\",\"\\u2705 Secure dual large-bore IV access and send baseline bloods.\",\"\\u2705 Obtain precise vital signs, including orthostatic measurements and accurate fluid balance.\",\"\\u2705 Perform a focused clinical examination, assessing volume status, palpating the graft for tenderness, and examining the surgical site.\",\"\\u2705 Conduct a targeted history: inquire about timeline of creatinine rise, urine output, fever, graft pain, medication adherence (especially immunosuppressants), and any new medications or hypotensive episodes.\",\"\\u2705 Perform bedside tests: urine dipstick for protein and blood, and a point-of-care glucose.\",\"\\u2705 Order urgent laboratory investigations: FBC, urea & electrolytes, LFTs, CRP, and coagulation screen.\",\"\\u2705 Order STAT trough levels of calcineurin inhibitors (Tacrolimus or Cyclosporine).\",\"\\u2705 Request an urgent renal ultrasound with Doppler to assess graft perfusion, rule out hydronephrosis, and exclude vascular complications like renal artery stenosis (TRAS) or renal vein thrombosis.\",\"\\u2705 Screen for BK virus and CMV by sending blood for PCR quantification.\",\"\\u2705 Review the patient\'s transplant records, including donor characteristics, HLA mismatch, and initial immunosuppression protocol.\",\"\\u2705 Consult the on-call nephrology\\/transplant team immediately to coordinate further management.\",\"\\u2705 Arrange for an urgent ultrasound-guided allograft biopsy, the gold standard for diagnosis.\",\"\\u2705 Withhold nephrotoxic agents (e.g., NSAIDs, ACEi\\/ARBs) until a clear diagnosis is established.\",\"\\u2705 Ensure clear communication with the primary transplanting center, especially as the transplant occurred abroad.\"],\"DDX_BUCKET_1_TITLE\":\"Vascular & Pre-Renal Causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"<strong>Hypovolemia:<\\/strong> Dehydration, diuretic use, diarrhea.\",\"<strong>Renal Artery Stenosis (TRAS):<\\/strong> Typically presents later but can be acute; look for a bruit over the graft.\",\"<strong>Renal Vein Thrombosis:<\\/strong> A rare but catastrophic event causing graft swelling, pain, and heavy proteinuria.\",\"<strong>Thrombotic Microangiopathy (TMA):<\\/strong> Can be CNI-induced or recurrent.\",\"<strong>Cardiorenal Syndrome:<\\/strong> Acute decompensated heart failure reducing graft perfusion.\"],\"DDX_BUCKET_2_TITLE\":\"Intrinsic Allograft Causes\",\"DDX_BUCKET_2_ITEMS_LI\":[\"<strong>Acute T-Cell Mediated Rejection (TCMR):<\\/strong> Most common cause in the early post-transplant period.\",\"<strong>Acute Antibody-Mediated Rejection (AMR):<\\/strong> Assessed via C4d staining and donor-specific antibodies (DSA).\",\"<strong>Calcineurin Inhibitor (CNI) Toxicity:<\\/strong> Dose-dependent vasoconstriction of the afferent arteriole.\",\"<strong>Acute Tubular Necrosis (ATN):<\\/strong> Can be prolonged post-transplant, especially with deceased donors or ischemic injury.\",\"<strong>BK Virus Nephropathy (BKVN):<\\/strong> Viral replication causing tubulointerstitial nephritis.\",\"<strong>Recurrent or De Novo Glomerulonephritis:<\\/strong> Less common in the first week but possible.\",\"<strong>Drug-induced Acute Interstitial Nephritis (AIN):<\\/strong> Caused by antibiotics (e.g., piperacillin-tazobactam), PPIs.\"],\"DDX_BUCKET_3_TITLE\":\"Post-Renal Causes\",\"DDX_BUCKET_3_ITEMS_LI\":[\"<strong>Ureteral Obstruction:<\\/strong> Caused by blood clots, stricture at the vesicoureteric anastomosis, or external compression (e.g., lymphocele, hematoma).\",\"<strong>Urine Leak:<\\/strong> From the ureteric anastomosis, leading to urinoma formation and potential infection.\",\"<strong>Bladder Outlet Obstruction:<\\/strong> Less common but consider in older males with BPH.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>Post-Transplant AKI<\\/h5><p class=\'card-text\'>Systematic approach is key. Exclude obstruction and vascular issues first.<\\/p><ul class=\'list-group list-group-flush\'><li class=\'list-group-item\'><strong>1. Doppler US:<\\/strong> Rule out hydronephrosis & check vascular flow.<\\/li><li class=\'list-group-item\'><strong>2. CNI Levels:<\\/strong> Check Tacrolimus\\/Cyclosporine trough.<\\/li><li class=\'list-group-item\'><strong>3. Biopsy:<\\/strong> Gold standard to differentiate rejection vs. ATN vs. CNI toxicity.<\\/li><\\/ul><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Laboratory Tests:<\\/strong> Full blood count, urea and electrolytes (serial), liver function tests, bone profile, C-reactive protein.\",\"\\ud83d\\udc8a <strong>Drug Levels:<\\/strong> Trough Tacrolimus or Cyclosporine level (STAT).\",\"\\ud83e\\udda0 <strong>Virology:<\\/strong> BK Virus and CMV PCR quantification in blood.\",\"\\ud83d\\udca7 <strong>Urinalysis:<\\/strong> Urine microscopy for cells\\/casts, urine protein-creatinine ratio (uPCR).\",\"\\u2764\\ufe0f <strong>Immunology:<\\/strong> Donor-Specific Antibody (DSA) testing using Luminex assay (if rejection is suspected).\",\"\\ud83d\\udd2c <strong>Imaging:<\\/strong> Urgent renal allograft ultrasound with Doppler.\",\"\\ud83d\\udd0e <strong>Definitive Diagnosis:<\\/strong> Ultrasound-guided allograft biopsy for histology (light microscopy, immunofluorescence, electron microscopy) and C4d staining, evaluated using the Banff classification.\"],\"EMERGENCY_ALGORITHM_HTML\":\"<pre class=\'text-white bg-dark p-2 rounded\'>Stable patient + Creatinine > 200 umol\\/L (1 week post-KTx)\\n  |\\n  +--[Perform Immediate Priorities (Vitals, Exam, IV access)]\\n  |\\n  +--[STAT Labs: U&E, FBC, CNI Level, BK\\/CMV PCR]\\n  |\\n  +--[Urgent Doppler Ultrasound]\\n      |\\n      +--[Obstruction?] --(YES)--&gt; Urology consult for stent\\/nephrostomy\\n      |\\n      +--[Vascular issue (TRAS\\/Thrombosis)?] --(YES)--&gt; Interventional Radiology consult\\n      |\\n      +--[No obstruction\\/vascular issue?] --(PROCEED)--&gt; Allograft Biopsy\\n          |\\n          +--[Biopsy Result: Banff 2B Rejection]\\n              |\\n              +--[Initiate high-dose pulse steroids]\\n              |\\n              +--[Consider ATG for steroid-resistance or severe presentation]\\n              |\\n              +--[Optimize baseline immunosuppression]\\n<\\/pre>\",\"PILLAR_1\":\"Diagnosis & Risk Stratification\",\"STEP_1_TITLE\":\"Initial Workup\",\"STEP_1_LI\":[\"<strong>Clinical Assessment:<\\/strong> Thorough history focusing on medication adherence, infectious symptoms, and hemodynamic stability.\",\"<strong>Laboratory Evaluation:<\\/strong> Obtain serial creatinine, CNI trough levels, and screen for viral pathogens (BK, CMV).\",\"<strong>Imaging:<\\/strong> An urgent Doppler ultrasound is mandatory to exclude surgical or vascular complications as the cause of graft dysfunction.\"],\"STEP_2_TITLE\":\"Definitive Diagnosis: Allograft Biopsy\",\"STEP_2_LI\":[\"<strong>Indication:<\\/strong> Allograft biopsy is the gold standard for diagnosing the cause of graft dysfunction when obstruction and vascular issues are ruled out.\",\"<strong>Procedure:<\\/strong> Performed under ultrasound guidance with adequate sampling (at least two cores, including cortex and medulla).\",\"<strong>Analysis:<\\/strong> Histology is evaluated using the Banff classification to grade T-cell mediated rejection (TCMR), antibody-mediated rejection (AMR), and other pathologies.\",\"<strong>Banff Score:<\\/strong> A \'t\' score reflects tubulitis, \'i\' interstitial inflammation, and \'v\' intimal arteritis. A score of v1 or greater is highly significant.\"],\"PILLAR_2\":\"Management of Acute Cellular Rejection (Banff IIB)\",\"STEP_3_TITLE\":\"First-Line Therapy\",\"STEP_3_LI\":[\"<strong>Pulse Steroids:<\\/strong> The mainstay of treatment for acute cellular rejection is high-dose intravenous methylprednisolone (e.g., 500 mg to 1 g daily for 3 days).\",\"<strong>Optimize Baseline Immunosuppression:<\\/strong> Ensure CNI levels are in the target therapeutic range and consider adjusting mycophenolate mofetil (MMF) or azathioprine doses.\",\"<strong>Prophylaxis:<\\/strong> Initiate gastroprotection (e.g., PPI) and prophylaxis against Pneumocystis jirovecii (PJP) and oral candidiasis.\"],\"STEP_4_TITLE\":\"Second-Line & Follow-up\",\"STEP_4_LI\":[\"<strong>Lymphocyte-Depleting Agents:<\\/strong> For steroid-resistant or severe rejection (like Banff IIB or III), Antithymocyte Globulin (ATG) is used. Dosing is typically 1-1.5 mg\\/kg for 5-10 days, adjusted based on lymphocyte counts.\",\"<strong>Monitoring:<\\/strong> Closely monitor creatinine, CNI levels, and full blood count (especially lymphocyte and platelet counts with ATG).\",\"<strong>Surveillance:<\\/strong> Repeat biopsy may be considered if graft function does not improve as expected.\",\"<strong>DSA Assessment:<\\/strong> Check for development of de novo donor-specific antibodies (dnDSA), as this may indicate a mixed rejection pattern requiring additional therapy.\"],\"TOPIC_BLOCK_A_TITLE\":\"Banff Classification of Acute T-Cell Mediated Rejection (TCMR)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<strong>Borderline:<\\/strong> Foci of tubulitis (t1, t2, or t3) with minor interstitial inflammation (i0 or i1), or interstitial inflammation (i2 or i3) with only mild tubulitis (t1).\",\"<strong>Grade IA:<\\/strong> Significant interstitial inflammation (i <span class=\'hl-symbol\'>><\\/span>25% of cortex, i2 or i3) AND significant tubulitis (t2 or t3 in <span class=\'hl-symbol\'>><\\/span>1 tubule).\",\"<strong>Grade IB:<\\/strong> Significant interstitial inflammation (i <span class=\'hl-symbol\'>><\\/span>25% of cortex, i2 or i3) AND severe tubulitis (t3 in <span class=\'hl-symbol\'>><\\/span>1 tubule).\",\"<strong>Grade IIA:<\\/strong> Mild-to-moderate intimal arteritis (v1).\",\"<strong>Grade IIB:<\\/strong> Severe intimal arteritis with <span class=\'hl-symbol\'>><\\/span>25% luminal occlusion (v2).\",\"<strong>Grade III:<\\/strong> Transmural arteritis and\\/or arterial fibrinoid necrosis (v3).\"],\"TOPIC_BLOCK_B_TITLE\":\"Treatment of Banff Grade IIB TCMR\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>High-Risk Rejection:<\\/strong> Grade IIB rejection involves significant vascular inflammation (severe intimal arteritis) and carries a higher risk of graft loss.\",\"\\ud83d\\udc8a <strong>Initial Therapy:<\\/strong> While pulse methylprednisolone is the first step, many centers would consider lymphocyte-depleting therapy upfront for Grade IIB.\",\"<strong>Antithymocyte Globulin (ATG):<\\/strong> A polyclonal antibody that depletes T-lymphocytes. It is a potent immunosuppressant reserved for severe or steroid-resistant rejection.\",\"<strong>Dosing & Monitoring:<\\/strong> ATG is typically dosed at 1-1.5 mg\\/kg\\/day. Requires close monitoring of CD3+ lymphocyte counts, platelet counts, and administration via a central line with pre-medication to prevent infusion reactions.\"],\"TOPIC_BLOCK_C_TITLE\":\"Donor-Specific Antibodies (DSA) & Luminex Assay\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<strong>Purpose:<\\/strong> To detect and quantify antibodies in the recipient\'s serum that are specifically targeted against the donor\'s HLA antigens.\",\"<strong>Luminex Technology:<\\/strong> Uses color-coded microbeads, each coated with a specific single HLA antigen.\",\"<strong>Procedure:<\\/strong> Patient\'s serum is mixed with the bead panel. If DSAs are present, they bind to the corresponding beads.\",\"<strong>Detection:<\\/strong> A fluorescently-labelled secondary antibody is added, which binds to the patient\'s antibodies. A laser-based instrument then identifies the bead (and thus the HLA antigen) and quantifies the amount of fluorescence.\",\"<strong>Mean Fluorescence Intensity (MFI):<\\/strong> The intensity of the fluorescent signal is reported as the MFI. A higher MFI suggests a greater quantity\\/avidity of the specific antibody. Thresholds for \'positive\' MFI vary by lab but are often in the 500-1000 range.\"],\"QUALITY_PROCESS_LI\":[\"\\u2705 Biopsy performed within 24 hours of decision for unexplained graft dysfunction.\",\"\\u2705 Turnaround time for histology report <span class=\'hl-symbol\'><<\\/span>48 hours.\",\"\\u2705 Daily monitoring of creatinine and CNI levels during treatment for rejection.\",\"\\u2705 PJP and anti-fungal prophylaxis administered concurrently with anti-rejection therapy.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 Return of serum creatinine to within 25% of baseline within 2 weeks of treatment.\",\"\\ud83d\\udcc9 Resolution of inflammation on any follow-up biopsy.\",\"\\ud83d\\udcc8 1-year and 5-year graft survival rates.\",\"\\ud83d\\udeab Absence of de novo DSA post-treatment.\"],\"QUALITY_SAFETY_LI\":[\" monitored with ATG therapy.\",\"\\ud83d\\udeab Low rates of post-treatment opportunistic infections (CMV, BKV, PJP).\",\"\\ud83d\\udeab Low rates of biopsy-related complications (e.g., significant bleeding requiring transfusion <span class=\'hl-symbol\'><<\\/span>1%).\",\"\\ud83d\\udeab Avoidance of over-suppression leading to leukopenia or thrombocytopenia.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f Risks of over-immunosuppression include life-threatening opportunistic infections (CMV, BK virus, fungal) and an increased long-term risk of malignancy, particularly Post-Transplant Lymphoproliferative Disorder (PTLD). The biopsy itself carries risks of bleeding, hematoma, and arteriovenous fistula formation.\",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f Clearly explain the diagnosis of acute rejection to the patient and family. Discuss the treatment plan, including the rationale for using potent drugs like steroids or ATG, their potential side effects, and the importance of close monitoring. Liaise with the patient\'s primary transplant center to ensure continuity of care and alignment of treatment strategy.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOne\'>Scenario 1: High Tacrolimus Level<\\/button><\\/h2><div id=\'collapseOne\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> Patient with rising creatinine to 220 \\u00b5mol\\/L, but Tacrolimus level comes back elevated at 18 ng\\/mL (Target 5-10 ng\\/mL). <strong>Action:<\\/strong> Hold Tacrolimus. Recheck level in 24-48h. Creatinine may improve with dose reduction alone. However, if dysfunction persists after level normalizes, biopsy is still indicated as CNI toxicity and rejection can coexist.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseTwo\'>Scenario 2: Concomitant BK Viremia<\\/button><\\/h2><div id=\'collapseTwo\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> Biopsy shows Banff IIA rejection, but blood BK virus PCR returns high at 50,000 copies\\/mL. <strong>Dilemma:<\\/strong> Treating rejection requires increasing immunosuppression, while treating BKVN requires reducing it. <strong>Action:<\\/strong> This is a complex balancing act. Typically, rejection is treated first with a short course of pulse steroids while MMF is reduced. CNI may be switched to an mTOR inhibitor. Requires expert consultation.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseThree\'>Scenario 3: No improvement after steroids<\\/button><\\/h2><div id=\'collapseThree\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:<\\/strong> Patient completes 3 days of methylprednisolone for Banff IIA rejection, but creatinine continues to rise. <strong>Action:<\\/strong> This is defined as steroid-resistant rejection. The next step is to initiate lymphocyte-depleting therapy with ATG. It is also crucial to test for DSA to rule out a concurrent antibody-mediated component that was missed on the initial biopsy. A repeat biopsy may be warranted.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What are your top three differential diagnoses for a creatinine of 200 \\u00b5mol\\/L one week post-transplant?\",\"a\":\"My top three differentials are acute cellular rejection, calcineurin inhibitor (CNI) toxicity, and an acute vascular or surgical complication such as ureteric obstruction.\"},{\"q\":\"What is the role of a Doppler ultrasound in this setting?\",\"a\":\"It is a crucial first-line investigation to rule out reversible surgical causes like hydronephrosis from ureteric obstruction, and to confirm graft perfusion and rule out vascular emergencies like renal artery stenosis or thrombosis.\"},{\"q\":\"The biopsy shows Banff Grade IIB rejection. What does this signify?\",\"a\":\"Banff IIB signifies a severe T-cell mediated rejection, characterized by severe intimal arteritis (v2), meaning inflammatory cells are invading the arterial walls, causing <span class=\'hl-symbol\'>><\\/span>25% luminal occlusion. This is a high-risk feature for subsequent graft loss.\"},{\"q\":\"How would you treat Banff IIB acute cellular rejection?\",\"a\":\"I would start with high-dose intravenous methylprednisolone. Given the severity of v-lesions in Grade IIB, I would have a low threshold to use a lymphocyte-depleting agent like Antithymocyte Globulin (ATG), especially if there is no prompt response to steroids.\"},{\"q\":\"What is the mechanism of action of Antithymocyte Globulin (ATG)?\",\"a\":\"ATG is a purified polyclonal antibody from rabbits or horses immunized with human thymocytes. It works by binding to multiple surface molecules on T-lymphocytes, leading to their depletion from the circulation via complement-dependent lysis and apoptosis.\"},{\"q\":\"What are the main side effects of ATG therapy?\",\"a\":\"Immediate side effects include fever, chills, and infusion reactions (cytokine release syndrome). Key hematological side effects are leukopenia and thrombocytopenia. It also causes profound immunosuppression, increasing the risk of opportunistic infections.\"},{\"q\":\"The examiner asks you to check for donor-specific antibodies (DSA). How is this done?\",\"a\":\"This is performed using a solid-phase immunoassay, most commonly the Luminex platform. The patient\'s serum is tested against a panel of beads, each coated with a specific known HLA antigen, to detect and quantify any circulating donor-specific antibodies.\"},{\"q\":\"What does Mean Fluorescence Intensity (MFI) mean in a DSA report?\",\"a\":\"MFI represents the quantitative strength of the antibody-antigen reaction on the Luminex assay. A higher MFI value generally corresponds to a higher concentration or avidity of the specific antibody in the patient\'s serum.\"},{\"q\":\"Why is it important to screen for BK virus in this patient?\",\"a\":\"BK virus can cause a viral nephropathy (BKVN) that presents with rising creatinine and histological features that can mimic acute rejection. The treatment for BKVN is to reduce immunosuppression, which is the opposite of treatment for rejection, making the distinction critical.\"},{\"q\":\"What key parameters would you monitor daily while treating this patient?\",\"a\":\"I would monitor daily serum creatinine and electrolytes, fluid balance chart and weight, full blood count (especially lymphocytes and platelets if on ATG), and trough CNI levels to ensure they are within the therapeutic range.\"}],\"PITFALLS_LI\":[\"\\u26a0\\ufe0f Attributing graft dysfunction to CNI toxicity based on a high level alone, without excluding rejection via biopsy.\",\"\\u26a0\\ufe0f Delaying a graft biopsy in a patient with unexplained creatinine rise and no obvious pre- or post-renal cause.\",\"\\u26a0\\ufe0f Failing to consider and rule out BK virus nephropathy, which can mimic rejection.\",\"\\u26a0\\ufe0f Inadequate prophylaxis against opportunistic infections (PJP, CMV, fungal) when augmenting immunosuppression for rejection.\",\"\\u26a0\\ufe0f Under-treating severe rejection (e.g., using steroids alone for Banff Grade IIB\\/III rejection) without considering lymphocyte depletion.\",\"\\u26a0\\ufe0f Not communicating with the patient\'s primary transplant center, leading to fragmented care.\"],\"ANSWER_STEPS_OL\":[\"This is a case of a <strong>stable patient<\\/strong> presenting with <strong>acute allograft dysfunction<\\/strong> just one week after a kidney transplant performed overseas.\",\"My immediate priorities are to ensure the patient remains hemodynamically stable, secure IV access, and perform a focused history and examination to assess for causes.\",\"First, I will order an <strong>urgent renal Doppler ultrasound<\\/strong> to rule out any surgical or vascular complications like obstruction or renal artery stenosis.\",\"Simultaneously, I will send <strong>urgent blood tests<\\/strong> including urea and electrolytes, a full blood count, and a trough level of their calcineurin inhibitor, either Tacrolimus or Cyclosporine.\",\"I will also send blood for <strong>BK virus and CMV PCR<\\/strong>, as these are important differential diagnoses.\",\"Once obstruction and major vascular issues are excluded by ultrasound, the next crucial step is an <strong>ultrasound-guided allograft biopsy<\\/strong> to establish a definitive histological diagnosis.\",\"Given the biopsy finding of <strong>Banff Grade IIB acute cellular rejection<\\/strong>, this indicates a severe rejection episode involving the graft\'s arteries.\",\"My initial treatment will be <strong>high-dose pulse intravenous methylprednisolone<\\/strong>, for example, 500mg daily for three days.\",\"I will also review and optimize their baseline immunosuppression to ensure their CNI levels are in the target range.\",\"Due to the severity of Grade IIB rejection, I will counsel the patient about the potential need for <strong>second-line therapy with Antithymocyte Globulin (ATG)<\\/strong> if their creatinine does not respond promptly to steroids.\",\"Finally, I will ensure the patient is on appropriate antimicrobial and gastric prophylaxis and will establish clear communication with their original transplant unit.\"],\"TEACHING_CONCEPTS_LI\":[\"The classic \'pre-renal, intrinsic, post-renal\' framework for AKI is equally applicable to the transplanted kidney.\",\"In the early post-transplant period, rejection is a diagnosis of exclusion that must be actively pursued once surgical complications are ruled out.\",\"The Banff classification provides a standardized, prognostically significant framework for reporting biopsy findings in kidney transplants.\",\"Treatment of allograft rejection is a balance between reversing the immune attack and avoiding the complications of over-immunosuppression.\"],\"TEACHING_MISTAKES_LI\":[\"Assuming a high CNI level is the sole cause of AKI; toxicity and rejection frequently coexist.\",\"Failing to appreciate the prognostic significance of vascular rejection (\'v\' lesions in the Banff score) and not escalating therapy appropriately.\",\"Forgetting to reduce other immunosuppressants (e.g., MMF) when faced with significant leukopenia or viral infection.\",\"Not performing DSA testing in cases of severe or steroid-resistant rejection, potentially missing a concurrent antibody-mediated component.\"],\"ASCII_FLOWCHART_PRE\":\"  [Rise in Creatinine Post-KTx]  \\n            |                     \\n [Urgent Doppler Ultrasound]----->[+\\/- Urgent Labs (U&E, CNI, Viral PCR)]\\n            |                                       \\n     +----------------+-----------------+            \\n     |                |                 |            \\n[Obstruction?]   [Vascular Issue?]   [Normal Study?] \\n     |                |                 |            \\n  [Urology]      [Interventional Rad]   |            \\n                                        |            \\n                               [Allograft Biopsy]    \\n                                        |            \\n                          +--------------------------+\\n                          |             |            |\\n                    [Rejection]      [CNI Tox]    [ATN\\/Other]\\n                          |             |            |\\n                   [Augment IS]    [Reduce CNI]  [Supportive]\",\"EVIDENCE_STUDIES_LI\":[\"While specific trials are numerous, the principles of treating acute rejection are based on decades of clinical experience and cohort studies demonstrating the efficacy of corticosteroids and lymphocyte-depleting antibodies.\",\"The introduction of the Banff classification in 1991 was a landmark for standardizing the diagnosis and grading of kidney allograft rejection, allowing for better comparison of treatment outcomes across studies.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"<strong>KDIGO Guidelines Recommend:<\\/strong> A graft biopsy should be performed for any unexplained acute rise in serum creatinine to guide therapy.\",\"<strong>Recommendation:<\\/strong> High-dose corticosteroids are the first-line treatment for acute T-cell mediated rejection.\",\"<strong>Recommendation:<\\/strong> Lymphocyte-depleting antibodies should be used for steroid-resistant or histologically severe initial episodes of rejection.\"],\"GUIDELINE_ANCHORS_LI\":[\"<strong>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009):<\\/strong> Provides the foundational framework for diagnosis and management of rejection, although newer immunosuppressive strategies and diagnostic tools have since evolved.\",\"<strong>The Banff Classification of Allograft Pathology:<\\/strong> Updated regularly by consensus meetings, it is the international standard for histological diagnosis of rejection.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'3\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingDosing\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseDosing\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'collapseDosing\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingDosing\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antithymocyte Globulin (Thymoglobulin\\u00ae) Dosing:<\\/strong> Typically initiated at 1 to 1.5 mg\\/kg. The first dose is often given intra-operatively or immediately post-biopsy confirmation. Subsequent daily doses are adjusted based on the absolute CD3+ T-lymphocyte count, with the goal of keeping the count suppressed (e.g., <span class=\'hl-symbol\'><<\\/span>50 cells\\/\\u00b5L). Treatment duration is usually 5-10 days. Pre-medication with corticosteroids, acetaminophen, and diphenhydramine is essential to prevent infusion reactions.<\\/li><li><strong>Methylprednisolone Dosing:<\\/strong> For acute rejection, a typical pulse dose is 500mg IV daily for 3 consecutive days. Some protocols use weight-based dosing (e.g., 10-15 mg\\/kg).<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingPolicy\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapsePolicy\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'collapsePolicy\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingPolicy\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>International Transplants:<\\/strong> For patients transplanted outside of the country (e.g., \'transplant tourism\'), it is critical to attempt to obtain all outside medical records. This includes the donor source (living\\/deceased), HLA typing, initial immunosuppression protocol, and any immediate post-operative complications. Communication with the primary transplant center, even if difficult, should be documented.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingExtensions\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtensions\'>Suggested schema extensions<\\/button><\\/h2><div id=\'collapseExtensions\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingExtensions\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li>A dedicated key for <strong>\'IMMUNOSUPPRESSION_REGIMEN\'<\\/strong> would be useful to list typical induction and maintenance protocols.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Post-Transplant AKI\",\"Acute Cellular Rejection\",\"Banff Grade IIB\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":15,\"investigations\":7,\"viva_items\":10,\"pitfalls\":6}}', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Acute Kidney Allograft Dysfunction Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n      transition: opacity 0.3s ease;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n      transform: translateY(-2px);\r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .chip:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn,\r\n    section[id^=\"extra-note-\"] .delete-section-btn {\r\n      position: absolute;\r\n      top: 12px;\r\n      right: 12px;\r\n      z-index: 10;\r\n      opacity: 0.7;\r\n      transition: all 0.2s ease;\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      background: rgba(239, 68, 68, 0.1);\r\n      border: 1px solid rgba(239, 68, 68, 0.3);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn:hover,\r\n    section[id^=\"extra-note-\"] .delete-section-btn:hover {\r\n      opacity: 1;\r\n      background: rgba(239, 68, 68, 0.2);\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn i {\r\n      font-size: 14px;\r\n      color: #dc2626;\r\n    }\r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n      .additional-note .delete-section-btn {\r\n        display: none;\r\n      }\r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n      transition: box-shadow 0.2s ease;\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n      transform: translateY(-1px);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    /* Delete button styling */\r\n    .delete-section-btn {\r\n      opacity: 0;\r\n      transition: opacity 0.2s ease;\r\n    }\r\n    \r\n    .delete-section-btn:hover {\r\n      opacity: 1;\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .nm-card:hover .delete-section-btn {\r\n      opacity: 1;\r\n    }\r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Acute Kidney Allograft Dysfunction Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Acute Kidney Allograft Dysfunction</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Post-Transplant AKI</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Acute Cellular Rejection</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">Banff Grade IIB</span>\r\n      </div>\r\n      <div class=\"small text-secondary\"><p>A patient presenting with a rise in serum creatinine one week post-kidney transplantation requires urgent and systematic evaluation. The differential diagnosis is broad, spanning pre-renal, intrinsic renal, and post-renal causes, with acute rejection and calcineurin inhibitor (CNI) toxicity being primary concerns. The goal is to rapidly identify and treat reversible causes to preserve long-term graft function.</p></div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li>✅ Confirm patient stability using an ABCDE approach.</li><li>✅ Secure dual large-bore IV access and send baseline bloods.</li><li>✅ Obtain precise vital signs, including orthostatic measurements and accurate fluid balance.</li><li>✅ Perform a focused clinical examination, assessing volume status, palpating the graft for tenderness, and examining the surgical site.</li><li>✅ Conduct a targeted history: inquire about timeline of creatinine rise, urine output, fever, graft pain, medication adherence (especially immunosuppressants), and any new medications or hypotensive episodes.</li><li>✅ Perform bedside tests: urine dipstick for protein and blood, and a point-of-care glucose.</li><li>✅ Order urgent laboratory investigations: FBC, urea & electrolytes, LFTs, CRP, and coagulation screen.</li><li>✅ Order STAT trough levels of calcineurin inhibitors (Tacrolimus or Cyclosporine).</li><li>✅ Request an urgent renal ultrasound with Doppler to assess graft perfusion, rule out hydronephrosis, and exclude vascular complications like renal artery stenosis (TRAS) or renal vein thrombosis.</li><li>✅ Screen for BK virus and CMV by sending blood for PCR quantification.</li><li>✅ Review the patient\'s transplant records, including donor characteristics, HLA mismatch, and initial immunosuppression protocol.</li><li>✅ Consult the on-call nephrology/transplant team immediately to coordinate further management.</li><li>✅ Arrange for an urgent ultrasound-guided allograft biopsy, the gold standard for diagnosis.</li><li>✅ Withhold nephrotoxic agents (e.g., NSAIDs, ACEi/ARBs) until a clear diagnosis is established.</li><li>✅ Ensure clear communication with the primary transplanting center, especially as the transplant occurred abroad.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Vascular & Pre-Renal Causes</div><ul class=\"mb-0\"><li><strong>Hypovolemia:</strong> Dehydration, diuretic use, diarrhea.</li><li><strong>Renal Artery Stenosis (TRAS):</strong> Typically presents later but can be acute; look for a bruit over the graft.</li><li><strong>Renal Vein Thrombosis:</strong> A rare but catastrophic event causing graft swelling, pain, and heavy proteinuria.</li><li><strong>Thrombotic Microangiopathy (TMA):</strong> Can be CNI-induced or recurrent.</li><li><strong>Cardiorenal Syndrome:</strong> Acute decompensated heart failure reducing graft perfusion.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Intrinsic Allograft Causes</div><ul class=\"mb-0\"><li><strong>Acute T-Cell Mediated Rejection (TCMR):</strong> Most common cause in the early post-transplant period.</li><li><strong>Acute Antibody-Mediated Rejection (AMR):</strong> Assessed via C4d staining and donor-specific antibodies (DSA).</li><li><strong>Calcineurin Inhibitor (CNI) Toxicity:</strong> Dose-dependent vasoconstriction of the afferent arteriole.</li><li><strong>Acute Tubular Necrosis (ATN):</strong> Can be prolonged post-transplant, especially with deceased donors or ischemic injury.</li><li><strong>BK Virus Nephropathy (BKVN):</strong> Viral replication causing tubulointerstitial nephritis.</li><li><strong>Recurrent or De Novo Glomerulonephritis:</strong> Less common in the first week but possible.</li><li><strong>Drug-induced Acute Interstitial Nephritis (AIN):</strong> Caused by antibiotics (e.g., piperacillin-tazobactam), PPIs.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Post-Renal Causes</div><ul class=\"mb-0\"><li><strong>Ureteral Obstruction:</strong> Caused by blood clots, stricture at the vesicoureteric anastomosis, or external compression (e.g., lymphocele, hematoma).</li><li><strong>Urine Leak:</strong> From the ureteric anastomosis, leading to urinoma formation and potential infection.</li><li><strong>Bladder Outlet Obstruction:</strong> Less common but consider in older males with BPH.</li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>Post-Transplant AKI</h5><p class=\'card-text\'>Systematic approach is key. Exclude obstruction and vascular issues first.</p><ul class=\'list-group list-group-flush\'><li class=\'list-group-item\'><strong>1. Doppler US:</strong> Rule out hydronephrosis & check vascular flow.</li><li class=\'list-group-item\'><strong>2. CNI Levels:</strong> Check Tacrolimus/Cyclosporine trough.</li><li class=\'list-group-item\'><strong>3. Biopsy:</strong> Gold standard to differentiate rejection vs. ATN vs. CNI toxicity.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li>🧪 <strong>Laboratory Tests:</strong> Full blood count, urea and electrolytes (serial), liver function tests, bone profile, C-reactive protein.</li><li>💊 <strong>Drug Levels:</strong> Trough Tacrolimus or Cyclosporine level (STAT).</li><li>🦠 <strong>Virology:</strong> BK Virus and CMV PCR quantification in blood.</li><li>💧 <strong>Urinalysis:</strong> Urine microscopy for cells/casts, urine protein-creatinine ratio (uPCR).</li><li>❤️ <strong>Immunology:</strong> Donor-Specific Antibody (DSA) testing using Luminex assay (if rejection is suspected).</li><li>🔬 <strong>Imaging:</strong> Urgent renal allograft ultrasound with Doppler.</li><li>🔎 <strong>Definitive Diagnosis:</strong> Ultrasound-guided allograft biopsy for histology (light microscopy, immunofluorescence, electron microscopy) and C4d staining, evaluated using the Banff classification.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\"><pre class=\'text-white bg-dark p-2 rounded\'>Stable patient + Creatinine > 200 umol/L (1 week post-KTx)\n  |\n  +--[Perform Immediate Priorities (Vitals, Exam, IV access)]\n  |\n  +--[STAT Labs: U&E, FBC, CNI Level, BK/CMV PCR]\n  |\n  +--[Urgent Doppler Ultrasound]\n      |\n      +--[Obstruction?] --(YES)--&gt; Urology consult for stent/nephrostomy\n      |\n      +--[Vascular issue (TRAS/Thrombosis)?] --(YES)--&gt; Interventional Radiology consult\n      |\n      +--[No obstruction/vascular issue?] --(PROCEED)--&gt; Allograft Biopsy\n          |\n          +--[Biopsy Result: Banff 2B Rejection]\n              |\n              +--[Initiate high-dose pulse steroids]\n              |\n              +--[Consider ATG for steroid-resistance or severe presentation]\n              |\n              +--[Optimize baseline immunosuppression]\n</pre></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Acute Kidney Allograft Dysfunction</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Diagnosis & Risk Stratification</div>\r\n            <div class=\"fw-semibold\">Initial Workup</div>\r\n            <ul class=\"mb-3\"><li><strong>Clinical Assessment:</strong> Thorough history focusing on medication adherence, infectious symptoms, and hemodynamic stability.</li><li><strong>Laboratory Evaluation:</strong> Obtain serial creatinine, CNI trough levels, and screen for viral pathogens (BK, CMV).</li><li><strong>Imaging:</strong> An urgent Doppler ultrasound is mandatory to exclude surgical or vascular complications as the cause of graft dysfunction.</li></ul>\r\n            <div class=\"fw-semibold\">Definitive Diagnosis: Allograft Biopsy</div>\r\n            <ul class=\"mb-0\"><li><strong>Indication:</strong> Allograft biopsy is the gold standard for diagnosing the cause of graft dysfunction when obstruction and vascular issues are ruled out.</li><li><strong>Procedure:</strong> Performed under ultrasound guidance with adequate sampling (at least two cores, including cortex and medulla).</li><li><strong>Analysis:</strong> Histology is evaluated using the Banff classification to grade T-cell mediated rejection (TCMR), antibody-mediated rejection (AMR), and other pathologies.</li><li><strong>Banff Score:</strong> A \'t\' score reflects tubulitis, \'i\' interstitial inflammation, and \'v\' intimal arteritis. A score of v1 or greater is highly significant.</li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Management of Acute Cellular Rejection (Banff IIB)</div>\r\n            <div class=\"fw-semibold\">First-Line Therapy</div>\r\n            <ul class=\"mb-3\"><li><strong>Pulse Steroids:</strong> The mainstay of treatment for acute cellular rejection is high-dose intravenous methylprednisolone (e.g., 500 mg to 1 g daily for 3 days).</li><li><strong>Optimize Baseline Immunosuppression:</strong> Ensure CNI levels are in the target therapeutic range and consider adjusting mycophenolate mofetil (MMF) or azathioprine doses.</li><li><strong>Prophylaxis:</strong> Initiate gastroprotection (e.g., PPI) and prophylaxis against Pneumocystis jirovecii (PJP) and oral candidiasis.</li></ul>\r\n            <div class=\"fw-semibold\">Second-Line & Follow-up</div>\r\n            <ul class=\"mb-0\"><li><strong>Lymphocyte-Depleting Agents:</strong> For steroid-resistant or severe rejection (like Banff IIB or III), Antithymocyte Globulin (ATG) is used. Dosing is typically 1-1.5 mg/kg for 5-10 days, adjusted based on lymphocyte counts.</li><li><strong>Monitoring:</strong> Closely monitor creatinine, CNI levels, and full blood count (especially lymphocyte and platelet counts with ATG).</li><li><strong>Surveillance:</strong> Repeat biopsy may be considered if graft function does not improve as expected.</li><li><strong>DSA Assessment:</strong> Check for development of de novo donor-specific antibodies (dnDSA), as this may indicate a mixed rejection pattern requiring additional therapy.</li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Banff Classification of Acute T-Cell Mediated Rejection (TCMR)</div><ul class=\"mb-0\"><li><strong>Borderline:</strong> Foci of tubulitis (t1, t2, or t3) with minor interstitial inflammation (i0 or i1), or interstitial inflammation (i2 or i3) with only mild tubulitis (t1).</li><li><strong>Grade IA:</strong> Significant interstitial inflammation (i <span class=\'hl-symbol\'>></span>25% of cortex, i2 or i3) AND significant tubulitis (t2 or t3 in <span class=\'hl-symbol\'>></span>1 tubule).</li><li><strong>Grade IB:</strong> Significant interstitial inflammation (i <span class=\'hl-symbol\'>></span>25% of cortex, i2 or i3) AND severe tubulitis (t3 in <span class=\'hl-symbol\'>></span>1 tubule).</li><li><strong>Grade IIA:</strong> Mild-to-moderate intimal arteritis (v1).</li><li><strong>Grade IIB:</strong> Severe intimal arteritis with <span class=\'hl-symbol\'>></span>25% luminal occlusion (v2).</li><li><strong>Grade III:</strong> Transmural arteritis and/or arterial fibrinoid necrosis (v3).</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Treatment of Banff Grade IIB TCMR</div><ul class=\"mb-0\"><li>⚠️ <strong>High-Risk Rejection:</strong> Grade IIB rejection involves significant vascular inflammation (severe intimal arteritis) and carries a higher risk of graft loss.</li><li>💊 <strong>Initial Therapy:</strong> While pulse methylprednisolone is the first step, many centers would consider lymphocyte-depleting therapy upfront for Grade IIB.</li><li><strong>Antithymocyte Globulin (ATG):</strong> A polyclonal antibody that depletes T-lymphocytes. It is a potent immunosuppressant reserved for severe or steroid-resistant rejection.</li><li><strong>Dosing & Monitoring:</strong> ATG is typically dosed at 1-1.5 mg/kg/day. Requires close monitoring of CD3+ lymphocyte counts, platelet counts, and administration via a central line with pre-medication to prevent infusion reactions.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Donor-Specific Antibodies (DSA) & Luminex Assay</div><ul class=\"mb-0\"><li><strong>Purpose:</strong> To detect and quantify antibodies in the recipient\'s serum that are specifically targeted against the donor\'s HLA antigens.</li><li><strong>Luminex Technology:</strong> Uses color-coded microbeads, each coated with a specific single HLA antigen.</li><li><strong>Procedure:</strong> Patient\'s serum is mixed with the bead panel. If DSAs are present, they bind to the corresponding beads.</li><li><strong>Detection:</strong> A fluorescently-labelled secondary antibody is added, which binds to the patient\'s antibodies. A laser-based instrument then identifies the bead (and thus the HLA antigen) and quantifies the amount of fluorescence.</li><li><strong>Mean Fluorescence Intensity (MFI):</strong> The intensity of the fluorescent signal is reported as the MFI. A higher MFI suggests a greater quantity/avidity of the specific antibody. Thresholds for \'positive\' MFI vary by lab but are often in the 500-1000 range.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li>✅ Biopsy performed within 24 hours of decision for unexplained graft dysfunction.</li><li>✅ Turnaround time for histology report <span class=\'hl-symbol\'><</span>48 hours.</li><li>✅ Daily monitoring of creatinine and CNI levels during treatment for rejection.</li><li>✅ PJP and anti-fungal prophylaxis administered concurrently with anti-rejection therapy.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li>📉 Return of serum creatinine to within 25% of baseline within 2 weeks of treatment.</li><li>📉 Resolution of inflammation on any follow-up biopsy.</li><li>📈 1-year and 5-year graft survival rates.</li><li>🚫 Absence of de novo DSA post-treatment.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li> monitored with ATG therapy.</li><li>🚫 Low rates of post-treatment opportunistic infections (CMV, BKV, PJP).</li><li>🚫 Low rates of biopsy-related complications (e.g., significant bleeding requiring transfusion <span class=\'hl-symbol\'><</span>1%).</li><li>🚫 Avoidance of over-suppression leading to leukopenia or thrombocytopenia.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              ⚠️ Risks of over-immunosuppression include life-threatening opportunistic infections (CMV, BK virus, fungal) and an increased long-term risk of malignancy, particularly Post-Transplant Lymphoproliferative Disorder (PTLD). The biopsy itself carries risks of bleeding, hematoma, and arteriovenous fistula formation.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              🗣️ Clearly explain the diagnosis of acute rejection to the patient and family. Discuss the treatment plan, including the rationale for using potent drugs like steroids or ATG, their potential side effects, and the importance of close monitoring. Liaise with the patient\'s primary transplant center to ensure continuity of care and alignment of treatment strategy.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'caseAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOne\'>Scenario 1: High Tacrolimus Level</button></h2><div id=\'collapseOne\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:</strong> Patient with rising creatinine to 220 µmol/L, but Tacrolimus level comes back elevated at 18 ng/mL (Target 5-10 ng/mL). <strong>Action:</strong> Hold Tacrolimus. Recheck level in 24-48h. Creatinine may improve with dose reduction alone. However, if dysfunction persists after level normalizes, biopsy is still indicated as CNI toxicity and rejection can coexist.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseTwo\'>Scenario 2: Concomitant BK Viremia</button></h2><div id=\'collapseTwo\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:</strong> Biopsy shows Banff IIA rejection, but blood BK virus PCR returns high at 50,000 copies/mL. <strong>Dilemma:</strong> Treating rejection requires increasing immunosuppression, while treating BKVN requires reducing it. <strong>Action:</strong> This is a complex balancing act. Typically, rejection is treated first with a short course of pulse steroids while MMF is reduced. CNI may be switched to an mTOR inhibitor. Requires expert consultation.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseThree\'>Scenario 3: No improvement after steroids</button></h2><div id=\'collapseThree\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'><div class=\'accordion-body\'><strong>Presentation:</strong> Patient completes 3 days of methylprednisolone for Banff IIA rejection, but creatinine continues to rise. <strong>Action:</strong> This is defined as steroid-resistant rejection. The next step is to initiate lymphocyte-depleting therapy with ATG. It is also crucial to test for DSA to rule out a concurrent antibody-mediated component that was missed on the initial biopsy. A repeat biopsy may be warranted.</div></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">What are your top three differential diagnoses for a creatinine of 200 µmol/L one week post-transplant?</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>My top three differentials are acute cellular rejection, calcineurin inhibitor (CNI) toxicity, and an acute vascular or surgical complication such as ureteric obstruction.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">What is the role of a Doppler ultrasound in this setting?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>It is a crucial first-line investigation to rule out reversible surgical causes like hydronephrosis from ureteric obstruction, and to confirm graft perfusion and rule out vascular emergencies like renal artery stenosis or thrombosis.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">The biopsy shows Banff Grade IIB rejection. What does this signify?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Banff IIB signifies a severe T-cell mediated rejection, characterized by severe intimal arteritis (v2), meaning inflammatory cells are invading the arterial walls, causing &lt;span class=&#039;hl-symbol&#039;&gt;&gt;&lt;/span&gt;25% luminal occlusion. This is a high-risk feature for subsequent graft loss.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">How would you treat Banff IIB acute cellular rejection?</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>I would start with high-dose intravenous methylprednisolone. Given the severity of v-lesions in Grade IIB, I would have a low threshold to use a lymphocyte-depleting agent like Antithymocyte Globulin (ATG), especially if there is no prompt response to steroids.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">What is the mechanism of action of Antithymocyte Globulin (ATG)?</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>ATG is a purified polyclonal antibody from rabbits or horses immunized with human thymocytes. It works by binding to multiple surface molecules on T-lymphocytes, leading to their depletion from the circulation via complement-dependent lysis and apoptosis.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">What are the main side effects of ATG therapy?</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Immediate side effects include fever, chills, and infusion reactions (cytokine release syndrome). Key hematological side effects are leukopenia and thrombocytopenia. It also causes profound immunosuppression, increasing the risk of opportunistic infections.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">The examiner asks you to check for donor-specific antibodies (DSA). How is this done?</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>This is performed using a solid-phase immunoassay, most commonly the Luminex platform. The patient&#039;s serum is tested against a panel of beads, each coated with a specific known HLA antigen, to detect and quantify any circulating donor-specific antibodies.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">What does Mean Fluorescence Intensity (MFI) mean in a DSA report?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>MFI represents the quantitative strength of the antibody-antigen reaction on the Luminex assay. A higher MFI value generally corresponds to a higher concentration or avidity of the specific antibody in the patient&#039;s serum.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">Why is it important to screen for BK virus in this patient?</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>BK virus can cause a viral nephropathy (BKVN) that presents with rising creatinine and histological features that can mimic acute rejection. The treatment for BKVN is to reduce immunosuppression, which is the opposite of treatment for rejection, making the distinction critical.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">What key parameters would you monitor daily while treating this patient?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>I would monitor daily serum creatinine and electrolytes, fluid balance chart and weight, full blood count (especially lymphocytes and platelets if on ATG), and trough CNI levels to ensure they are within the therapeutic range.</p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'audit\' data-unmapped-count=\'3\'></div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingDosing\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseDosing\'>Drug dosing & adjustments</button></h2><div id=\'collapseDosing\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingDosing\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antithymocyte Globulin (Thymoglobulin®) Dosing:</strong> Typically initiated at 1 to 1.5 mg/kg. The first dose is often given intra-operatively or immediately post-biopsy confirmation. Subsequent daily doses are adjusted based on the absolute CD3+ T-lymphocyte count, with the goal of keeping the count suppressed (e.g., <span class=\'hl-symbol\'><</span>50 cells/µL). Treatment duration is usually 5-10 days. Pre-medication with corticosteroids, acetaminophen, and diphenhydramine is essential to prevent infusion reactions.</li><li><strong>Methylprednisolone Dosing:</strong> For acute rejection, a typical pulse dose is 500mg IV daily for 3 consecutive days. Some protocols use weight-based dosing (e.g., 10-15 mg/kg).</li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingPolicy\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapsePolicy\'>Local policy & pathway notes</button></h2><div id=\'collapsePolicy\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingPolicy\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>International Transplants:</strong> For patients transplanted outside of the country (e.g., \'transplant tourism\'), it is critical to attempt to obtain all outside medical records. This includes the donor source (living/deceased), HLA typing, initial immunosuppression protocol, and any immediate post-operative complications. Communication with the primary transplant center, even if difficult, should be documented.</li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingExtensions\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtensions\'>Suggested schema extensions</button></h2><div id=\'collapseExtensions\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingExtensions\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li>A dedicated key for <strong>\'IMMUNOSUPPRESSION_REGIMEN\'</strong> would be useful to list typical induction and maintenance protocols.</li></ul></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li>⚠️ Attributing graft dysfunction to CNI toxicity based on a high level alone, without excluding rejection via biopsy.</li><li>⚠️ Delaying a graft biopsy in a patient with unexplained creatinine rise and no obvious pre- or post-renal cause.</li><li>⚠️ Failing to consider and rule out BK virus nephropathy, which can mimic rejection.</li><li>⚠️ Inadequate prophylaxis against opportunistic infections (PJP, CMV, fungal) when augmenting immunosuppression for rejection.</li><li>⚠️ Under-treating severe rejection (e.g., using steroids alone for Banff Grade IIB/III rejection) without considering lymphocyte depletion.</li><li>⚠️ Not communicating with the patient\'s primary transplant center, leading to fragmented care.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li>The classic \'pre-renal, intrinsic, post-renal\' framework for AKI is equally applicable to the transplanted kidney.</li><li>In the early post-transplant period, rejection is a diagnosis of exclusion that must be actively pursued once surgical complications are ruled out.</li><li>The Banff classification provides a standardized, prognostically significant framework for reporting biopsy findings in kidney transplants.</li><li>Treatment of allograft rejection is a balance between reversing the immune attack and avoiding the complications of over-immunosuppression.</li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li>Assuming a high CNI level is the sole cause of AKI; toxicity and rejection frequently coexist.</li><li>Failing to appreciate the prognostic significance of vascular rejection (\'v\' lesions in the Banff score) and not escalating therapy appropriately.</li><li>Forgetting to reduce other immunosuppressants (e.g., MMF) when faced with significant leukopenia or viral infection.</li><li>Not performing DSA testing in cases of severe or steroid-resistant rejection, potentially missing a concurrent antibody-mediated component.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li>This is a case of a <strong>stable patient</strong> presenting with <strong>acute allograft dysfunction</strong> just one week after a kidney transplant performed overseas.</li><li>My immediate priorities are to ensure the patient remains hemodynamically stable, secure IV access, and perform a focused history and examination to assess for causes.</li><li>First, I will order an <strong>urgent renal Doppler ultrasound</strong> to rule out any surgical or vascular complications like obstruction or renal artery stenosis.</li><li>Simultaneously, I will send <strong>urgent blood tests</strong> including urea and electrolytes, a full blood count, and a trough level of their calcineurin inhibitor, either Tacrolimus or Cyclosporine.</li><li>I will also send blood for <strong>BK virus and CMV PCR</strong>, as these are important differential diagnoses.</li><li>Once obstruction and major vascular issues are excluded by ultrasound, the next crucial step is an <strong>ultrasound-guided allograft biopsy</strong> to establish a definitive histological diagnosis.</li><li>Given the biopsy finding of <strong>Banff Grade IIB acute cellular rejection</strong>, this indicates a severe rejection episode involving the graft\'s arteries.</li><li>My initial treatment will be <strong>high-dose pulse intravenous methylprednisolone</strong>, for example, 500mg daily for three days.</li><li>I will also review and optimize their baseline immunosuppression to ensure their CNI levels are in the target range.</li><li>Due to the severity of Grade IIB rejection, I will counsel the patient about the potential need for <strong>second-line therapy with Antithymocyte Globulin (ATG)</strong> if their creatinine does not respond promptly to steroids.</li><li>Finally, I will ensure the patient is on appropriate antimicrobial and gastric prophylaxis and will establish clear communication with their original transplant unit.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\">  [Rise in Creatinine Post-KTx]  \n            |                     \n [Urgent Doppler Ultrasound]----->[+/- Urgent Labs (U&E, CNI, Viral PCR)]\n            |                                       \n     +----------------+-----------------+            \n     |                |                 |            \n[Obstruction?]   [Vascular Issue?]   [Normal Study?] \n     |                |                 |            \n  [Urology]      [Interventional Rad]   |            \n                                        |            \n                               [Allograft Biopsy]    \n                                        |            \n                          +--------------------------+\n                          |             |            |\n                    [Rejection]      [CNI Tox]    [ATN/Other]\n                          |             |            |\n                   [Augment IS]    [Reduce CNI]  [Supportive]</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li>While specific trials are numerous, the principles of treating acute rejection are based on decades of clinical experience and cohort studies demonstrating the efficacy of corticosteroids and lymphocyte-depleting antibodies.</li><li>The introduction of the Banff classification in 1991 was a landmark for standardizing the diagnosis and grading of kidney allograft rejection, allowing for better comparison of treatment outcomes across studies.</li></ul>\r\n      <ul class=\"mb-0\"><li><strong>KDIGO Guidelines Recommend:</strong> A graft biopsy should be performed for any unexplained acute rise in serum creatinine to guide therapy.</li><li><strong>Recommendation:</strong> High-dose corticosteroids are the first-line treatment for acute T-cell mediated rejection.</li><li><strong>Recommendation:</strong> Lymphocyte-depleting antibodies should be used for steroid-resistant or histologically severe initial episodes of rejection.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li><strong>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009):</strong> Provides the foundational framework for diagnosis and management of rejection, although newer immunosuppressive strategies and diagnostic tools have since evolved.</li><li><strong>The Banff Classification of Allograft Pathology:</strong> Updated regularly by consensus meetings, it is the international standard for histological diagnosis of rejection.</li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                     <button class=\"btn btn-outline-danger btn-sm delete-section-btn\" title=\"Delete this section\">\r\n                       <i class=\"bi bi-trash\"></i>\r\n                     </button>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   // Add delete functionality to the new section\r\n                   const deleteBtn = newSection.querySelector(\'.delete-section-btn\');\r\n                   if (deleteBtn) {\r\n                     deleteBtn.addEventListener(\'click\', (e) => {\r\n                       e.preventDefault();\r\n                       e.stopPropagation();\r\n                       const sectionTitle = newSection.querySelector(\'.section-title span:last-child\')?.textContent?.trim() || \'Study Note\';\r\n                       if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n                         newSection.remove();\r\n                         showDeleteMessage(`Study Note deleted successfully`);\r\n                       }\r\n                     });\r\n                   }\r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          transition: opacity 0.3s ease;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      // Initialize delete buttons for sections\r\n      initializeDeleteButtons();\r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, delete, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // ================== SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n    // Initialize delete functionality for all sections\r\n    function initializeDeleteButtons() {\r\n      console.log(\'Initializing delete buttons for sections...\');\r\n      \r\n      // Add delete buttons to all sections\r\n      const sections = document.querySelectorAll(\'section.nm-card, section.additional-note\');\r\n      sections.forEach((section, index) => {\r\n        addDeleteButtonToSection(section, index);\r\n      });\r\n      \r\n      console.log(\'Delete buttons initialized for\', sections.length, \'sections\');\r\n    }\r\n    \r\n    // Add delete button to a section\r\n    function addDeleteButtonToSection(section, index) {\r\n      // Check if delete button already exists\r\n      if (section.querySelector(\'.delete-section-btn\')) {\r\n        return;\r\n      }\r\n      \r\n      // Create delete button\r\n      const deleteBtn = document.createElement(\'button\');\r\n      deleteBtn.className = \'btn btn-outline-danger btn-sm delete-section-btn\';\r\n      deleteBtn.innerHTML = \'<i class=\"bi bi-trash\"></i>\';\r\n      deleteBtn.title = \'Delete this section\';\r\n      deleteBtn.style.position = \'absolute\';\r\n      deleteBtn.style.top = \'10px\';\r\n      deleteBtn.style.right = \'10px\';\r\n      deleteBtn.style.zIndex = \'10\';\r\n      \r\n      // Add click handler\r\n      deleteBtn.addEventListener(\'click\', (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        deleteSection(section, index);\r\n      });\r\n      \r\n      // Make section position relative for absolute positioning of delete button\r\n      section.style.position = \'relative\';\r\n      \r\n      // Add delete button to section\r\n      section.appendChild(deleteBtn);\r\n    }\r\n    \r\n    // Delete a section\r\n    function deleteSection(section, index) {\r\n      const sectionTitle = section.querySelector(\'.section-title\')?.textContent?.trim() || \'Section\';\r\n      \r\n      // Show confirmation dialog\r\n      if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n        console.log(\'Deleting section:\', sectionTitle);\r\n        \r\n        // Remove the section\r\n        section.remove();\r\n        \r\n        // Show success message\r\n        showDeleteMessage(`Section \"${sectionTitle}\" deleted successfully`);\r\n        \r\n        // Reinitialize delete buttons for remaining sections\r\n        setTimeout(() => {\r\n          initializeDeleteButtons();\r\n        }, 100);\r\n      }\r\n    }\r\n    \r\n    // Show delete confirmation message\r\n    function showDeleteMessage(message) {\r\n      // Create temporary message element\r\n      const messageEl = document.createElement(\'div\');\r\n      messageEl.className = \'alert alert-success alert-dismissible fade show\';\r\n      messageEl.style.position = \'fixed\';\r\n      messageEl.style.top = \'20px\';\r\n      messageEl.style.right = \'20px\';\r\n      messageEl.style.zIndex = \'9999\';\r\n      messageEl.innerHTML = `\r\n        ${message}\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n      `;\r\n      \r\n      // Add to page\r\n      document.body.appendChild(messageEl);\r\n      \r\n      // Auto-remove after 3 seconds\r\n      setTimeout(() => {\r\n        if (messageEl.parentNode) {\r\n          messageEl.remove();\r\n        }\r\n      }, 3000);\r\n    }\r\n    \r\n    // ================== END SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for delete buttons\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-19 09:23:58', '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:23:58');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(5, NULL, 1, 1, 1, 'adpkd-30yo-female', 'Autosomal Dominant Polycystic Kidney Disease (ADPKD) in a 30-year-old woman', 'Risk stratification (MIC/PROPKD) for rapid progression • BP control & pregnancy-safe therapy • Tolvaptan: who, how, and when', 'published', 'Essentials: For a 30-year-old woman with ADPKD, confirm diagnosis/imaging class, estimate progression risk, control blood pressure, discuss family planning, and consider disease-modifying therapy (tolvaptan) if criteria for rapid progression are met. Pregnancy planning requires stopping teratogens (RAS inhibitors, tolvaptan) and tailored monitoring.   ', '{\"slug\":\"adpkd-30yo-female\",\"TOPIC\":\"Autosomal Dominant Polycystic Kidney Disease (ADPKD) in a 30-year-old woman\",\"CHIP_1\":\"Risk stratification (MIC\\/PROPKD) for rapid progression\",\"CHIP_2\":\"BP control & pregnancy-safe therapy\",\"CHIP_3\":\"Tolvaptan: who, how, and when\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Essentials:<\\/strong> For a 30-year-old woman with ADPKD, confirm diagnosis\\/imaging class, estimate progression risk, control blood pressure, discuss family planning, and consider disease-modifying therapy (tolvaptan) if criteria for rapid progression are met. Pregnancy planning requires stopping teratogens (RAS inhibitors, tolvaptan) and tailored monitoring.   <\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e <strong>Confirm phenotype & baseline risk:<\\/strong> Family history; ultrasound\\/MRI with total kidney volume (TKV) and Mayo Imaging Classification (MIC). Consider genetic testing if diagnosis is uncertain or atypical.  \",\"\\ud83e\\uddea <strong>Baseline labs:<\\/strong> Serum creatinine\\/eGFR, electrolytes, ALT\\/AST\\/bilirubin (pre-tolvaptan baseline), urine ACR, urine culture if symptoms. \",\"\\ud83e\\ude7a <strong>Blood pressure:<\\/strong> Establish home BP monitoring; aim intensive control if tolerated (see targets below). \",\"\\ud83d\\udc76 <strong>Pregnancy status & counseling:<\\/strong> Do a pregnancy test if uncertain. Stop teratogens (ACEi\\/ARB, tolvaptan) and switch to pregnancy-compatible agents when planning or if pregnant. \",\"\\u26a0\\ufe0f <strong>Red flags requiring urgent evaluation:<\\/strong> Thunderclap headache (screen for ICA\\/SAH), sepsis\\/fever with flank pain (suspect cyst infection), gross hematuria with clot retention, uncontrolled pain. \",\"\\ud83e\\udde0 <strong>Intracranial aneurysm (ICA) risk review:<\\/strong> Consider pre-pregnancy MRA screening if family history of ICA\\/SAH, de novo ADPKD, limited family history, or extracerebral vascular phenotype. \"],\"DDX_BUCKET_1_TITLE\":\"Flank pain, hematuria, fever\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Infected kidney cyst vs. acute pyelonephritis (cyst-targeting antibiotics needed). \",\"Hemorrhagic cyst rupture vs. nephrolithiasis.\",\"Obstructing stone with secondary infection.\"],\"DDX_BUCKET_2_TITLE\":\"Early hypertension & kidney impairment\",\"DDX_BUCKET_2_ITEMS_LI\":[\"ADPKD-related RAAS activation; secondary causes less likely at this age but consider if atypical.\",\"Other cystic diseases if imaging\\/genetics atypical.\"],\"DDX_BUCKET_3_TITLE\":\"Headache\\/neurologic symptoms\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Unruptured or ruptured intracranial aneurysm (ICA\\/SAH). \",\"Primary headache disorders (migraine, tension) once ICA excluded.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'><ul class=\'mb-2\'><li><strong>Imaging & risk:<\\/strong> MIC (1A\\u20131E) using age-adjusted height-indexed TKV; higher classes (1C\\u20131E) predict faster eGFR loss. Combine with PROPKD score when available.  <\\/li><li><strong>Tolvaptan candidacy:<\\/strong> Consider in rapidly progressive ADPKD (e.g., MIC 1C\\u20131E, high PROPKD, rapid eGFR decline). Start per KDIGO algorithm; counsel on aquaretic effects and hepatotoxicity monitoring. <\\/li><li><strong>LFT monitoring on tolvaptan:<\\/strong> Follow KDIGO schedule for early detection and management of DILI. <\\/li><li><strong>BP targets:<\\/strong> Intensive control per CKD guidance; postpartum ADPKD target in young women with preserved eGFR: SBP <span class=\'hl-symbol\'><<\\/span>110\\/75 mm Hg (HALT-PKD). <\\/li><li><strong>Pregnancy:<\\/strong> Stop ACEi\\/ARB & tolvaptan when planning or pregnant; monthly BP\\/urine checks; low-dose aspirin from week 12\\u201336; treat asymptomatic bacteriuria. <\\/li><li><strong>ICA screening (pre-pregnancy):<\\/strong> Offer in selected higher-risk women (family history, de novo, limited pedigree, extracerebral vascular signs). <\\/li><\\/ul><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Laboratory:<\\/strong> Creatinine\\/eGFR, electrolytes, ALT\\/AST\\/bilirubin (for tolvaptan baseline\\/monitoring), urine ACR, urinalysis \\u00b1 culture. \",\"\\ud83e\\uddf2 <strong>Imaging:<\\/strong> Renal US initial; MRI (preferred) or low-dose non-contrast CT for precise TKV volumetry and MIC assignment.  \",\"\\ud83e\\uddec <strong>Genetics:<\\/strong> Consider PKD1\\/PKD2 testing if imaging is inconclusive, for atypical\\/early presentation, or for reproductive planning. \",\"\\ud83e\\udde0 <strong>ICA screening:<\\/strong> Brain MRA (no contrast) in selected high-risk patients or pre-pregnancy as per KDIGO practice points. \",\"\\ud83e\\uddea <strong>Pregnancy workup (if pregnant):<\\/strong> Monthly BP\\/creatinine\\/proteinuria, monthly urinalysis for asymptomatic bacteriuria. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'accordion\' id=\'emAlgo\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#a1\'>Thunderclap headache \\/ focal deficit<\\/button><\\/h2><div id=\'a1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#emAlgo\'><div class=\'accordion-body\'><ol><li><strong>Immediate<\\/strong> non-contrast head CT \\u00b1 CTA; urgent neurosurgical consult.<\\/li><li><strong>If negative but high suspicion:<\\/strong> Lumbar puncture and MRA \\u00b1 repeat imaging.<\\/li><li><strong>ADPKD context:<\\/strong> Document ICA history; screen first-degree relatives as indicated. <\\/li><\\/ol><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#a2\'>Sepsis\\/fever with flank pain<\\/button><\\/h2><div id=\'a2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#emAlgo\'><div class=\'accordion-body\'><ol><li><strong>Labs:<\\/strong> CBC, cultures; <strong>Imaging:<\\/strong> CT\\/MRI to distinguish cyst infection vs pyelonephritis.<\\/li><li><strong>Antibiotics with cyst penetration<\\/strong> (e.g., fluoroquinolone or TMP-SMX when appropriate); avoid agents with poor cyst penetration. <\\/li><li><strong>Drainage<\\/strong> if large infected cyst not responding to antibiotics.<\\/li><\\/ol><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#a3\'>Gross hematuria \\/ clot retention<\\/button><\\/h2><div id=\'a3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#emAlgo\'><div class=\'accordion-body\'><ol><li>Exclude obstruction; hydrate judiciously; urology if persistent bleeding or obstruction.<\\/li><li>Hold anticoagulants if safe; consider imaging for hemorrhagic cyst.<\\/li><\\/ol><\\/div><\\/div><\\/div><\\/div>\",\"PILLAR_1\":\"Disease modification & CKD care\",\"STEP_1_TITLE\":\"Identify rapid progressors & consider tolvaptan\",\"STEP_1_LI\":[\"Use MIC (1C\\u20131E), eGFR slope, genotype\\/PROPKD to flag rapid progression.  \",\"If eligible, initiate tolvaptan per KDIGO algorithm; counsel on aquaresis; enroll in LFT monitoring protocol (early and ongoing). \",\"Avoid in pregnancy\\/breastfeeding; ensure effective contraception during therapy. \"],\"STEP_2_TITLE\":\"Optimize BP & CKD risk reduction\",\"STEP_2_LI\":[\"Home BP monitoring; intensive control per CKD guideline; postpartum young women target SBP <span class=\'hl-symbol\'><<\\/span>110\\/75 mm Hg when eGFR <span class=\'hl-symbol\'>><\\/span>60. \",\"ACEi\\/ARB first-line (non-pregnant); switch to labetalol, long-acting nifedipine, hydralazine, clonidine, or methyldopa if pregnant. \",\"CKD bundle: avoid nephrotoxins (NSAIDs), manage lipids, vaccines, lifestyle counseling. \"],\"PILLAR_2\":\"Complication prevention & supportive care\",\"STEP_3_TITLE\":\"Extrarenal screening & counseling\",\"STEP_3_LI\":[\"Discuss ICA risk and targeted screening (MRA) in high-risk groups and pre-pregnancy. \",\"Assess for polycystic liver disease (PLD) symptoms; consider somatostatin analogs in significant PLD (specialist use). \"],\"STEP_4_TITLE\":\"Infection, stones, and pain strategies\",\"STEP_4_LI\":[\"Suspected cyst infection: imaging + cyst-penetrating antibiotics; drainage if refractory. \",\"Stone prevention: hydration, dietary measures; evaluate recurrent stones (uric acid\\/calcium).\",\"Chronic pain: multimodal plan; consider nephrology-urology pain pathways. \"],\"TOPIC_BLOCK_A_TITLE\":\"Tolvaptan: practical points\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\u2705 <strong>Who qualifies:<\\/strong> Rapid progressors (e.g., MIC 1C\\u20131E, high PROPKD, steep eGFR decline) after shared decision-making. \",\"\\ud83e\\uddea <strong>Liver safety:<\\/strong> Follow KDIGO monitoring schedule; act per DILI algorithm for enzyme elevations. \",\"\\ud83d\\udca7 <strong>Aquaresis:<\\/strong> Counsel on thirst\\/polyuria\\/nocturia; timing doses to lifestyle; consider adjuncts for polyuria burden as per emerging practice. \",\"\\ud83d\\udeab <strong>Pregnancy\\/lactation:<\\/strong> Contraindicated; ensure reliable contraception and stop before conception. \",\"\\ud83d\\udcca <strong>Evidence base:<\\/strong> TEMPO 3:4 and REPRISE showed slowed eGFR decline; review benefits vs burdens. \"],\"TOPIC_BLOCK_B_TITLE\":\"Intracranial aneurysm (ICA) in ADPKD\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Who to screen:<\\/strong> Family history of ICA\\/SAH, de novo ADPKD, limited pedigree information, extracerebral vascular phenotype; consider pre-pregnancy. \",\"\\ud83e\\udde0 <strong>How:<\\/strong> Non-contrast MRA preferred; surveillance interval individualized if negative and risk persists. \",\"\\u26a1 <strong>Emergency:<\\/strong> Thunderclap headache \\u2192 CT\\/CTA \\u00b1 LP; urgent neurosurgical review. \"],\"TOPIC_BLOCK_C_TITLE\":\"Pregnancy & contraception in ADPKD\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83c\\udf7c <strong>Before pregnancy:<\\/strong> Stop tolvaptan and RAS inhibitors; switch to pregnancy-compatible agents; consider ICA screening if indicated; offer genetic counseling (PGT\\/prenatal options).  \",\"\\ud83e\\udd30 <strong>During pregnancy:<\\/strong> Monthly BP\\/eGFR\\/proteinuria; encourage HBPM; low-dose aspirin week 12\\u201336; monthly screen for bacteriuria and treat if positive.  \",\"\\ud83e\\uddea <strong>Imaging:<\\/strong> Ultrasound or MRI (no gadolinium) is safe for acute abdominal pain. \",\"\\ud83e\\udd31 <strong>Breastfeeding\\/post-partum:<\\/strong> Tolvaptan contraindicated while breastfeeding; postpartum nephrology review <span class=\'hl-symbol\'><<\\/span>6 months; reset BP targets; pelvic floor PT if urinary symptoms.  \"],\"QUALITY_PROCESS_LI\":[\"Document MIC class, TKV method, and eGFR slope at baseline.\",\"Record pregnancy intentions and contraception plan at each visit. \",\"Enroll eligible patients in structured tolvaptan LFT monitoring protocol. \",\"Standardize HBPM workflow and thresholds for escalation.\"],\"QUALITY_OUTCOME_LI\":[\"Proportion of rapid progressors offered shared decision-making on tolvaptan.\",\"BP control rate per guideline targets.\",\"Rates of cyst infection hospitalization and ICA events over time.\"],\"QUALITY_SAFETY_LI\":[\"Zero unmonitored ALT\\/AST elevations on tolvaptan therapy. \",\"Zero ACEi\\/ARB exposure after pregnancy is confirmed. \",\"Antibiotic selection adherence for suspected cyst infections. \"],\"SAFETY_LI\":\"\\ud83d\\udc8a <strong>Medication safety:<\\/strong> Track hepatotoxicity with scheduled labs on tolvaptan; avoid RAS inhibitors and tolvaptan in pregnancy; avoid NSAIDs and nephrotoxins.  \",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Shared decisions:<\\/strong> Explain MIC\\/PROPKD risk, realistic goals of tolvaptan (slows, not reverses), lifestyle impacts (polyuria), pregnancy planning timelines, and ICA screening rationale.  \",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'cases\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: Newly diagnosed 30-year-old planning pregnancy<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><ul><li><strong>Actions:<\\/strong> MIC classification (MRI TKV), eGFR slope baseline, pregnancy test.<\\/li><li><strong>Med changes:<\\/strong> Stop ACEi\\/ARB & tolvaptan if used; switch to labetalol\\/nifedipine ER as needed. <\\/li><li><strong>Preventive care:<\\/strong> Low-dose aspirin from week 12; monthly BP\\/urine checks once pregnant. <\\/li><li><strong>Consider:<\\/strong> Pre-pregnancy MRA if high-risk for ICA; genetic counseling (PGT\\/prenatal). <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: Severe sudden headache in ADPKD<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><ul><li><strong>Immediate:<\\/strong> CT \\u00b1 CTA; if negative & suspicious, LP\\/MRA.<\\/li><li><strong>Plan:<\\/strong> Neurosurgery if SAH; screen relatives when appropriate. <\\/li><li><strong>Follow-up:<\\/strong> Address BP control and future ICA surveillance.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: Fever + flank pain unresponsive to oral antibiotics<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><ul><li><strong>Workup:<\\/strong> CT\\/MRI to localize infected cyst.<\\/li><li><strong>Therapy:<\\/strong> Switch to cyst-penetrating antibiotics; percutaneous drainage if large\\/refractory. <\\/li><li><strong>Prevention:<\\/strong> Hydration, prompt UTI treatment, review analgesic use.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c4\'>Case 4: Rapid eGFR decline at age 30 (MIC 1D)<\\/button><\\/h2><div id=\'c4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><ul><li><strong>Offer:<\\/strong> Tolvaptan with counseling on aquaresis and liver monitoring. <\\/li><li><strong>Monitor:<\\/strong> ALT\\/AST schedule; adjust dose per tolerability. <\\/li><li><strong>Bundle:<\\/strong> HBPM, CKD risk reduction, lifestyle and work accommodations.<\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"How do you risk-stratify a 30-year-old with ADPKD for rapid progression?\",\"a\":\"Use Mayo Imaging Classification (age-adjusted height-indexed TKV) and eGFR slope; consider PROPKD score\\/genotype if available. Higher MIC classes (1C\\u20131E) indicate higher risk.  \"},{\"q\":\"What are the main benefits and burdens of tolvaptan?\",\"a\":\"It slows eGFR decline in rapidly progressive ADPKD; burdens include aquaretic symptoms and rare hepatotoxicity, requiring structured LFT monitoring and lifestyle adjustments.  \"},{\"q\":\"When is tolvaptan contraindicated in women?\",\"a\":\"During pregnancy and breastfeeding; reliable contraception is required while on therapy and it should be stopped before conception. \"},{\"q\":\"Preferred imaging modality for precise TKV and MIC assignment?\",\"a\":\"MRI (non-contrast) is preferred for reproducible volumetry; low-dose non-contrast CT is an alternative when MRI is not feasible. \"},{\"q\":\"Who should be screened for intracranial aneurysm in ADPKD?\",\"a\":\"Those with family history of ICA\\/SAH, de novo ADPKD, limited pedigree information, or extracerebral vascular phenotypes; consider pre-pregnancy. \"},{\"q\":\"How do you manage suspected infected cysts?\",\"a\":\"Obtain imaging (CT\\/MRI) to localize; treat with antibiotics that penetrate cysts and consider drainage if refractory. \"},{\"q\":\"What BP targets apply to young women with ADPKD postpartum?\",\"a\":\"Target SBP <110\\/75 mm Hg when eGFR >60 mL\\/min\\/1.73 m\\u00b2 (based on HALT-PKD) and intensify HBPM. \"},{\"q\":\"Which antihypertensives are acceptable in pregnancy for ADPKD?\",\"a\":\"Labetalol, long-acting nifedipine, hydralazine, clonidine, or methyldopa; avoid ACEi\\/ARBs. \"},{\"q\":\"What antenatal preventive measures are recommended?\",\"a\":\"Monthly BP\\/eGFR\\/proteinuria checks, home BP monitoring, low-dose aspirin from week 12\\u201336, and monthly screening\\/treatment of asymptomatic bacteriuria.  \"},{\"q\":\"Does a normal fetal ultrasound exclude ADPKD in at-risk pregnancies?\",\"a\":\"No. Fetal\\/childhood ultrasounds may be normal; cysts develop later, so normal scans do not exclude ADPKD. \"},{\"q\":\"Name two extrarenal manifestations to counsel about.\",\"a\":\"Polycystic liver disease (PLD) and intracranial aneurysms; discuss symptoms and targeted screening. \"},{\"q\":\"Which trials underpin tolvaptan\'s efficacy?\",\"a\":\"TEMPO 3:4 (earlier disease) and REPRISE (later-stage) demonstrated slowed eGFR decline. \"}],\"PITFALLS_LI\":[\"Starting\\/continuing ACEi\\/ARB or tolvaptan in a woman planning pregnancy or already pregnant. \",\"Treating suspected cyst infection with antibiotics that poorly penetrate cysts. \",\"Assuming normal fetal\\/childhood ultrasound excludes ADPKD in at-risk offspring. \",\"Delaying ICA evaluation in thunderclap headache.\",\"Under-monitoring liver enzymes on tolvaptan. \"],\"ANSWER_STEPS_OL\":[\"Confirm diagnosis and classify with MIC (obtain MRI TKV if possible); document eGFR slope and consider PROPKD score.  \",\"Assess pregnancy status\\/intentions; stop teratogens (ACEi\\/ARB, tolvaptan) and plan compatible BP regimen. \",\"Initiate CKD measures: HBPM with intensive targets, avoid NSAIDs, address lipids and vaccines. \",\"If rapid progression: discuss tolvaptan (benefits, aquaresis, LFT monitoring) and start per KDIGO algorithm. \",\"Counsel on ICA risk; arrange targeted MRA screening if high-risk or pre-pregnancy. \",\"Educate on cyst infection signs; provide access plan for urgent imaging and cyst-penetrating antibiotics. \",\"Schedule follow-up for labs (including LFTs if on tolvaptan), BP review, and imaging surveillance.\"],\"TEACHING_CONCEPTS_LI\":[\"Mayo Imaging Classification (MIC) and its link to eGFR trajectory. \",\"PROPKD score and genotype-phenotype correlation. \",\"Tolvaptan mechanisms (V2 antagonism), trial evidence, and DILI monitoring.  \",\"Targeted ICA screening strategy in ADPKD. \",\"Pregnancy management bundle in ADPKD (BP, aspirin, bacteriuria). \"],\"TEACHING_MISTAKES_LI\":[\"Equating all flank pain with pyelonephritis and missing infected cysts requiring cyst-penetrating antibiotics. \",\"Using gadolinium MRI contrast unnecessarily in pregnancy for abdominal pain assessment. \",\"Delaying tolvaptan in eligible rapid progressors due to unaddressed lifestyle side effects\\u2014counsel early. \"],\"ASCII_FLOWCHART_PRE\":\"ADPKD (30F) INITIAL PATHWAY\\n|\\n+--> Confirm dx (US\\/MRI) -> MIC class -> eGFR slope\\n|                                 |\\n|                                 +--> Rapid progressor? -> Discuss tolvaptan -> Enroll LFT monitoring\\n|\\n+--> Pregnancy? -> YES: stop ACEi\\/ARB, stop tolvaptan; start pregnancy-safe BP meds; monthly BP\\/UA; ASA 12-36w\\n|                   NO: optimize BP, CKD measures\\n|\\n+--> ICA risk? -> If FHx\\/de novo\\/limited pedigree -> MRA (esp. pre-pregnancy)\\n|\\n+--> Red flags -> Thunderclap HA: CT\\/CTA; Fever+flank pain: CT\\/MRI + cyst-penetrating antibiotics\\n\",\"EVIDENCE_STUDIES_LI\":[\"TEMPO 3:4 (tolvaptan in earlier ADPKD) and REPRISE (later-stage): slowed eGFR decline. \",\"HALT-PKD BP findings informing low BP targets in young with preserved eGFR.  \",\"MIC and PROPKD: imaging\\/genetic tools predicting progression.  \",\"PLD management signals for somatostatin analogs (lanreotide\\/octreotide). \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Offer tolvaptan to rapid progressors after shared decision-making; monitor LFTs per KDIGO schedule. \",\"Adopt intensive BP control with pregnancy-safe substitutions when applicable. \",\"Screen for ICA in defined higher-risk groups and pre-pregnancy as indicated. \",\"Implement pregnancy care bundle (aspirin 12\\u201336 weeks, monthly urine screens). \"],\"GUIDELINE_ANCHORS_LI\":[\"KDIGO ADPKD (Kidney International Suppl. 2025) \\u2013 imaging risk, tolvaptan algorithm, ICA, pregnancy.   \",\"KDIGO 2021 Blood Pressure in CKD \\u2013 targets and approach. \",\"ERA 2022 Consensus on Tolvaptan in ADPKD \\u2013 practical use. \",\"KDIGO 2017 CKD-MBD \\u2013 general CKD bone\\/mineral care as ADPKD advances. \"],\"ADDITIONAL_SECTIONS_HTML\":\"<section id=\\\"extra-note-1756023783668\\\" class=\\\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\\\" style=\\\"position: relative;\\\">\\n                     <div class=\\\"section-title mb-2\\\">\\n                       <span class=\\\"icon-circle\\\"><i class=\\\"bi bi-sticky-fill text-info\\\"><\\/i><\\/span>\\n                       <span>Extra Note #1756023783<\\/span>\\n                     <\\/div>\\n                     <div class=\\\"border rounded p-3 bg-white\\\">\\n                       <h1>Tolvaptan Dosing in Autosomal Dominant Polycystic Kidney Disease (ADPKD)<\\/h1>\\n<h2>Standard Dosing Regimen<\\/h2>\\n<p>Tolvaptan (Jynarque\\u00ae) is administered using a <strong>split-dose regimen<\\/strong> to mitigate aquaresis-related side effects while maintaining therapeutic efficacy:<\\/p>\\n<table>\\n<thead>\\n<tr>\\n<th>Time of Day<\\/th>\\n<th>Starting Dose<\\/th>\\n<th>Titration Steps<\\/th>\\n<th>Maximum Dose<\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td><strong>Morning<\\/strong><\\/td>\\n<td>45 mg<\\/td>\\n<td>Increase by 15 mg weekly<\\/td>\\n<td>90 mg<\\/td>\\n<\\/tr>\\n<tr>\\n<td><strong>Evening<\\/strong><\\/td>\\n<td>15 mg<\\/td>\\n<td>Increase by 15 mg weekly<\\/td>\\n<td>30 mg<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<h3>Titration Schedule<\\/h3>\\n<ul>\\n<li><strong>Week 1:<\\/strong> 45 mg AM \\/ 15 mg PM<\\/li>\\n<li><strong>Week 2:<\\/strong> 60 mg AM \\/ 15 mg PM<\\/li>\\n<li><strong>Week 3:<\\/strong> 60 mg AM \\/ 30 mg PM<\\/li>\\n<li><strong>Week 4:<\\/strong> 90 mg AM \\/ 30 mg PM (maximum dose)<\\/li>\\n<\\/ul>\\n<h2>Key Practical Considerations<\\/h2>\\n<h3>Initiation Requirements<\\/h3>\\n<ul>\\n<li><strong>Confirmed diagnosis:<\\/strong> ADPKD with rapidly progressive disease (typically <span class=\\\"search-highlight\\\" data-search-index=\\\"2\\\">Ma<\\/span>yo Class 1C-1E)<\\/li>\\n<li><strong>Liver function:<\\/strong> Normal ALT, AST, and bilirubin at baseline<\\/li>\\n<li><strong>Pregnancy test:<\\/strong> Negative in women of childbearing potential<\\/li>\\n<li><strong>Effective contraception:<\\/strong> Required during treatment<\\/li>\\n<\\/ul>\\n<h3>Monitoring Schedule<\\/h3>\\n<ul>\\n<li><strong>Liver enzymes:<\\/strong> ALT, AST, bilirubin at:<ul>\\n<li>Baseline<\\/li>\\n<li>2 weeks and 4 weeks after initiation<\\/li>\\n<li>Monthly for first 18 months<\\/li>\\n<li>Every 3 months thereafter<\\/li>\\n<\\/ul>\\n<\\/li>\\n<\\/ul>\\n<h3>Dose Adjustments &amp; Interruptions<\\/h3>\\n<table>\\n<thead>\\n<tr>\\n<th>Scenario<\\/th>\\n<th>Action<\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td><strong>ALT\\/AST &gt;3\\u00d7 ULN<\\/strong><\\/td>\\n<td>Immediately interrupt therapy<\\/td>\\n<\\/tr>\\n<tr>\\n<td><strong>ALT\\/AST &gt;5\\u00d7 ULN<\\/strong><\\/td>\\n<td>Permanently discontinue<\\/td>\\n<\\/tr>\\n<tr>\\n<td><strong>ALT\\/AST &gt;3\\u00d7 ULN + bilirubin &gt;2\\u00d7 ULN<\\/strong><\\/td>\\n<td>Permanently discontinue<\\/td>\\n<\\/tr>\\n<tr>\\n<td><strong>Significant dehydration<\\/strong><\\/td>\\n<td>Interrupt until resolved<\\/td>\\n<\\/tr>\\n<tr>\\n<td><strong>Elective surgery<\\/strong><\\/td>\\n<td>Hold 24 hours prior<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<h2>Special Populations<\\/h2>\\n<h3>Renal Impairment<\\/h3>\\n<ul>\\n<li><strong>No dose adjustment<\\/strong> required based on eGFR<\\/li>\\n<li>Can be used across CKD stages 1-4<\\/li>\\n<li>Not recommended in ESRD or patients on dialysis<\\/li>\\n<\\/ul>\\n<h3>Hepatic Impairment<\\/h3>\\n<ul>\\n<li><strong>Contraindicated<\\/strong> in patients with history of, or current, liver injury<\\/li>\\n<li>Use with caution in any hepatic impairment<\\/li>\\n<\\/ul>\\n<h3>Elderly Patients<\\/h3>\\n<ul>\\n<li>No specific dose adjustment recommended<\\/li>\\n<li>Increased monitoring for dehydration and related complications<\\/li>\\n<\\/ul>\\n<h2>Administration Instructions<\\/h2>\\n<ol>\\n<li><strong>Take with or without food<\\/strong><\\/li>\\n<li><strong>Maintain adequate fluid intake<\\/strong> to avoid dehydration<\\/li>\\n<li><strong>Dose timing:<\\/strong> <ul>\\n<li>Morning dose upon waking<\\/li>\\n<li>Evening dose 8-9 hours later<\\/li>\\n<\\/ul>\\n<\\/li>\\n<li><strong>Avoid grapefruit juice<\\/strong> (CYP3A4 inhibitor)<\\/li>\\n<\\/ol>\\n<h2>Clinical Pearls<\\/h2>\\n<ul>\\n<li><strong>Therapeutic goal:<\\/strong> Achieve and maintain maximum tolerated dose<\\/li>\\n<li><strong>Dose reduction<\\/strong> may be considered for persistent aquaresis-related symptoms<\\/li>\\n<li><strong>Permanent discontinuation<\\/strong> required for significant liver injury<\\/li>\\n<li><strong>Rechallenge<\\/strong> after hepatotoxicity is not recommended<\\/li>\\n<\\/ul>\\n<div class=\\\"accordion overflow-accordion\\\" id=\\\"overflowAccordion\\\">\\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#unmappedPearls\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"unmappedPearls\\\">\\n        <i class=\\\"bi bi-gem\\\"><\\/i> Unmapped Pearls\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"unmappedPearls\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Clinical insight:<\\/strong> Many patients cannot tolerate the maximum dose due to polyuria; aim for the highest well-tolerated dose rather than forcing 90\\/30 mg<\\/li>\\n          <li><strong>Cross-reference example:<\\/strong> See: <em>Drug Dosing &amp; Adjustments<\\/em> for renal dosing considerations<\\/li>\\n          <li><strong>Practical tip:<\\/strong> Evening dose is critical for preventing nocturnal thirst; skipping it often leads to poor compliance<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#edgeCases\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"edgeCases\\\">\\n        <i class=\\\"bi bi-exclamation-triangle\\\"><\\/i> Edge Cases &amp; Special Populations\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"edgeCases\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Pregnancy:<\\/strong> Absolutely contraindicated; must have negative pregnancy test before initiation and effective contraception during therapy<\\/li>\\n          <li><strong>Transplant:<\\/strong> Limited data; typically discontinued post-transplant as disease progression halts<\\/li>\\n          <li><strong>Dialysis:<\\/strong> Not recommended in ESRD; no established benefit<\\/li>\\n          <li><strong>Pediatrics:<\\/strong> Not studied or approved for children with ADPKD<\\/li>\\n          <li><strong>Geriatrics:<\\/strong> Increased risk of dehydration; more frequent monitoring recommended<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#drugDosing\\\" aria-expanded=\\\"true\\\" aria-controls=\\\"drugDosing\\\">\\n        <i class=\\\"bi bi-capsule\\\"><\\/i> Drug Dosing &amp; Adjustments\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"drugDosing\\\" class=\\\"accordion-collapse collapse show\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Renal dosing:<\\/strong> No adjustment needed for renal impairment, but use with caution in advanced CKD (stage 4) due to risk of rapid progression to ESRD<\\/li>\\n          <li><strong>Drug interactions:<\\/strong> Strong CYP3A4 inhibitors (ketoconazole, clarithromycin) increase tolvaptan levels; avoid concomitant use<\\/li>\\n          <li><strong>Monitoring:<\\/strong> Strict LFT monitoring protocol must be followed; patients should understand the signs of liver injury (fatigue, jaundice, dark urine)<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#localPolicy\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"localPolicy\\\">\\n        <i class=\\\"bi bi-building\\\"><\\/i> Local Policy &amp; Pathway Notes\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"localPolicy\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Site-specific processes:<\\/strong> Many institutions require hepatology consultation before initiation<\\/li>\\n          <li><strong>Referral pathways:<\\/strong> Typically requires specialist nephrology assessment and approval<\\/li>\\n          <li><strong>Resource availability:<\\/strong> Limited to patients meeting strict criteria for rapidly progressive ADPKD; often requires prior authorization<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n<\\/div>\\n\\n<div class=\\\"audit\\\" data-unmapped-count=\\\"3\\\"><\\/div>\\n                     <\\/div>\\n                   <button class=\\\"btn btn-outline-danger btn-sm delete-section-btn\\\" title=\\\"Delete this section\\\" style=\\\"position: absolute; top: 10px; right: 10px; z-index: 10;\\\"><i class=\\\"bi bi-trash\\\"><\\/i><\\/button><\\/section><section id=\\\"extra-note-1756038142438\\\" class=\\\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\\\">\\n                     <div class=\\\"section-title mb-2\\\">\\n                       <span class=\\\"icon-circle\\\"><i class=\\\"bi bi-sticky-fill text-info\\\"><\\/i><\\/span>\\n                       <span>Extra Note #1756038142<\\/span>\\n                     <\\/div>\\n                     <div class=\\\"border rounded p-3 bg-white\\\">\\n                       <p>Of course! Here is a detailed, study-friendly breakdown of the Mayo Imaging Classification for ADPKD, tailored for your viva.<\\/p>\\n<h3><strong>Quick Overview<\\/strong><\\/h3>\\n<p>The Mayo Imaging Classification (MIC) is a powerful prognostic tool that uses <strong>age-adjusted height-adjusted Total Kidney Volume (HtTKV)<\\/strong> to categorize ADPKD patients into 5 classes (1A to 1E). It predicts the rate of future kidney function decline, helping identify rapid progressors who may benefit from disease-modifying therapy like tolvaptan.<\\/p>\\n<hr>\\n<h3><strong>\\ud83d\\udcca Mayo Imaging Classification (MIC) Table<\\/strong><\\/h3>\\n<p>This is the core of the classification. The class is determined by a single MRI or CT scan.<\\/p>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\\"left\\\">Class<\\/th>\\n<th align=\\\"left\\\">HtTKV (mL\\/m)<\\/th>\\n<th align=\\\"left\\\"><strong>Nickname \\/ Prognosis<\\/strong><\\/th>\\n<th align=\\\"left\\\"><strong>Expected Annual eGFR Decline<\\/strong><\\/th>\\n<th align=\\\"left\\\"><strong>Clinical Implication<\\/strong><\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td align=\\\"left\\\"><strong>1A<\\/strong><\\/td>\\n<td align=\\\"left\\\">&lt; <strong>300<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Mild \\/ Slow Progressor<\\/strong><\\/td>\\n<td align=\\\"left\\\">~1.8 mL\\/min\\/1.73m\\u00b2\\/year<\\/td>\\n<td align=\\\"left\\\">Reassure. Unlikely to reach ESRD in their lifetime. Low priority for tolvaptan.<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>1B<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>300 to &lt; 400<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Moderate \\/ Slow-Moderate<\\/strong><\\/td>\\n<td align=\\\"left\\\">~2.5 mL\\/min\\/1.73m\\u00b2\\/year<\\/td>\\n<td align=\\\"left\\\">Moderate risk. Monitor closely. Tolvaptan not typically first-line.<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>1C<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>400 to &lt; 500<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Substantial \\/ Moderate<\\/strong><\\/td>\\n<td align=\\\"left\\\">~3.2 mL\\/min\\/1.73m\\u00b2\\/year<\\/td>\\n<td align=\\\"left\\\"><strong>\\ud83d\\udea8 Tolvaptan Candidate<\\/strong>. Significant risk of progression.<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>1D<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>500 to &lt; 600<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Severe \\/ Rapid<\\/strong><\\/td>\\n<td align=\\\"left\\\">~4.2 mL\\/min\\/1.73m\\u00b2\\/year<\\/td>\\n<td align=\\\"left\\\"><strong>\\ud83d\\udea8 High-Priority Tolvaptan Candidate<\\/strong>. Very high risk of rapid progression to ESRD.<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>1E<\\/strong><\\/td>\\n<td align=\\\"left\\\">\\u2265 <strong>600<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Extreme \\/ Very Rapid<\\/strong><\\/td>\\n<td align=\\\"left\\\">~5.3 mL\\/min\\/1.73m\\u00b2\\/year<\\/td>\\n<td align=\\\"left\\\"><strong>\\ud83d\\udea8 Highest-Priority Tolvaptan Candidate<\\/strong>. Will almost certainly progress rapidly.<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<p><strong>HtTKV = Height-adjusted Total Kidney Volume.<\\/strong> This adjustment is <strong>crucial<\\/strong> for accuracy as it accounts for a patient\'s body size.<\\/p>\\n<hr>\\n<h3><strong>\\ud83c\\udfaf Key Mnemonics &amp; Memory Hooks<\\/strong><\\/h3>\\n<ul>\\n<li><p><strong>\\\"A, B, C, D, E - Assess, Be Cautious, Decide on Drugs, Escalate care\\\"<\\/strong><\\/p>\\n<ul>\\n<li><strong>A\\/B:<\\/strong> Assess and monitor.<\\/li>\\n<li><strong>C\\/D\\/E:<\\/strong> Be Cautious, <strong>Decide<\\/strong> on Drugs (tolvaptan), <strong>Escalate<\\/strong> monitoring and care.<\\/li>\\n<\\/ul>\\n<\\/li>\\n<li><p><strong>The Magic Number is 500:<\\/strong> The line between \\\"monitor\\\" and \\\"treat\\\" often falls around Class <strong>1C\\/1D<\\/strong> (HtTKV of ~500 mL\\/m). This is a key threshold to remember.<\\/p>\\n<\\/li>\\n<li><p><strong>Visual Hook:<\\/strong> Imagine the classes on a speedometer:\\n<code>[1A]---[1B]---[1C]---[1D]---[1E]<\\/code>\\n<code>[SLOW]---------&gt;[FAST]---------&gt;[VERY FAST]<\\/code><\\/p>\\n<\\/li>\\n<\\/ul>\\n<hr>\\n<h3><strong>\\ud83d\\udcc8 Step-by-Step: How to Use the MIC in Clinic<\\/strong><\\/h3>\\n<pre><code class=\\\"language-mermaid\\\">flowchart TD\\nA[Patient with confirmed ADPKD] --&gt; B[Perform MRI or CT scan]\\nB --&gt; C[Calculate Total Kidney Volume TKV&lt;br&gt;using ellipsoid or volumetry method]\\nC --&gt; D[Adjust for height:&lt;br&gt;HtTKV = TKV \\/ Height m]\\nD --&gt; E{Plot HtTKV on MIC Chart&lt;br&gt;against Patient Age}\\nE --\\u2192 F[Determine Class 1A through 1E]\\nF --&gt; G[Use Class + eGFR slope +&lt;br&gt;PROPKD score for prognosis]\\nG --&gt; H[Guide shared decision-making&lt;br&gt;for Tolvaptan therapy]\\n<\\/code><\\/pre>\\n<hr>\\n<h3><strong>\\ud83d\\udca1 Clinical Pearls for the Viva<\\/strong><\\/h3>\\n<ol>\\n<li><strong>Imaging Modality:<\\/strong> MRI (without contrast) is the <strong>gold standard<\\/strong> for precise volumetry. Low-dose CT is an alternative. Ultrasound is not accurate enough for MIC classification.<\\/li>\\n<li><strong>It\'s Not Just Size:<\\/strong> The MIC is most powerful when combined with:<ul>\\n<li><strong>Baseline eGFR<\\/strong> and <strong>historical eGFR slope<\\/strong><\\/li>\\n<li><strong>Genotype<\\/strong> (PKD1 mutation is worse than PKD2)<\\/li>\\n<li><strong>PROPKD Score<\\/strong> (a genetic\\/clinical scoring system)<\\/li>\\n<\\/ul>\\n<\\/li>\\n<li><strong>Age Matters:<\\/strong> A 30-year-old with a HtTKV of 450 mL\\/m (Class 1C) is at much higher risk than a 60-year-old with the same volume. The classification is <strong>age-adjusted<\\/strong>.<\\/li>\\n<li><strong>Not for Diagnosis:<\\/strong> The MIC is a <strong>prognostic tool<\\/strong>, not a diagnostic tool. Diagnosis is based on standard imaging criteria (e.g., \\u22653 cysts per kidney in a 15-39 year old).<\\/li>\\n<\\/ol>\\n<hr>\\n<h3><strong>\\ud83c\\udfe5 Viva Tips &amp; Common Examiner Questions<\\/strong><\\/h3>\\n<ul>\\n<li><p><strong>Q: \\\"This 30-year-old woman has ADPKD. Her MRI shows a HtTKV of 550 mL\\/m. How would you classify her and what does this mean?\\\"<\\/strong><\\/p>\\n<ul>\\n<li><strong>A:<\\/strong> \\\"This places her in Mayo Class <strong>1D<\\/strong>, which signifies severe disease and a rapid progressor phenotype. Her expected annual eGFR decline is around 4.2 mL\\/min\\/year. Based on this, I would strongly consider her a candidate for disease-modifying therapy with tolvaptan after discussing the risks, benefits, and the need for contraception.\\\"<\\/li>\\n<\\/ul>\\n<\\/li>\\n<li><p><strong>Q: \\\"What are the limitations of the Mayo Classification?\\\"<\\/strong><\\/p>\\n<ul>\\n<li><strong>A:<\\/strong> \\\"First, it requires advanced imaging (MRI\\/CT), which is more costly and less available than ultrasound. Second, it may be less reliable in very young patients (&lt;18 years) or those with atypical, asymmetric cystic disease. Finally, it\'s a predictor of <em>average<\\/em> risk; we must always integrate it with the patient\'s clinical story and genotype.\\\"<\\/li>\\n<\\/ul>\\n<\\/li>\\n<li><p><strong>Q: \\\"Why do we adjust for height?\\\"<\\/strong><\\/p>\\n<ul>\\n<li><strong>A:<\\/strong> \\\"To avoid misclassification. A tall person would be expected to have larger organs than a short person. HtTKV standardizes the measurement, allowing for a fair comparison of kidney size across all patients, regardless of their body stature.\\\"<\\/li>\\n<\\/ul>\\n<\\/li>\\n<\\/ul>\\n<hr>\\n<h3><strong>\\ud83d\\udd17 Connection to Your 30-year-old ADPKD Patient<\\/strong><\\/h3>\\n<p>For your 30-year-old female patient, establishing her MIC is <strong>one of the most critical steps<\\/strong>.<\\/p>\\n<ul>\\n<li>It directly informs the point on <strong>\\\"Identify rapid progressors &amp; consider tolvaptan\\\"<\\/strong>.<\\/li>\\n<li>Finding she is Class 1C, 1D, or 1E would be a major red flag, prompting immediate discussion about <strong>tolvaptan initiation<\\/strong> (with its practical points like LFT monitoring and the imperative for <strong>contraception<\\/strong> due to teratogenicity).<\\/li>\\n<li>A large TKV also correlates with a higher risk of complications like <strong>flank pain<\\/strong> and <strong>hematuria<\\/strong>, which are part of her presenting complaint. It reinforces the need for aggressive <strong>BP control<\\/strong> and comprehensive <strong>CKD care<\\/strong>.<\\/li>\\n<\\/ul>\\n<p><strong>Key Takeaway:<\\/strong> The Mayo Imaging Classification transforms a simple scan into a crystal ball, predicting disease trajectory and guiding one of the most important treatment decisions in modern ADPKD management. <strong>Memorize the class thresholds (especially 1C-E) and their implications.<\\/strong><\\/p>\\n                     <\\/div>\\n                   <\\/section>\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex1\'>Unmapped pearls<\\/button><\\/h2><div id=\'ex1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Hydration advice:<\\/strong> Liberal fluid intake may lower vasopressin but formal outcome data are evolving; counsel individualized plans. See: <em>Tolvaptan: practical points<\\/em>. <\\/li><li><strong>Contraception in PLD:<\\/strong> Prefer non-estrogen methods (IUDs, progestin-only) when PLD is significant. See: <em>Pregnancy & contraception<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'ex2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Advanced CKD (G4\\u2013G5):<\\/strong> Tolvaptan benefit\\/risk narrows; individualize per KDIGO and patient goals. <\\/li><li><strong>Transplant pathway:<\\/strong> Consider native nephrectomy indications unique to ADPKD (space, infection, pain). <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'ex3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Cyst infections:<\\/strong> Choose agents with cyst penetration; adjust for eGFR; monitor QT risk with FQs.<\\/li><li><strong>Analgesia:<\\/strong> Avoid NSAIDs; consider acetaminophen and adjuvants.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'ex4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Tolvaptan access:<\\/strong> Check local prescribing criteria, REMS\\/monitoring requirements.<\\/li><li><strong>ICA network:<\\/strong> Establish rapid access to neurovascular imaging.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'ex5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>RISK_TOOLS_HTML:<\\/strong> Slot to render MIC\\/PROPKD calculators.<\\/li><li><strong>TOLVAPTAN_MONITORING_TABLE_HTML:<\\/strong> Standardized LFT schedule and actions.<\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Risk stratification (MIC\\/PROPKD) for rapid progression\",\"BP control & pregnancy-safe therapy\",\"Tolvaptan: who, how, and when\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":6,\"investigations\":5,\"viva_items\":12,\"pitfalls\":5}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(6, NULL, 3, 1, 1, 'bloody-pd-effluent-approach', 'Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD — emergency approach', 'Automated PD (APD) • Hemoperitoneum • ER assessment', 'published', 'A sudden bloody PD effluent is alarming but often benign (e.g., ovulation or menstruation). Your job in the ER is to stabilize the patient, exclude peritonitis and major intra-abdominal pathology, protect the PD catheter from clot, and target investigations to the likely source.', '{\"slug\":\"bloody-pd-effluent-approach\",\"TOPIC\":\"Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD \\u2014 emergency approach\",\"CHIP_1\":\"Automated PD (APD)\",\"CHIP_2\":\"Hemoperitoneum\",\"CHIP_3\":\"ER assessment\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A sudden bloody PD effluent is alarming but often benign (e.g., ovulation or menstruation). Your job in the ER is to stabilize the patient, exclude peritonitis and major intra-abdominal pathology, protect the PD catheter from clot, and target investigations to the likely source.\",\"IMMEDIATE_PRIORITIES_LI\":[\"<strong>Airway\\/breathing\\/circulation:<\\/strong> Assess vitals, pain, peritoneal signs; obtain IV access, CBC and type & screen if unstable.\",\"<strong>Save and sample effluent:<\\/strong> If fluid is dwelling, drain and send for cell count with differential, Gram stain, and culture; if no dwell, instill 1 L, dwell ~2 h, then drain for testing. This timing strengthens diagnostic yield for peritonitis. \",\"<strong>Exclude peritonitis early:<\\/strong> Diagnostic criteria include abdominal symptoms\\/cloudy effluent plus effluent WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with <span class=\'hl-symbol\'>><\\/span>50% PMNs after a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell and\\/or positive culture (prefer blood-culture bottle technique). \",\"<strong>Protect the catheter:<\\/strong> Flush the abdomen with 1\\u20132 exchanges containing intraperitoneal heparin 500 U\\/L to prevent intraluminal clotting; routine systemic antibiotics are not indicated for isolated hemoperitoneum. \",\"<strong>Focused history & exam:<\\/strong> Recent exertion\\/strain, abdominal trauma, menses\\/ovulation, constipation, catheter manipulation, anticoagulants\\/antiplatelets, PKD, malignancy risks; examine exit site\\/tunnel.\",\"<strong>Red flags for surgical\\/gynecologic evaluation:<\\/strong> Hemodynamic instability, ongoing heavy bleeding\\/clots, falling hemoglobin, severe\\/locally peritoneal pain, or no benign explanation. Management depends on the source and may require imaging (US\\/CT) or laparoscopy. \"],\"DDX_BUCKET_1_TITLE\":\"Benign & PD-related\",\"DDX_BUCKET_1_ITEMS_LI\":[\"<strong>Ovulation\\/menstruation:<\\/strong> Common benign cause in women on PD. \",\"<strong>Catheter or abdominal wall trauma:<\\/strong> Manipulation, vigorous strain\\/coughing; usually self-limited. \",\"<strong>Post-procedure:<\\/strong> After lap cholecystectomy or lithotripsy; observe if stable. \",\"<strong>Ectopic endometrium shedding:<\\/strong> Endometriosis involving peritoneum. \"],\"DDX_BUCKET_2_TITLE\":\"Coagulopathy & medical\",\"DDX_BUCKET_2_ITEMS_LI\":[\"<strong>Platelets\\/coagulation disorders:<\\/strong> Thrombocytopenia or anticoagulation effect. \",\"<strong>Femoral hematoma leak:<\\/strong> Retroperitoneal\\/femoral bleed tracking into peritoneum. \",\"<strong>Polycystic kidney disease cyst rupture:<\\/strong> Intraperitoneal blood from cyst hemorrhage. \"],\"DDX_BUCKET_3_TITLE\":\"Surgical\\/visceral emergencies\",\"DDX_BUCKET_3_ITEMS_LI\":[\"<strong>Ischemic bowel or colonic malignancy:<\\/strong> Consider if pain, systemic features, or GI symptoms. \",\"<strong>Splenic rupture or pancreatitis:<\\/strong> Particularly with trauma\\/pancreatic symptoms. \",\"<strong>Sclerosing encapsulating peritonitis:<\\/strong> Rare but serious; surgical input. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2 mb-2\'><div class=\'card-body p-2\'><div class=\'row g-2\'><div class=\'col-6\'><h6 class=\'mb-1\'>Do<\\/h6><ul class=\'mb-0\'><li>Stabilize first; send effluent for cell count\\/diff, Gram, culture after a ~2 h dwell.<\\/li><li>Add IP heparin 500 U\\/L to exchanges to prevent catheter clotting.<\\/li><li>Screen for benign gynecologic causes in women.<\\/li><li>Order CBC, coagulation panel; consider pelvic US\\/CT if red flags.<\\/li><\\/ul><\\/div><div class=\'col-6\'><h6 class=\'mb-1\'>Avoid<\\/h6><ul class=\'mb-0\'><li>Starting empiric antibiotics for blood-stained dialysate without infection features.<\\/li><li>Letting the catheter sit without anticoagulated exchanges when blood is present.<\\/li><li>Missing short-dwell APD nuances\\u2014%PMNs is more reliable than absolute WBC with short dwells.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<strong>Effluent cell count with differential:<\\/strong> Diagnose\\/exclude peritonitis (turbid effluent with WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and PMNs <span class=\'hl-symbol\'>><\\/span>50% after a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell). In short-dwell APD, rely more on %PMNs. \",\"<strong>Effluent culture & Gram stain:<\\/strong> Inoculate into blood culture bottles to improve yield. \",\"<strong>Macroscopic effluent check:<\\/strong> Degree of blood\\/clots\\/fibrin (risk of catheter blockage). For isolated blood-staining, routine antibiotics are not needed. \",\"<strong>Labs:<\\/strong> CBC (Hb\\/platelets), PT\\/INR, aPTT, crossmatch if bleeding; \\u03b2-hCG if pregnancy possible.\",\"<strong>Imaging:<\\/strong> Bedside US if unstable; CT abdomen\\/pelvis when serious intra-abdominal source suspected; diagnostic laparoscopy if uncertainty persists. \",\"<strong>Other targeted tests:<\\/strong> Consider PD effluent cytology if malignant source suspected. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'algorithm\'><ol class=\'mb-2\'><li><strong>Triage:<\\/strong> If shock\\/peritonism \\u2192 resuscitate, activate surgery\\/gyne, urgent US\\/CT; hold anticoagulants.<\\/li><li><strong>Sample effluent correctly:<\\/strong> If no dwell, instill 1 L, dwell ~2 h, then drain for cell count\\/diff, Gram, culture. Diagnose peritonitis if WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and PMNs <span class=\'hl-symbol\'>><\\/span>50%. <\\/li><li><strong>Protect catheter:<\\/strong> Run 1\\u20132 exchanges with IP heparin 500 U\\/L; counsel that IP heparin does not change systemic coagulation.  <\\/li><li><strong>Classify likely cause:<\\/strong> Benign (menses\\/ovulation, minor trauma) vs coagulopathy vs surgical\\/visceral; tailor workup. <\\/li><li><strong>Definitive management:<\\/strong> Observe\\/reassure if benign and stable; correct coagulopathy; image and consult surgery\\/gyne if red flags. Management depends on the source (US\\/CT \\u00b1 laparoscopy). <\\/li><\\/ol><\\/div>\",\"PILLAR_1\":\"Stabilize and exclude infection\",\"STEP_1_TITLE\":\"Stabilization & sampling\",\"STEP_1_LI\":[\"<strong>Resuscitate as needed:<\\/strong> Fluids, analgesia, crossmatch; hold anticoagulants\\/antiplatelets if safe.\",\"<strong>Effluent sampling best practice:<\\/strong> Aim for a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell before sampling; use blood culture bottles. \",\"<strong>Peritonitis rule-in criteria:<\\/strong> Symptoms\\/cloudy effluent + WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with PMNs <span class=\'hl-symbol\'>><\\/span>50% and\\/or positive culture. \"],\"STEP_2_TITLE\":\"Catheter preservation & reassurance\",\"STEP_2_LI\":[\"<strong>Intraperitoneal heparin:<\\/strong> Heparin 500 U\\/L in exchanges to prevent catheter clot; usually resolves spontaneously; antibiotics not routinely needed for isolated blood-stained dialysate. \",\"<strong>Education:<\\/strong> Explain common benign triggers (menses\\/ovulation, minor strain) and expected course. \"],\"PILLAR_2\":\"Localize source and treat\",\"STEP_3_TITLE\":\"Targeted evaluation\",\"STEP_3_LI\":[\"<strong>Basic labs & coagulation:<\\/strong> Platelets, PT\\/INR, aPTT; correct coagulopathy if present. \",\"<strong>Imaging:<\\/strong> US if unstable or to evaluate adnexa; CT abdomen\\/pelvis when intra-abdominal source suspected; consider laparoscopy if unclear. \"],\"STEP_4_TITLE\":\"Definitive management & disposition\",\"STEP_4_LI\":[\"<strong>Benign\\/stable:<\\/strong> Continue low-trauma PD exchanges with IP heparin; outpatient review within 24\\u201372 h.\",\"<strong>Surgical\\/gynecologic source:<\\/strong> Manage per underlying pathology; PD plan individualized (temporary HD if PD unsafe or repeatedly clots). \"],\"TOPIC_BLOCK_A_TITLE\":\"Using intraperitoneal heparin safely\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<strong>Dose:<\\/strong> 500 U\\/L heparin in dialysate; repeat for several exchanges until effluent clears. \",\"<strong>Purpose:<\\/strong> Prevents catheter\\/fibrin clotting without changing systemic coagulation. \",\"<strong>Antibiotics:<\\/strong> Not routinely indicated for blood-stained dialysate in the absence of infection. \"],\"TOPIC_BLOCK_B_TITLE\":\"When to escalate (image, admit, consult)\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<strong>Image now:<\\/strong> Ongoing heavy bleeding\\/clots, peritonism, hypotension, or falling Hb \\u2192 urgent US\\/CT. \",\"<strong>Consults:<\\/strong> Surgery (suspected visceral bleed\\/ischemia), Gynecology (adnexal\\/uterine source). \",\"<strong>Admit:<\\/strong> Hemodynamic instability, need for transfusion\\/procedures, or unclear source after ED workup. \"],\"TOPIC_BLOCK_C_TITLE\":\"Peritonitis checkpoints in bloody effluent\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<strong>Don\'t miss infection:<\\/strong> Cloudiness, pain, fever \\u2192 apply ISPD criteria (WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L; PMNs <span class=\'hl-symbol\'>><\\/span>50% after a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; positive culture). \",\"<strong>Short dwells (APD):<\\/strong> If dwell short, %PMNs has greater diagnostic value than absolute WBC. \",\"<strong>Empiric therapy:<\\/strong> If criteria met, start guideline-based intraperitoneal antibiotics and narrow with cultures. \"],\"QUALITY_PROCESS_LI\":[\"<strong>Timely sampling:<\\/strong> Effluent sent within 30 min; ensure dwell timing documented. \",\"<strong>Standardized order set:<\\/strong> Pre-checked labs (CBC, PT\\/INR\\/aPTT), pregnancy test if applicable, and imaging triggers.\",\"<strong>Documentation:<\\/strong> Record menstrual history\\/anticoagulants and share with patient\\/relatives.\"],\"QUALITY_OUTCOME_LI\":[\"<strong>Catheter patency preserved:<\\/strong> No catheter occlusion requiring intervention. \",\"<strong>Appropriate antibiotic stewardship:<\\/strong> No unnecessary antibiotics for isolated hemoperitoneum. \",\"<strong>Safe disposition:<\\/strong> Clear source or safe observation with follow-up arranged.\"],\"QUALITY_SAFETY_LI\":[\"<strong>Anticoagulant reconciliation:<\\/strong> Hold\\/reverse only when bleeding risk outweighs thrombotic risk; liaise with prescribers.\",\"<strong>Imaging radiation safety:<\\/strong> Consider US first in reproductive-age women; CT if indicated.\"],\"SAFETY_LI\":\"<strong>Key safety tip:<\\/strong> Intraperitoneal heparin (500 U\\/L) prevents catheter clot without altering systemic coagulation\\u2014use early to avoid catheter loss.  \",\"COMMUNICATION_LI\":\"<strong>Reassure and explain:<\\/strong> \'Blood in the bag\' is often benign (e.g., around menses); we\'ll check for infection\\/serious causes, protect the catheter, and image only if warning signs appear. \",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesPDHem\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>APD user, day 10 of cycle, pink effluent but no pain<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Stable vitals, menstruating.<\\/li><li>Effluent sampling after ~2 h dwell: clear cell count; culture negative.<\\/li><li>Run 2 exchanges with IP heparin 500 U\\/L; observe and reassure.<\\/li><li>No antibiotics; outpatient check in 48\\u201372 h. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Bloody effluent with crampy pain and clots<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Check Hb\\/platelets\\/coags; hold anticoagulants.<\\/li><li>Effluent cell count\\/diff and culture after ~2 h dwell; start IP heparin exchanges.<\\/li><li>CT abdomen\\/pelvis to evaluate for surgical source if ongoing bleeding or peritonism; consult surgery\\/gyne as indicated. <\\/li><li>Management tailored to source; PD plan individualized.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Cloudy + bloody effluent with abdominal pain and fever<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Meets ISPD criteria if WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and PMNs <span class=\'hl-symbol\'>><\\/span>50% after a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; inoculate blood-culture bottles. <\\/li><li>Start empiric IP antibiotics per local ISPD-aligned protocol and narrow to sensitivities. <\\/li><li>Continue IP heparin to maintain catheter patency if blood present. <\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"List common benign causes of bloody PD effluent in women.\",\"a\":\"Ovulation or menstruation, catheter-induced minor trauma, post-procedure (e.g., lap cholecystectomy, lithotripsy), shedding of ectopic endometrium. \"},{\"q\":\"What effluent criteria support PD peritonitis?\",\"a\":\"Symptoms\\/cloudy bag plus effluent WBC >100\\/\\u00b5L and PMNs >50% after a \\u22652 h dwell, and\\/or a positive culture; rely more on %PMNs with short dwells. \"},{\"q\":\"How do you prevent catheter clot when blood is present in PD effluent?\",\"a\":\"Add intraperitoneal heparin 500 U\\/L to exchanges; it prevents clotting without altering systemic coagulation.  \"},{\"q\":\"Do all blood-stained bags require antibiotics?\",\"a\":\"No. Blood-stained dialysate is rarely infectious; culture is reasonable, but routine antibiotics are not necessary without infection features. \"},{\"q\":\"Name serious causes of hemoperitoneum you must not miss.\",\"a\":\"Ischemic bowel, splenic rupture, pancreatitis, colonic adenocarcinoma, femoral hematoma leak, PKD cyst rupture, coagulopathy. \"},{\"q\":\"What imaging do you choose if unstable versus stable with red flags?\",\"a\":\"Unstable: bedside ultrasound and urgent CT if feasible. Stable with concerning features: CT abdomen\\/pelvis; consider laparoscopy if unclear. \"},{\"q\":\"How should you collect effluent for culture to improve yield?\",\"a\":\"After a \\u22652 h dwell, inoculate into blood culture bottles. \"},{\"q\":\"What counseling is helpful for an anxious patient with benign hemoperitoneum?\",\"a\":\"Explain common benign triggers, expected spontaneous resolution, and that IP heparin protects the catheter; arrange short-interval follow-up. \"},{\"q\":\"When should you admit and consult surgery\\/gynecology?\",\"a\":\"If hemodynamically unstable, ongoing bleeding\\/clots, falling Hb, peritonism, or unclear source after ED workup. \"},{\"q\":\"What peritonitis management principles apply if criteria are met?\",\"a\":\"Start intraperitoneal empiric antibiotics per ISPD-aligned regimens and narrow to sensitivities; reassess within 48\\u201396 h for response. \"},{\"q\":\"Does IP heparin increase systemic bleeding risk?\",\"a\":\"No\\u2014IP heparin does not change systemic coagulation at these doses; it prevents catheter clotting. \"}],\"PITFALLS_LI\":[\"<strong>Missing infection:<\\/strong> Treating as \'benign blood\' without checking cell count\\/diff, Gram, and culture after an adequate dwell. \",\"<strong>Catheter loss:<\\/strong> Not adding IP heparin when effluent is bloody, leading to intraluminal clot. \",\"<strong>Unnecessary antibiotics:<\\/strong> Starting empiric antibiotics for isolated blood-stained dialysate without infection features. \",\"<strong>Under-imaging:<\\/strong> Failing to image when ongoing bleeding, pain, or instability suggests a surgical\\/visceral source. \"],\"ANSWER_STEPS_OL\":[\"<strong>Stabilize ABCs:<\\/strong> Vitals, IV access, analgesia; labs (CBC, PT\\/INR\\/aPTT), type & screen.\",\"<strong>Effluent sampling:<\\/strong> Ensure ~2 h dwell; send cell count\\/diff, Gram, culture (blood culture bottles). \",\"<strong>Protect catheter:<\\/strong> Run 1\\u20132 exchanges with IP heparin 500 U\\/L; avoid systemic antibiotic use unless infection suspected. \",\"<strong>Focused diagnosis:<\\/strong> Screen for benign gynecologic\\/PD-related causes; check platelets\\/coags; assess for red flags. \",\"<strong>Image and consult:<\\/strong> US\\/CT and surgical\\/gynecologic input if instability, ongoing bleeding, peritonism, or unclear cause. \",\"<strong>Plan disposition:<\\/strong> Observe\\/reassure if benign and stable; admit for procedural\\/surgical management when indicated; individualize PD vs temporary HD based on source and safety.\"],\"TEACHING_CONCEPTS_LI\":[\"<strong>Hemoperitoneum spectrum:<\\/strong> Often benign in women on PD; serious visceral causes are rarer but critical to exclude. \",\"<strong>ISPD diagnostics:<\\/strong> The 2-h dwell and %PMNs emphasis for short-dwell APD improve accuracy. \",\"<strong>Catheter preservation:<\\/strong> IP heparin is a simple, high-value intervention. \"],\"TEACHING_MISTAKES_LI\":[\"<strong>Assuming infection with any discoloration:<\\/strong> Blood alone \\u2260 peritonitis; confirm with criteria. \",\"<strong>Sampling too early:<\\/strong> No dwell or very short dwell reduces diagnostic yield; instill and dwell if needed. \",\"<strong>Skipping culture bottles:<\\/strong> Blood culture bottles improve culture sensitivity. \"],\"ASCII_FLOWCHART_PRE\":\"PD bag appears bloody -> Check vitals\\n  -> Unstable or peritonism? YES -> Resuscitate + urgent US\\/CT -> Surgery\\/Gyn consult -> Manage source\\n                                 NO  -> Effluent dwell ~2 h -> Send cell count\\/diff, Gram, culture\\n                                         -> Add IP heparin 500 U\\/L to exchanges\\n                                         -> Meets peritonitis criteria (WBC >100\\/uL AND PMN >50%)? YES -> Start IP antibiotics per ISPD; narrow to sensitivities\\n                                                                                                        NO  -> Consider benign causes (menses\\/ovulation, minor trauma)\\n                                                                                                              -> Check CBC, coags; target imaging if red flags\\n                                                                                                              -> Reassure\\/observe; short-interval follow-up\",\"EVIDENCE_STUDIES_LI\":[\"<strong>Comprehensive Clinical Nephrology:<\\/strong> Notes that blood-stained dialysate is rarely serious and recommends IP heparin 500 U\\/L; routine antibiotics not required without infection. \",\"<strong>Clinical Handbook of Nephrology (2024):<\\/strong> Figure 12.18 lists benign vs serious hemoperitoneum causes and states IP heparin prevents catheter clot without systemic effect. \",\"<strong>ISPD-aligned summaries:<\\/strong> Diagnostic thresholds and short-dwell (%PMNs) caveat for PD peritonitis. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"<strong>Use IP heparin early:<\\/strong> Add 500 U\\/L to exchanges when blood is present to protect catheter patency; this does not alter systemic coagulation.  \",\"<strong>Avoid unnecessary antibiotics:<\\/strong> Isolated blood-stained dialysate without infection does not warrant empiric antibiotics; still send cultures. \",\"<strong>Follow ISPD criteria:<\\/strong> Apply WBC and %PMNs thresholds after an adequate dwell and use blood culture bottles for sampling. \"],\"GUIDELINE_ANCHORS_LI\":[\"<strong>ISPD peritonitis diagnostics (adult):<\\/strong> Symptoms\\/cloudy effluent + effluent WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and PMNs <span class=\'hl-symbol\'>><\\/span>50% after a <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; culture preferred in blood culture bottles; rely on %PMNs in short dwells. \",\"<strong>Hemoperitoneum workup:<\\/strong> Categorize benign vs serious etiologies and tailor imaging (US\\/CT) and laparoscopy where indicated. \"],\"ADDITIONAL_SECTIONS_HTML\":\"<section id=\\\"extra-note-1756014837030\\\" class=\\\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\\\">\\n                     <div class=\\\"section-title mb-2\\\">\\n                       <span class=\\\"icon-circle\\\"><i class=\\\"bi bi-sticky-fill text-info\\\"><\\/i><\\/span>\\n                       <span>Extra Note #1756014837<\\/span>\\n                     <\\/div>\\n                     <div class=\\\"border rounded p-3 bg-white\\\">\\n                       <p>Here are the structured fields for dwell time, sampling method, and bottle type in the context of evaluating bloody peritoneal dialysis effluent:<\\/p>\\n<h2>Dwell Time for Diagnostic Sampling<\\/h2>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\\"left\\\">Dwell Duration<\\/th>\\n<th align=\\\"left\\\">Clinical Scenario<\\/th>\\n<th align=\\\"left\\\">Purpose &amp; Rationale<\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td align=\\\"left\\\"><strong>\\u2265 2 hours<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>Standard diagnostic dwell<\\/strong><\\/td>\\n<td align=\\\"left\\\">\\u2022 <strong>Optimal for cell count interpretation:<\\/strong> Allows sufficient time for leukocyte migration into peritoneal fluid<br>\\u2022 <strong>KDIGO\\/ISPD guideline recommendation:<\\/strong> Required for accurate peritonitis diagnosis (WBC &gt;100\\/\\u00b5L + &gt;50% PMNs)<br>\\u2022 <strong>Gold standard:<\\/strong> Provides most reliable differential count<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>&lt; 2 hours<\\/strong><\\/td>\\n<td align=\\\"left\\\">APD cycles or emergent sampling<\\/td>\\n<td align=\\\"left\\\">\\u2022 <strong>Suboptimal for absolute WBC count:<\\/strong> May yield falsely low counts due to insufficient dwell time<br>\\u2022 <strong>Relative value preserved:<\\/strong> Percentage of polymorphonuclear neutrophils (%PMNs) remains clinically useful<br>\\u2022 <strong>Clinical correlation essential:<\\/strong> Requires stronger emphasis on symptoms and Gram stain results<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>No dwell<\\/strong><\\/td>\\n<td align=\\\"left\\\">Catheter trauma or acute bleeding<\\/td>\\n<td align=\\\"left\\\">\\u2022 <strong>Limited diagnostic utility:<\\/strong> Cannot exclude peritonitis based on cell count alone<br>\\u2022 <strong>Therapeutic instillation recommended:<\\/strong> Instill 1L dialysate, dwell 2 hours, then sample<br>\\u2022 <strong>Gram stain still valuable:<\\/strong> May detect organisms despite inadequate dwell time<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<h2>Sampling Method Specifications<\\/h2>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\\"left\\\">Method<\\/th>\\n<th align=\\\"left\\\">Technique<\\/th>\\n<th align=\\\"left\\\">Advantages<\\/th>\\n<th align=\\\"left\\\">Limitations<\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td align=\\\"left\\\"><strong>Direct aspiration<\\/strong><\\/td>\\n<td align=\\\"left\\\">Aspirate from catheter port using sterile technique<\\/td>\\n<td align=\\\"left\\\">\\u2022 Immediate availability<br>\\u2022 Minimal contamination risk<br>\\u2022 Suitable for any dwell time<\\/td>\\n<td align=\\\"left\\\">\\u2022 Small volume may limit testing options<br>\\u2022 Risk of missing localized infection<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>Drainage bag collection<\\/strong><\\/td>\\n<td align=\\\"left\\\">Drain complete exchange into sterile collection bag<\\/td>\\n<td align=\\\"left\\\">\\u2022 Larger volume for multiple tests<br>\\u2022 Representative sample of entire dwell<br>\\u2022 Standardized method<\\/td>\\n<td align=\\\"left\\\">\\u2022 Potential for external contamination<br>\\u2022 Requires careful aseptic technique<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>Syringe instillation\\/aspiration<\\/strong><\\/td>\\n<td align=\\\"left\\\">Instill\\/aspirate via syringe through catheter port<\\/td>\\n<td align=\\\"left\\\">\\u2022 Controlled volume management<br>\\u2022 Useful for difficult drains<br>\\u2022 Minimizes air introduction<\\/td>\\n<td align=\\\"left\\\">\\u2022 Increased manipulation risk<br>\\u2022 Requires strict sterile technique<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<h2>Culture Bottle Type Selection<\\/h2>\\n<table>\\n<thead>\\n<tr>\\n<th align=\\\"left\\\">Bottle Type<\\/th>\\n<th align=\\\"left\\\">Recommended Use<\\/th>\\n<th align=\\\"left\\\">Inoculation Volume<\\/th>\\n<th align=\\\"left\\\">Advantages<\\/th>\\n<\\/tr>\\n<\\/thead>\\n<tbody><tr>\\n<td align=\\\"left\\\"><strong>Blood culture bottles<\\/strong><\\/td>\\n<td align=\\\"left\\\"><strong>First-line preferred method<\\/strong><\\/td>\\n<td align=\\\"left\\\">5-10 mL per bottle<\\/td>\\n<td align=\\\"left\\\">\\u2022 <strong>Superior yield:<\\/strong> 80-90% sensitivity vs. 50-60% with conventional methods<br>\\u2022 <strong>Continuous monitoring:<\\/strong> Automated systems detect growth earlier<br>\\u2022 <strong>Reduced contamination:<\\/strong> Closed system minimizes external contamination<br>\\u2022 <strong>Broader organism detection:<\\/strong> Better for fastidious organisms<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>Conventional culture bottles<\\/strong><\\/td>\\n<td align=\\\"left\\\">Alternative when blood culture bottles unavailable<\\/td>\\n<td align=\\\"left\\\">50-100 mL<\\/td>\\n<td align=\\\"left\\\">\\u2022 Widely available<br>\\u2022 Lower cost<br>\\u2022 Familiar to microbiology labs<\\/td>\\n<\\/tr>\\n<tr>\\n<td align=\\\"left\\\"><strong>Mycobacterial\\/fungal culture<\\/strong><\\/td>\\n<td align=\\\"left\\\">Suspected atypical infections<\\/td>\\n<td align=\\\"left\\\">10-50 mL<\\/td>\\n<td align=\\\"left\\\">\\u2022 Specialized media for unusual pathogens<br>\\u2022 Required if TB or fungal peritonitis suspected<\\/td>\\n<\\/tr>\\n<\\/tbody><\\/table>\\n<h2>Clinical Application Protocol<\\/h2>\\n<p><strong>Standard Diagnostic Sequence for Bloody Effluent:<\\/strong><\\/p>\\n<ol>\\n<li><strong>If dwelling fluid present:<\\/strong> Drain completely and send for cell count with differential, Gram stain, and culture<\\/li>\\n<li><strong>If no dwell fluid present:<\\/strong> Instill 1L dialysate with IP heparin (500 U\\/L), dwell for \\u22652 hours, then drain and sample<\\/li>\\n<li><strong>Always inoculate blood culture bottles<\\/strong> with 5-10 mL effluent for optimal microbial detection<\\/li>\\n<li><strong>Process remaining fluid<\\/strong> for cell count, differential, and additional tests as indicated<\\/li>\\n<\\/ol>\\n<p><strong>Critical Timing Considerations:<\\/strong><\\/p>\\n<ul>\\n<li><strong>Peritonitis diagnosis requires \\u22652 hour dwell<\\/strong> for accurate cell count interpretation<\\/li>\\n<li><strong>Sample processing within 1 hour<\\/strong> of collection for optimal cell preservation<\\/li>\\n<li><strong>Culture bottles should be inoculated immediately<\\/strong> at bedside when possible<\\/li>\\n<\\/ul>\\n<div class=\\\"accordion overflow-accordion\\\" id=\\\"overflowAccordion\\\">\\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#unmappedPearls\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"unmappedPearls\\\">\\n        <i class=\\\"bi bi-gem\\\"><\\/i> Unmapped Pearls\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"unmappedPearls\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Clinical insight:<\\/strong> In APD patients with short cycles, a purposeful 2-hour dwell is essential for accurate peritonitis diagnosis - don\'t rely on overnight cycler effluent for cell counts<\\/li>\\n          <li><strong>Practical tip:<\\/strong> Keep blood culture bottles at bedside in PD units to facilitate immediate inoculation and maximize culture yield<\\/li>\\n          <li><strong>Cross-reference example:<\\/strong> See: <em>Peritonitis checkpoints in bloody effluent<\\/em> for interpretation guidelines<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#edgeCases\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"edgeCases\\\">\\n        <i class=\\\"bi bi-exclamation-triangle\\\"><\\/i> Edge Cases &amp; Special Populations\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"edgeCases\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Pediatrics:<\\/strong> Smaller inoculation volumes (3-5 mL) may be used in children while maintaining adequate culture sensitivity<\\/li>\\n          <li><strong>Geriatrics:<\\/strong> Consider reduced dwell volumes (500-750 mL) in frail elderly patients who cannot tolerate full 1L dwells<\\/li>\\n          <li><strong>Dialysis:<\\/strong> Patients with rapid ultrafiltration may require shorter dwell times; adjust diagnostic expectations accordingly<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button collapsed\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#localPolicy\\\" aria-expanded=\\\"false\\\" aria-controls=\\\"localPolicy\\\">\\n        <i class=\\\"bi bi-building\\\"><\\/i> Local Policy &amp; Pathway Notes\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"localPolicy\\\" class=\\\"accordion-collapse collapse\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>Site-specific processes:<\\/strong> Some institutions may have standing orders for PD effluent sampling kits containing appropriate culture bottles<\\/li>\\n          <li><strong>Resource availability:<\\/strong> In settings without blood culture bottles, conventional cultures with larger inoculation volumes (50-100 mL) are acceptable alternatives<\\/li>\\n          <li><strong>Referral pathways:<\\/strong> Establish clear protocols for after-hours sample processing with microbiology departments<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  \\n  <div class=\\\"accordion-item\\\">\\n    <h2 class=\\\"accordion-header\\\">\\n      <button class=\\\"accordion-button\\\" type=\\\"button\\\" data-bs-toggle=\\\"collapse\\\" data-bs-target=\\\"#schemaExtensions\\\" aria-expanded=\\\"true\\\" aria-controls=\\\"schemaExtensions\\\">\\n        <i class=\\\"bi bi-arrow-expand\\\"><\\/i> Suggested Schema Extensions\\n      <\\/button>\\n    <\\/h2>\\n    <div id=\\\"schemaExtensions\\\" class=\\\"accordion-collapse collapse show\\\" data-bs-parent=\\\"#overflowAccordion\\\" style=\\\"\\\">\\n      <div class=\\\"accordion-body\\\">\\n        <ul>\\n          <li><strong>optimal_dwell_time_minutes:<\\/strong> Integer field specifying ideal dwell duration for diagnostic sampling<\\/li>\\n          <li><strong>culture_method_preference:<\\/strong> Categorical field indicating preferred culture technique (blood culture bottles vs conventional)<\\/li>\\n          <li><strong>Purpose:<\\/strong> Standardize diagnostic approach across different clinical scenarios and resource settings<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\\n\\n<div class=\\\"audit\\\" data-unmapped-count=\\\"3\\\"><\\/div>\\n                     <\\/div>\\n                   <\\/section>\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'10\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e1\'>Unmapped pearls<\\/button><\\/h2><div id=\'e1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Short-dwell nuance:<\\/strong> In APD, %PMNs is more reliable than absolute WBC with brief dwells\\u2014document dwell time. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li><li><strong>Chylous vs bloody:<\\/strong> Milky turbid effluent may be lipids (e.g., chylous ascites) rather than blood; different workup. <\\/li><li><strong>Exit site matters:<\\/strong> Inspect for infection\\/tunnel tenderness in any PD complication. <\\/li><li><strong>Technique survival:<\\/strong> Noninfectious complications can drive technique failure; early recognition preserves PD. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'e2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Pregnancy:<\\/strong> Prioritize US imaging; gyne input early; avoid unnecessary radiation.<\\/li><li><strong>PKD:<\\/strong> Heightened suspicion for cyst rupture when hemoperitoneum occurs. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'e3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Anticoagulants\\/antiplatelets:<\\/strong> Temporarily hold or reverse (case-by-case) in active bleeding; resume when safe.<\\/li><li><strong>PD drug clearance:<\\/strong> APD can increase dialyzability for some drugs; check levels\\/clinical effect if narrow TI. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'e4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>PD peritonitis bundles:<\\/strong> Ensure alignment with your center\'s ISPD-based empiric regimens and culture pathways; retraining after events is recommended. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'e5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>PD_SAMPLING_BLOCK:<\\/strong> Structured fields for dwell time, sampling method, and bottle type.<\\/li><li><strong>PD_CATHETER_PROTECTION:<\\/strong> Dose and timing fields for IP heparin across exchanges.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"Automated PD (APD)\",\"Hemoperitoneum\",\"ER assessment\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":6,\"viva_items\":11,\"pitfalls\":4}}', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD — emergency approach Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n      transition: opacity 0.3s ease;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n      transform: translateY(-2px);\r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .chip:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn,\r\n    section[id^=\"extra-note-\"] .delete-section-btn {\r\n      position: absolute;\r\n      top: 12px;\r\n      right: 12px;\r\n      z-index: 10;\r\n      opacity: 0.7;\r\n      transition: all 0.2s ease;\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      background: rgba(239, 68, 68, 0.1);\r\n      border: 1px solid rgba(239, 68, 68, 0.3);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn:hover,\r\n    section[id^=\"extra-note-\"] .delete-section-btn:hover {\r\n      opacity: 1;\r\n      background: rgba(239, 68, 68, 0.2);\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn i {\r\n      font-size: 14px;\r\n      color: #dc2626;\r\n    }\r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n      .additional-note .delete-section-btn {\r\n        display: none;\r\n      }\r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n      transition: box-shadow 0.2s ease;\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n      transform: translateY(-1px);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    /* Delete button styling */\r\n    .delete-section-btn {\r\n      opacity: 0;\r\n      transition: opacity 0.2s ease;\r\n    }\r\n    \r\n    .delete-section-btn:hover {\r\n      opacity: 1;\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .nm-card:hover .delete-section-btn {\r\n      opacity: 1;\r\n    }\r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD — emergency approach Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD — emergency approach</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Automated PD (APD)</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Hemoperitoneum</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">ER assessment</span>\r\n      </div>\r\n      <div class=\"small text-secondary\">A sudden bloody PD effluent is alarming but often benign (e.g., ovulation or menstruation). Your job in the ER is to stabilize the patient, exclude peritonitis and major intra-abdominal pathology, protect the PD catheter from clot, and target investigations to the likely source.</div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li><strong>Airway/breathing/circulation:</strong> Assess vitals, pain, peritoneal signs; obtain IV access, CBC and type & screen if unstable.</li><li><strong>Save and sample effluent:</strong> If fluid is dwelling, drain and send for cell count with differential, Gram stain, and culture; if no dwell, instill 1 L, dwell ~2 h, then drain for testing. This timing strengthens diagnostic yield for peritonitis. </li><li><strong>Exclude peritonitis early:</strong> Diagnostic criteria include abdominal symptoms/cloudy effluent plus effluent WBC <span class=\'hl-symbol\'>></span>100/µL with <span class=\'hl-symbol\'>></span>50% PMNs after a <span class=\'hl-symbol\'>>=</span>2 h dwell and/or positive culture (prefer blood-culture bottle technique). </li><li><strong>Protect the catheter:</strong> Flush the abdomen with 1–2 exchanges containing intraperitoneal heparin 500 U/L to prevent intraluminal clotting; routine systemic antibiotics are not indicated for isolated hemoperitoneum. </li><li><strong>Focused history & exam:</strong> Recent exertion/strain, abdominal trauma, menses/ovulation, constipation, catheter manipulation, anticoagulants/antiplatelets, PKD, malignancy risks; examine exit site/tunnel.</li><li><strong>Red flags for surgical/gynecologic evaluation:</strong> Hemodynamic instability, ongoing heavy bleeding/clots, falling hemoglobin, severe/locally peritoneal pain, or no benign explanation. Management depends on the source and may require imaging (US/CT) or laparoscopy. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Benign & PD-related</div><ul class=\"mb-0\"><li><strong>Ovulation/menstruation:</strong> Common benign cause in women on PD. </li><li><strong>Catheter or abdominal wall trauma:</strong> Manipulation, vigorous strain/coughing; usually self-limited. </li><li><strong>Post-procedure:</strong> After lap cholecystectomy or lithotripsy; observe if stable. </li><li><strong>Ectopic endometrium shedding:</strong> Endometriosis involving peritoneum. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Coagulopathy & medical</div><ul class=\"mb-0\"><li><strong>Platelets/coagulation disorders:</strong> Thrombocytopenia or anticoagulation effect. </li><li><strong>Femoral hematoma leak:</strong> Retroperitoneal/femoral bleed tracking into peritoneum. </li><li><strong>Polycystic kidney disease cyst rupture:</strong> Intraperitoneal blood from cyst hemorrhage. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Surgical/visceral emergencies</div><ul class=\"mb-0\"><li><strong>Ischemic bowel or colonic malignancy:</strong> Consider if pain, systemic features, or GI symptoms. </li><li><strong>Splenic rupture or pancreatitis:</strong> Particularly with trauma/pancreatic symptoms. </li><li><strong>Sclerosing encapsulating peritonitis:</strong> Rare but serious; surgical input. </li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div class=\'card p-2 mb-2\'><div class=\'card-body p-2\'><div class=\'row g-2\'><div class=\'col-6\'><h6 class=\'mb-1\'>Do</h6><ul class=\'mb-0\'><li>Stabilize first; send effluent for cell count/diff, Gram, culture after a ~2 h dwell.</li><li>Add IP heparin 500 U/L to exchanges to prevent catheter clotting.</li><li>Screen for benign gynecologic causes in women.</li><li>Order CBC, coagulation panel; consider pelvic US/CT if red flags.</li></ul></div><div class=\'col-6\'><h6 class=\'mb-1\'>Avoid</h6><ul class=\'mb-0\'><li>Starting empiric antibiotics for blood-stained dialysate without infection features.</li><li>Letting the catheter sit without anticoagulated exchanges when blood is present.</li><li>Missing short-dwell APD nuances—%PMNs is more reliable than absolute WBC with short dwells.</li></ul></div></div></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li><strong>Effluent cell count with differential:</strong> Diagnose/exclude peritonitis (turbid effluent with WBC <span class=\'hl-symbol\'>></span>100/µL and PMNs <span class=\'hl-symbol\'>></span>50% after a <span class=\'hl-symbol\'>>=</span>2 h dwell). In short-dwell APD, rely more on %PMNs. </li><li><strong>Effluent culture & Gram stain:</strong> Inoculate into blood culture bottles to improve yield. </li><li><strong>Macroscopic effluent check:</strong> Degree of blood/clots/fibrin (risk of catheter blockage). For isolated blood-staining, routine antibiotics are not needed. </li><li><strong>Labs:</strong> CBC (Hb/platelets), PT/INR, aPTT, crossmatch if bleeding; β-hCG if pregnancy possible.</li><li><strong>Imaging:</strong> Bedside US if unstable; CT abdomen/pelvis when serious intra-abdominal source suspected; diagnostic laparoscopy if uncertainty persists. </li><li><strong>Other targeted tests:</strong> Consider PD effluent cytology if malignant source suspected. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\"><div class=\'algorithm\'><ol class=\'mb-2\'><li><strong>Triage:</strong> If shock/peritonism → resuscitate, activate surgery/gyne, urgent US/CT; hold anticoagulants.</li><li><strong>Sample effluent correctly:</strong> If no dwell, instill 1 L, dwell ~2 h, then drain for cell count/diff, Gram, culture. Diagnose peritonitis if WBC <span class=\'hl-symbol\'>></span>100/µL and PMNs <span class=\'hl-symbol\'>></span>50%. </li><li><strong>Protect catheter:</strong> Run 1–2 exchanges with IP heparin 500 U/L; counsel that IP heparin does not change systemic coagulation.  </li><li><strong>Classify likely cause:</strong> Benign (menses/ovulation, minor trauma) vs coagulopathy vs surgical/visceral; tailor workup. </li><li><strong>Definitive management:</strong> Observe/reassure if benign and stable; correct coagulopathy; image and consult surgery/gyne if red flags. Management depends on the source (US/CT ± laparoscopy). </li></ol></div></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Bloody peritoneal dialysis (PD) effluent (hemoperitoneum) on APD — emergency approach</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Stabilize and exclude infection</div>\r\n            <div class=\"fw-semibold\">Stabilization & sampling</div>\r\n            <ul class=\"mb-3\"><li><strong>Resuscitate as needed:</strong> Fluids, analgesia, crossmatch; hold anticoagulants/antiplatelets if safe.</li><li><strong>Effluent sampling best practice:</strong> Aim for a <span class=\'hl-symbol\'>>=</span>2 h dwell before sampling; use blood culture bottles. </li><li><strong>Peritonitis rule-in criteria:</strong> Symptoms/cloudy effluent + WBC <span class=\'hl-symbol\'>></span>100/µL with PMNs <span class=\'hl-symbol\'>></span>50% and/or positive culture. </li></ul>\r\n            <div class=\"fw-semibold\">Catheter preservation & reassurance</div>\r\n            <ul class=\"mb-0\"><li><strong>Intraperitoneal heparin:</strong> Heparin 500 U/L in exchanges to prevent catheter clot; usually resolves spontaneously; antibiotics not routinely needed for isolated blood-stained dialysate. </li><li><strong>Education:</strong> Explain common benign triggers (menses/ovulation, minor strain) and expected course. </li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Localize source and treat</div>\r\n            <div class=\"fw-semibold\">Targeted evaluation</div>\r\n            <ul class=\"mb-3\"><li><strong>Basic labs & coagulation:</strong> Platelets, PT/INR, aPTT; correct coagulopathy if present. </li><li><strong>Imaging:</strong> US if unstable or to evaluate adnexa; CT abdomen/pelvis when intra-abdominal source suspected; consider laparoscopy if unclear. </li></ul>\r\n            <div class=\"fw-semibold\">Definitive management & disposition</div>\r\n            <ul class=\"mb-0\"><li><strong>Benign/stable:</strong> Continue low-trauma PD exchanges with IP heparin; outpatient review within 24–72 h.</li><li><strong>Surgical/gynecologic source:</strong> Manage per underlying pathology; PD plan individualized (temporary HD if PD unsafe or repeatedly clots). </li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Using intraperitoneal heparin safely</div><ul class=\"mb-0\"><li><strong>Dose:</strong> 500 U/L heparin in dialysate; repeat for several exchanges until effluent clears. </li><li><strong>Purpose:</strong> Prevents catheter/fibrin clotting without changing systemic coagulation. </li><li><strong>Antibiotics:</strong> Not routinely indicated for blood-stained dialysate in the absence of infection. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">When to escalate (image, admit, consult)</div><ul class=\"mb-0\"><li><strong>Image now:</strong> Ongoing heavy bleeding/clots, peritonism, hypotension, or falling Hb → urgent US/CT. </li><li><strong>Consults:</strong> Surgery (suspected visceral bleed/ischemia), Gynecology (adnexal/uterine source). </li><li><strong>Admit:</strong> Hemodynamic instability, need for transfusion/procedures, or unclear source after ED workup. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Peritonitis checkpoints in bloody effluent</div><ul class=\"mb-0\"><li><strong>Don\'t miss infection:</strong> Cloudiness, pain, fever → apply ISPD criteria (WBC <span class=\'hl-symbol\'>></span>100/µL; PMNs <span class=\'hl-symbol\'>></span>50% after a <span class=\'hl-symbol\'>>=</span>2 h dwell; positive culture). </li><li><strong>Short dwells (APD):</strong> If dwell short, %PMNs has greater diagnostic value than absolute WBC. </li><li><strong>Empiric therapy:</strong> If criteria met, start guideline-based intraperitoneal antibiotics and narrow with cultures. </li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li><strong>Timely sampling:</strong> Effluent sent within 30 min; ensure dwell timing documented. </li><li><strong>Standardized order set:</strong> Pre-checked labs (CBC, PT/INR/aPTT), pregnancy test if applicable, and imaging triggers.</li><li><strong>Documentation:</strong> Record menstrual history/anticoagulants and share with patient/relatives.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li><strong>Catheter patency preserved:</strong> No catheter occlusion requiring intervention. </li><li><strong>Appropriate antibiotic stewardship:</strong> No unnecessary antibiotics for isolated hemoperitoneum. </li><li><strong>Safe disposition:</strong> Clear source or safe observation with follow-up arranged.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li><strong>Anticoagulant reconciliation:</strong> Hold/reverse only when bleeding risk outweighs thrombotic risk; liaise with prescribers.</li><li><strong>Imaging radiation safety:</strong> Consider US first in reproductive-age women; CT if indicated.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              <strong>Key safety tip:</strong> Intraperitoneal heparin (500 U/L) prevents catheter clot without altering systemic coagulation—use early to avoid catheter loss.  \r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              <strong>Reassure and explain:</strong> \'Blood in the bag\' is often benign (e.g., around menses); we\'ll check for infection/serious causes, protect the catheter, and image only if warning signs appear. \r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'casesPDHem\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>APD user, day 10 of cycle, pink effluent but no pain</button></h2><div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Stable vitals, menstruating.</li><li>Effluent sampling after ~2 h dwell: clear cell count; culture negative.</li><li>Run 2 exchanges with IP heparin 500 U/L; observe and reassure.</li><li>No antibiotics; outpatient check in 48–72 h. </li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Bloody effluent with crampy pain and clots</button></h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Check Hb/platelets/coags; hold anticoagulants.</li><li>Effluent cell count/diff and culture after ~2 h dwell; start IP heparin exchanges.</li><li>CT abdomen/pelvis to evaluate for surgical source if ongoing bleeding or peritonism; consult surgery/gyne as indicated. </li><li>Management tailored to source; PD plan individualized.</li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Cloudy + bloody effluent with abdominal pain and fever</button></h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDHem\'><div class=\'accordion-body\'><ul><li>Meets ISPD criteria if WBC <span class=\'hl-symbol\'>></span>100/µL and PMNs <span class=\'hl-symbol\'>></span>50% after a <span class=\'hl-symbol\'>>=</span>2 h dwell; inoculate blood-culture bottles. </li><li>Start empiric IP antibiotics per local ISPD-aligned protocol and narrow to sensitivities. </li><li>Continue IP heparin to maintain catheter patency if blood present. </li></ul></div></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">List common benign causes of bloody PD effluent in women.</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Ovulation or menstruation, catheter-induced minor trauma, post-procedure (e.g., lap cholecystectomy, lithotripsy), shedding of ectopic endometrium. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">What effluent criteria support PD peritonitis?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Symptoms/cloudy bag plus effluent WBC &gt;100/µL and PMNs &gt;50% after a ≥2 h dwell, and/or a positive culture; rely more on %PMNs with short dwells. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">How do you prevent catheter clot when blood is present in PD effluent?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Add intraperitoneal heparin 500 U/L to exchanges; it prevents clotting without altering systemic coagulation.  </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">Do all blood-stained bags require antibiotics?</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>No. Blood-stained dialysate is rarely infectious; culture is reasonable, but routine antibiotics are not necessary without infection features. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">Name serious causes of hemoperitoneum you must not miss.</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Ischemic bowel, splenic rupture, pancreatitis, colonic adenocarcinoma, femoral hematoma leak, PKD cyst rupture, coagulopathy. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">What imaging do you choose if unstable versus stable with red flags?</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Unstable: bedside ultrasound and urgent CT if feasible. Stable with concerning features: CT abdomen/pelvis; consider laparoscopy if unclear. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">How should you collect effluent for culture to improve yield?</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>After a ≥2 h dwell, inoculate into blood culture bottles. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">What counseling is helpful for an anxious patient with benign hemoperitoneum?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Explain common benign triggers, expected spontaneous resolution, and that IP heparin protects the catheter; arrange short-interval follow-up. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">When should you admit and consult surgery/gynecology?</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>If hemodynamically unstable, ongoing bleeding/clots, falling Hb, peritonism, or unclear source after ED workup. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">What peritonitis management principles apply if criteria are met?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Start intraperitoneal empiric antibiotics per ISPD-aligned regimens and narrow to sensitivities; reassess within 48–96 h for response. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah10\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac10\" aria-expanded=\"false\" aria-controls=\"vivac10\">Does IP heparin increase systemic bleeding risk?</button></h2><div id=\"vivac10\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>No—IP heparin does not change systemic coagulation at these doses; it prevents catheter clotting. </p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'audit\' data-unmapped-count=\'10\'></div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e1\'>Unmapped pearls</button></h2><div id=\'e1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Short-dwell nuance:</strong> In APD, %PMNs is more reliable than absolute WBC with brief dwells—document dwell time. See: <em>TOPIC_BLOCK_C_TITLE</em>. </li><li><strong>Chylous vs bloody:</strong> Milky turbid effluent may be lipids (e.g., chylous ascites) rather than blood; different workup. </li><li><strong>Exit site matters:</strong> Inspect for infection/tunnel tenderness in any PD complication. </li><li><strong>Technique survival:</strong> Noninfectious complications can drive technique failure; early recognition preserves PD. </li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e2\'>Edge cases & special populations</button></h2><div id=\'e2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Pregnancy:</strong> Prioritize US imaging; gyne input early; avoid unnecessary radiation.</li><li><strong>PKD:</strong> Heightened suspicion for cyst rupture when hemoperitoneum occurs. </li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e3\'>Drug dosing & adjustments</button></h2><div id=\'e3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Anticoagulants/antiplatelets:</strong> Temporarily hold or reverse (case-by-case) in active bleeding; resume when safe.</li><li><strong>PD drug clearance:</strong> APD can increase dialyzability for some drugs; check levels/clinical effect if narrow TI. </li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e4\'>Local policy & pathway notes</button></h2><div id=\'e4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>PD peritonitis bundles:</strong> Ensure alignment with your center\'s ISPD-based empiric regimens and culture pathways; retraining after events is recommended. </li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'e5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#e5\'>Suggested schema extensions</button></h2><div id=\'e5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>PD_SAMPLING_BLOCK:</strong> Structured fields for dwell time, sampling method, and bottle type.</li><li><strong>PD_CATHETER_PROTECTION:</strong> Dose and timing fields for IP heparin across exchanges.</li></ul></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li><strong>Missing infection:</strong> Treating as \'benign blood\' without checking cell count/diff, Gram, and culture after an adequate dwell. </li><li><strong>Catheter loss:</strong> Not adding IP heparin when effluent is bloody, leading to intraluminal clot. </li><li><strong>Unnecessary antibiotics:</strong> Starting empiric antibiotics for isolated blood-stained dialysate without infection features. </li><li><strong>Under-imaging:</strong> Failing to image when ongoing bleeding, pain, or instability suggests a surgical/visceral source. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li><strong>Hemoperitoneum spectrum:</strong> Often benign in women on PD; serious visceral causes are rarer but critical to exclude. </li><li><strong>ISPD diagnostics:</strong> The 2-h dwell and %PMNs emphasis for short-dwell APD improve accuracy. </li><li><strong>Catheter preservation:</strong> IP heparin is a simple, high-value intervention. </li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li><strong>Assuming infection with any discoloration:</strong> Blood alone ≠ peritonitis; confirm with criteria. </li><li><strong>Sampling too early:</strong> No dwell or very short dwell reduces diagnostic yield; instill and dwell if needed. </li><li><strong>Skipping culture bottles:</strong> Blood culture bottles improve culture sensitivity. </li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li><strong>Stabilize ABCs:</strong> Vitals, IV access, analgesia; labs (CBC, PT/INR/aPTT), type & screen.</li><li><strong>Effluent sampling:</strong> Ensure ~2 h dwell; send cell count/diff, Gram, culture (blood culture bottles). </li><li><strong>Protect catheter:</strong> Run 1–2 exchanges with IP heparin 500 U/L; avoid systemic antibiotic use unless infection suspected. </li><li><strong>Focused diagnosis:</strong> Screen for benign gynecologic/PD-related causes; check platelets/coags; assess for red flags. </li><li><strong>Image and consult:</strong> US/CT and surgical/gynecologic input if instability, ongoing bleeding, peritonism, or unclear cause. </li><li><strong>Plan disposition:</strong> Observe/reassure if benign and stable; admit for procedural/surgical management when indicated; individualize PD vs temporary HD based on source and safety.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\">PD bag appears bloody -> Check vitals\n  -> Unstable or peritonism? YES -> Resuscitate + urgent US/CT -> Surgery/Gyn consult -> Manage source\n                                 NO  -> Effluent dwell ~2 h -> Send cell count/diff, Gram, culture\n                                         -> Add IP heparin 500 U/L to exchanges\n                                         -> Meets peritonitis criteria (WBC >100/uL AND PMN >50%)? YES -> Start IP antibiotics per ISPD; narrow to sensitivities\n                                                                                                        NO  -> Consider benign causes (menses/ovulation, minor trauma)\n                                                                                                              -> Check CBC, coags; target imaging if red flags\n                                                                                                              -> Reassure/observe; short-interval follow-up</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li><strong>Comprehensive Clinical Nephrology:</strong> Notes that blood-stained dialysate is rarely serious and recommends IP heparin 500 U/L; routine antibiotics not required without infection. </li><li><strong>Clinical Handbook of Nephrology (2024):</strong> Figure 12.18 lists benign vs serious hemoperitoneum causes and states IP heparin prevents catheter clot without systemic effect. </li><li><strong>ISPD-aligned summaries:</strong> Diagnostic thresholds and short-dwell (%PMNs) caveat for PD peritonitis. </li></ul>\r\n      <ul class=\"mb-0\"><li><strong>Use IP heparin early:</strong> Add 500 U/L to exchanges when blood is present to protect catheter patency; this does not alter systemic coagulation.  </li><li><strong>Avoid unnecessary antibiotics:</strong> Isolated blood-stained dialysate without infection does not warrant empiric antibiotics; still send cultures. </li><li><strong>Follow ISPD criteria:</strong> Apply WBC and %PMNs thresholds after an adequate dwell and use blood culture bottles for sampling. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li><strong>ISPD peritonitis diagnostics (adult):</strong> Symptoms/cloudy effluent + effluent WBC <span class=\'hl-symbol\'>></span>100/µL and PMNs <span class=\'hl-symbol\'>></span>50% after a <span class=\'hl-symbol\'>>=</span>2 h dwell; culture preferred in blood culture bottles; rely on %PMNs in short dwells. </li><li><strong>Hemoperitoneum workup:</strong> Categorize benign vs serious etiologies and tailor imaging (US/CT) and laparoscopy where indicated. </li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"><section id=\"extra-note-1756014837030\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\">\n                     <div class=\"section-title mb-2\">\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill text-info\"></i></span>\n                       <span>Extra Note #1756014837</span>\n                     </div>\n                     <div class=\"border rounded p-3 bg-white\">\n                       <p>Here are the structured fields for dwell time, sampling method, and bottle type in the context of evaluating bloody peritoneal dialysis effluent:</p>\n<h2>Dwell Time for Diagnostic Sampling</h2>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Dwell Duration</th>\n<th align=\"left\">Clinical Scenario</th>\n<th align=\"left\">Purpose &amp; Rationale</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><strong>≥ 2 hours</strong></td>\n<td align=\"left\"><strong>Standard diagnostic dwell</strong></td>\n<td align=\"left\">• <strong>Optimal for cell count interpretation:</strong> Allows sufficient time for leukocyte migration into peritoneal fluid<br>• <strong>KDIGO/ISPD guideline recommendation:</strong> Required for accurate peritonitis diagnosis (WBC &gt;100/µL + &gt;50% PMNs)<br>• <strong>Gold standard:</strong> Provides most reliable differential count</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>&lt; 2 hours</strong></td>\n<td align=\"left\">APD cycles or emergent sampling</td>\n<td align=\"left\">• <strong>Suboptimal for absolute WBC count:</strong> May yield falsely low counts due to insufficient dwell time<br>• <strong>Relative value preserved:</strong> Percentage of polymorphonuclear neutrophils (%PMNs) remains clinically useful<br>• <strong>Clinical correlation essential:</strong> Requires stronger emphasis on symptoms and Gram stain results</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>No dwell</strong></td>\n<td align=\"left\">Catheter trauma or acute bleeding</td>\n<td align=\"left\">• <strong>Limited diagnostic utility:</strong> Cannot exclude peritonitis based on cell count alone<br>• <strong>Therapeutic instillation recommended:</strong> Instill 1L dialysate, dwell 2 hours, then sample<br>• <strong>Gram stain still valuable:</strong> May detect organisms despite inadequate dwell time</td>\n</tr>\n</tbody></table>\n<h2>Sampling Method Specifications</h2>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Method</th>\n<th align=\"left\">Technique</th>\n<th align=\"left\">Advantages</th>\n<th align=\"left\">Limitations</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><strong>Direct aspiration</strong></td>\n<td align=\"left\">Aspirate from catheter port using sterile technique</td>\n<td align=\"left\">• Immediate availability<br>• Minimal contamination risk<br>• Suitable for any dwell time</td>\n<td align=\"left\">• Small volume may limit testing options<br>• Risk of missing localized infection</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>Drainage bag collection</strong></td>\n<td align=\"left\">Drain complete exchange into sterile collection bag</td>\n<td align=\"left\">• Larger volume for multiple tests<br>• Representative sample of entire dwell<br>• Standardized method</td>\n<td align=\"left\">• Potential for external contamination<br>• Requires careful aseptic technique</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>Syringe instillation/aspiration</strong></td>\n<td align=\"left\">Instill/aspirate via syringe through catheter port</td>\n<td align=\"left\">• Controlled volume management<br>• Useful for difficult drains<br>• Minimizes air introduction</td>\n<td align=\"left\">• Increased manipulation risk<br>• Requires strict sterile technique</td>\n</tr>\n</tbody></table>\n<h2>Culture Bottle Type Selection</h2>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Bottle Type</th>\n<th align=\"left\">Recommended Use</th>\n<th align=\"left\">Inoculation Volume</th>\n<th align=\"left\">Advantages</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><strong>Blood culture bottles</strong></td>\n<td align=\"left\"><strong>First-line preferred method</strong></td>\n<td align=\"left\">5-10 mL per bottle</td>\n<td align=\"left\">• <strong>Superior yield:</strong> 80-90% sensitivity vs. 50-60% with conventional methods<br>• <strong>Continuous monitoring:</strong> Automated systems detect growth earlier<br>• <strong>Reduced contamination:</strong> Closed system minimizes external contamination<br>• <strong>Broader organism detection:</strong> Better for fastidious organisms</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>Conventional culture bottles</strong></td>\n<td align=\"left\">Alternative when blood culture bottles unavailable</td>\n<td align=\"left\">50-100 mL</td>\n<td align=\"left\">• Widely available<br>• Lower cost<br>• Familiar to microbiology labs</td>\n</tr>\n<tr>\n<td align=\"left\"><strong>Mycobacterial/fungal culture</strong></td>\n<td align=\"left\">Suspected atypical infections</td>\n<td align=\"left\">10-50 mL</td>\n<td align=\"left\">• Specialized media for unusual pathogens<br>• Required if TB or fungal peritonitis suspected</td>\n</tr>\n</tbody></table>\n<h2>Clinical Application Protocol</h2>\n<p><strong>Standard Diagnostic Sequence for Bloody Effluent:</strong></p>\n<ol>\n<li><strong>If dwelling fluid present:</strong> Drain completely and send for cell count with differential, Gram stain, and culture</li>\n<li><strong>If no dwell fluid present:</strong> Instill 1L dialysate with IP heparin (500 U/L), dwell for ≥2 hours, then drain and sample</li>\n<li><strong>Always inoculate blood culture bottles</strong> with 5-10 mL effluent for optimal microbial detection</li>\n<li><strong>Process remaining fluid</strong> for cell count, differential, and additional tests as indicated</li>\n</ol>\n<p><strong>Critical Timing Considerations:</strong></p>\n<ul>\n<li><strong>Peritonitis diagnosis requires ≥2 hour dwell</strong> for accurate cell count interpretation</li>\n<li><strong>Sample processing within 1 hour</strong> of collection for optimal cell preservation</li>\n<li><strong>Culture bottles should be inoculated immediately</strong> at bedside when possible</li>\n</ul>\n<div class=\"accordion overflow-accordion\" id=\"overflowAccordion\">\n  <div class=\"accordion-item\">\n    <h2 class=\"accordion-header\">\n      <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#unmappedPearls\" aria-expanded=\"false\" aria-controls=\"unmappedPearls\">\n        <i class=\"bi bi-gem\"></i> Unmapped Pearls\n      </button>\n    </h2>\n    <div id=\"unmappedPearls\" class=\"accordion-collapse collapse\" data-bs-parent=\"#overflowAccordion\" style=\"\">\n      <div class=\"accordion-body\">\n        <ul>\n          <li><strong>Clinical insight:</strong> In APD patients with short cycles, a purposeful 2-hour dwell is essential for accurate peritonitis diagnosis - don\'t rely on overnight cycler effluent for cell counts</li>\n          <li><strong>Practical tip:</strong> Keep blood culture bottles at bedside in PD units to facilitate immediate inoculation and maximize culture yield</li>\n          <li><strong>Cross-reference example:</strong> See: <em>Peritonitis checkpoints in bloody effluent</em> for interpretation guidelines</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"accordion-item\">\n    <h2 class=\"accordion-header\">\n      <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#edgeCases\" aria-expanded=\"false\" aria-controls=\"edgeCases\">\n        <i class=\"bi bi-exclamation-triangle\"></i> Edge Cases &amp; Special Populations\n      </button>\n    </h2>\n    <div id=\"edgeCases\" class=\"accordion-collapse collapse\" data-bs-parent=\"#overflowAccordion\" style=\"\">\n      <div class=\"accordion-body\">\n        <ul>\n          <li><strong>Pediatrics:</strong> Smaller inoculation volumes (3-5 mL) may be used in children while maintaining adequate culture sensitivity</li>\n          <li><strong>Geriatrics:</strong> Consider reduced dwell volumes (500-750 mL) in frail elderly patients who cannot tolerate full 1L dwells</li>\n          <li><strong>Dialysis:</strong> Patients with rapid ultrafiltration may require shorter dwell times; adjust diagnostic expectations accordingly</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"accordion-item\">\n    <h2 class=\"accordion-header\">\n      <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#localPolicy\" aria-expanded=\"false\" aria-controls=\"localPolicy\">\n        <i class=\"bi bi-building\"></i> Local Policy &amp; Pathway Notes\n      </button>\n    </h2>\n    <div id=\"localPolicy\" class=\"accordion-collapse collapse\" data-bs-parent=\"#overflowAccordion\" style=\"\">\n      <div class=\"accordion-body\">\n        <ul>\n          <li><strong>Site-specific processes:</strong> Some institutions may have standing orders for PD effluent sampling kits containing appropriate culture bottles</li>\n          <li><strong>Resource availability:</strong> In settings without blood culture bottles, conventional cultures with larger inoculation volumes (50-100 mL) are acceptable alternatives</li>\n          <li><strong>Referral pathways:</strong> Establish clear protocols for after-hours sample processing with microbiology departments</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"accordion-item\">\n    <h2 class=\"accordion-header\">\n      <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#schemaExtensions\" aria-expanded=\"true\" aria-controls=\"schemaExtensions\">\n        <i class=\"bi bi-arrow-expand\"></i> Suggested Schema Extensions\n      </button>\n    </h2>\n    <div id=\"schemaExtensions\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#overflowAccordion\" style=\"\">\n      <div class=\"accordion-body\">\n        <ul>\n          <li><strong>optimal_dwell_time_minutes:</strong> Integer field specifying ideal dwell duration for diagnostic sampling</li>\n          <li><strong>culture_method_preference:</strong> Categorical field indicating preferred culture technique (blood culture bottles vs conventional)</li>\n          <li><strong>Purpose:</strong> Standardize diagnostic approach across different clinical scenarios and resource settings</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class=\"audit\" data-unmapped-count=\"3\"></div>\n                     </div>\n                   </section></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                     <button class=\"btn btn-outline-danger btn-sm delete-section-btn\" title=\"Delete this section\">\r\n                       <i class=\"bi bi-trash\"></i>\r\n                     </button>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   // Add delete functionality to the new section\r\n                   const deleteBtn = newSection.querySelector(\'.delete-section-btn\');\r\n                   if (deleteBtn) {\r\n                     deleteBtn.addEventListener(\'click\', (e) => {\r\n                       e.preventDefault();\r\n                       e.stopPropagation();\r\n                       const sectionTitle = newSection.querySelector(\'.section-title span:last-child\')?.textContent?.trim() || \'Study Note\';\r\n                       if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n                         newSection.remove();\r\n                         showDeleteMessage(`Study Note deleted successfully`);\r\n                       }\r\n                     });\r\n                   }\r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          transition: opacity 0.3s ease;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      // Initialize delete buttons for sections\r\n      initializeDeleteButtons();\r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, delete, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // ================== SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n    // Initialize delete functionality for all sections\r\n    function initializeDeleteButtons() {\r\n      console.log(\'Initializing delete buttons for sections...\');\r\n      \r\n      // Add delete buttons to all sections\r\n      const sections = document.querySelectorAll(\'section.nm-card, section.additional-note\');\r\n      sections.forEach((section, index) => {\r\n        addDeleteButtonToSection(section, index);\r\n      });\r\n      \r\n      console.log(\'Delete buttons initialized for\', sections.length, \'sections\');\r\n    }\r\n    \r\n    // Add delete button to a section\r\n    function addDeleteButtonToSection(section, index) {\r\n      // Check if delete button already exists\r\n      if (section.querySelector(\'.delete-section-btn\')) {\r\n        return;\r\n      }\r\n      \r\n      // Create delete button\r\n      const deleteBtn = document.createElement(\'button\');\r\n      deleteBtn.className = \'btn btn-outline-danger btn-sm delete-section-btn\';\r\n      deleteBtn.innerHTML = \'<i class=\"bi bi-trash\"></i>\';\r\n      deleteBtn.title = \'Delete this section\';\r\n      deleteBtn.style.position = \'absolute\';\r\n      deleteBtn.style.top = \'10px\';\r\n      deleteBtn.style.right = \'10px\';\r\n      deleteBtn.style.zIndex = \'10\';\r\n      \r\n      // Add click handler\r\n      deleteBtn.addEventListener(\'click\', (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        deleteSection(section, index);\r\n      });\r\n      \r\n      // Make section position relative for absolute positioning of delete button\r\n      section.style.position = \'relative\';\r\n      \r\n      // Add delete button to section\r\n      section.appendChild(deleteBtn);\r\n    }\r\n    \r\n    // Delete a section\r\n    function deleteSection(section, index) {\r\n      const sectionTitle = section.querySelector(\'.section-title\')?.textContent?.trim() || \'Section\';\r\n      \r\n      // Show confirmation dialog\r\n      if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n        console.log(\'Deleting section:\', sectionTitle);\r\n        \r\n        // Remove the section\r\n        section.remove();\r\n        \r\n        // Show success message\r\n        showDeleteMessage(`Section \"${sectionTitle}\" deleted successfully`);\r\n        \r\n        // Reinitialize delete buttons for remaining sections\r\n        setTimeout(() => {\r\n          initializeDeleteButtons();\r\n        }, 100);\r\n      }\r\n    }\r\n    \r\n    // Show delete confirmation message\r\n    function showDeleteMessage(message) {\r\n      // Create temporary message element\r\n      const messageEl = document.createElement(\'div\');\r\n      messageEl.className = \'alert alert-success alert-dismissible fade show\';\r\n      messageEl.style.position = \'fixed\';\r\n      messageEl.style.top = \'20px\';\r\n      messageEl.style.right = \'20px\';\r\n      messageEl.style.zIndex = \'9999\';\r\n      messageEl.innerHTML = `\r\n        ${message}\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n      `;\r\n      \r\n      // Add to page\r\n      document.body.appendChild(messageEl);\r\n      \r\n      // Auto-remove after 3 seconds\r\n      setTimeout(() => {\r\n        if (messageEl.parentNode) {\r\n          messageEl.remove();\r\n        }\r\n      }, 3000);\r\n    }\r\n    \r\n    // ================== END SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for delete buttons\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-19 15:24:20', '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 15:24:20');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(7, NULL, 4, 1, 1, 'early-post-kidney-transplant-aki-week-1-banff-2b', 'Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA', 'Early graft dysfunction (1st week) • Banff 2B TCMR treatment • DSA testing & virtual crossmatch (Luminex)', 'published', 'A stable patient 1 week after kidney transplant (KTX) presents with creatinine ~200 µmol/L (~2.3 mg/dL). Approach systematically: confirm volume status and immunosuppression adherence, check calcineurin inhibitor trough levels, perform urgent renal ultrasound with Doppler to assess perfusion/obstruction, and proceed to allograft biopsy when indicated. Vascular/uro complications, T-cell–mediated (TCMR) or antibody-mediated rejection (ABMR), calcineurin-inhibitor toxicity, ischemic ATN, and infection are the key early differentials. ', '{\"slug\":\"early-post-kidney-transplant-aki-week-1-banff-2b\",\"TOPIC\":\"Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA\",\"CHIP_1\":\"Early graft dysfunction (1st week)\",\"CHIP_2\":\"Banff 2B TCMR treatment\",\"CHIP_3\":\"DSA testing & virtual crossmatch (Luminex)\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A stable patient 1 week after kidney transplant (KTX) presents with creatinine ~200 \\u00b5mol\\/L (~2.3 mg\\/dL). Approach systematically: confirm volume status and immunosuppression adherence, check calcineurin inhibitor trough levels, perform urgent renal ultrasound with Doppler to assess perfusion\\/obstruction, and proceed to allograft biopsy when indicated. Vascular\\/uro complications, T-cell\\u2013mediated (TCMR) or antibody-mediated rejection (ABMR), calcineurin-inhibitor toxicity, ischemic ATN, and infection are the key early differentials. \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Stability & access:<\\/strong> ABCs, IV access, review meds\\/immunosuppression schedules and missed doses; obtain outside operative & donor data.\",\"\\ud83e\\uddea <strong>Essential labs:<\\/strong> serum creatinine, urea, electrolytes, bicarbonate, CBC, LFTs, CRP, urinalysis\\/culture; tacrolimus\\/cyclosporine trough (true C0), drug\\u2013drug interaction screen; consider CMV\\/BK as per risk.  \",\"\\ud83e\\uddf4 <strong>Avoid nephrotoxins:<\\/strong> hold NSAIDs\\/ACEi if hypovolemic; review antimicrobials\\/macrolides that raise CNI levels. \",\"\\ud83d\\udda5\\ufe0f <strong>Bedside imaging:<\\/strong> renal ultrasound with Doppler to assess perfusion and obstruction; look for arterial\\/venous flow, intrarenal waveforms, and hydronephrosis. \",\"\\ud83e\\uddeb <strong>Early biopsy if unexplained rise:<\\/strong> proceed once infection\\/obstruction\\/thrombosis are excluded; histology guides therapy (TCMR vs ABMR). \"],\"DDX_BUCKET_1_TITLE\":\"Vascular & Urologic (often urgent early post-KTX)\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83d\\udd34 <strong>Renal vein thrombosis\\/artery thrombosis:<\\/strong> acute pain, anuria\\/hematuria; Doppler flow loss.\",\"\\ud83d\\udfe0 <strong>Transplant renal artery stenosis (TRAS):<\\/strong> refractory HTN, graft dysfunction; Doppler peak systolic velocity (PSV) elevated with intrarenal tardus\\u2013parvus; confirm with CTA\\/MRA\\/angiography.  \",\"\\ud83d\\udfe1 <strong>Obstruction\\/leak:<\\/strong> hydronephrosis or perinephric collection on ultrasound; consider stent\\/ureteric issues. \"],\"DDX_BUCKET_2_TITLE\":\"Immunologic\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83e\\uddec <strong>TCMR (Banff):<\\/strong> ranges from borderline to Banff 2B\\/3; Banff 2B\\/3 usually needs rATG. \",\"\\ud83e\\uddea <strong>ABMR:<\\/strong> DSA-mediated microcirculation injury; management typically combines steroids, plasmapheresis, IVIG \\u00b1 rituximab. \"],\"DDX_BUCKET_3_TITLE\":\"Drug, Ischemic, and Infectious\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83d\\udc8a <strong>CNI toxicity:<\\/strong> tremor, hyperkalemia, elevated trough; check interactions (macrolides, azoles, phenytoin) and diarrhea effects. \",\"\\u23f1\\ufe0f <strong>Ischemic ATN\\/delayed graft function:<\\/strong> consider if persistent from peri-operative period.\",\"\\ud83e\\udda0 <strong>UTI\\/pyelonephritis, CMV\\/BK viremia:<\\/strong> evaluate by culture and PCR per risk\\/timing. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'>\\n  <div><strong>Targets (early, 0\\u20132 mo):<\\/strong> Tacrolimus 8\\u201315 ng\\/mL; cyclosporine 200\\u2013350 ng\\/mL. Ensure true trough (C0). <\\/div>\\n  <div><strong>Doppler pearls:<\\/strong> Intrarenal tardus\\u2013parvus suggests proximal stenosis; abnormal resistive index > <span class=\'hl-symbol\'>\\u2265<\\/span> 0.80 predicts worse outcomes (not specific to AR).  <\\/div>\\n  <div><strong>TRAS confirmation & Rx:<\\/strong> If Doppler suggests TRAS (elevated PSV and RAR), confirm with CTA\\/MRA or angiography; treat by angioplasty\\/stenting when appropriate. <\\/div>\\n  <div><strong>DSA (Luminex SAB):<\\/strong> Patient serum + beads (single antigen); read by fluorescence (MFI). Used for virtual crossmatch; C1q\\/C3d assays add pathogenicity context. <\\/div>\\n  <div><strong>Banff 2B TCMR:<\\/strong> Pulse IV methylprednisolone then rATG 1\\u20131.5 mg\\/kg IV \\u00d7 7\\u201314 days; intensify maintenance IS.  <\\/div>\\n<\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Repeat creatinine, urea, electrolytes, UA\\/culture:<\\/strong> trend trajectory and exclude infection.\",\"\\ud83d\\udc8a <strong>CNI trough:<\\/strong> confirm 12-h C0; frequent checks early until in target; assess interactions and diarrhea.  \",\"\\ud83e\\udda0 <strong>Viral tests per risk:<\\/strong> CMV PCR (donor\\/recipient serostatus guided), BK PCR if graft dysfunction persists. \",\"\\ud83d\\udda5\\ufe0f <strong>Ultrasound with Doppler:<\\/strong> flow in main artery\\/vein, intrarenal waveforms (tardus\\u2013parvus), resistive index, hydronephrosis. \",\"\\ud83e\\uddeb <strong>Allograft biopsy:<\\/strong> classify Banff lesions; rule in TCMR vs ABMR; send C4d, EM as available. \",\"\\ud83e\\uddec <strong>DSA testing:<\\/strong> Luminex single-antigen bead (SAB) with MFI; consider C1q\\/C3d; use for virtual crossmatch if needed. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-secondary p-2\'>\\n<strong>Stable week-1 post-KTX creatinine rise:<\\/strong>\\n<ol class=\'mb-1\'>\\n  <li><strong>Confirm basics:<\\/strong> volume status, meds taken, true C0 trough, interactions.<\\/li>\\n  <li><strong>Bedside ultrasound:<\\/strong> exclude obstruction\\/perfusion issue; if Doppler suggests stenosis, arrange CTA\\/MRA & consider angiography.<\\/li>\\n  <li><strong>If no reversible cause:<\\/strong> proceed to biopsy (Banff grading) and send DSA (Luminex SAB) for ABMR component.<\\/li>\\n  <li><strong>Treat per pathology:<\\/strong> Banff 2B TCMR \\u2192 IV steroids then rATG; ABMR component \\u2192 steroids + plasmapheresis + IVIG \\u00b1 rituximab.<\\/li>\\n<\\/ol>\\n<small>See dosing and criteria below for details.<\\/small>\\n<\\/div>\",\"PILLAR_1\":\"Structured initial approach\",\"STEP_1_TITLE\":\"History & Examination (focused)\",\"STEP_1_LI\":[\"\\ud83e\\ude7a <strong>History:<\\/strong> urine output, weight\\/volume status, timing of IS doses, drug interactions (e.g., macrolides), diarrhea, fever\\/UTI symptoms, pain at graft.\",\"\\ud83d\\udc40 <strong>Exam:<\\/strong> vitals, edema\\/JVP, graft site tenderness\\/bruit, bladder scan; review surgical drains\\/catheters.\"],\"STEP_2_TITLE\":\"Initial tests (same day)\",\"STEP_2_LI\":[\"\\ud83e\\uddea <strong>Labs:<\\/strong> BMP, CBC, urinalysis\\/culture, LFTs; tacrolimus\\/cyclosporine trough (target early tac 8\\u201315 ng\\/mL). \",\"\\ud83d\\udda5\\ufe0f <strong>Ultrasound with Doppler:<\\/strong> evaluate perfusion\\/obstruction; if suspicious for TRAS, proceed to CTA\\/MRA\\/angiography. \",\"\\ud83e\\uddec <strong>DSA (Luminex SAB):<\\/strong> for suspected ABMR\\/mixed rejection; consider C1q\\/C3d. \"],\"PILLAR_2\":\"Definitive diagnostics & targeted therapy\",\"STEP_3_TITLE\":\"Biopsy-driven decisions\",\"STEP_3_LI\":[\"\\ud83e\\uddeb <strong>Allograft biopsy:<\\/strong> Banff classification (TCMR vs ABMR); include C4d and microcirculation lesions; adjust plan accordingly. \"],\"STEP_4_TITLE\":\"Treat what you find\",\"STEP_4_LI\":[\"\\ud83d\\udc8a <strong>Banff 2B TCMR:<\\/strong> IV methylprednisolone (250\\u2013500 mg\\/day \\u00d7 3\\u20135) then rATG 1\\u20131.5 mg\\/kg IV \\u00d7 7\\u201314 days; intensify maintenance IS.  \",\"\\ud83d\\udc89 <strong>ABMR (if present):<\\/strong> steroids + plasmapheresis + IVIG \\u00b1 rituximab, individualized to DSA burden\\/biopsy severity. \",\"\\ud83e\\ude7b <strong>TRAS:<\\/strong> confirm and consider angioplasty\\/stent when hemodynamically significant. \"],\"TOPIC_BLOCK_A_TITLE\":\"Banff 2B TCMR \\u2014 Practical Management\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\u2705 <strong>Steroid pulse:<\\/strong> methylprednisolone 250\\u2013500 mg IV daily \\u00d7 3\\u20135 days. \",\"\\u2705 <strong>rATG dosing:<\\/strong> rabbit ATG 1\\u20131.5 mg\\/kg IV daily for 7\\u201314 days; center protocols vary (premedicate; monitor WBC\\/platelets). \",\"\\u2705 <strong>Intensify maintenance IS:<\\/strong> optimize tacrolimus\\/MMF and steroid taper per response. \",\"\\ud83d\\udd0e <strong>Reassess:<\\/strong> creatinine trend and consider follow-up biopsy if poor response.\"],\"TOPIC_BLOCK_B_TITLE\":\"TRAS \\u2014 What to look for on Doppler\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Suggestive Doppler:<\\/strong> elevated anastomotic PSV and renal-to-aortic ratio (RAR), intrarenal tardus\\u2013parvus waveform. \",\"\\ud83e\\udded <strong>Confirmatory imaging:<\\/strong> CTA\\/MRA or angiography when ultrasound suggests hemodynamically significant stenosis. \",\"\\ud83d\\udee0\\ufe0f <strong>Treatment:<\\/strong> percutaneous angioplasty\\/stenting when indicated; monitor BP\\/renal function response. \"],\"TOPIC_BLOCK_C_TITLE\":\"DSA & Virtual Crossmatch (Luminex SAB)\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\uddea <strong>How SAB works:<\\/strong> patient serum is incubated with single-antigen beads, each bead displays one HLA antigen; fluorescence (MFI) quantifies binding. \",\"\\ud83e\\udde0 <strong>Virtual crossmatch:<\\/strong> compare recipient DSA (SAB) against known donor HLA typing to predict physical crossmatch. \",\"\\ud83e\\uddf7 <strong>Complement-binding assays:<\\/strong> C1q\\/C3d positivity may indicate more pathogenic DSA. \",\"\\u2139\\ufe0f <strong>MFI thresholds:<\\/strong> positive cut-offs are lab-specific; interpret with clinical\\/biopsy context.\"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udccb <strong>Document true trough timing:<\\/strong> record dosing\\/collection times for CNIs. \",\"\\ud83d\\udda5\\ufe0f <strong>Standardized Doppler protocol:<\\/strong> ensure PSV\\/RAR and intrarenal waveform capture.\",\"\\ud83e\\uddeb <strong>Biopsy pathway:<\\/strong> consent, bleeding risk, pre-procedure labs, and timely pathology communication.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Creatinine trajectory:<\\/strong> return toward baseline within days\\u2013weeks after effective therapy.\",\"\\ud83e\\uddea <strong>Immunologic control:<\\/strong> reduction of DSA MFI and resolution of microcirculation injury on follow-up biopsy when applicable.\"],\"QUALITY_SAFETY_LI\":[\"\\ud83d\\udee1\\ufe0f <strong>ATG safety:<\\/strong> premedicate; monitor for infusion reactions, leukopenia, thrombocytopenia, infection risk. \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Biopsy precautions:<\\/strong> correct coagulopathy, manage antiplatelets\\/anticoagulants, and monitor post-procedure for bleeding.\",\"COMMUNICATION_LI\":\"\\ud83d\\uddfa\\ufe0f <strong>Coordinate with outside transplant center:<\\/strong> obtain operative notes, donor\\/recipient HLA data, induction regimen, and early post-op course to contextualize current findings.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'cases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: High tacrolimus level<\\/button>\\n    <\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clue:<\\/strong> tremor, K+ high, tac level 20 ng\\/mL.<\\/li>\\n          <li><strong>Action:<\\/strong> hold\\/reduce tac, review recent macrolides\\/azole use; re-check level. <\\/li>\\n          <li><strong>Teaching:<\\/strong> monitor C0 frequently early post-KTX. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: Suspected TRAS<\\/button>\\n    <\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clue:<\\/strong> refractory HTN, bruit, rising creatinine.<\\/li>\\n          <li><strong>Doppler:<\\/strong> elevated PSV\\/RAR; intrarenal tardus\\u2013parvus waveform. <\\/li>\\n          <li><strong>Next:<\\/strong> CTA\\/MRA \\u2192 angiography; angioplasty\\/stent if significant. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: Biopsy Banff 2B<\\/button>\\n    <\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Plan:<\\/strong> IV methylpred \\u00d73\\u20135 then rATG 1\\u20131.5 mg\\/kg IV daily \\u00d77\\u201314; monitor counts\\/fever.  <\\/li>\\n          <li><strong>Check:<\\/strong> send DSA (Luminex SAB) to assess for mixed ABMR; consider PLEX\\/IVIG \\u00b1 rituximab if ABMR present.  <\\/li>\\n          <li><strong>Follow-up:<\\/strong> trend creatinine; consider repeat biopsy if non-responsive.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"Outline your initial approach to a stable week-1 post-KTX patient with creatinine ~200 \\u00b5mol\\/L.\",\"a\":\"Confirm adherence\\/true CNI trough, screen for interactions\\/diarrhea, perform urgent renal ultrasound with Doppler, send UA\\/culture and targeted viral tests, and arrange biopsy if no reversible cause.  \"},{\"q\":\"What tacrolimus level do you target in the first 0\\u20132 months?\",\"a\":\"Typically 8\\u201315 ng\\/mL, measured as a true 12-h trough (C0). \"},{\"q\":\"How do you perform DSA testing and what is MFI?\",\"a\":\"Use Luminex single-antigen beads: patient serum binds bead-bound HLA; fluorescence readout (MFI) semi-quantifies binding. Thresholds are lab-specific; interpret with clinical\\/biopsy context. \"},{\"q\":\"Define a virtual crossmatch.\",\"a\":\"Comparison of the recipient\'s DSA (SAB profile) to the donor\'s HLA type to predict a physical crossmatch. \"},{\"q\":\"Banff 2B TCMR on biopsy\\u2014how do you treat?\",\"a\":\"Pulse IV methylprednisolone then rATG 1\\u20131.5 mg\\/kg IV daily for 7\\u201314 days; optimize maintenance immunosuppression.  \"},{\"q\":\"State a standard regimen for active ABMR.\",\"a\":\"Steroids + plasmapheresis + IVIG \\u00b1 rituximab, individualized to DSA\\/biopsy severity. \"},{\"q\":\"What Doppler findings suggest TRAS?\",\"a\":\"Elevated anastomotic PSV and renal-aortic ratio with intrarenal tardus\\u2013parvus; confirm by CTA\\/MRA or angiography. \"},{\"q\":\"Does a high intrarenal resistive index prove rejection?\",\"a\":\"No. RI <span class=\'hl-symbol\'>\\u2265<\\/span> 0.80 predicts worse outcomes but is not specific for rejection. \"},{\"q\":\"Name two common culprits that raise tacrolimus levels.\",\"a\":\"Macrolides (e.g., clarithromycin) and azoles via CYP3A4\\/P-gp inhibition. \"},{\"q\":\"How frequently should CNI levels be checked early post-KTX?\",\"a\":\"Frequently until therapeutic targets are reached; ensure timing is a true trough. \"},{\"q\":\"What is the role of complement-binding DSA assays?\",\"a\":\"C1q\\/C3d positivity suggests complement-activating antibodies and higher risk; supports ABMR risk stratification. \"},{\"q\":\"When is biopsy indicated in the first week?\",\"a\":\"If no reversible cause on exam\\/labs\\/imaging and creatinine remains elevated; biopsy guides TCMR vs ABMR therapy. \"}],\"PITFALLS_LI\":[\"\\u274c <strong>Measuring a non-trough CNI level:<\\/strong> leads to misinterpretation and wrong dose changes. \",\"\\u274c <strong>Delaying Doppler ultrasound:<\\/strong> can miss thrombosis\\/stenosis or obstruction early. \",\"\\u274c <strong>Ignoring drug interactions\\/diarrhea:<\\/strong> may cause unrecognized CNI toxicity or subtherapeutic levels. \",\"\\u274c <strong>Assuming high RI means rejection:<\\/strong> it is prognostic, not diagnostic. \",\"\\u274c <strong>Undertreating Banff 2B:<\\/strong> steroids alone are often insufficient; add rATG. \"],\"ANSWER_STEPS_OL\":[\"History & exam (adherence, interactions, volume, symptoms).\",\"Full labs including true CNI trough and infection screen.\",\"Urgent ultrasound with Doppler; pursue CTA\\/MRA if TRAS suspected.\",\"Send DSA (Luminex SAB) \\u00b1 C1q\\/C3d; obtain outside transplant data.\",\"Biopsy if no reversible cause; classify Banff.\",\"Treat Banff 2B with steroids \\u2192 rATG; if ABMR, add PLEX + IVIG \\u00b1 rituximab.\",\"Optimize maintenance immunosuppression and monitor response.\"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83d\\udd2c <strong>Biopsy-driven therapy:<\\/strong> pathology directs TCMR vs ABMR treatment. \",\"\\ud83e\\uddea <strong>SAB and virtual crossmatch:<\\/strong> understand what MFI represents and lab variability. \",\"\\ud83e\\udde0 <strong>CNI pharmacology:<\\/strong> CYP3A4\\/P-gp interactions and diarrhea effects. \",\"\\ud83e\\ude7b <strong>Doppler patterns:<\\/strong> tardus\\u2013parvus and indices to triage vascular causes. \"],\"TEACHING_MISTAKES_LI\":[\"\\ud83d\\ude45 <strong>Treating presumed rejection without imaging:<\\/strong> may miss thrombosis\\/obstruction.\",\"\\ud83d\\ude45 <strong>Not confirming true trough:<\\/strong> leads to mis-dosing CNIs.\",\"\\ud83d\\ude45 <strong>Forgetting infection work-up:<\\/strong> especially UTI early post-op can mimic rejection.\"],\"ASCII_FLOWCHART_PRE\":\"WEEK-1 POST-KTX CREAT RISE (STABLE)\\n|\\n+--> Check adherence & true CNI trough (C0); review interactions\\n|\\n+--> Labs (BMP\\/CBC\\/UA), urine culture; CMV\\/BK as indicated\\n|\\n+--> Renal US + Doppler\\n      |-- If obstruction\\/perfusion problem --> fix (stent\\/IR\\/angioplasty)\\n      |-- If no reversible cause --> proceed to biopsy + DSA (SAB)\\n             |-- Banff 2B TCMR --> Steroid pulse --> rATG 1-1.5 mg\\/kg x 7-14 d\\n             |-- ABMR or mixed --> Steroids + PLEX + IVIG +\\/- rituximab\\n             |-- Reassess; optimize maintenance IS\\n\",\"EVIDENCE_STUDIES_LI\":[\"Comprehensive Clinical Nephrology: rATG 1\\u20131.5 mg\\/kg IV \\u00d7 7\\u201314 days for rejection; ABMR treatments table (PLEX, IVIG, rituximab, etc.).  \",\"Washington Manual: ABMR standard of care (steroids + plasmapheresis + IVIG \\u00b1 rituximab). \",\"Absolute Nephrology Review: early tacrolimus target 8\\u201315 ng\\/mL and frequent trough monitoring.  \",\"Doppler stenosis patterns and management: tardus\\u2013parvus and confirmatory imaging \\u2192 angioplasty\\/stenting. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Use biopsy to direct therapy; treat Banff 2B\\/3 with steroid pulse followed by rATG.\",\"Combine plasmapheresis + IVIG \\u00b1 rituximab for active ABMR in appropriate cases.\",\"Ensure true trough CNI monitoring and interaction review early post-transplant.\",\"Employ Doppler criteria to triage TRAS; confirm before intervention.\"],\"GUIDELINE_ANCHORS_LI\":[\"\\ud83d\\udcd1 <strong>Banff classification & treatment intensity:<\\/strong> Banff IIA\\/IIB\\/III require more intensive therapy than borderline\\/IA. \",\"\\ud83d\\udcd1 <strong>ABMR care bundle:<\\/strong> Steroids + PLEX + IVIG \\u00b1 rituximab is widely adopted standard therapy. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'x1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x1\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'x1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Premedication for rATG:<\\/strong> acetaminophen, antihistamine, and steroids reduce infusion reactions. See: <em>Banff 2B TCMR \\u2014 Practical Management<\\/em>. <\\/li>\\n          <li><strong>MFI nuance:<\\/strong> rising MFI trends carry more weight than a single threshold; complement-binding (C1q\\/C3d) refines risk. See: <em>DSA & Virtual Crossmatch<\\/em>. <\\/li>\\n          <li><strong>RI context:<\\/strong> elevated RI reflects parenchymal compliance and hemodynamics; it is prognostic rather than diagnostic. See: <em>Quick Ref Card<\\/em>. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'x2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x2\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'x2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Pediatrics\\/pregnancy:<\\/strong> coordinate biopsy\\/imaging and immunosuppression adjustments with specialized teams; tailor tacrolimus targets and infection prophylaxis.<\\/li>\\n          <li><strong>Highly sensitized recipients:<\\/strong> early DSA dynamics and mixed rejection are common; low threshold for adding ABMR therapies. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'x3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x3\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'x3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>rATG cytopenias:<\\/strong> hold or reduce dose with leukopenia\\/thrombocytopenia; add antimicrobial prophylaxis per center protocol.<\\/li>\\n          <li><strong>CNI interactions:<\\/strong> macrolides\\/azoles increase levels; enzyme inducers (e.g., phenytoin) reduce levels\\u2014monitor closely. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'x4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x4\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'x4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>External KTX (outside KSA):<\\/strong> early contact with the original transplant center expedites donor HLA\\/DSA history and induction details; align on biopsy thresholds and ABMR add-ons.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'x5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x5\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'x5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>TRANSPLANT_OPERATIVE_NOTES_REQUIRED:<\\/strong> donor type, cold ischemia time, anastomosis details.<\\/li>\\n          <li><strong>CNI_TROUGH_METADATA:<\\/strong> exact dose\\/time taken and blood draw time.<\\/li>\\n          <li><strong>DSA_PANEL_DETAILS:<\\/strong> lab method, positivity threshold, complement-binding assay availability.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Early graft dysfunction (1st week)\",\"Banff 2B TCMR treatment\",\"DSA testing & virtual crossmatch (Luminex)\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":5,\"investigations\":6,\"viva_items\":12,\"pitfalls\":5}}', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    .chip:hover {\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Early graft dysfunction (1st week)</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Banff 2B TCMR treatment</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">DSA testing & virtual crossmatch (Luminex)</span>\r\n      </div>\r\n      <div class=\"small text-secondary\">A stable patient 1 week after kidney transplant (KTX) presents with creatinine ~200 µmol/L (~2.3 mg/dL). Approach systematically: confirm volume status and immunosuppression adherence, check calcineurin inhibitor trough levels, perform urgent renal ultrasound with Doppler to assess perfusion/obstruction, and proceed to allograft biopsy when indicated. Vascular/uro complications, T-cell–mediated (TCMR) or antibody-mediated rejection (ABMR), calcineurin-inhibitor toxicity, ischemic ATN, and infection are the key early differentials. </div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li>⚠️ <strong>Stability & access:</strong> ABCs, IV access, review meds/immunosuppression schedules and missed doses; obtain outside operative & donor data.</li><li>🧪 <strong>Essential labs:</strong> serum creatinine, urea, electrolytes, bicarbonate, CBC, LFTs, CRP, urinalysis/culture; tacrolimus/cyclosporine trough (true C0), drug–drug interaction screen; consider CMV/BK as per risk.  </li><li>🧴 <strong>Avoid nephrotoxins:</strong> hold NSAIDs/ACEi if hypovolemic; review antimicrobials/macrolides that raise CNI levels. </li><li>🖥️ <strong>Bedside imaging:</strong> renal ultrasound with Doppler to assess perfusion and obstruction; look for arterial/venous flow, intrarenal waveforms, and hydronephrosis. </li><li>🧫 <strong>Early biopsy if unexplained rise:</strong> proceed once infection/obstruction/thrombosis are excluded; histology guides therapy (TCMR vs ABMR). </li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Vascular & Urologic (often urgent early post-KTX)</div><ul class=\"mb-0\"><li>🔴 <strong>Renal vein thrombosis/artery thrombosis:</strong> acute pain, anuria/hematuria; Doppler flow loss.</li><li>🟠 <strong>Transplant renal artery stenosis (TRAS):</strong> refractory HTN, graft dysfunction; Doppler peak systolic velocity (PSV) elevated with intrarenal tardus–parvus; confirm with CTA/MRA/angiography.  </li><li>🟡 <strong>Obstruction/leak:</strong> hydronephrosis or perinephric collection on ultrasound; consider stent/ureteric issues. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Immunologic</div><ul class=\"mb-0\"><li>🧬 <strong>TCMR (Banff):</strong> ranges from borderline to Banff 2B/3; Banff 2B/3 usually needs rATG. </li><li>🧪 <strong>ABMR:</strong> DSA-mediated microcirculation injury; management typically combines steroids, plasmapheresis, IVIG ± rituximab. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Drug, Ischemic, and Infectious</div><ul class=\"mb-0\"><li>💊 <strong>CNI toxicity:</strong> tremor, hyperkalemia, elevated trough; check interactions (macrolides, azoles, phenytoin) and diarrhea effects. </li><li>⏱️ <strong>Ischemic ATN/delayed graft function:</strong> consider if persistent from peri-operative period.</li><li>🦠 <strong>UTI/pyelonephritis, CMV/BK viremia:</strong> evaluate by culture and PCR per risk/timing. </li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div class=\'card p-2\'>\n  <div><strong>Targets (early, 0–2 mo):</strong> Tacrolimus 8–15 ng/mL; cyclosporine 200–350 ng/mL. Ensure true trough (C0). </div>\n  <div><strong>Doppler pearls:</strong> Intrarenal tardus–parvus suggests proximal stenosis; abnormal resistive index > <span class=\'hl-symbol\'>≥</span> 0.80 predicts worse outcomes (not specific to AR).  </div>\n  <div><strong>TRAS confirmation & Rx:</strong> If Doppler suggests TRAS (elevated PSV and RAR), confirm with CTA/MRA or angiography; treat by angioplasty/stenting when appropriate. </div>\n  <div><strong>DSA (Luminex SAB):</strong> Patient serum + beads (single antigen); read by fluorescence (MFI). Used for virtual crossmatch; C1q/C3d assays add pathogenicity context. </div>\n  <div><strong>Banff 2B TCMR:</strong> Pulse IV methylprednisolone then rATG 1–1.5 mg/kg IV × 7–14 days; intensify maintenance IS.  </div>\n</div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li>🧪 <strong>Repeat creatinine, urea, electrolytes, UA/culture:</strong> trend trajectory and exclude infection.</li><li>💊 <strong>CNI trough:</strong> confirm 12-h C0; frequent checks early until in target; assess interactions and diarrhea.  </li><li>🦠 <strong>Viral tests per risk:</strong> CMV PCR (donor/recipient serostatus guided), BK PCR if graft dysfunction persists. </li><li>🖥️ <strong>Ultrasound with Doppler:</strong> flow in main artery/vein, intrarenal waveforms (tardus–parvus), resistive index, hydronephrosis. </li><li>🧫 <strong>Allograft biopsy:</strong> classify Banff lesions; rule in TCMR vs ABMR; send C4d, EM as available. </li><li>🧬 <strong>DSA testing:</strong> Luminex single-antigen bead (SAB) with MFI; consider C1q/C3d; use for virtual crossmatch if needed. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\"><div class=\'alert alert-secondary p-2\'>\n<strong>Stable week-1 post-KTX creatinine rise:</strong>\n<ol class=\'mb-1\'>\n  <li><strong>Confirm basics:</strong> volume status, meds taken, true C0 trough, interactions.</li>\n  <li><strong>Bedside ultrasound:</strong> exclude obstruction/perfusion issue; if Doppler suggests stenosis, arrange CTA/MRA & consider angiography.</li>\n  <li><strong>If no reversible cause:</strong> proceed to biopsy (Banff grading) and send DSA (Luminex SAB) for ABMR component.</li>\n  <li><strong>Treat per pathology:</strong> Banff 2B TCMR → IV steroids then rATG; ABMR component → steroids + plasmapheresis + IVIG ± rituximab.</li>\n</ol>\n<small>See dosing and criteria below for details.</small>\n</div></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Week-1 Kidney Transplant Dysfunction (KTX outside KSA): Work-up, Banff 2B Rejection & DSA</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Structured initial approach</div>\r\n            <div class=\"fw-semibold\">History & Examination (focused)</div>\r\n            <ul class=\"mb-3\"><li>🩺 <strong>History:</strong> urine output, weight/volume status, timing of IS doses, drug interactions (e.g., macrolides), diarrhea, fever/UTI symptoms, pain at graft.</li><li>👀 <strong>Exam:</strong> vitals, edema/JVP, graft site tenderness/bruit, bladder scan; review surgical drains/catheters.</li></ul>\r\n            <div class=\"fw-semibold\">Initial tests (same day)</div>\r\n            <ul class=\"mb-0\"><li>🧪 <strong>Labs:</strong> BMP, CBC, urinalysis/culture, LFTs; tacrolimus/cyclosporine trough (target early tac 8–15 ng/mL). </li><li>🖥️ <strong>Ultrasound with Doppler:</strong> evaluate perfusion/obstruction; if suspicious for TRAS, proceed to CTA/MRA/angiography. </li><li>🧬 <strong>DSA (Luminex SAB):</strong> for suspected ABMR/mixed rejection; consider C1q/C3d. </li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Definitive diagnostics & targeted therapy</div>\r\n            <div class=\"fw-semibold\">Biopsy-driven decisions</div>\r\n            <ul class=\"mb-3\"><li>🧫 <strong>Allograft biopsy:</strong> Banff classification (TCMR vs ABMR); include C4d and microcirculation lesions; adjust plan accordingly. </li></ul>\r\n            <div class=\"fw-semibold\">Treat what you find</div>\r\n            <ul class=\"mb-0\"><li>💊 <strong>Banff 2B TCMR:</strong> IV methylprednisolone (250–500 mg/day × 3–5) then rATG 1–1.5 mg/kg IV × 7–14 days; intensify maintenance IS.  </li><li>💉 <strong>ABMR (if present):</strong> steroids + plasmapheresis + IVIG ± rituximab, individualized to DSA burden/biopsy severity. </li><li>🩻 <strong>TRAS:</strong> confirm and consider angioplasty/stent when hemodynamically significant. </li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Banff 2B TCMR — Practical Management</div><ul class=\"mb-0\"><li>✅ <strong>Steroid pulse:</strong> methylprednisolone 250–500 mg IV daily × 3–5 days. </li><li>✅ <strong>rATG dosing:</strong> rabbit ATG 1–1.5 mg/kg IV daily for 7–14 days; center protocols vary (premedicate; monitor WBC/platelets). </li><li>✅ <strong>Intensify maintenance IS:</strong> optimize tacrolimus/MMF and steroid taper per response. </li><li>🔎 <strong>Reassess:</strong> creatinine trend and consider follow-up biopsy if poor response.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">TRAS — What to look for on Doppler</div><ul class=\"mb-0\"><li>🔎 <strong>Suggestive Doppler:</strong> elevated anastomotic PSV and renal-to-aortic ratio (RAR), intrarenal tardus–parvus waveform. </li><li>🧭 <strong>Confirmatory imaging:</strong> CTA/MRA or angiography when ultrasound suggests hemodynamically significant stenosis. </li><li>🛠️ <strong>Treatment:</strong> percutaneous angioplasty/stenting when indicated; monitor BP/renal function response. </li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">DSA & Virtual Crossmatch (Luminex SAB)</div><ul class=\"mb-0\"><li>🧪 <strong>How SAB works:</strong> patient serum is incubated with single-antigen beads, each bead displays one HLA antigen; fluorescence (MFI) quantifies binding. </li><li>🧠 <strong>Virtual crossmatch:</strong> compare recipient DSA (SAB) against known donor HLA typing to predict physical crossmatch. </li><li>🧷 <strong>Complement-binding assays:</strong> C1q/C3d positivity may indicate more pathogenic DSA. </li><li>ℹ️ <strong>MFI thresholds:</strong> positive cut-offs are lab-specific; interpret with clinical/biopsy context.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li>📋 <strong>Document true trough timing:</strong> record dosing/collection times for CNIs. </li><li>🖥️ <strong>Standardized Doppler protocol:</strong> ensure PSV/RAR and intrarenal waveform capture.</li><li>🧫 <strong>Biopsy pathway:</strong> consent, bleeding risk, pre-procedure labs, and timely pathology communication.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li>📉 <strong>Creatinine trajectory:</strong> return toward baseline within days–weeks after effective therapy.</li><li>🧪 <strong>Immunologic control:</strong> reduction of DSA MFI and resolution of microcirculation injury on follow-up biopsy when applicable.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li>🛡️ <strong>ATG safety:</strong> premedicate; monitor for infusion reactions, leukopenia, thrombocytopenia, infection risk. </li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              ⚠️ <strong>Biopsy precautions:</strong> correct coagulopathy, manage antiplatelets/anticoagulants, and monitor post-procedure for bleeding.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              🗺️ <strong>Coordinate with outside transplant center:</strong> obtain operative notes, donor/recipient HLA data, induction regimen, and early post-op course to contextualize current findings.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'cases\'>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c1h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: High tacrolimus level</button>\n    </h2>\n    <div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clue:</strong> tremor, K+ high, tac level 20 ng/mL.</li>\n          <li><strong>Action:</strong> hold/reduce tac, review recent macrolides/azole use; re-check level. </li>\n          <li><strong>Teaching:</strong> monitor C0 frequently early post-KTX. </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c2h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: Suspected TRAS</button>\n    </h2>\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clue:</strong> refractory HTN, bruit, rising creatinine.</li>\n          <li><strong>Doppler:</strong> elevated PSV/RAR; intrarenal tardus–parvus waveform. </li>\n          <li><strong>Next:</strong> CTA/MRA → angiography; angioplasty/stent if significant. </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c3h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: Biopsy Banff 2B</button>\n    </h2>\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Plan:</strong> IV methylpred ×3–5 then rATG 1–1.5 mg/kg IV daily ×7–14; monitor counts/fever.  </li>\n          <li><strong>Check:</strong> send DSA (Luminex SAB) to assess for mixed ABMR; consider PLEX/IVIG ± rituximab if ABMR present.  </li>\n          <li><strong>Follow-up:</strong> trend creatinine; consider repeat biopsy if non-responsive.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">Outline your initial approach to a stable week-1 post-KTX patient with creatinine ~200 µmol/L.</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Confirm adherence/true CNI trough, screen for interactions/diarrhea, perform urgent renal ultrasound with Doppler, send UA/culture and targeted viral tests, and arrange biopsy if no reversible cause.  </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">What tacrolimus level do you target in the first 0–2 months?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Typically 8–15 ng/mL, measured as a true 12-h trough (C0). </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">How do you perform DSA testing and what is MFI?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Use Luminex single-antigen beads: patient serum binds bead-bound HLA; fluorescence readout (MFI) semi-quantifies binding. Thresholds are lab-specific; interpret with clinical/biopsy context. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">Define a virtual crossmatch.</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Comparison of the recipient&#039;s DSA (SAB profile) to the donor&#039;s HLA type to predict a physical crossmatch. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">Banff 2B TCMR on biopsy—how do you treat?</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Pulse IV methylprednisolone then rATG 1–1.5 mg/kg IV daily for 7–14 days; optimize maintenance immunosuppression.  </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">State a standard regimen for active ABMR.</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Steroids + plasmapheresis + IVIG ± rituximab, individualized to DSA/biopsy severity. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">What Doppler findings suggest TRAS?</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Elevated anastomotic PSV and renal-aortic ratio with intrarenal tardus–parvus; confirm by CTA/MRA or angiography. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">Does a high intrarenal resistive index prove rejection?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>No. RI &lt;span class=&#039;hl-symbol&#039;&gt;≥&lt;/span&gt; 0.80 predicts worse outcomes but is not specific for rejection. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">Name two common culprits that raise tacrolimus levels.</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Macrolides (e.g., clarithromycin) and azoles via CYP3A4/P-gp inhibition. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">How frequently should CNI levels be checked early post-KTX?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Frequently until therapeutic targets are reached; ensure timing is a true trough. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah10\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac10\" aria-expanded=\"false\" aria-controls=\"vivac10\">What is the role of complement-binding DSA assays?</button></h2><div id=\"vivac10\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>C1q/C3d positivity suggests complement-activating antibodies and higher risk; supports ABMR risk stratification. </p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah11\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac11\" aria-expanded=\"false\" aria-controls=\"vivac11\">When is biopsy indicated in the first week?</button></h2><div id=\"vivac11\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>If no reversible cause on exam/labs/imaging and creatinine remains elevated; biopsy guides TCMR vs ABMR therapy. </p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'audit\' data-unmapped-count=\'5\'></div><div class=\'accordion\' id=\'extraInfoAccordion\'>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'x1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x1\'>Unmapped pearls</button></h2>\n    <div id=\'x1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Premedication for rATG:</strong> acetaminophen, antihistamine, and steroids reduce infusion reactions. See: <em>Banff 2B TCMR — Practical Management</em>. </li>\n          <li><strong>MFI nuance:</strong> rising MFI trends carry more weight than a single threshold; complement-binding (C1q/C3d) refines risk. See: <em>DSA & Virtual Crossmatch</em>. </li>\n          <li><strong>RI context:</strong> elevated RI reflects parenchymal compliance and hemodynamics; it is prognostic rather than diagnostic. See: <em>Quick Ref Card</em>. </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'x2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x2\'>Edge cases & special populations</button></h2>\n    <div id=\'x2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Pediatrics/pregnancy:</strong> coordinate biopsy/imaging and immunosuppression adjustments with specialized teams; tailor tacrolimus targets and infection prophylaxis.</li>\n          <li><strong>Highly sensitized recipients:</strong> early DSA dynamics and mixed rejection are common; low threshold for adding ABMR therapies. </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'x3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x3\'>Drug dosing & adjustments</button></h2>\n    <div id=\'x3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>rATG cytopenias:</strong> hold or reduce dose with leukopenia/thrombocytopenia; add antimicrobial prophylaxis per center protocol.</li>\n          <li><strong>CNI interactions:</strong> macrolides/azoles increase levels; enzyme inducers (e.g., phenytoin) reduce levels—monitor closely. </li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'x4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x4\'>Local policy & pathway notes</button></h2>\n    <div id=\'x4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>External KTX (outside KSA):</strong> early contact with the original transplant center expedites donor HLA/DSA history and induction details; align on biopsy thresholds and ABMR add-ons.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'x5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#x5\'>Suggested schema extensions</button></h2>\n    <div id=\'x5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>TRANSPLANT_OPERATIVE_NOTES_REQUIRED:</strong> donor type, cold ischemia time, anastomosis details.</li>\n          <li><strong>CNI_TROUGH_METADATA:</strong> exact dose/time taken and blood draw time.</li>\n          <li><strong>DSA_PANEL_DETAILS:</strong> lab method, positivity threshold, complement-binding assay availability.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li>❌ <strong>Measuring a non-trough CNI level:</strong> leads to misinterpretation and wrong dose changes. </li><li>❌ <strong>Delaying Doppler ultrasound:</strong> can miss thrombosis/stenosis or obstruction early. </li><li>❌ <strong>Ignoring drug interactions/diarrhea:</strong> may cause unrecognized CNI toxicity or subtherapeutic levels. </li><li>❌ <strong>Assuming high RI means rejection:</strong> it is prognostic, not diagnostic. </li><li>❌ <strong>Undertreating Banff 2B:</strong> steroids alone are often insufficient; add rATG. </li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li>🔬 <strong>Biopsy-driven therapy:</strong> pathology directs TCMR vs ABMR treatment. </li><li>🧪 <strong>SAB and virtual crossmatch:</strong> understand what MFI represents and lab variability. </li><li>🧠 <strong>CNI pharmacology:</strong> CYP3A4/P-gp interactions and diarrhea effects. </li><li>🩻 <strong>Doppler patterns:</strong> tardus–parvus and indices to triage vascular causes. </li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li>🙅 <strong>Treating presumed rejection without imaging:</strong> may miss thrombosis/obstruction.</li><li>🙅 <strong>Not confirming true trough:</strong> leads to mis-dosing CNIs.</li><li>🙅 <strong>Forgetting infection work-up:</strong> especially UTI early post-op can mimic rejection.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li>History & exam (adherence, interactions, volume, symptoms).</li><li>Full labs including true CNI trough and infection screen.</li><li>Urgent ultrasound with Doppler; pursue CTA/MRA if TRAS suspected.</li><li>Send DSA (Luminex SAB) ± C1q/C3d; obtain outside transplant data.</li><li>Biopsy if no reversible cause; classify Banff.</li><li>Treat Banff 2B with steroids → rATG; if ABMR, add PLEX + IVIG ± rituximab.</li><li>Optimize maintenance immunosuppression and monitor response.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\">WEEK-1 POST-KTX CREAT RISE (STABLE)\n|\n+--> Check adherence & true CNI trough (C0); review interactions\n|\n+--> Labs (BMP/CBC/UA), urine culture; CMV/BK as indicated\n|\n+--> Renal US + Doppler\n      |-- If obstruction/perfusion problem --> fix (stent/IR/angioplasty)\n      |-- If no reversible cause --> proceed to biopsy + DSA (SAB)\n             |-- Banff 2B TCMR --> Steroid pulse --> rATG 1-1.5 mg/kg x 7-14 d\n             |-- ABMR or mixed --> Steroids + PLEX + IVIG +/- rituximab\n             |-- Reassess; optimize maintenance IS\n</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li>Comprehensive Clinical Nephrology: rATG 1–1.5 mg/kg IV × 7–14 days for rejection; ABMR treatments table (PLEX, IVIG, rituximab, etc.).  </li><li>Washington Manual: ABMR standard of care (steroids + plasmapheresis + IVIG ± rituximab). </li><li>Absolute Nephrology Review: early tacrolimus target 8–15 ng/mL and frequent trough monitoring.  </li><li>Doppler stenosis patterns and management: tardus–parvus and confirmatory imaging → angioplasty/stenting. </li></ul>\r\n      <ul class=\"mb-0\"><li>Use biopsy to direct therapy; treat Banff 2B/3 with steroid pulse followed by rATG.</li><li>Combine plasmapheresis + IVIG ± rituximab for active ABMR in appropriate cases.</li><li>Ensure true trough CNI monitoring and interaction review early post-transplant.</li><li>Employ Doppler criteria to triage TRAS; confirm before intervention.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li>📑 <strong>Banff classification & treatment intensity:</strong> Banff IIA/IIB/III require more intensive therapy than borderline/IA. </li><li>📑 <strong>ABMR care bundle:</strong> Steroids + PLEX + IVIG ± rituximab is widely adopted standard therapy. </li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    \r\n    \r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for notes\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-20 02:08:14', '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-20 02:08:14');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(8, NULL, 4, 1, 1, 'early-post-kidney-transplant-creatinine-200-stable-er', 'Early post–kidney transplant (1 week) with creatinine 200, stable in ER', 'Early (≤30 days) post-KTX • Rising creatinine • TRAS vs rejection vs obstruction vs drug toxicity', 'published', 'Summary: A stable recipient 1 week post–kidney transplant presents with creatinine 200. The approach prioritizes ABCDE stabilization, targeted transplant history, urgent bedside tests, calcineurin inhibitor troughs, infection screen, duplex Doppler ultrasound to exclude TRAS/obstruction, and timely biopsy. Management depends on findings; Banff 2B acute rejection warrants high-dose steroids plus lymphocyte-depleting therapy (e.g., rATG) with infection prophylaxis and close monitoring.', '{\"slug\":\"early-post-kidney-transplant-creatinine-200-stable-er\",\"TOPIC\":\"Early post\\u2013kidney transplant (1 week) with creatinine 200, stable in ER\",\"CHIP_1\":\"Early (\\u226430 days) post-KTX\",\"CHIP_2\":\"Rising creatinine\",\"CHIP_3\":\"TRAS vs rejection vs obstruction vs drug toxicity\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Summary:<\\/strong> A stable recipient 1 week post\\u2013kidney transplant presents with creatinine 200. The approach prioritizes ABCDE stabilization, targeted transplant history, urgent bedside tests, calcineurin inhibitor troughs, infection screen, duplex Doppler ultrasound to exclude TRAS\\/obstruction, and timely biopsy. Management depends on findings; Banff 2B acute rejection warrants high-dose steroids plus lymphocyte-depleting therapy (e.g., rATG) with infection prophylaxis and close monitoring.<\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"Stabilize: Confirm ABCDE, attach monitor, record vitals, assess mental status and urine output hourly.\",\"Access: Establish two peripheral IV lines, send urgent bloods, maintain strict input\\/output with Foley if not already in place.\",\"Sepsis-screen: Check temperature, review lines\\/wounds\\/urine; start empiric antibiotics only if infection suspected after cultures.\",\"Bedside tests: Perform capillary glucose, urine dip for blood\\/protein\\/leukocytes\\/nitrites, and 12-lead ECG (look for hyperkalemia changes).\",\"Renal ultrasound Doppler: Request urgent duplex of the graft with resistive index and velocity profile to assess TRAS, obstruction, or hematoma.\",\"Immunosuppression levels: Draw tacrolimus\\/cyclosporine trough before next dose; hold\\/adjust dosing only after level is known.\",\"Drug reconciliation: Verify all meds including OTC\\/herbals; stop nephrotoxins (NSAIDs, aminoglycosides, amphotericin, radiocontrast) and review interactions (e.g., azoles, macrolides, diltiazem).\",\"Core labs: Order CBC with differential, CMP including K+, bicarbonate, phosphate, magnesium, CRP, coagulation profile, trough drug level, BK viral load (plasma), CMV PCR if symptomatic, D-dimer if concern for thrombosis.\",\"Transplant immunology: Send DSA testing (Luminex single-antigen bead) and complement-binding assay if available; document historic crossmatch and sensitization.\",\"Urinary evaluation: Send urine microscopy and culture; check bladder scan for retention; assess drain output and graft tenderness.\",\"Fluid strategy: If hypovolemic, give isotonic crystalloid bolus 250\\u2013500 mL and reassess; avoid fluid overload; target MAP \\u2265 65 mmHg (wrap as: <span class=\'hl-symbol\'>\\u2265<\\/span> 65 mmHg).\",\"Contrast avoidance: Defer iodinated contrast until Doppler\\/biopsy plan is clear unless life-saving imaging is required; use prophylaxis if unavoidable.\",\"Biopsy pathway: If ultrasound excludes mechanical causes and creatinine remains elevated, arrange urgent graft biopsy the same day with platelet\\/INR optimization.\",\"Hyperkalemia safety: If K+ \\u2265 6.0 mmol\\/L or ECG changes, treat immediately (calcium, insulin\\/dextrose, beta-agonist, potassium binders) and prepare AEIOU dialysis indications.\",\"Escalation: Discuss with transplant surgery\\/immunology; plan admission and telemetry if clinically indicated.\",\"Documentation: Time-stamp all actions, communicate plan with patient and team, and set criteria for deterioration and dialysis.\"],\"DDX_BUCKET_1_TITLE\":\"Hemodynamic, medication, and tubular causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Volume issues: Prerenal azotemia from hypovolemia or over-diuresis.\",\"Drug toxicity: Calcineurin inhibitor nephrotoxicity (tacrolimus\\/cyclosporine), TMP-SMX, acyclovir, PPIs.\",\"ATN\\/ischemia: Delayed graft function or perioperative ischemia-reperfusion injury.\",\"Obstruction-retention: Bladder outlet obstruction or catheter issues.\"],\"DDX_BUCKET_2_TITLE\":\"Vascular and urologic complications\",\"DDX_BUCKET_2_ITEMS_LI\":[\"TRAS: Transplant renal artery stenosis\\u2014bruit, refractory hypertension, Doppler peak systolic velocity elevation.\",\"Venous thrombosis: Painful swollen graft, sudden oligo-anuria.\",\"Ureteric leak\\/obstruction: Perigraft collection, rising creatinine, decreased urine output.\",\"Perinephric hematoma\\/lymphocele: Mass effect with hydronephrosis.\"],\"DDX_BUCKET_3_TITLE\":\"Immunologic and infectious causes\",\"DDX_BUCKET_3_ITEMS_LI\":[\"TCMR: Banff I\\u2013III; 2B denotes severe intimal arteritis.\",\"AMR: DSA-positive with microvascular injury; C4d variable.\",\"BK virus nephropathy: Viremia and biopsy changes.\",\"Pyelonephritis\\/UTI: Dysuria, fever, graft tenderness; positive cultures.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>Early post-KTX creatinine rise (stable)<\\/h5><p><strong>First hour:<\\/strong> ABCDE, monitor, IV access, urine output, bedside dip\\/ECG, labs sent, request graft Doppler.<\\/p><p><strong>Trough targets (typical 1st month):<\\/strong> Tacrolimus 8\\u201312 ng\\/mL; Cyclosporine 150\\u2013250 ng\\/mL. Adjust per center protocol.<\\/p><p><strong>Dialysis triggers (AEIOU):<\\/strong> <em>Acidosis, Electrolytes (refractory K+), Intoxications, Overload, Uremia.<\\/em><\\/p><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"Vitals & monitoring: BP, HR, temperature, weight, strict urine output, fluid balance chart.\",\"POC tests: Capillary glucose, urine dipstick, ECG.\",\"Laboratory panels: CBC with differential, CMP (urea\\/creatinine, electrolytes, bicarbonate, calcium, phosphate, magnesium), CRP, coagulation profile.\",\"Immunosuppression: Tacrolimus or cyclosporine trough (C0); mycophenolate level if available.\",\"Infection screen: Urine culture, blood cultures if febrile, CMV PCR if symptomatic, BK viremia (plasma PCR).\",\"Transplant immunology: Donor-specific antibodies (DSA) via Luminex single-antigen bead with mean fluorescence intensity (MFI); consider C1q\\/C3d binding assays.\",\"Imaging: Urgent graft ultrasound with Doppler (RI, peak systolic velocity); if TRAS suspected and Doppler positive, proceed to CTA\\/MRA or angiography.\",\"Urologic assessment: Bladder scan, consider nephrostomy if obstructed and unstable.\",\"Biopsy: Ultrasound-guided graft biopsy once mechanical causes are excluded and coagulation is acceptable.\"],\"EMERGENCY_ALGORITHM_HTML\":\"EARLY POST-KTX ER ALGORITHM (STABLE)\\n\\n1) ABCDE and monitoring -> if unstable, follow resuscitation pathway.\\n2) Foley for accurate UO; send stat labs + trough level.\\n3) Bedside: glucose, urine dip, ECG.\\n4) Duplex Doppler of graft now.\\n5) If obstruction\\/collection -> drain\\/relieve; if TRAS likely -> CTA\\/MRA or angiography.\\n6) If no mechanical cause and creatinine rising -> plan graft biopsy today.\\n7) If K+ >= 6.0 or ECG changes -> hyperkalemia protocol and consider dialysis.\\n8) If biopsy Banff 2B -> high-dose steroids + rATG; evaluate for AMR (DSA) and add PLEX\\/IVIG if needed.\\n9) Reassess q4-6h: UO, vitals, labs; adjust immunosuppression.\\n10) Admit under transplant team; prophylaxis and monitoring.\",\"PILLAR_1\":\"Diagnosis & stabilization\",\"STEP_1_TITLE\":\"Initial stabilization and rule-out of surgical emergencies\",\"STEP_1_LI\":[\"Monitoring: ABCDE, continuous ECG, strict urine output with Foley.\",\"Doppler-first: Duplex ultrasound to assess TRAS, venous thrombosis, obstruction, or collections.\",\"Labs-now: Send full panels and trough levels before dose administration.\"],\"STEP_2_TITLE\":\"Focused transplant evaluation and immunology\",\"STEP_2_LI\":[\"History-focus: Donor type, ischemia times, induction agents, baseline creatinine, urine trends, complications since discharge.\",\"Immunology: Obtain DSA by Luminex single-antigen bead (report MFI), and complement-binding if available.\",\"Infection\\/viral: BK and CMV testing guided by symptoms and protocols.\"],\"PILLAR_2\":\"Therapy & follow-up\",\"STEP_3_TITLE\":\"Targeted therapy based on etiology\",\"STEP_3_LI\":[\"TRAS pathway: If hemodynamically significant, plan percutaneous angioplasty \\u00b1 stent after confirmatory imaging.\",\"Obstruction\\/leak: Urology consult; stent or nephrostomy; drain collections.\",\"Drug toxicity: Adjust calcineurin inhibitor to target trough; review interactions; ensure hydration.\",\"Infection: Tailored antibiotics after cultures; avoid nephrotoxins.\"],\"STEP_4_TITLE\":\"Banff 2B acute rejection management\",\"STEP_4_LI\":[\"Steroids: Methylprednisolone 500 mg IV daily x 3 days, then taper by protocol.\",\"rATG dosing: Rabbit ATG (Thymoglobulin) 1.5 mg\\/kg\\/day for 5\\u20137 doses (typical total 6\\u201310.5 mg\\/kg); premedicate (acetaminophen, antihistamine, steroid).\",\"ATG safety: Hold\\/adjust if WBC < 2.0 x10^9\\/L or platelets < 50 x10^9\\/L; monitor for cytokine reactions and infections.\",\"AMR add-ons: If DSA positive\\/AMR features, add plasmapheresis (5\\u20137 sessions) + IVIG (e.g., 2 g\\/kg divided) \\u00b1 rituximab per protocol.\",\"Prophylaxis: Start\\/continue PJP prophylaxis, CMV prophylaxis\\/monitoring as per risk, and antifungal if indicated.\"],\"TOPIC_BLOCK_A_TITLE\":\"Transplant Doppler & TRAS\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"Doppler metrics: Peak systolic velocity elevation at anastomosis and parvus-tardus waveform distal to lesion.\",\"Next imaging: CTA\\/MRA or diagnostic angiography if Doppler suggests TRAS.\",\"Treatment: Percutaneous angioplasty with or without stent is first-line for significant TRAS.\"],\"TOPIC_BLOCK_B_TITLE\":\"DSA testing & virtual crossmatch\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"Assay: Luminex single-antigen bead\\u2014patient serum against antigen-coated beads; read fluorescence as MFI.\",\"Interpretation: Higher MFI suggests stronger antibody; labs set positivity thresholds; complement-binding assays refine risk.\",\"Virtual crossmatch: Compare recipient anti-HLA specificities to donor HLA profile to predict compatibility without physical crossmatch.\"],\"TOPIC_BLOCK_C_TITLE\":\"Biopsy & Banff 2B\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"Definition: Banff 2B indicates severe intimal arteritis (v2) with more extensive endothelial inflammation.\",\"Therapy standard: Pulse steroids plus lymphocyte-depleting therapy (e.g., rATG); evaluate for AMR overlap.\",\"Follow-up: Repeat creatinine, DSA, and consider follow-up biopsy if poor response.\"],\"QUALITY_PROCESS_LI\":[\"Time-to-Doppler: < 2 hours from triage (<span class=\'hl-symbol\'><<\\/span> 2 h).\",\"Biopsy timing: Same-day biopsy once mechanical causes excluded.\",\"Level timing: Calcineurin inhibitor trough sampled pre-dose and resulted within 6\\u20138 h.\"],\"QUALITY_OUTCOME_LI\":[\"Renal recovery: Creatinine trend down by 20\\u201330% within 72\\u201396 h after effective therapy.\",\"Complication rate: No major bleeding post-biopsy; no catheter-related infections.\",\"Readmission: < 30-day readmissions minimized with clear discharge criteria (<span class=\'hl-symbol\'><<\\/span> 30 days).\"],\"QUALITY_SAFETY_LI\":[\"Bleeding prevention: Correct platelets \\u2265 50 x10^9\\/L and INR \\u2264 1.5 before biopsy (<span class=\'hl-symbol\'>\\u2265<\\/span> 50; <span class=\'hl-symbol\'>\\u2264<\\/span> 1.5).\",\"ATG monitoring: Daily CBC; hold if severe leukopenia or thrombocytopenia.\",\"Contrast safety: Use non-contrast imaging first; if contrast essential, hydrate and minimize dose.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Key safety:<\\/strong> Protect airway\\/breathing if deterioration; treat hyperkalemia immediately; correct coagulopathy before biopsy; premedicate and monitor during rATG; avoid nephrotoxins and drug interactions.\",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Communication:<\\/strong> Explain differential (TRAS, obstruction, rejection, drug toxicity), why Doppler\\/biopsy are needed, expected treatments (steroids, rATG, possible PLEX\\/IVIG), and monitoring plan; confirm understanding and consent.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesEarlyKTX\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'>\\n      <button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\' aria-expanded=\'true\' aria-controls=\'c1\'>High tacrolimus trough with creatinine 200<\\/button>\\n    <\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse show\' aria-labelledby=\'c1h\' data-bs-parent=\'#casesEarlyKTX\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clues:<\\/strong> Tremor, hyperkalemia, hypertension; trough 15\\u201320 ng\\/mL.<\\/li>\\n          <li><strong>Action:<\\/strong> Hold\\/adjust tacrolimus to target 8\\u201312 ng\\/mL; check interactions (azoles, macrolides).<\\/li>\\n          <li><strong>Support:<\\/strong> Optimize volume and avoid nephrotoxins.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\' aria-expanded=\'false\' aria-controls=\'c2\'>Suspected TRAS on Doppler<\\/button>\\n    <\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' aria-labelledby=\'c2h\' data-bs-parent=\'#casesEarlyKTX\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clues:<\\/strong> Elevated peak systolic velocity at anastomosis; parvus-tardus waveform.<\\/li>\\n          <li><strong>Action:<\\/strong> Arrange CTA\\/MRA or angiography; plan for angioplasty \\u00b1 stent if hemodynamically significant.<\\/li>\\n          <li><strong>BP:<\\/strong> Control with RAAS-sparing regimen until revascularization.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\' aria-expanded=\'false\' aria-controls=\'c3\'>Ureteric obstruction\\/leak<\\/button>\\n    <\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' aria-labelledby=\'c3h\' data-bs-parent=\'#casesEarlyKTX\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clues:<\\/strong> Hydronephrosis or perinephric collection on ultrasound; low UO.<\\/li>\\n          <li><strong>Action:<\\/strong> Urgent urology consult; stent\\/nephrostomy; drain collections.<\\/li>\\n          <li><strong>Antibiotics:<\\/strong> Start if infected collections or pyelonephritis suspected.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c4h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c4\' aria-expanded=\'false\' aria-controls=\'c4\'>Banff 2B acute rejection on biopsy<\\/button>\\n    <\\/h2>\\n    <div id=\'c4\' class=\'accordion-collapse collapse\' aria-labelledby=\'c4h\' data-bs-parent=\'#casesEarlyKTX\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Action:<\\/strong> Methylprednisolone 500 mg IV daily x3; add rATG 1.5 mg\\/kg\\/day for 5\\u20137 doses.<\\/li>\\n          <li><strong>AMR features:<\\/strong> If DSA positive or microvascular injury, add PLEX 5\\u20137 sessions + IVIG.<\\/li>\\n          <li><strong>Follow-up:<\\/strong> Monitor creatinine, DSA, and consider repeat biopsy if poor response.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c5h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c5\' aria-expanded=\'false\' aria-controls=\'c5\'>BK viremia with graft dysfunction<\\/button>\\n    <\\/h2>\\n    <div id=\'c5\' class=\'accordion-collapse collapse\' aria-labelledby=\'c5h\' data-bs-parent=\'#casesEarlyKTX\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Clues:<\\/strong> Rising creatinine with positive plasma BK PCR.<\\/li>\\n          <li><strong>Action:<\\/strong> Reduce immunosuppression (especially antimetabolite), close viral load monitoring.<\\/li>\\n          <li><strong>Avoid:<\\/strong> Empiric antivirals with nephrotoxicity unless indicated.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is your immediate approach to a stable patient 1 week post-KTX with creatinine 200?\",\"a\":\"Stabilize ABCDE, monitor, IV access, bedside tests, urgent Doppler of graft, send full labs and immunosuppression troughs, screen for infection, send DSA, and plan biopsy if no mechanical cause.\"},{\"q\":\"Which complications are you prioritizing early?\",\"a\":\"TRAS, ureteric obstruction\\/leak, venous thrombosis, calcineurin inhibitor toxicity, acute rejection (TCMR\\/AMR), infection, and BK virus nephropathy.\"},{\"q\":\"How do you evaluate for TRAS in the ER?\",\"a\":\"Start with duplex Doppler measuring peak systolic velocity and waveform; if positive, proceed to CTA\\/MRA or angiography and plan angioplasty \\u00b1 stent if significant.\"},{\"q\":\"What labs are mandatory now?\",\"a\":\"CBC, CMP with K+\\/bicarbonate, coagulation, CRP, tacrolimus or cyclosporine trough, urine analysis\\/culture, BK PCR, and CMV PCR if symptomatic.\"},{\"q\":\"Describe Luminex single-antigen bead testing for DSA.\",\"a\":\"Patient serum is incubated with HLA-coated beads; fluorescence is read as MFI to identify specific donor-reactive antibodies; complement-binding assays refine risk.\"},{\"q\":\"What does Banff 2B mean and how do you treat it?\",\"a\":\"It reflects severe intimal arteritis. Treat with high-dose IV methylprednisolone and rATG; if AMR features or DSA positive, add plasmapheresis and IVIG \\u00b1 rituximab per protocol.\"},{\"q\":\"State a typical rATG regimen for acute rejection.\",\"a\":\"Rabbit ATG 1.5 mg\\/kg\\/day for 5\\u20137 doses (total 6\\u201310.5 mg\\/kg), with premedication and CBC monitoring; hold if leukopenia or thrombocytopenia.\"},{\"q\":\"When do you initiate dialysis in this context?\",\"a\":\"Use AEIOU: refractory acidosis, refractory hyperkalemia, intoxications, volume overload unresponsive to diuretics, uremic complications; not solely the creatinine value.\"},{\"q\":\"What trough levels do you aim for in the first month?\",\"a\":\"Tacrolimus roughly 8\\u201312 ng\\/mL; cyclosporine 150\\u2013250 ng\\/mL, adjusted to center protocol and patient risk.\"},{\"q\":\"How do you minimize biopsy bleeding risk?\",\"a\":\"Ensure platelets \\u2265 50 x10^9\\/L and INR \\u2264 1.5, hold anticoagulants as appropriate, and use ultrasound guidance with post-procedure observation.\"},{\"q\":\"Key drug interactions that raise tacrolimus levels?\",\"a\":\"Azoles, macrolides, diltiazem\\/verapamil, protease inhibitors, and grapefruit products; rifampin lowers levels.\"}],\"PITFALLS_LI\":[\"Delaying Doppler and missing TRAS or obstruction.\",\"Adjusting calcineurin inhibitor dosing before obtaining a true trough level.\",\"Treating empirically for rejection without excluding mechanical or infectious causes.\",\"Proceeding to contrast studies without hydration or alternatives.\",\"Underdosing or prematurely stopping rATG due to anticipated\\u2014not observed\\u2014cytopenias.\"],\"ANSWER_STEPS_OL\":[\"This is a case of a stable recipient one week post\\u2013kidney transplant presenting to the ER with creatinine 200.\",\"My immediate priorities are ABCDE stabilization, monitoring, IV access, and strict urine output measurement.\",\"First I will perform bedside tests including capillary glucose, urine dipstick, and a 12-lead ECG.\",\"Then I will send full labs including CBC, CMP, coagulation, CRP, and a calcineurin inhibitor trough before the next dose.\",\"I will urgently request a graft ultrasound with Doppler to exclude TRAS, venous thrombosis, obstruction, or collections.\",\"In parallel I will send transplant immunology tests including donor-specific antibodies using Luminex single-antigen bead with MFI reporting.\",\"If Doppler excludes mechanical causes and creatinine remains elevated, I will arrange a same-day ultrasound-guided graft biopsy.\",\"If the biopsy shows Banff 2B acute rejection, I will give methylprednisolone 500 mg IV daily for three days and start rabbit ATG 1.5 mg\\/kg\\/day for 5\\u20137 doses with CBC-guided adjustments.\",\"If AMR features or positive DSA are present, I will add plasmapheresis with IVIG and consider rituximab as per protocol.\",\"I will review all medications and stop nephrotoxins and interacting agents while titrating the calcineurin inhibitor to target trough.\",\"I will treat hyperkalemia immediately if K+ is high or ECG changes occur and consider dialysis for AEIOU indications.\",\"Finally, I will admit the patient under the transplant team, start infection prophylaxis as indicated, and monitor creatinine, urine output, trough levels, and DSA response.\"],\"TEACHING_CONCEPTS_LI\":[\"Pathways: Mechanical vs immunologic vs drug toxicity in early allograft dysfunction.\",\"Doppler-first: Noninvasive, rapid, and contrast-sparing gatekeeper for TRAS\\/obstruction.\",\"Immunology: DSA kinetics and complement-binding inform AMR severity.\",\"Banff nuance: Histology drives therapy intensity and need for follow-up biopsy.\",\"Safety net: AEIOU for dialysis decisions rather than creatinine alone.\"],\"TEACHING_MISTAKES_LI\":[\"Using the creatinine value alone to decide dialysis.\",\"Skipping DSA testing when biopsy suggests vascular injury.\",\"Ignoring drug interactions that elevate tacrolimus and mimic rejection.\",\"Proceeding to contrast angiography without attempting Doppler and hydration.\",\"Starting high-dose steroids before excluding infected collections.\"],\"ASCII_FLOWCHART_PRE\":\"EARLY POST-KTX CREATININE 200 (STABLE)\\n\\n[Start]\\n  |\\n  v\\n[ABCDE + Monitor + Foley]\\n  |\\n  v\\n[Bedside: glucose, urine dip, ECG]\\n  |\\n  v\\n[Send labs + trough level]\\n  |\\n  v\\n[Duplex Doppler of graft]\\n  |-- if Mechanical cause -> [Fix: drain\\/stent\\/angioplasty]\\n  |-- else -> [Plan graft biopsy]\\n  |\\n  v\\n[Biopsy result]\\n  |-- Banff 2B -> [MP 500 mg IV x3 + rATG 1.5 mg\\/kg\\/d x5-7]\\n  |-- AMR features -> [Add PLEX + IVIG \\u00b1 rituximab]\\n  |-- Drug toxicity -> [Adjust CNI]\\n  |-- Infection -> [Targeted antibiotics]\\n  |\\n  v\\n[Reassess UO\\/Cr; consider AEIOU for dialysis]\",\"EVIDENCE_STUDIES_LI\":[\"Banff classification updates: arteritis severity correlates with outcomes.\",\"Trials and cohort data supporting rATG efficacy in steroid-resistant TCMR.\",\"Observational studies showing Doppler\'s utility in detecting TRAS early.\",\"Data linking high DSA MFI and complement-binding to AMR severity.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Use Doppler ultrasound as first-line imaging for early graft dysfunction.\",\"Treat Banff 2B with pulse steroids plus rATG; add AMR-directed therapy when DSA\\/microvascular injury present.\",\"Obtain calcineurin inhibitor troughs before dosing changes and avoid interacting drugs.\",\"Apply AEIOU criteria for dialysis rather than creatinine thresholds.\"],\"GUIDELINE_ANCHORS_LI\":[\"KDIGO Kidney Transplant Recipient Guidelines: evaluation of graft dysfunction, acute rejection treatment, infection prophylaxis.\",\"Center protocols on rATG dosing, biopsy safety parameters, and TRAS management pathways.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'4\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra1\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'extra1\' class=\'accordion-collapse collapse show\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>CNI targets:<\\/strong> Tailor tacrolimus to immunologic risk and infection risk; use center-specific ranges.<\\/li>\\n        <li><strong>dd-cfDNA:<\\/strong> If available, donor-derived cfDNA can support rejection assessment\\u2014adjunct only.<\\/li>\\n        <li><strong>Contrast-alternatives:<\\/strong> Prefer MR angiography without gadolinium if severe renal dysfunction and MRI-safe.<\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra2\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'extra2\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>Pregnancy:<\\/strong> Avoid mycophenolate; coordinate with maternal-fetal medicine.<\\/li>\\n        <li><strong>Pediatrics:<\\/strong> Dose rATG per kg with careful CBC monitoring; consider sedation for biopsy.<\\/li>\\n        <li><strong>Highly sensitized:<\\/strong> Low threshold for AMR therapy; involve immunology early.<\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra3\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'extra3\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>rATG adjustments:<\\/strong> Reduce or hold if WBC < 2.0 x10^9\\/L or platelets < 50 x10^9\\/L.<\\/li>\\n        <li><strong>MMF modulation:<\\/strong> Consider dose reduction in BK viremia; avoid abrupt cessation in high immunologic risk.<\\/li>\\n        <li><strong>Antimicrobials:<\\/strong> Avoid nephrotoxic agents; adjust dosing to eGFR and drug levels.<\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra4\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'extra4\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>Center protocols:<\\/strong> Follow institutional targets for trough levels and biopsy thresholds.<\\/li>\\n        <li><strong>DSA reporting:<\\/strong> Use lab-defined MFI cutoffs and complement-binding interpretation.<\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra5\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'extra5\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>IMMUNO_TARGETS_LI:<\\/strong> To specify center-specific trough goals and induction details.<\\/li>\\n        <li><strong>VIROLOGY_MONITORING_LI:<\\/strong> To standardize CMV\\/BK monitoring cadence and thresholds.<\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n<\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Early (\\u226430 days) post-KTX\",\"Rising creatinine\",\"TRAS vs rejection vs obstruction vs drug toxicity\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":16,\"investigations\":9,\"viva_items\":11,\"pitfalls\":5}}', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Early post–kidney transplant (1 week) with creatinine 200, stable in ER Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    .chip:hover {\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Early post–kidney transplant (1 week) with creatinine 200, stable in ER Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Early post–kidney transplant (1 week) with creatinine 200, stable in ER</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Early (≤30 days) post-KTX</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Rising creatinine</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">TRAS vs rejection vs obstruction vs drug toxicity</span>\r\n      </div>\r\n      <div class=\"small text-secondary\"><p><strong>Summary:</strong> A stable recipient 1 week post–kidney transplant presents with creatinine 200. The approach prioritizes ABCDE stabilization, targeted transplant history, urgent bedside tests, calcineurin inhibitor troughs, infection screen, duplex Doppler ultrasound to exclude TRAS/obstruction, and timely biopsy. Management depends on findings; Banff 2B acute rejection warrants high-dose steroids plus lymphocyte-depleting therapy (e.g., rATG) with infection prophylaxis and close monitoring.</p></div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li>Stabilize: Confirm ABCDE, attach monitor, record vitals, assess mental status and urine output hourly.</li><li>Access: Establish two peripheral IV lines, send urgent bloods, maintain strict input/output with Foley if not already in place.</li><li>Sepsis-screen: Check temperature, review lines/wounds/urine; start empiric antibiotics only if infection suspected after cultures.</li><li>Bedside tests: Perform capillary glucose, urine dip for blood/protein/leukocytes/nitrites, and 12-lead ECG (look for hyperkalemia changes).</li><li>Renal ultrasound Doppler: Request urgent duplex of the graft with resistive index and velocity profile to assess TRAS, obstruction, or hematoma.</li><li>Immunosuppression levels: Draw tacrolimus/cyclosporine trough before next dose; hold/adjust dosing only after level is known.</li><li>Drug reconciliation: Verify all meds including OTC/herbals; stop nephrotoxins (NSAIDs, aminoglycosides, amphotericin, radiocontrast) and review interactions (e.g., azoles, macrolides, diltiazem).</li><li>Core labs: Order CBC with differential, CMP including K+, bicarbonate, phosphate, magnesium, CRP, coagulation profile, trough drug level, BK viral load (plasma), CMV PCR if symptomatic, D-dimer if concern for thrombosis.</li><li>Transplant immunology: Send DSA testing (Luminex single-antigen bead) and complement-binding assay if available; document historic crossmatch and sensitization.</li><li>Urinary evaluation: Send urine microscopy and culture; check bladder scan for retention; assess drain output and graft tenderness.</li><li>Fluid strategy: If hypovolemic, give isotonic crystalloid bolus 250–500 mL and reassess; avoid fluid overload; target MAP ≥ 65 mmHg (wrap as: <span class=\'hl-symbol\'>≥</span> 65 mmHg).</li><li>Contrast avoidance: Defer iodinated contrast until Doppler/biopsy plan is clear unless life-saving imaging is required; use prophylaxis if unavoidable.</li><li>Biopsy pathway: If ultrasound excludes mechanical causes and creatinine remains elevated, arrange urgent graft biopsy the same day with platelet/INR optimization.</li><li>Hyperkalemia safety: If K+ ≥ 6.0 mmol/L or ECG changes, treat immediately (calcium, insulin/dextrose, beta-agonist, potassium binders) and prepare AEIOU dialysis indications.</li><li>Escalation: Discuss with transplant surgery/immunology; plan admission and telemetry if clinically indicated.</li><li>Documentation: Time-stamp all actions, communicate plan with patient and team, and set criteria for deterioration and dialysis.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Hemodynamic, medication, and tubular causes</div><ul class=\"mb-0\"><li>Volume issues: Prerenal azotemia from hypovolemia or over-diuresis.</li><li>Drug toxicity: Calcineurin inhibitor nephrotoxicity (tacrolimus/cyclosporine), TMP-SMX, acyclovir, PPIs.</li><li>ATN/ischemia: Delayed graft function or perioperative ischemia-reperfusion injury.</li><li>Obstruction-retention: Bladder outlet obstruction or catheter issues.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Vascular and urologic complications</div><ul class=\"mb-0\"><li>TRAS: Transplant renal artery stenosis—bruit, refractory hypertension, Doppler peak systolic velocity elevation.</li><li>Venous thrombosis: Painful swollen graft, sudden oligo-anuria.</li><li>Ureteric leak/obstruction: Perigraft collection, rising creatinine, decreased urine output.</li><li>Perinephric hematoma/lymphocele: Mass effect with hydronephrosis.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Immunologic and infectious causes</div><ul class=\"mb-0\"><li>TCMR: Banff I–III; 2B denotes severe intimal arteritis.</li><li>AMR: DSA-positive with microvascular injury; C4d variable.</li><li>BK virus nephropathy: Viremia and biopsy changes.</li><li>Pyelonephritis/UTI: Dysuria, fever, graft tenderness; positive cultures.</li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>Early post-KTX creatinine rise (stable)</h5><p><strong>First hour:</strong> ABCDE, monitor, IV access, urine output, bedside dip/ECG, labs sent, request graft Doppler.</p><p><strong>Trough targets (typical 1st month):</strong> Tacrolimus 8–12 ng/mL; Cyclosporine 150–250 ng/mL. Adjust per center protocol.</p><p><strong>Dialysis triggers (AEIOU):</strong> <em>Acidosis, Electrolytes (refractory K+), Intoxications, Overload, Uremia.</em></p></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li>Vitals & monitoring: BP, HR, temperature, weight, strict urine output, fluid balance chart.</li><li>POC tests: Capillary glucose, urine dipstick, ECG.</li><li>Laboratory panels: CBC with differential, CMP (urea/creatinine, electrolytes, bicarbonate, calcium, phosphate, magnesium), CRP, coagulation profile.</li><li>Immunosuppression: Tacrolimus or cyclosporine trough (C0); mycophenolate level if available.</li><li>Infection screen: Urine culture, blood cultures if febrile, CMV PCR if symptomatic, BK viremia (plasma PCR).</li><li>Transplant immunology: Donor-specific antibodies (DSA) via Luminex single-antigen bead with mean fluorescence intensity (MFI); consider C1q/C3d binding assays.</li><li>Imaging: Urgent graft ultrasound with Doppler (RI, peak systolic velocity); if TRAS suspected and Doppler positive, proceed to CTA/MRA or angiography.</li><li>Urologic assessment: Bladder scan, consider nephrostomy if obstructed and unstable.</li><li>Biopsy: Ultrasound-guided graft biopsy once mechanical causes are excluded and coagulation is acceptable.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\">EARLY POST-KTX ER ALGORITHM (STABLE)\n\n1) ABCDE and monitoring -> if unstable, follow resuscitation pathway.\n2) Foley for accurate UO; send stat labs + trough level.\n3) Bedside: glucose, urine dip, ECG.\n4) Duplex Doppler of graft now.\n5) If obstruction/collection -> drain/relieve; if TRAS likely -> CTA/MRA or angiography.\n6) If no mechanical cause and creatinine rising -> plan graft biopsy today.\n7) If K+ >= 6.0 or ECG changes -> hyperkalemia protocol and consider dialysis.\n8) If biopsy Banff 2B -> high-dose steroids + rATG; evaluate for AMR (DSA) and add PLEX/IVIG if needed.\n9) Reassess q4-6h: UO, vitals, labs; adjust immunosuppression.\n10) Admit under transplant team; prophylaxis and monitoring.</div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Early post–kidney transplant (1 week) with creatinine 200, stable in ER</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Diagnosis & stabilization</div>\r\n            <div class=\"fw-semibold\">Initial stabilization and rule-out of surgical emergencies</div>\r\n            <ul class=\"mb-3\"><li>Monitoring: ABCDE, continuous ECG, strict urine output with Foley.</li><li>Doppler-first: Duplex ultrasound to assess TRAS, venous thrombosis, obstruction, or collections.</li><li>Labs-now: Send full panels and trough levels before dose administration.</li></ul>\r\n            <div class=\"fw-semibold\">Focused transplant evaluation and immunology</div>\r\n            <ul class=\"mb-0\"><li>History-focus: Donor type, ischemia times, induction agents, baseline creatinine, urine trends, complications since discharge.</li><li>Immunology: Obtain DSA by Luminex single-antigen bead (report MFI), and complement-binding if available.</li><li>Infection/viral: BK and CMV testing guided by symptoms and protocols.</li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Therapy & follow-up</div>\r\n            <div class=\"fw-semibold\">Targeted therapy based on etiology</div>\r\n            <ul class=\"mb-3\"><li>TRAS pathway: If hemodynamically significant, plan percutaneous angioplasty ± stent after confirmatory imaging.</li><li>Obstruction/leak: Urology consult; stent or nephrostomy; drain collections.</li><li>Drug toxicity: Adjust calcineurin inhibitor to target trough; review interactions; ensure hydration.</li><li>Infection: Tailored antibiotics after cultures; avoid nephrotoxins.</li></ul>\r\n            <div class=\"fw-semibold\">Banff 2B acute rejection management</div>\r\n            <ul class=\"mb-0\"><li>Steroids: Methylprednisolone 500 mg IV daily x 3 days, then taper by protocol.</li><li>rATG dosing: Rabbit ATG (Thymoglobulin) 1.5 mg/kg/day for 5–7 doses (typical total 6–10.5 mg/kg); premedicate (acetaminophen, antihistamine, steroid).</li><li>ATG safety: Hold/adjust if WBC < 2.0 x10^9/L or platelets < 50 x10^9/L; monitor for cytokine reactions and infections.</li><li>AMR add-ons: If DSA positive/AMR features, add plasmapheresis (5–7 sessions) + IVIG (e.g., 2 g/kg divided) ± rituximab per protocol.</li><li>Prophylaxis: Start/continue PJP prophylaxis, CMV prophylaxis/monitoring as per risk, and antifungal if indicated.</li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Transplant Doppler & TRAS</div><ul class=\"mb-0\"><li>Doppler metrics: Peak systolic velocity elevation at anastomosis and parvus-tardus waveform distal to lesion.</li><li>Next imaging: CTA/MRA or diagnostic angiography if Doppler suggests TRAS.</li><li>Treatment: Percutaneous angioplasty with or without stent is first-line for significant TRAS.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">DSA testing & virtual crossmatch</div><ul class=\"mb-0\"><li>Assay: Luminex single-antigen bead—patient serum against antigen-coated beads; read fluorescence as MFI.</li><li>Interpretation: Higher MFI suggests stronger antibody; labs set positivity thresholds; complement-binding assays refine risk.</li><li>Virtual crossmatch: Compare recipient anti-HLA specificities to donor HLA profile to predict compatibility without physical crossmatch.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Biopsy & Banff 2B</div><ul class=\"mb-0\"><li>Definition: Banff 2B indicates severe intimal arteritis (v2) with more extensive endothelial inflammation.</li><li>Therapy standard: Pulse steroids plus lymphocyte-depleting therapy (e.g., rATG); evaluate for AMR overlap.</li><li>Follow-up: Repeat creatinine, DSA, and consider follow-up biopsy if poor response.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li>Time-to-Doppler: < 2 hours from triage (<span class=\'hl-symbol\'><</span> 2 h).</li><li>Biopsy timing: Same-day biopsy once mechanical causes excluded.</li><li>Level timing: Calcineurin inhibitor trough sampled pre-dose and resulted within 6–8 h.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li>Renal recovery: Creatinine trend down by 20–30% within 72–96 h after effective therapy.</li><li>Complication rate: No major bleeding post-biopsy; no catheter-related infections.</li><li>Readmission: < 30-day readmissions minimized with clear discharge criteria (<span class=\'hl-symbol\'><</span> 30 days).</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li>Bleeding prevention: Correct platelets ≥ 50 x10^9/L and INR ≤ 1.5 before biopsy (<span class=\'hl-symbol\'>≥</span> 50; <span class=\'hl-symbol\'>≤</span> 1.5).</li><li>ATG monitoring: Daily CBC; hold if severe leukopenia or thrombocytopenia.</li><li>Contrast safety: Use non-contrast imaging first; if contrast essential, hydrate and minimize dose.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              ⚠️ <strong>Key safety:</strong> Protect airway/breathing if deterioration; treat hyperkalemia immediately; correct coagulopathy before biopsy; premedicate and monitor during rATG; avoid nephrotoxins and drug interactions.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              🗣️ <strong>Communication:</strong> Explain differential (TRAS, obstruction, rejection, drug toxicity), why Doppler/biopsy are needed, expected treatments (steroids, rATG, possible PLEX/IVIG), and monitoring plan; confirm understanding and consent.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'casesEarlyKTX\'>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c1h\'>\n      <button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\' aria-expanded=\'true\' aria-controls=\'c1\'>High tacrolimus trough with creatinine 200</button>\n    </h2>\n    <div id=\'c1\' class=\'accordion-collapse collapse show\' aria-labelledby=\'c1h\' data-bs-parent=\'#casesEarlyKTX\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clues:</strong> Tremor, hyperkalemia, hypertension; trough 15–20 ng/mL.</li>\n          <li><strong>Action:</strong> Hold/adjust tacrolimus to target 8–12 ng/mL; check interactions (azoles, macrolides).</li>\n          <li><strong>Support:</strong> Optimize volume and avoid nephrotoxins.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c2h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\' aria-expanded=\'false\' aria-controls=\'c2\'>Suspected TRAS on Doppler</button>\n    </h2>\n    <div id=\'c2\' class=\'accordion-collapse collapse\' aria-labelledby=\'c2h\' data-bs-parent=\'#casesEarlyKTX\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clues:</strong> Elevated peak systolic velocity at anastomosis; parvus-tardus waveform.</li>\n          <li><strong>Action:</strong> Arrange CTA/MRA or angiography; plan for angioplasty ± stent if hemodynamically significant.</li>\n          <li><strong>BP:</strong> Control with RAAS-sparing regimen until revascularization.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c3h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\' aria-expanded=\'false\' aria-controls=\'c3\'>Ureteric obstruction/leak</button>\n    </h2>\n    <div id=\'c3\' class=\'accordion-collapse collapse\' aria-labelledby=\'c3h\' data-bs-parent=\'#casesEarlyKTX\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clues:</strong> Hydronephrosis or perinephric collection on ultrasound; low UO.</li>\n          <li><strong>Action:</strong> Urgent urology consult; stent/nephrostomy; drain collections.</li>\n          <li><strong>Antibiotics:</strong> Start if infected collections or pyelonephritis suspected.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c4h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c4\' aria-expanded=\'false\' aria-controls=\'c4\'>Banff 2B acute rejection on biopsy</button>\n    </h2>\n    <div id=\'c4\' class=\'accordion-collapse collapse\' aria-labelledby=\'c4h\' data-bs-parent=\'#casesEarlyKTX\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Action:</strong> Methylprednisolone 500 mg IV daily x3; add rATG 1.5 mg/kg/day for 5–7 doses.</li>\n          <li><strong>AMR features:</strong> If DSA positive or microvascular injury, add PLEX 5–7 sessions + IVIG.</li>\n          <li><strong>Follow-up:</strong> Monitor creatinine, DSA, and consider repeat biopsy if poor response.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\' id=\'c5h\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c5\' aria-expanded=\'false\' aria-controls=\'c5\'>BK viremia with graft dysfunction</button>\n    </h2>\n    <div id=\'c5\' class=\'accordion-collapse collapse\' aria-labelledby=\'c5h\' data-bs-parent=\'#casesEarlyKTX\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li><strong>Clues:</strong> Rising creatinine with positive plasma BK PCR.</li>\n          <li><strong>Action:</strong> Reduce immunosuppression (especially antimetabolite), close viral load monitoring.</li>\n          <li><strong>Avoid:</strong> Empiric antivirals with nephrotoxicity unless indicated.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">What is your immediate approach to a stable patient 1 week post-KTX with creatinine 200?</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Stabilize ABCDE, monitor, IV access, bedside tests, urgent Doppler of graft, send full labs and immunosuppression troughs, screen for infection, send DSA, and plan biopsy if no mechanical cause.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">Which complications are you prioritizing early?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>TRAS, ureteric obstruction/leak, venous thrombosis, calcineurin inhibitor toxicity, acute rejection (TCMR/AMR), infection, and BK virus nephropathy.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">How do you evaluate for TRAS in the ER?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Start with duplex Doppler measuring peak systolic velocity and waveform; if positive, proceed to CTA/MRA or angiography and plan angioplasty ± stent if significant.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">What labs are mandatory now?</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>CBC, CMP with K+/bicarbonate, coagulation, CRP, tacrolimus or cyclosporine trough, urine analysis/culture, BK PCR, and CMV PCR if symptomatic.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">Describe Luminex single-antigen bead testing for DSA.</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Patient serum is incubated with HLA-coated beads; fluorescence is read as MFI to identify specific donor-reactive antibodies; complement-binding assays refine risk.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">What does Banff 2B mean and how do you treat it?</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>It reflects severe intimal arteritis. Treat with high-dose IV methylprednisolone and rATG; if AMR features or DSA positive, add plasmapheresis and IVIG ± rituximab per protocol.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">State a typical rATG regimen for acute rejection.</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Rabbit ATG 1.5 mg/kg/day for 5–7 doses (total 6–10.5 mg/kg), with premedication and CBC monitoring; hold if leukopenia or thrombocytopenia.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">When do you initiate dialysis in this context?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Use AEIOU: refractory acidosis, refractory hyperkalemia, intoxications, volume overload unresponsive to diuretics, uremic complications; not solely the creatinine value.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">What trough levels do you aim for in the first month?</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Tacrolimus roughly 8–12 ng/mL; cyclosporine 150–250 ng/mL, adjusted to center protocol and patient risk.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">How do you minimize biopsy bleeding risk?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Ensure platelets ≥ 50 x10^9/L and INR ≤ 1.5, hold anticoagulants as appropriate, and use ultrasound guidance with post-procedure observation.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah10\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac10\" aria-expanded=\"false\" aria-controls=\"vivac10\">Key drug interactions that raise tacrolimus levels?</button></h2><div id=\"vivac10\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Azoles, macrolides, diltiazem/verapamil, protease inhibitors, and grapefruit products; rifampin lowers levels.</p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'audit\' data-unmapped-count=\'4\'></div><div class=\'accordion\' id=\'extraInfoAccordion\'>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra1\'>Unmapped pearls</button></h2>\n    <div id=\'extra1\' class=\'accordion-collapse collapse show\'><div class=\'accordion-body\'>\n      <ul>\n        <li><strong>CNI targets:</strong> Tailor tacrolimus to immunologic risk and infection risk; use center-specific ranges.</li>\n        <li><strong>dd-cfDNA:</strong> If available, donor-derived cfDNA can support rejection assessment—adjunct only.</li>\n        <li><strong>Contrast-alternatives:</strong> Prefer MR angiography without gadolinium if severe renal dysfunction and MRI-safe.</li>\n      </ul>\n    </div></div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra2\'>Edge cases & special populations</button></h2>\n    <div id=\'extra2\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\n      <ul>\n        <li><strong>Pregnancy:</strong> Avoid mycophenolate; coordinate with maternal-fetal medicine.</li>\n        <li><strong>Pediatrics:</strong> Dose rATG per kg with careful CBC monitoring; consider sedation for biopsy.</li>\n        <li><strong>Highly sensitized:</strong> Low threshold for AMR therapy; involve immunology early.</li>\n      </ul>\n    </div></div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra3\'>Drug dosing & adjustments</button></h2>\n    <div id=\'extra3\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\n      <ul>\n        <li><strong>rATG adjustments:</strong> Reduce or hold if WBC < 2.0 x10^9/L or platelets < 50 x10^9/L.</li>\n        <li><strong>MMF modulation:</strong> Consider dose reduction in BK viremia; avoid abrupt cessation in high immunologic risk.</li>\n        <li><strong>Antimicrobials:</strong> Avoid nephrotoxic agents; adjust dosing to eGFR and drug levels.</li>\n      </ul>\n    </div></div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra4\'>Local policy & pathway notes</button></h2>\n    <div id=\'extra4\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\n      <ul>\n        <li><strong>Center protocols:</strong> Follow institutional targets for trough levels and biopsy thresholds.</li>\n        <li><strong>DSA reporting:</strong> Use lab-defined MFI cutoffs and complement-binding interpretation.</li>\n      </ul>\n    </div></div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra5\'>Suggested schema extensions</button></h2>\n    <div id=\'extra5\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\n      <ul>\n        <li><strong>IMMUNO_TARGETS_LI:</strong> To specify center-specific trough goals and induction details.</li>\n        <li><strong>VIROLOGY_MONITORING_LI:</strong> To standardize CMV/BK monitoring cadence and thresholds.</li>\n      </ul>\n    </div></div>\n  </div>\n</div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li>Delaying Doppler and missing TRAS or obstruction.</li><li>Adjusting calcineurin inhibitor dosing before obtaining a true trough level.</li><li>Treating empirically for rejection without excluding mechanical or infectious causes.</li><li>Proceeding to contrast studies without hydration or alternatives.</li><li>Underdosing or prematurely stopping rATG due to anticipated—not observed—cytopenias.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li>Pathways: Mechanical vs immunologic vs drug toxicity in early allograft dysfunction.</li><li>Doppler-first: Noninvasive, rapid, and contrast-sparing gatekeeper for TRAS/obstruction.</li><li>Immunology: DSA kinetics and complement-binding inform AMR severity.</li><li>Banff nuance: Histology drives therapy intensity and need for follow-up biopsy.</li><li>Safety net: AEIOU for dialysis decisions rather than creatinine alone.</li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li>Using the creatinine value alone to decide dialysis.</li><li>Skipping DSA testing when biopsy suggests vascular injury.</li><li>Ignoring drug interactions that elevate tacrolimus and mimic rejection.</li><li>Proceeding to contrast angiography without attempting Doppler and hydration.</li><li>Starting high-dose steroids before excluding infected collections.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li>This is a case of a stable recipient one week post–kidney transplant presenting to the ER with creatinine 200.</li><li>My immediate priorities are ABCDE stabilization, monitoring, IV access, and strict urine output measurement.</li><li>First I will perform bedside tests including capillary glucose, urine dipstick, and a 12-lead ECG.</li><li>Then I will send full labs including CBC, CMP, coagulation, CRP, and a calcineurin inhibitor trough before the next dose.</li><li>I will urgently request a graft ultrasound with Doppler to exclude TRAS, venous thrombosis, obstruction, or collections.</li><li>In parallel I will send transplant immunology tests including donor-specific antibodies using Luminex single-antigen bead with MFI reporting.</li><li>If Doppler excludes mechanical causes and creatinine remains elevated, I will arrange a same-day ultrasound-guided graft biopsy.</li><li>If the biopsy shows Banff 2B acute rejection, I will give methylprednisolone 500 mg IV daily for three days and start rabbit ATG 1.5 mg/kg/day for 5–7 doses with CBC-guided adjustments.</li><li>If AMR features or positive DSA are present, I will add plasmapheresis with IVIG and consider rituximab as per protocol.</li><li>I will review all medications and stop nephrotoxins and interacting agents while titrating the calcineurin inhibitor to target trough.</li><li>I will treat hyperkalemia immediately if K+ is high or ECG changes occur and consider dialysis for AEIOU indications.</li><li>Finally, I will admit the patient under the transplant team, start infection prophylaxis as indicated, and monitor creatinine, urine output, trough levels, and DSA response.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\">EARLY POST-KTX CREATININE 200 (STABLE)\n\n[Start]\n  |\n  v\n[ABCDE + Monitor + Foley]\n  |\n  v\n[Bedside: glucose, urine dip, ECG]\n  |\n  v\n[Send labs + trough level]\n  |\n  v\n[Duplex Doppler of graft]\n  |-- if Mechanical cause -> [Fix: drain/stent/angioplasty]\n  |-- else -> [Plan graft biopsy]\n  |\n  v\n[Biopsy result]\n  |-- Banff 2B -> [MP 500 mg IV x3 + rATG 1.5 mg/kg/d x5-7]\n  |-- AMR features -> [Add PLEX + IVIG ± rituximab]\n  |-- Drug toxicity -> [Adjust CNI]\n  |-- Infection -> [Targeted antibiotics]\n  |\n  v\n[Reassess UO/Cr; consider AEIOU for dialysis]</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li>Banff classification updates: arteritis severity correlates with outcomes.</li><li>Trials and cohort data supporting rATG efficacy in steroid-resistant TCMR.</li><li>Observational studies showing Doppler\'s utility in detecting TRAS early.</li><li>Data linking high DSA MFI and complement-binding to AMR severity.</li></ul>\r\n      <ul class=\"mb-0\"><li>Use Doppler ultrasound as first-line imaging for early graft dysfunction.</li><li>Treat Banff 2B with pulse steroids plus rATG; add AMR-directed therapy when DSA/microvascular injury present.</li><li>Obtain calcineurin inhibitor troughs before dosing changes and avoid interacting drugs.</li><li>Apply AEIOU criteria for dialysis rather than creatinine thresholds.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li>KDIGO Kidney Transplant Recipient Guidelines: evaluation of graft dysfunction, acute rejection treatment, infection prophylaxis.</li><li>Center protocols on rATG dosing, biopsy safety parameters, and TRAS management pathways.</li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    \r\n    \r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for notes\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-20 00:07:33', '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-20 00:07:33');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(9, NULL, 4, 1, 1, 'early-post-kidney-transplant-creatinine-200-workup-banff-2b-atg-dsa', 'dynamic Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection', NULL, 'published', NULL, '{\"slug\":\"early-post-kidney-transplant-creatinine-200-workup-banff-2b-atg-dsa\",\"topic\":\"Early Post\\u2013Kidney Transplant (1 week) with Creatinine 200 \\u00b5mol\\/L: Workup, Imaging (TRAS), DSA, Banff 2B & ATG Dosing\",\"OVERVIEW_HTML\":\"<p><strong>Setting:<\\/strong> 1 week status post kidney transplant (KTX) performed outside KSA, stable patient presenting with creatinine ~200 \\u00b5mol\\/L (~2.3 mg\\/dL). Early graft dysfunction requires a structured approach to rule out reversible surgical\\/vascular\\/urinary causes, drug toxicity, infection, and rejection (TCMR\\/ABMR).<\\/p><p><strong>Key priorities:<\\/strong> rapid bedside assessment, full lab panel and immunosuppression levels, urgent renal allograft ultrasound with Doppler, and timely biopsy if no mechanical cause is identified.<\\/p>\",\"INITIAL_APPROACH_LI\":[\"<strong>History:<\\/strong> donor\\/recipient details, DGF\\/SF trajectory, urine output, fluid intake, weight, fever\\/chills, dysuria, pain over graft, timing\\/doses of immunosuppression, missed doses, nephrotoxins.\",\"<strong>Examination:<\\/strong> vitals, volume status, graft tenderness\\/bruit, catheter\\/drain sites, edema, signs of infection.\",\"<strong>Immediate tests:<\\/strong> BMP\\/U&E, CBC, LFTs, coagulation, urinalysis & urine culture, tacrolimus\\/cyclosporine trough, BK\\/CMV screening per protocol, glucose, Mg, PO4.\",\"<strong>Imaging:<\\/strong> renal ultrasound with Doppler (arterial\\/venous patency, resistive indices, hydronephrosis, collections).\",\"<strong>Decision:<\\/strong> if no surgical\\/obstructive\\/vascular lesion and creatinine not improving, proceed to ultrasound-guided allograft biopsy to differentiate TCMR vs ABMR vs CNI toxicity vs ATN.\"],\"DIFFERENTIAL_TABLE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Category<\\/th><th>Clues<\\/th><th>Next steps<\\/th><\\/tr><\\/thead><tbody><tr><td>Pre-renal (hypovolemia)<\\/td><td>Orthostasis, dry mucosa, high Hct, recent diuretics<\\/td><td>Volume repletion, recheck creatinine<\\/td><\\/tr><tr><td>Obstruction\\/urinary leak<\\/td><td>Oliguria, hydronephrosis, perinephric collection<\\/td><td>US with Doppler; consider nephrostomy\\/stent<\\/td><\\/tr><tr><td>Vascular complication<\\/td><td>Sudden pain, bruit loss, high RI, absent flow<\\/td><td>Urgent Doppler; if thrombosis suspected, immediate surgical consult<\\/td><\\/tr><tr><td>TRAS<\\/td><td>Refractory HTN, bruit, graft dysfunction (days\\u2013months)<\\/td><td>Doppler; if suggestive, CT\\/MR angiography; plan angioplasty\\/stent if significant<\\/td><\\/tr><tr><td>Calcineurin inhibitor (CNI) toxicity<\\/td><td>Early high tac\\/CsA troughs, tremor, HTN, K\\u2191, Mg\\u2193<\\/td><td>Check\\/adjust trough targets; exclude rejection by biopsy if doubt<\\/td><\\/tr><tr><td>Ischemia\\u2013reperfusion injury (ATN\\/DGF)<\\/td><td>Slow fall or plateau in creatinine since transplant<\\/td><td>Supportive care; exclude obstruction\\/infection; biopsy if atypical<\\/td><\\/tr><tr><td>Rejection (TCMR\\/ABMR)<\\/td><td>Rising creatinine, proteinuria\\/hematuria, DSA \\u00b1 C4d<\\/td><td>Biopsy with Banff scoring; DSA testing; treat per phenotype<\\/td><\\/tr><tr><td>Infection (BK, CMV, bacterial)<\\/td><td>Pyuria, viruria\\/viremia; systemic or GU symptoms<\\/td><td>Targeted testing; adjust immunosuppression; specific therapy<\\/td><\\/tr><\\/tbody><\\/table>\",\"LAB_WORKUP_LI\":[\"Serum: Na, K, Cl, HCO3, BUN, creatinine, Ca, Mg, PO4, uric acid, glucose, LFTs.\",\"CBC with differential; CRP if infection suspected.\",\"Tacrolimus C0 (or cyclosporine C0\\/C2), mycophenolic acid level if available.\",\"Urinalysis (protein, blood, WBC), urine culture; spot UPCR\\/ACR.\",\"Virology per protocol: BK virus PCR (plasma \\u00b1 urine), CMV PCR (if mismatched\\/symptomatic), HBsAg\\/anti-HBc\\/HCV RNA as appropriate.\",\"Drug screen for nephrotoxins (aminoglycosides, amphotericin, NSAIDs, contrast history).\"],\"DYNAMIC_TRAS_DIAGNOSTICS_HTML\":\"<div><h5>Transplant Renal Artery Stenosis (TRAS): bedside & imaging<\\/h5><ul><li><strong>When to suspect:<\\/strong> new\\/refractory hypertension, audible bruit, graft dysfunction without another cause, flash pulmonary edema.<\\/li><li><strong>First-line:<\\/strong> renal allograft Doppler: look for elevated peak systolic velocity (>200 cm\\/s), velocity ratio >2 across stenosis, tardus-parvus waveforms distally, and increased acceleration time.<\\/li><li><strong>Second-line:<\\/strong> CT angiography or MR angiography if Doppler equivocal. Digital subtraction angiography when intervention is planned.<\\/li><li><strong>Management:<\\/strong> angioplasty \\u00b1 stent for hemodynamically significant lesions; optimize BP and statin therapy.<\\/li><\\/ul><\\/div>\",\"BIOPSY_INDICATIONS_LI\":[\"Persistent or rising creatinine without mechanical cause.\",\"New significant proteinuria or hematuria.\",\"Suspected rejection despite therapeutic CNI troughs.\",\"Atypical course of DGF or discordant clinical data.\",\"Unexplained graft tenderness\\/fever after excluding infection.\"],\"BANFF_2B_TCMR_TREATMENT_LI\":[\"<strong>Pulse steroids:<\\/strong> methylprednisolone 500\\u20131000 mg IV daily for 3 doses.\",\"<strong>rATG (Thymoglobulin):<\\/strong> 1.0\\u20131.5 mg\\/kg IV daily for 4\\u20137 doses (typical total 4.5\\u20137.5 mg\\/kg) for Banff grade 2 (especially 2B) or steroid-resistant rejection.\",\"<strong>Premedication:<\\/strong> acetaminophen, antihistamine, and corticosteroid; DVT and infection prophylaxis per protocol.\",\"<strong>Hold\\/adjust criteria:<\\/strong> consider dose reduction\\/hold if WBC < 2.0 \\u00d710<sup>9<\\/sup>\\/L, platelets < 50 \\u00d710<sup>9<\\/sup>\\/L.\",\"<strong>Optimize maintenance IS:<\\/strong> ensure tacrolimus in target range; resume\\/adjust MMF; taper steroids to baseline maintenance.\",\"<strong>Monitor:<\\/strong> daily CBC, chemistry, tacrolimus trough; CMV\\/BK surveillance after lymphocyte-depleting therapy.\"],\"ABMR_TREATMENT_SUMMARY_LI\":[\"Therapeutic plasma exchange (TPE) + IVIG.\",\"Add rituximab in selected cases; consider bortezomib\\/carfilzomib for refractory disease.\",\"Consider complement inhibition (e.g., eculizumab) in severe early ABMR where available.\",\"Tight BP\\/proteinuria control; correct CNI exposure; treat concurrent infections.\"],\"DYNAMIC_DSA_METHODS_HTML\":\"<div><h5>DSA Testing & Crossmatching<\\/h5><ul><li><strong>Assays:<\\/strong> <em>Luminex single-antigen bead (SAB)<\\/em> identifies donor-specific anti-HLA antibodies with semi-quantitative readout (MFI). Complement-binding assays (C1q\\/C3d) can help risk-stratify.<\\/li><li><strong>Virtual crossmatch (VXM):<\\/strong> compares recipient SAB profile to donor HLA typing in silico; positive VXM (clinically relevant DSA) suggests higher risk for ABMR.<\\/li><li><strong>Flow cytometry crossmatch (FCXM):<\\/strong> detects binding of patient antibodies to donor T- and B-lymphocytes; more sensitive than CDC crossmatch.<\\/li><li><strong>Interpreting MFI:<\\/strong> lab-specific thresholds; many centers consider MFI \\u22651,000\\u20131,500 as potentially positive; clinical context (complement-binding, titer changes, prozone) matters.<\\/li><li><strong>When to send:<\\/strong> at presentation with graft dysfunction, post-treatment to document DSA response, and per protocol surveillance in sensitized recipients.<\\/li><\\/ul><\\/div>\",\"DYNAMIC_IMMUNOSUPPRESSION_TARGETS_TABLE_HTML\":\"<table class=\'table table-striped table-sm\'><thead><tr><th>Drug<\\/th><th>Early target (weeks 0\\u20134)<\\/th><th>Notes<\\/th><\\/tr><\\/thead><tbody><tr><td>Tacrolimus (trough, C0)<\\/td><td>~8\\u201312 ng\\/mL<\\/td><td>Adjust by center protocol, infection risk, and DDI; avoid peaks.<\\/td><\\/tr><tr><td>Cyclosporine (C0)<\\/td><td>~150\\u2013250 ng\\/mL<\\/td><td>Some centers use C2 monitoring; ranges vary by protocol.<\\/td><\\/tr><tr><td>Mycophenolate<\\/td><td>MMF 1\\u20131.5 g BID (or MPS 720 mg BID)<\\/td><td>Adjust for leukopenia\\/GI; exposure targets if available.<\\/td><\\/tr><tr><td>Prednisone<\\/td><td>e.g., 5\\u201320 mg\\/day taper<\\/td><td>Per induction\\/center taper plan.<\\/td><\\/tr><\\/tbody><\\/table>\",\"DYNAMIC_ATG_DOSING_TABLE_HTML\":\"<table class=\'table table-bordered table-sm\'><thead><tr><th>Agent<\\/th><th>Indication<\\/th><th>Typical dose<\\/th><th>Premeds<\\/th><th>Monitoring\\/holds<\\/th><\\/tr><\\/thead><tbody><tr><td>rATG (Thymoglobulin)<\\/td><td>Banff 2 (esp. 2B) TCMR; steroid-resistant rejection<\\/td><td>1.0\\u20131.5 mg\\/kg IV daily \\u00d74\\u20137 (total ~4.5\\u20137.5 mg\\/kg)<\\/td><td>Acetaminophen, diphenhydramine, steroid<\\/td><td>Daily CBC; consider hold\\/reduce if WBC <2.0 \\u00d710<sup>9<\\/sup>\\/L or platelets <50 \\u00d710<sup>9<\\/sup>\\/L; CMV\\/BK prophylaxis and surveillance<\\/td><\\/tr><\\/tbody><\\/table>\",\"FLUIDS_MEDS_CAUTION_LI\":[\"Avoid nephrotoxins (NSAIDs, aminoglycosides, IV contrast unless essential; if needed, hydrate and use low\\/iso-osmolar contrast).\",\"Review anti-hypertensives (ACEi\\/ARB early post-KTX often deferred unless clear need).\",\"Correct volume status (balanced crystalloids); aim euvolemia.\",\"Dose-adjust renally cleared medications.\"],\"ASCII_FLOWCHART_PRE\":\"EARLY GRAFT DYSFUNCTION (CREAT ~200 \\u00b5mol\\/L) - 1 WEEK POST-KTX\\n\\n1) ABCs & vitals -> stable? If unstable: urgent surgical\\/transplant consult\\n2) Focused Hx\\/Exam -> volume, pain, fever, IS adherence, nephrotoxins\\n3) Labs -> U&E, CBC, LFT, UA\\/culture, tac\\/CsA trough, BK\\/CMV as indicated\\n4) Ultrasound + Doppler -> patency? hydronephrosis? collections?\\n   - If obstruction\\/leak\\/collection -> urology\\/intervention\\n   - If vascular flow absent\\/thrombosis -> immediate surgical team\\n   - If TRAS suspected -> confirm with CTA\\/MRA; plan angioplasty\\/stent\\n5) If no mechanical cause and creatinine not improving -> Biopsy\\n   - Banff 2B TCMR -> MP pulse + rATG\\n   - ABMR -> TPE + IVIG \\u00b1 rituximab\\/other agents\\n   - CNI toxicity\\/ATN -> adjust CNI; supportive care\\n6) Reassess daily -> labs, troughs, urine output; surveil CMV\\/BK after ATG\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'cases\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: Plateaued creatinine, normal Doppler<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><p><strong>Findings:<\\/strong> Cr 200\\u2013210 \\u00b5mol\\/L over 48 h, good urine output, Doppler patent, RI 0.7, tac trough 6 ng\\/mL.<\\/p><p><strong>Action:<\\/strong> Optimize tac to ~8\\u201312; if no improvement, proceed to biopsy to distinguish ATN vs subclinical TCMR; send DSA same day.<\\/p><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: Banff 2B on biopsy<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><p><strong>Plan:<\\/strong> Methylpred 500\\u20131000 mg IV daily \\u00d73 then rATG 1\\u20131.5 mg\\/kg IV daily \\u00d75 (total ~7.5 mg\\/kg) with premeds. Monitor CBC; hold if WBC < 2.0 or platelets < 50. Tight infection prophylaxis; recheck creatinine and consider follow-up biopsy if suboptimal response.<\\/p><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: Rising creatinine + positive DSA<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'><div class=\'accordion-body\'><p><strong>Findings:<\\/strong> New class II DSA with high MFI; C4d+ on biopsy (ABMR).<\\/p><p><strong>Treatment:<\\/strong> 5 sessions TPE + low-dose IVIG after each, plus rituximab 375 mg\\/m<sup>2<\\/sup> once; optimize CNI and BP; consider proteasome inhibitor if refractory; monitor DSA trends and proteinuria.<\\/p><\\/div><\\/div><\\/div><\\/div>\",\"VIVA_BANK_OL\":[\"Q: First imaging for early post-KTX graft dysfunction? A: Renal ultrasound with Doppler to assess patency, RI, hydronephrosis, and collections.\",\"Q: Two vascular complications to exclude urgently? A: Renal artery\\/vein thrombosis and significant TRAS.\",\"Q: Target tacrolimus trough in week 1\\u20134? A: About 8\\u201312 ng\\/mL (center-specific).\",\"Q: Indications for biopsy at 1 week? A: No mechanical cause and persistent\\/rising creatinine, new proteinuria\\/hematuria, suspected rejection.\",\"Q: Banff 2B TCMR initial therapy? A: IV methylpred pulse followed by rATG (1\\u20131.5 mg\\/kg\\/day for 4\\u20137 doses).\",\"Q: Premedications before rATG? A: Acetaminophen, antihistamine, and steroid; plus infection\\/DVT prophylaxis per protocol.\",\"Q: When to hold rATG? A: Severe leukopenia (WBC < 2.0 \\u00d710^9\\/L) or thrombocytopenia (platelets < 50 \\u00d710^9\\/L).\",\"Q: ABMR cornerstone therapy? A: Plasmapheresis + IVIG; consider rituximab and others if indicated.\",\"Q: What is a virtual crossmatch? A: In silico comparison of recipient HLA antibody profile (SAB) with donor HLA typing.\",\"Q: What does MFI represent in Luminex? A: Semi-quantitative fluorescence intensity reflecting antibody binding; thresholds are lab-specific and context-dependent.\",\"Q: One Doppler sign of TRAS? A: Tardus\\u2013parvus intrarenal waveform with prolonged acceleration time.\",\"Q: Name two non-immunologic causes of early creatinine rise. A: Hypovolemia and CNI nephrotoxicity.\"],\"DYNAMIC_DISPOSITION_CHECKLIST_HTML\":\"<ul><li><strong>Stable outpatient vs admit:<\\/strong> Admit for expedited workup\\/biopsy unless a clear reversible non-immune cause is rapidly corrected.<\\/li><li><strong>Consults:<\\/strong> Transplant surgery\\/interventional radiology if vascular\\/urinary issue; infectious diseases for complex cases.<\\/li><li><strong>Follow-up:<\\/strong> Daily labs while inpatient; early clinic review within 48\\u201372 h post-discharge.<\\/li><\\/ul>\",\"PEARLS_PITFALLS_LI\":[\"Do not delay Doppler\\u2014mechanical causes are common and reversible early.\",\"High tac does not exclude rejection; biopsy is definitive.\",\"MFI values are not absolute; consider complement-binding and trends.\",\"After lymphocyte-depleting therapy, intensify CMV and BK surveillance.\",\"Control BP and proteinuria to protect the graft irrespective of etiology.\"],\"REFERENCES_HTML\":\"<ul><li>Clinical Handbook of Nephrology (Elsevier, 2024): practical algorithms for transplant evaluation and rejection management. <\\/li><li>Handbook of Critical Care Nephrology (LWW, 2021): ICU-focused AKI and transplant pearls relevant to early graft dysfunction. <\\/li><li>Washington Manual Nephrology Subspecialty Consult (4th ed., 2021): concise dosing and management tables (including rATG). <\\/li><li>Absolute Nephrology Review (Springer, 2022): Q&A style reinforcement on rejection, DSA assays, and TRAS. <\\/li><li>Best of Five MCQs for the European Specialty Examination in Nephrology (OUP, 2024): exam-oriented coverage of biopsy-based decisions and post-KTX complications. <\\/li><\\/ul>\",\"NOTES_HTML\":\"<p><strong>Units:<\\/strong> Creatinine 200 \\u00b5mol\\/L \\u2248 2.26 mg\\/dL. Thresholds and targets vary by center; align with local transplant program protocols and KSA MoH guidance where applicable.<\\/p>\",\"TOPIC\":\"dynamic Kidney Transplant \\u2013 Early Allograft Dysfunction and Banff 2B Rejection\",\"template\":\"dynamic-template.html\"}', '{\"template\":\"dynamic-template.html\"}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53'),
(10, NULL, 3, 1, 1, 'pd-catheter-no-outflow', 'Peritoneal dialysis (PD) catheter no outflow', 'Troubleshooting algorithm • Fibrin-related obstruction • When to escalate/remove catheter', 'published', 'Outflow failure on PD is common and most often mechanical. After treating constipation, think intraluminal obstruction (fibrin/clot), catheter malposition or kinking, omental wrap/adhesions, bladder compression, and occult peritonitis. A stepwise approach—screen, image, flush with heparinized saline, then consider thrombolytic dwell (tPA/urokinase), radiologic manipulation, or surgical revision—prevents delays and avoids unnecessary catheter loss.  ', '{\"slug\":\"pd-catheter-no-outflow\",\"TOPIC\":\"Peritoneal dialysis (PD) catheter no outflow\",\"CHIP_1\":\"Troubleshooting algorithm\",\"CHIP_2\":\"Fibrin-related obstruction\",\"CHIP_3\":\"When to escalate\\/remove catheter\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Outflow failure on PD is common and most often mechanical. After treating constipation, think intraluminal obstruction (fibrin\\/clot), catheter malposition or kinking, omental wrap\\/adhesions, bladder compression, and occult peritonitis. A stepwise approach\\u2014screen, image, flush with heparinized saline, then consider thrombolytic dwell (tPA\\/urokinase), radiologic manipulation, or surgical revision\\u2014prevents delays and avoids unnecessary catheter loss.  \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e <strong>Confirm true outflow failure:<\\/strong> inability to drain dwell within <span class=\'hl-symbol\'><=<\\/span>45 min; inspect clamps\\/lines for kinks; check transfer set. \",\"\\ud83e\\uddea <strong>Rule out peritonitis:<\\/strong> send effluent cell count, Gram stain\\/culture before antibiotics if cloudy or symptomatic; follow ISPD empiric coverage if suspected. \",\"\\u2705 <strong>Address extrinsic causes:<\\/strong> treat constipation (commonest cause), relieve bladder distension (scan\\/catheterize PRN).  \",\"\\ud83d\\uddbc\\ufe0f <strong>Localize catheter:<\\/strong> plain abdominal radiograph for radio-opaque stripe aiming pelvic location; CT if uncertain. \",\"\\ud83d\\udc89 <strong>Safe patency attempt:<\\/strong> aseptic repeated flushes with 20\\u201350 mL heparinized 0.9% saline by trained staff; avoid high-pressure force. \"],\"DDX_BUCKET_1_TITLE\":\"Intraluminal & intramural\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Fibrin strands\\/clot<\\/strong> causing one- or two-way obstruction. \",\"\\ud83e\\udea2 <strong>Kink within catheter<\\/strong> (tip or subcutaneous tunnel). \"],\"DDX_BUCKET_2_TITLE\":\"Extraluminal\\/mechanical\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83d\\udca9 <strong>Constipation<\\/strong> (most common; rectosigmoid distension displaces\\/occludes side-holes). \",\"\\ud83e\\uded9 <strong>Bladder distension<\\/strong> compressing catheter externally. \",\"\\ud83e\\uddf5 <strong>Omental wrap\\/adhesions<\\/strong> (may cause complete inflow\\/outflow failure). \"],\"DDX_BUCKET_3_TITLE\":\"Position\\/migration & inflammatory\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83d\\udccd <strong>Catheter tip migration<\\/strong> from pelvis. \",\"\\ud83d\\udd25 <strong>Peritonitis<\\/strong> (fibrin, ileus, pain\\/cloudy effluent). \",\"\\ud83e\\uddeb <strong>Exit\\/tunnel infection<\\/strong> (consider ultrasound if suspected). \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'><div class=\'row\'><div class=\'col\'><ul class=\'mb-2\'><li><strong>1) Basics:<\\/strong> check clamps\\/kinks; re-position patient; cough\\/deep-breathe; treat constipation; bladder scan.<\\/li><li><strong>2) Image:<\\/strong> AP abdominal film for radio-opaque stripe in pelvis; CT if unclear. <\\/li><li><strong>3) Aseptic flush:<\\/strong> 20\\u201350 mL heparinized saline via trained nurse. <\\/li><li><strong>4) Thrombolytic dwell:<\\/strong> tPA 1 mg\\/mL, 8 mL, dwell 1\\u20132 h; or urokinase 5000 U in 40 mL NS ~1 h.  <\\/li><li><strong>5) If flow restored:<\\/strong> add heparin <span class=\'hl-symbol\'>\\u2265<\\/span>500 U\\/L to dialysate for next cycles. <\\/li><li><strong>6) If malposition:<\\/strong> fluoroscopic wire\\/stylet or Fogarty manipulation; low long-term success\\u2014consider new catheter.  <\\/li><li><strong>7) Consider removal\\/replacement:<\\/strong> refractory mechanical failure, adhesions\\/loculations, malposition with poor flow, or refractory\\/fungal peritonitis. <\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83d\\uddbc\\ufe0f <strong>AP abdominal radiograph:<\\/strong> confirm tip in pelvis via radio-opaque stripe; lateral as needed. \",\"\\ud83e\\uddea <strong>Effluent cell count & culture:<\\/strong> if pain\\/cloudy effluent or fever; follow ISPD sampling before empiric therapy. \",\"\\ud83e\\uddcd <strong>Bladder scan:<\\/strong> exclude distension causing external compression. \",\"\\ud83d\\udda5\\ufe0f <strong>CT abdomen:<\\/strong> if radiograph non-diagnostic or to evaluate adhesions\\/loculations\\/migration. \",\"\\ud83d\\udd8a\\ufe0f <strong>Ultrasound of tunnel\\/exit:<\\/strong> if infection suspected. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'accordion\' id=\'algoPDNoFlow\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#stepA\'>Initial bedside actions<\\/button><\\/h2><div id=\'stepA\' class=\'accordion-collapse collapse\' data-bs-parent=\'#algoPDNoFlow\'><div class=\'accordion-body\'><ul><li><strong>Inspect & reset system:<\\/strong> clamps open, no kinks, transfer set patent.<\\/li><li><strong>Reposition:<\\/strong> sit-to-stand, lateral decubitus, knee-chest; ask to cough.<\\/li><li><strong>Treat constipation & empty bladder:<\\/strong> suppository\\/enema or oral regimen; bladder scan\\/catheterize if distended.  <\\/li><li><strong>Suspect peritonitis?<\\/strong> Sample effluent then start empiric per ISPD if indicated. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#stepB\'>Imaging & conservative clearance<\\/button><\\/h2><div id=\'stepB\' class=\'accordion-collapse collapse\' data-bs-parent=\'#algoPDNoFlow\'><div class=\'accordion-body\'><ul><li><strong>AP x-ray:<\\/strong> confirm pelvic tip; CT if unclear. <\\/li><li><strong>Aseptic flush:<\\/strong> 20\\u201350 mL heparinized saline by trained staff. <\\/li><li><strong>If hemoperitoneum:<\\/strong> IP heparin to prevent catheter clotting. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#stepC\'>Pharmacologic clearance<\\/button><\\/h2><div id=\'stepC\' class=\'accordion-collapse collapse\' data-bs-parent=\'#algoPDNoFlow\'><div class=\'accordion-body\'><ul><li><strong>tPA dwell:<\\/strong> 8 mL of 1 mg\\/mL, dwell 1\\u20132 h; then aspirate\\/flush. <\\/li><li><strong>Alternative:<\\/strong> urokinase 5000 U (or tPA 2 mg) in 40 mL NS for ~1 h. <\\/li><li><strong>Post-clearance:<\\/strong> add heparin 500 U\\/L to dialysate for next cycles. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#stepD\'>Reposition\\/replace<\\/button><\\/h2><div id=\'stepD\' class=\'accordion-collapse collapse\' data-bs-parent=\'#algoPDNoFlow\'><div class=\'accordion-body\'><ul><li><strong>Fluoroscopic manipulation:<\\/strong> guidewire\\/stylet or Fogarty balloon to re-seat tip in pelvis; success modest.  <\\/li><li><strong>Laparoscopic revision:<\\/strong> omentopexy\\/partial omentectomy for wraps; adhesiolysis; replace if needed. <\\/li><li><strong>Remove catheter:<\\/strong> per ISPD-indicated scenarios (refractory\\/fungal peritonitis, adhesions\\/loculations, malposition with poor flow). <\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"PILLAR_1\":\"Assessment & conservative management\",\"STEP_1_TITLE\":\"Screen & stabilize\",\"STEP_1_LI\":[\"\\ud83e\\udded <strong>Definition:<\\/strong> failure to drain dwell within 45 minutes \\u2192 evaluate for malfunction. \",\"\\ud83e\\uddf4 <strong>Asepsis:<\\/strong> treat as a procedure; mask\\/clean connections.\",\"\\ud83d\\udc8a <strong>Constipation first:<\\/strong> laxatives\\/enema; review opioids\\/anticholinergics. \"],\"STEP_2_TITLE\":\"Image & simple clearance\",\"STEP_2_LI\":[\"\\ud83d\\uddbc\\ufe0f <strong>Radiograph:<\\/strong> confirm pelvic tip; CT if uncertain. \",\"\\ud83d\\udc89 <strong>Heparinized saline flush:<\\/strong> 20\\u201350 mL by trained nurse. \",\"\\ud83e\\ude78 <strong>If hemoperitoneum present:<\\/strong> consider IP heparin to prevent intraluminal clot. \"],\"PILLAR_2\":\"Pharmacologic & procedural restoration\",\"STEP_3_TITLE\":\"Fibrinolytic dwell (fibrin\\/clot)\",\"STEP_3_LI\":[\"\\ud83d\\udc89 <strong>tPA:<\\/strong> 8 mL of 1 mg\\/mL into catheter; dwell 1\\u20132 h; aspirate\\/flush. \",\"\\ud83d\\udc89 <strong>Alternative:<\\/strong> urokinase 5000 U or tPA 2 mg in 40 mL NS ~1 h. \",\"\\u2705 <strong>After clearance:<\\/strong> add heparin 500 U\\/L to dialysate for subsequent exchanges to reduce recurrence. \"],\"STEP_4_TITLE\":\"Reposition\\/revise\\/remove\",\"STEP_4_LI\":[\"\\ud83e\\uddf5 <strong>Fluoro-guided manipulation:<\\/strong> guidewire\\/stylet or Fogarty; success limited (27\\u201348%); recurrence common.  \",\"\\ud83d\\udd2a <strong>Lap surgery:<\\/strong> omentopexy\\/omental resection; adhesiolysis; replace if needed. \",\"\\ud83d\\udeab <strong>Remove catheter:<\\/strong> refractory mechanical failure; refractory\\/fungal peritonitis; significant loculations\\/malposition. \"],\"TOPIC_BLOCK_A_TITLE\":\"Fibrin-specific tips\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Triggers:<\\/strong> peritonitis and hemoperitoneum increase fibrin; prophylactic IP heparin (500 U\\/L) can keep lumen patent.  \",\"\\ud83d\\udc89 <strong>tPA vs urokinase:<\\/strong> both acceptable; local protocols vary\\u2014know availability\\/doses. \",\"\\ud83d\\udd01 <strong>Recurrence prevention:<\\/strong> continue heparinized dialysate for several cycles post-clearance. \"],\"TOPIC_BLOCK_B_TITLE\":\"Imaging & localization pearls\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\uddbc\\ufe0f <strong>Radio-opaque stripe:<\\/strong> confirms catheter course; tip should sit in pelvis; lateral view clarifies loops\\/kinks. \",\"\\ud83d\\udda5\\ufe0f <strong>CT utility:<\\/strong> identifies migration\\/adhesions when x-ray is equivocal. \"],\"TOPIC_BLOCK_C_TITLE\":\"When to abandon salvage\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>Persistent no-flow despite thrombolytics & manipulation<\\/strong> with non-pelvic tip or omental wrap on imaging. \",\"\\ud83e\\uddeb <strong>Refractory\\/fungal peritonitis<\\/strong> or significant loculations \\u2192 remove catheter; reinsert after resolution\\/holiday. \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udcca <strong>Track PD no-flow events:<\\/strong> root-cause (constipation vs migration vs fibrin) and time-to-salvage.\",\"\\ud83e\\uddfc <strong>Aseptic technique audits:<\\/strong> for all manipulations\\/flushes to reduce infection risk.\",\"\\ud83d\\udccb <strong>Standardize tPA\\/urokinase protocols:<\\/strong> clear dosing, dwell time, and post-clearance heparinization.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Reduced unplanned HD transfers<\\/strong> due to PD access failure.\",\"\\ud83d\\udd52 <strong>Shorter time-to-drainage restoration<\\/strong> after no-flow episodes.\",\"\\ud83e\\uddea <strong>Lower peritonitis incidence<\\/strong> post-manipulation.\"],\"QUALITY_SAFETY_LI\":[\"\\u26a0\\ufe0f <strong>Avoid high-pressure flushing<\\/strong> to prevent visceral injury.\",\"\\ud83e\\uddea <strong>Always culture before antibiotics<\\/strong> if peritonitis suspected to preserve diagnostic yield. \",\"\\ud83e\\uddef <strong>Stop if pain\\/worsening signs<\\/strong> during flush or thrombolytic dwell; reassess for malposition\\/perforation.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Manipulations are invasive:<\\/strong> use sterile technique, trained personnel, and monitor for pain\\/bleeding; escalate early if red flags (fever, severe pain, peritoneal signs).\",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Explain steps & expectations:<\\/strong> discuss possible need for thrombolytic dwell or catheter revision; provide constipation prevention plan and when to call for help.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdCases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>CAPD patient with persistent no outflow after laxatives<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Investigations:<\\/strong> AP x-ray for tip position; bladder scan; effluent sampling if symptomatic. <\\/li>\\n          <li><strong>Action:<\\/strong> heparinized saline flush 20\\u201350 mL; if unsuccessful, tPA 8 mL (1 mg\\/mL) dwell 1\\u20132 h. <\\/li>\\n          <li><strong>Follow-up:<\\/strong> heparin 500 U\\/L in dialysate for next cycles. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>APD patient with abrupt two-way obstruction after coughing fit<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Consider:<\\/strong> migration\\/kink or omental wrap if complete inflow\\/outflow failure.  <\\/li>\\n          <li><strong>Action:<\\/strong> radiograph; if malpositioned, attempt fluoroscopic guidewire\\/stylet or Fogarty manipulation. <\\/li>\\n          <li><strong>Plan B:<\\/strong> laparoscopic omentopexy or replacement if manipulation fails. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Cloudy effluent with poor drainage<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Action first:<\\/strong> sample effluent; start ISPD empiric therapy if peritonitis suspected. <\\/li>\\n          <li><strong>Adjunct:<\\/strong> add heparin 500 U\\/L to dialysate to prevent fibrin occlusion during peritonitis. <\\/li>\\n          <li><strong>Escalation:<\\/strong> remove catheter for refractory\\/fungal peritonitis. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the most common cause of PD outflow failure?\",\"a\":\"Constipation causing rectosigmoid distension and side-hole occlusion\\/migration. \"},{\"q\":\"Define PD outflow failure operationally.\",\"a\":\"Failure to drain the dwelling fluid within 45 minutes (often preceded by sluggish outflow). \"},{\"q\":\"First imaging test for suspected catheter migration?\",\"a\":\"AP abdominal radiograph to identify the radio-opaque stripe; tip should be in pelvis. \"},{\"q\":\"Initial conservative clearance maneuver?\",\"a\":\"Aseptic heparinized 0.9% saline flush (20\\u201350 mL) by trained staff. \"},{\"q\":\"tPA dosing for suspected fibrin plug?\",\"a\":\"Instill 8 mL of 1 mg\\/mL tPA into the catheter, dwell 1\\u20132 hours, then aspirate\\/flush. \"},{\"q\":\"Alternative to tPA if unavailable?\",\"a\":\"Urokinase 5000 U (or tPA 2 mg) in 40 mL NS for ~1 hour. \"},{\"q\":\"How to prevent recurrent fibrin occlusion post-clearance?\",\"a\":\"Add heparin 500 U\\/L to dialysate for the next exchanges. \"},{\"q\":\"When to suspect omental wrap?\",\"a\":\"Complete inflow and outflow failure with imaging suggesting tip entrapment; requires omentopexy\\/omental resection. \"},{\"q\":\"What are ISPD-based indications for catheter removal?\",\"a\":\"Refractory peritonitis, fungal peritonitis, significant adhesions\\/loculations, or persistent malposition with poor flow. \"},{\"q\":\"Role of heparin during peritonitis with poor drainage?\",\"a\":\"Adding 500 U\\/L heparin to dialysate helps prevent fibrin-related occlusion. \"},{\"q\":\"Success of fluoroscopic repositioning?\",\"a\":\"Often limited (\\u224827\\u201348% long-term); consider new catheter if recurrent. \"},{\"q\":\"How to recognize extrinsic compression besides constipation?\",\"a\":\"Bladder distension\\u2014use bladder scan; decompress if needed. \"}],\"PITFALLS_LI\":[\"\\u274c <strong>Forcing high-pressure flushes<\\/strong> risking visceral injury.\",\"\\u274c <strong>Starting antibiotics before sampling<\\/strong> when peritonitis is suspected\\u2014reduces culture yield. \",\"\\u274c <strong>Ignoring bladder distension<\\/strong> as a reversible compressive cause. \",\"\\u274c <strong>Stopping after first thrombolytic attempt<\\/strong> without post-clearance heparinization\\u2014recurrence risk. \"],\"ANSWER_STEPS_OL\":[\"Confirm no-flow (check clamps\\/lines) and treat constipation aggressively; empty bladder if distended.  \",\"Obtain AP x-ray for tip position; CT if unclear. \",\"If symptomatic\\/cloudy, sample effluent and start ISPD empiric therapy. \",\"Attempt aseptic heparinized saline flush (20\\u201350 mL). \",\"If still occluded, instill tPA (8 mL of 1 mg\\/mL, dwell 1\\u20132 h) or urokinase 5000 U in 40 mL NS (~1 h), then aspirate\\/flush.  \",\"On restoration, add heparin 500 U\\/L to dialysate for subsequent exchanges. \",\"If malpositioned\\/wrapped, attempt fluoroscopic manipulation; if unsuccessful or recurrent, proceed to laparoscopic revision or replacement.  \",\"Remove catheter in ISPD-defined scenarios (refractory\\/fungal peritonitis, loculations, persistent malfunction). \"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83d\\udca1 <strong>Constipation-first heuristic:<\\/strong> treat before invasive steps. \",\"\\ud83d\\udca1 <strong>Pelvic tip principle:<\\/strong> pelvic location minimizes malfunction; confirm radiographically. \",\"\\ud83d\\udca1 <strong>Fibrin physiology:<\\/strong> inflammation\\/bleeding increases fibrin load; heparin mitigates catheter clotting. \"],\"TEACHING_MISTAKES_LI\":[\"\\ud83d\\udeab <strong>Attributing all no-flow to fibrin<\\/strong> without excluding constipation\\/bladder issues. \",\"\\ud83d\\udeab <strong>Skipping imaging<\\/strong> before manipulation\\u2014missed migration\\/wrap. \",\"\\ud83d\\udeab <strong>Not heparinizing dialysate post-clearance<\\/strong> leading to early re-occlusion. \"],\"ASCII_FLOWCHART_PRE\":\"PD NO-OUTFLOW (AFTER CONSTIPATION TREATED)\\n|\\n+--> Check clamps\\/lines\\/kinks --> OK? --no--> Fix & retry drain\\n|\\n+--> Bladder scan --> Distended? --yes--> Decompress --> retry\\n|\\n+--> AP ABD X-RAY (tip pelvic?)\\n      |\\n      +--no--> Fluoro wire\\/stylet or Fogarty --> success? yes--> continue; no--> lap revision\\/replacement\\n      |\\n      +--yes--> Aseptic heparinized saline flush (20-50 mL)\\n                 |\\n                 +--success--> Add heparin 500 U\\/L x several cycles\\n                 |\\n                 +--fail--> tPA 8 mL (1 mg\\/mL) dwell 1-2 h OR urokinase 5000 U\\/40 mL ~1 h\\n                            |\\n                            +--success--> Heparinize dialysate; monitor\\n                            |\\n                            +--fail--> Escalate to manipulation or surgery\\n\\n* If cloudy\\/pain: sample effluent; ISPD empiric antibiotics.\\n\",\"EVIDENCE_STUDIES_LI\":[\"ISPD Peritonitis Guideline 2016\\/2022 updates (sampling before empiric therapy; indications for removal). \",\"Fluoroscopic\\/surgical approaches for migration\\/omental wrap with limited reposition success; favor laparoscopy when needed.  \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"\\u2705 <strong>Add IP heparin<\\/strong> (\\u2248500 U\\/L) during peritonitis\\/hemoperitoneum and after fibrin clearance to prevent re-occlusion.  \",\"\\u2705 <strong>Use tPA\\/urokinase dwell<\\/strong> for suspected fibrin plug before invasive manipulation.  \",\"\\u2705 <strong>Remove catheter<\\/strong> for refractory\\/fungal peritonitis or unresolved mechanical failure. \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD Peritonitis Recommendations (2016, 2022 update)\\u2014diagnosis, empiric therapy, and catheter removal criteria. \",\"Clinical Handbook of Nephrology\\u2014PD malfunction evaluation & tPA protocol; post-clearance heparinization.  \",\"Comprehensive Clinical Nephrology\\u2014urokinase\\/tPA alternatives; manipulation and surgical strategies.  \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#pearls\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'pearls\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>\\u2705 <strong>Patient maneuvers:<\\/strong> gentle ambulation, side-lying, and knee-chest can improve drainage (adjunct to <em>Assessment & conservative management<\\/em>).<\\/li>\\n          <li>\\u2705 <strong>Medication review:<\\/strong> reduce constipating drugs (opioids, anticholinergics) to prevent recurrence (see: <em>IMMEDIATE_PRIORITIES_LI<\\/em>).<\\/li>\\n          <li>\\u2705 <strong>Dry-day APD sampling:<\\/strong> instill 1 L, dwell 1\\u20132 h, then sample if peritonitis suspected (see: <em>CASE_SCENARIOS_HTML<\\/em>).<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#edge\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'edge\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>\\ud83e\\uddd2 <strong>Pediatrics:<\\/strong> consider smaller thrombolytic volumes; consult local pediatric PD protocols.<\\/li>\\n          <li>\\ud83e\\udd30 <strong>Pregnancy:<\\/strong> favor conservative measures and prompt imaging to avoid prolonged no-flow.<\\/li>\\n          <li>\\ud83e\\udec0 <strong>Post-cardiac surgery<\\/strong> or coagulopathy: weigh bleeding risk before thrombolytic dwell; consider lower dose\\/shorter dwell.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#dosing\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'dosing\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>\\ud83d\\udc8a <strong>tPA dwell:<\\/strong> institutional caps may apply (e.g., max 2\\u20134 mg total in adults); monitor for bleeding.<\\/li>\\n          <li>\\ud83d\\udc8a <strong>Heparin:<\\/strong> avoid systemic anticoagulation assumptions\\u2014IP heparin at 500 U\\/L does not change systemic coagulation. (See: <em>TOPIC_BLOCK_A_TITLE<\\/em>.)<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#local\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'local\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>\\ud83d\\udcde <strong>Escalation pathway:<\\/strong> ensure on-call interventional radiology and general surgery availability for salvage\\/revision.<\\/li>\\n          <li>\\ud83c\\udfe5 <strong>Competency list:<\\/strong> designate PD nurses authorized for heparinized flush and thrombolytic dwell.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#schema\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'schema\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>\\u2795 Add key: <code>THROMBOLYTIC_PROTOCOLS_TABLE_HTML<\\/code> to standardize local tPA\\/urokinase recipes.<\\/li>\\n          <li>\\u2795 Add key: <code>PD_ACCESS_SERVICE_CONTACTS<\\/code> for rapid salvage coordination.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"Troubleshooting algorithm\",\"Fibrin-related obstruction\",\"When to escalate\\/remove catheter\"],\"section_counts\":{\"immediate_priorities\":5,\"investigations\":5,\"viva_items\":12,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(11, NULL, 3, 1, 1, 'pd-catheter-problems', 'Peritoneal dialysis (PD) catheter problems', 'Catheter flow dysfunction • Exit-site/tunnel infection & peritonitis • Leaks, hernias & hydrothorax', 'published', 'A quick, viva-level guide to recognizing and managing common PD catheter problems—mechanical flow failure, infections (exit-site, tunnel, peritonitis), and dialysate leaks—with practical bedside steps, when to escalate, and prevention pearls aligned with ISPD/KDIGO-style practice. Start with stabilization, collect effluent early if peritonitis is suspected, troubleshoot systematically, and involve interventional/surgical colleagues when conservative measures fail.  ', '{\"slug\":\"pd-catheter-problems\",\"TOPIC\":\"Peritoneal dialysis (PD) catheter problems\",\"CHIP_1\":\"Catheter flow dysfunction\",\"CHIP_2\":\"Exit-site\\/tunnel infection & peritonitis\",\"CHIP_3\":\"Leaks, hernias & hydrothorax\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A quick, viva-level guide to recognizing and managing common PD catheter problems\\u2014mechanical flow failure, infections (exit-site, tunnel, peritonitis), and dialysate leaks\\u2014with practical bedside steps, when to escalate, and prevention pearls aligned with ISPD\\/KDIGO-style practice. Start with stabilization, collect effluent early if peritonitis is suspected, troubleshoot systematically, and involve interventional\\/surgical colleagues when conservative measures fail.  \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Screen for sepsis\\/peritonitis:<\\/strong> If abdominal pain or cloudy effluent, drain after a <strong>minimum 2-hour dwell<\\/strong>, send cell count\\/differential, Gram stain, and cultures; start empiric IP antibiotics covering Gram-positive and Gram-negative organisms without delay. \",\"\\ud83e\\uddea <strong>Effluent thresholds:<\\/strong> WBC count <span class=\'hl-symbol\'>><\\/span>100\\/\\u03bcL with PMN <span class=\'hl-symbol\'>><\\/span>50% supports peritonitis (in APD dry-day samples, PMN percentage is more informative). \",\"\\ud83d\\udc8a <strong>Fungal red flag:<\\/strong> Suspected\\/confirmed fungal peritonitis \\u2192 <strong>immediate catheter removal<\\/strong> and systemic antifungals. \",\"\\ud83d\\udd0e <strong>Rule out simple mechanical causes first:<\\/strong> Constipation, clamp closed, bladder distension, kinking, fibrin\\/clot. Treat constipation promptly; add heparin if fibrin present.  \",\"\\ud83e\\uded7 <strong>Leak\\/hernia suspicion:<\\/strong> Reduce\\/hold intraperitoneal volumes, prefer supine APD, and consider temporary HD if needed.  \",\"\\ud83e\\udded <strong>Know when to remove the catheter:<\\/strong> Refractory peritonitis = failure of effluent to clear after 5 days of appropriate antibiotics; reinsert only after complete resolution and a <strong>~2-week holiday<\\/strong>. \"],\"DDX_BUCKET_1_TITLE\":\"Infectious problems\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Exit-site infection: erythema, crusting, tenderness; often needs topical and\\/or systemic antibiotics. \",\"Tunnel infection: pain, induration along tunnel; consider ultrasound; empiric cover for <em>S. aureus<\\/em> (cefalexin if no MRSA risk; use vancomycin\\/linezolid if MRSA; add ciprofloxacin if Pseudomonas risk). \",\"Peritonitis: abdominal pain, cloudy effluent; test after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; start empiric IP antibiotics promptly. \",\"Fungal peritonitis: consider in relapsing\\/antibiotic-refractory cases; <strong>remove catheter<\\/strong> and start systemic antifungals. \"],\"DDX_BUCKET_2_TITLE\":\"Mechanical\\/flow problems\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Constipation (most common cause of outflow failure); treat aggressively.  \",\"Fibrin\\/clot in lumen; add heparin 500 U\\/L to each bag; consider tPA dwell if flushing fails.  \",\"Tip migration, kinking, omental wrap, adhesions; confirm with plain film\\/CT and consider fluoroscopic\\/laparoscopic salvage.  \",\"External factors: closed clamp, bladder distension compressing catheter. \"],\"DDX_BUCKET_3_TITLE\":\"Pressure\\/leak\\/hernia & other\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Pericatheter\\/abdominal wall leak (early\\/late); rest from CAPD 1\\u20133 weeks; switch to APD\\/CCPD or temporary HD. \",\"Genital\\/scrotal edema (inguinal hernia or patent processus vaginalis); reduce volumes, surgical evaluation if persistent. \",\"Pleuroperitoneal leak (hydrothorax): right-sided effusion; stop CAPD, low-volume APD; confirm with peritoneal scintigraphy\\/CT peritoneogram. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-3 rounded-3 shadow-sm\'><h6>PD catheter problems \\u2013 quick actions<\\/h6><ul class=\'mb-2\'><li><strong>Suspected peritonitis:<\\/strong> Drain after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell \\u2192 send cell count\\/differential, Gram, cultures in blood culture bottles \\u2192 start empiric IP antibiotics (Gram+ and Gram\\u2212). <\\/li><li><strong>Blocked catheter:<\\/strong> Check clamp\\/position; treat constipation; gentle heparinized saline flush; if no flow, consider tPA dwell (e.g., 1 mg\\/mL, 8 mL, 1\\u20132 h) then flush; add heparin 500 U\\/L to bags if fibrin.  <\\/li><li><strong>Leak\\/hernia:<\\/strong> Reduce intraperitoneal volume, use supine APD; rest CAPD 1\\u20133 weeks; consider temporary HD. <\\/li><li><strong>Fungal peritonitis:<\\/strong> Remove catheter promptly; start systemic antifungals. <\\/li><\\/ul><div class=\'small text-muted\'>Prevention: systemic prophylactic antibiotic before insertion; topical exit-site antibiotic routinely. <\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Effluent analysis:<\\/strong> cell count with differential, Gram stain, and culture (blood culture bottles). \",\"\\ud83e\\uddea <strong>Interpretation tips:<\\/strong> WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u03bcL with PMN <span class=\'hl-symbol\'>><\\/span>50% supports peritonitis; in APD dry-day sampling, rely on PMN percentage. \",\"\\ud83d\\uddbc\\ufe0f <strong>Imaging for malfunction:<\\/strong> Abdominal plain film (radiopaque stripe) for position\\/kink; CT if uncertain. \",\"\\ud83e\\uded7 <strong>Leak workup:<\\/strong> Clinical exam; glucose test of leaking fluid; consider CT peritoneogram\\/peritoneal scintigraphy. \",\"\\ud83e\\ude7b <strong>Tunnel assessment:<\\/strong> Ultrasound to detect occult tunnel infection\\/collections. \",\"\\ud83e\\uddf4 <strong>Response tracking:<\\/strong> Daily effluent clarity and WBC trend to judge therapy; \'refractory\' if effluent fails to clear by day 5. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'accordion\' id=\'algo\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#alg1\'>Suspected PD peritonitis (unstable or severe pain)<\\/button><\\/h2><div id=\'alg1\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ol class=\'mb-2\'><li><strong>Stabilize:<\\/strong> IV access, vitals, analgesia, fluid resuscitation, lactate; broad labs.<\\/li><li><strong>Effluent:<\\/strong> Drain after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; send cell count\\/diff, Gram, cultures (blood culture bottles). Start empiric IP antibiotics immediately. <\\/li><li><strong>Fungal suspected:<\\/strong> Arrange <strong>immediate catheter removal<\\/strong>; start systemic antifungals. <\\/li><li><strong>Reassess at 48\\u201372 h:<\\/strong> Narrow therapy per culture; if no clearing by day 5 \\u2192 treat as refractory; plan removal and re-insertion after resolution (<span class=\'hl-symbol\'>>=<\\/span>2 weeks). <\\/li><\\/ol><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#alg2\'>Complete outflow failure with metabolic emergency (e.g., hyperkalemia)<\\/button><\\/h2><div id=\'alg2\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ol class=\'mb-2\'><li><strong>Exclude simple causes:<\\/strong> Clamp closed, catheter kink, constipation, bladder distension. <\\/li><li><strong>Attempt flush:<\\/strong> Aseptic heparinized saline flush; consider tPA dwell if persistent fibrin blockage; add heparin to bags after patency restored.  <\\/li><li><strong>If not rapidly correctable:<\\/strong> Bridge with urgent HD\\/CRRT to treat the emergency; continue PD troubleshooting in parallel. (General practice)<\\/li><\\/ol><\\/div><\\/div><\\/div><\\/div>\",\"PILLAR_1\":\"Stabilize, identify cause\",\"STEP_1_TITLE\":\"Recognize red flags & start empiric therapy early\",\"STEP_1_LI\":[\"Cloudy effluent or severe pain \\u2192 collect effluent after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell and start empiric IP antibiotics. \",\"If fungal organism suspected\\/isolated \\u2192 <strong>remove catheter<\\/strong> and use systemic antifungals. \",\"Track response; \'refractory\' if no clearing by day 5 of appropriate therapy. \"],\"STEP_2_TITLE\":\"Focused bedside troubleshooting\",\"STEP_2_LI\":[\"Check patient position and clamps; inspect exit\\/tunnel.\",\"Treat constipation empirically; it is the <strong>most common<\\/strong> cause of outflow failure. \",\"If fibrin present: add heparin 500 U\\/L to each bag; consider tPA dwell when flushing fails.  \",\"Imaging if persistent failure: abdominal X-ray for tip\\/kink; CT if needed. \"],\"PILLAR_2\":\"Fix the catheter & prevent recurrence\",\"STEP_3_TITLE\":\"Interventional\\/surgical options\",\"STEP_3_LI\":[\"Fluoroscopic manipulation\\/guidewire repositioning for tip migration or fibrin cast (local protocols).\",\"Laparoscopic salvage to remove omental wrap\\/adhesions; advanced laparoscopy reduces mechanical complications versus open\\/basic techniques. \",\"Plan catheter re-insertion after infection resolution with a holiday of ~2 weeks if removed. \"],\"STEP_4_TITLE\":\"Prevention bundle\",\"STEP_4_LI\":[\"Systemic prophylactic antibiotic immediately prior to catheter insertion; routine topical exit-site antibiotic. \",\"Standardize exit-site care and constipation prophylaxis; educate on early reporting of flow\\/pain issues. \",\"Use low volumes\\/supine APD for early use to reduce leak risk. \"],\"TOPIC_BLOCK_A_TITLE\":\"Troubleshooting flow failure (stepwise)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Confirm true obstruction:<\\/strong> Define outflow failure as inability to drain within ~45 min; note preceding sluggishness. \",\"\\ud83d\\udebd <strong>Relieve constipation first:<\\/strong> Oral laxatives\\/enema; maintain regular bowel habit thereafter. \",\"\\ud83e\\uddea <strong>Treat fibrin:<\\/strong> Heparin 500 U\\/L to each bag; tPA dwell (e.g., 8 mL of 1 mg\\/mL for 1\\u20132 h) if persistent.  \",\"\\ud83d\\uddbc\\ufe0f <strong>Localize tip\\/kink:<\\/strong> Plain film (radiopaque stripe) or CT; consider fluoroscopic\\/laparoscopic correction. \"],\"TOPIC_BLOCK_B_TITLE\":\"Exit-site\\/tunnel infection & peritonitis\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83e\\uddf4 <strong>Prevention:<\\/strong> Systemic prophylactic antibiotic at insertion; topical exit-site antibiotic ongoing. \",\"\\ud83e\\uddea <strong>Diagnose peritonitis:<\\/strong> Effluent WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u03bcL with PMN <span class=\'hl-symbol\'>><\\/span>50% (APD dry-day: rely on PMN %); culture negativity should be <span class=\'hl-symbol\'><<\\/span>20% of episodes.  \",\"\\ud83d\\udc8a <strong>Empiric therapy:<\\/strong> Start IP antibiotics covering Gram+ and Gram\\u2212 after sampling; de-escalate per cultures. \",\"\\ud83c\\udf44 <strong>Fungal peritonitis:<\\/strong> Remove catheter and treat systemically (e.g., azoles\\/echinocandin per organism). \",\"\\ud83d\\udd01 <strong>Refractory case:<\\/strong> If no clearing by day 5, plan catheter removal; reinsert after full clinical\\/lab resolution with ~2-week gap. \"],\"TOPIC_BLOCK_C_TITLE\":\"Leaks, hernias & hydrothorax\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\uded7 <strong>Dialysate leaks:<\\/strong> Early or late; rest CAPD 1\\u20133 weeks; switch to APD\\/CCPD or temporary HD during rest. \",\"\\ud83d\\udecf\\ufe0f <strong>Early use strategy:<\\/strong> Low volumes in supine position for first 1\\u20132 weeks reduces leak risk. \",\"\\ud83e\\ude7a <strong>Hernias\\/genital edema:<\\/strong> Reduce fill volumes; surgical review if persistent. (Standard practice)\",\"\\ud83c\\udf2c\\ufe0f <strong>Pleuroperitoneal leak (hydrothorax):<\\/strong> Stop CAPD; low volume APD; confirm with imaging; consider pleurodesis\\/repair if needed. \"],\"QUALITY_PROCESS_LI\":[\"\\ud83e\\udded <strong>Effluent sampling-to-antibiotic time:<\\/strong> median <span class=\'hl-symbol\'><<\\/span>2 h for suspected peritonitis.\",\"\\ud83e\\uddf4 <strong>Prophylaxis adherence:<\\/strong> Document systemic pre-insertion antibiotic and ongoing topical exit-site antibiotic. \",\"\\ud83d\\udcc8 <strong>Constipation protocol:<\\/strong> Bowel regimen embedded in PD pathway; laxatives supplied.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Peritonitis rate:<\\/strong> target <span class=\'hl-symbol\'><<\\/span>0.5 episodes\\/patient-year (local benchmark).\",\"\\ud83e\\uddea <strong>Culture-negative peritonitis:<\\/strong> <span class=\'hl-symbol\'><<\\/span>20% of episodes. \",\"\\ud83d\\udd04 <strong>Catheter survival:<\\/strong> 1-year survival optimized with advanced laparoscopic techniques. \"],\"QUALITY_SAFETY_LI\":[\"\\ud83d\\uded1 <strong>Fungal peritonitis escalation:<\\/strong> Immediate catheter removal and antifungals; do not delay. \",\"\\ud83e\\uddea <strong>Sampling before antibiotics:<\\/strong> Whenever feasible without delaying therapy in unstable patients. \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f Avoid IP amphotericin when possible due to chemical peritonitis risk; prefer systemic therapy and catheter removal for fungal cases. \",\"COMMUNICATION_LI\":\"Use teach-back: show patients how to recognize cloudy effluent, check clamps\\/position, and follow the constipation regimen; provide a one-page action plan and on-call number.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'cases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Cloudy effluent with severe abdominal pain overnight<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse show\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>Action:<\\/strong> Drain after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; send cell count\\/diff, Gram, cultures; start empiric IP antibiotics. <\\/li>\\n        <li><strong>Target:<\\/strong> WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u03bcL with PMN <span class=\'hl-symbol\'>><\\/span>50% supports peritonitis. <\\/li>\\n        <li><strong>Reassess:<\\/strong> No clearing by day 5 \\u2192 plan removal. <\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Sudden outflow failure on CAPD<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>Check basics:<\\/strong> Clamp, kinks, position; assess for constipation\\/bladder distension. <\\/li>\\n        <li><strong>Flush:<\\/strong> Aseptic heparinized saline; if fibrin suspected, add heparin 500 U\\/L to PD bags; consider tPA dwell if flush fails.  <\\/li>\\n        <li><strong>Image:<\\/strong> X-ray for tip\\/kink; escalate to CT\\/fluoroscopy if unresolved. <\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Pericatheter swelling & falling UF volumes<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <ul>\\n        <li><strong>Dx:<\\/strong> Dialysate leak.<\\/li>\\n        <li><strong>Plan:<\\/strong> Rest CAPD for 1\\u20133 weeks; switch to APD\\/CCPD or temporary HD during rest; avoid daytime exchanges on APD. <\\/li>\\n        <li><strong>Prevention:<\\/strong> Use low volumes, supine position early after insertion. <\\/li>\\n      <\\/ul>\\n    <\\/div><\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c4\'>Recurrent mechanical dysfunction despite flushes<\\/button><\\/h2>\\n    <div id=\'c4\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'>\\n      <p><strong>Consider laparoscopic salvage<\\/strong> (adhesiolysis\\/omentopexy). Advanced laparoscopy lowers obstruction\\/migration\\/leak and hernia rates compared with open\\/basic techniques; consider re-site if persistent. <\\/p>\\n    <\\/div><\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the most common cause of PD outflow failure?\",\"a\":\"Constipation; treat empirically and maintain a bowel regimen. \"},{\"q\":\"How do you define refractory PD peritonitis?\",\"a\":\"Failure of effluent to clear after 5 days of appropriate antibiotics; plan catheter removal. \"},{\"q\":\"Initial steps when peritonitis is suspected?\",\"a\":\"After a \\u22652 h dwell, send effluent for cell count\\/diff, Gram, cultures, and start empiric IP antibiotics. \"},{\"q\":\"How do you handle fibrin-related catheter blockage?\",\"a\":\"Add heparin 500 U\\/L to each bag; if persistent, instill tPA (e.g., 8 mL of 1 mg\\/mL) for 1\\u20132 h then flush.  \"},{\"q\":\"When should a PD catheter be removed urgently?\",\"a\":\"Fungal peritonitis, refractory bacterial peritonitis, severe tunnel infection or mechanical failure not salvageable.  \"},{\"q\":\"Best imaging to check catheter position?\",\"a\":\"Abdominal X-ray (radiopaque stripe); CT if uncertainty persists. \"},{\"q\":\"What pre-insertion prophylaxis reduces early peritonitis?\",\"a\":\"A single systemic antibiotic dose immediately before catheter insertion; continue topical exit-site antibiotics. \"},{\"q\":\"Key diagnostic threshold for peritonitis in CAPD?\",\"a\":\"Effluent WBC >100\\/\\u03bcL with PMN >50%. \"},{\"q\":\"How do you manage a dialysate leak 2 months into CAPD?\",\"a\":\"Rest CAPD 1\\u20133 weeks and switch to APD\\/CCPD or temporary HD during rest. \"},{\"q\":\"What surgical approach lowers mechanical complications?\",\"a\":\"Advanced laparoscopic catheter techniques (e.g., omentopexy\\/adhesiolysis) reduce obstruction, migration, leaks, and hernias. \"},{\"q\":\"What proportion of culture-negative peritonitis is acceptable?\",\"a\":\"Less than 20% of peritonitis episodes. \"}],\"PITFALLS_LI\":[\"Delaying empiric antibiotics while waiting for results in a clinically septic patient. \",\"Treating outflow failure without addressing constipation first. \",\"Continuing PD in fungal peritonitis instead of urgent catheter removal. \",\"Overfilling early post-op leading to leaks; avoid high volumes and keep supine. \"],\"ANSWER_STEPS_OL\":[\"Assess stability; manage airway\\/breathing\\/circulation; analgesia.\",\"If peritonitis suspected: after a \\u22652 h dwell, send effluent for cell count\\/diff, Gram, and culture; start empiric IP antibiotics. \",\"Check for simple mechanical causes: clamps, position, constipation, bladder distension. \",\"Flush gently with heparinized saline; if fibrin suspected, add heparin 500 U\\/L to bags; consider tPA dwell if persistent.  \",\"Image catheter if unresolved: X-ray for tip\\/kink; CT if needed; consider fluoroscopic\\/laparoscopic correction. \",\"For leaks\\/hernia: reduce\\/hold volumes; rest CAPD; use supine APD; surgical referral if persistent. \",\"Escalate: refractory peritonitis by day 5 or fungal \\u2192 remove catheter; plan re-insertion after full resolution (~2 weeks). \"],\"TEACHING_CONCEPTS_LI\":[\"Sieve vs pore physiology: sodium sieving early in high-glucose dwells via aquaporin-1 (ultrasmall pores). \",\"Technique failure often stems from UF insufficiency and inadequate solute clearance\\u2014optimize prescription and membrane use. \",\"Culture-negative peritonitis should be uncommon with proper culture technique. \"],\"TEACHING_MISTAKES_LI\":[\"Assuming all cloudy effluent is infection without ruling out fibrin (send sample; add heparin if fibrin). \",\"Ignoring exit-site care and pre-insertion prophylaxis, increasing early peritonitis risk. \",\"Persisting with high volumes early post-insertion, precipitating dialysate leaks. \"],\"ASCII_FLOWCHART_PRE\":\"PD FLOW\\/INFECTION TROUBLESHOOT\\n\\nStart --> Pain\\/cloudy effluent? --> Yes --> Dwell >=2h then sample (cell count\\/diff, Gram, cultures) --> Start empiric IP ABx --> Fungal? --> Yes --> REMOVE CATHETER --> Treat systemically --> Reinsert after ~2 weeks.\\n                                    |\\n                                    No --> Proceed to flow check\\n\\nFlow problem? --> Yes --> Basics: clamp open? patient supine? constipation? bladder distension? --> Fix --> Flow OK?\\n                                                                                                       |\\n                                                                                                      No --> Heparinized flush --> Fibrin suspected? --> Yes --> Add heparin 500 U\\/L to bags +\\/- tPA dwell (1-2h) --> Flow OK?\\n                                                                                                                                                                        |\\n                                                                                                                                                                       No --> X-ray +\\/- CT --> Migration\\/kink\\/omentum? --> Fluoro\\/laparoscopic correction --> If not salvageable --> Temporary HD and plan re-site.\\n\\nLeak\\/hernia suspected? --> Reduce volume; supine APD; rest CAPD 1-3 weeks --> Persistent? --> Surgical review.\\n\\nEnd.\",\"EVIDENCE_STUDIES_LI\":[\"Advanced laparoscopic insertion lowers obstruction, migration, leaks, and hernias vs open\\/basic techniques; better 1\\u20132 yr catheter survival. \",\"Heparin 500 U\\/L mitigates fibrin-related flow restriction; tPA dwell can restore patency when flushing fails.  \",\"Resting CAPD with switch to APD\\/CCPD for dialysate leaks improves outcomes. \",\"Refractory peritonitis definition (day 5 non-clearance) and re-insertion timing guidance. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Start empiric IP antibiotics immediately after proper sampling when peritonitis is suspected; do not delay. \",\"Remove the PD catheter for fungal peritonitis and treat with systemic antifungals. \",\"Adopt pre-insertion systemic antibiotic and routine topical exit-site antibiotic to prevent early infections. \",\"Embed a constipation protocol in PD programs to prevent outflow failure. \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD 2022 update on prevention and treatment of peritonitis\\u2014sampling after \\u22652 h dwell; empiric Gram+\\/Gram\\u2212 coverage. \",\"ISPD 2017 catheter-related infection recommendations\\u2014empiric agents for tunnel\\/exit-site infection. \",\"Clinical Handbook (2024): refractory peritonitis day-5 definition; catheter removal\\/re-insertion timing. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'12\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra1\'>Unmapped pearls<\\/button><\\/h2><div id=\'extra1\' class=\'accordion-collapse collapse show\'><div class=\'accordion-body\'><ul class=\'mb-0\'><li><strong>Culture technique:<\\/strong> Use blood culture bottles for higher yield; keep culture-negative rate <span class=\'hl-symbol\'><<\\/span>20%. See: <em>TOPIC_BLOCK_B_TITLE<\\/em>. <\\/li><li><strong>Early post-op use:<\\/strong> Start with 1 L fills, supine, avoid ambulation with fluid in abdomen for ~2 weeks. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li><li><strong>Positioning tip:<\\/strong> Lateral decubitus can sometimes improve drainage during troubleshooting (local practice).<\\/li><li><strong>Two-way obstruction clue:<\\/strong> Fibrin\\/clot may cause inflow and outflow issues. See: <em>TOPIC_BLOCK_A_TITLE<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'extra2\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ul class=\'mb-0\'><li><strong>Pregnancy:<\\/strong> Favor low-volume, high-frequency exchanges; watch for leaks\\/hernia exacerbation.<\\/li><li><strong>Transplant candidates:<\\/strong> Aggressive infection prevention to preserve peritoneum.<\\/li><li><strong>Pediatrics:<\\/strong> Higher leak risk with large volumes\\u2014start conservatively.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'extra3\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ul class=\'mb-0\'><li><strong>Antifungals:<\\/strong> Use systemic azoles\\/echinocandins; dosing per renal\\/hepatic function and interactions. See: <em>TOPIC_BLOCK_B_TITLE<\\/em>. <\\/li><li><strong>IP drug stability:<\\/strong> Verify compatibility before adding to dialysate (local formulary).<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'extra4\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ul class=\'mb-0\'><li><strong>Escalation triggers:<\\/strong> No effluent clearing by day 5 or fungal growth \\u2192 mandatory MDT review for catheter removal. See: <em>IMMEDIATE_PRIORITIES_LI<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'extra5\' class=\'accordion-collapse collapse\'><div class=\'accordion-body\'><ul class=\'mb-0\'><li><strong>Catheter insertion technique field:<\\/strong> Open vs basic\\/advanced laparoscopy (with adjuncts). <\\/li><li><strong>Leak risk mitigation field:<\\/strong> Early-use volumes\\/position protocol. <\\/li><\\/ul><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"Catheter flow dysfunction\",\"Exit-site\\/tunnel infection & peritonitis\",\"Leaks, hernias & hydrothorax\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":6,\"viva_items\":11,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(12, NULL, 3, 1, 1, 'pd-fluid-overload', 'Peritoneal dialysis patient with volume overload: assessment and management', 'PD hypervolemia • Ultrafiltration (UF) failure • Icodextrin & 4.25% dextrose', 'published', 'Essence: In a peritoneal dialysis (PD) patient with fluid overload, stabilize the airway and circulation, confirm true hypervolemia, then rapidly identify the cause (nonadherence, UF failure, peritonitis, mechanical issues, or cardiac disease). Adjust the PD prescription for rapid UF (short dwells with higher dextrose; long dwell with icodextrin), treat precipitating factors (e.g., constipation, infection), and escalate to temporary hemodialysis if there is refractory pulmonary edema or life-threatening instability.   ', '{\"slug\":\"pd-fluid-overload\",\"TOPIC\":\"Peritoneal dialysis patient with volume overload: assessment and management\",\"CHIP_1\":\"PD hypervolemia\",\"CHIP_2\":\"Ultrafiltration (UF) failure\",\"CHIP_3\":\"Icodextrin & 4.25% dextrose\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Essence:<\\/strong> In a peritoneal dialysis (PD) patient with fluid overload, stabilize the airway and circulation, confirm true hypervolemia, then rapidly identify the cause (nonadherence, UF failure, peritonitis, mechanical issues, or cardiac disease). Adjust the PD prescription for rapid UF (short dwells with higher dextrose; long dwell with icodextrin), treat precipitating factors (e.g., constipation, infection), and escalate to temporary hemodialysis if there is refractory pulmonary edema or life-threatening instability.   <\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Stabilize:<\\/strong> Assess airway, breathing, circulation; give oxygen; upright position; consider noninvasive ventilation for pulmonary edema.\",\"\\u26a0\\ufe0f <strong>Identify red flags:<\\/strong> Hypoxia, severe hypertension, chest pain, altered mentation, oliguria\\/anuria, K+ derangements, severe acidosis.\",\"\\u26a0\\ufe0f <strong>When to escalate:<\\/strong> If pulmonary edema or fluid overload is <span class=\'hl-symbol\'>>=<\\/span> moderate and refractory to PD measures, arrange urgent hemodialysis\\/UF. \",\"\\ud83e\\uddea <strong>Quick checks:<\\/strong> Weight change, BP, JVP, lung exam, edema, PD effluent appearance; check cycler logs, last exchanges, and bag strengths.\",\"\\ud83e\\uddea <strong>Lab panel:<\\/strong> Electrolytes, urea\\/Cr, glucose, ABG if hypoxic, BNP if CHF suspected; PD effluent cell count\\/Gram if cloudy. \",\"\\ud83d\\udcac <strong>Immediate counseling:<\\/strong> Restrict sodium (typically ~2 g\\/day) and fluids; review adherence to exchange schedule and bag strengths. \"],\"DDX_BUCKET_1_TITLE\":\"Dialysis-related causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Nonadherence:<\\/strong> Excess Na+\\/fluid intake, skipped exchanges, incorrect bag strengths or dwell times. \",\"\\ud83d\\udd0e <strong>UF failure\\u2014membrane issue:<\\/strong> Fast transporter or aquaporin dysfunction; confirm with PET (4.25% dextrose). UF failure suspected if 4-h PET UF <span class=\'hl-symbol\'><<\\/span>400 mL (4.25%) or <span class=\'hl-symbol\'><<\\/span>100 mL (2.5%). \",\"\\ud83d\\udd0e <strong>Peritonitis:<\\/strong> Inflammation reduces UF; look for cloudy effluent, abdominal pain; obtain effluent studies promptly. \",\"\\ud83d\\udd0e <strong>Mechanical problems:<\\/strong> Catheter outflow failure (constipation most common), kinking, omental wrapping, fibrin clot, malposition. \"],\"DDX_BUCKET_2_TITLE\":\"Non\\u2013dialysis-related contributors\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Cardiorenal factors:<\\/strong> New or decompensated heart failure raising venous pressures; assess clinically and consider ECHO. \",\"\\ud83d\\udd0e <strong>Fluid leaks\\/third spacing:<\\/strong> Pleuroperitoneal leak (hydrothorax), abdominal wall\\/inguinal leaks (rapid weight gain with poor UF).\",\"\\ud83d\\udd0e <strong>Hypoalbuminemia\\/malnutrition:<\\/strong> Low oncotic pressure worsening edema; optimize nutrition and dialytic dose. \"],\"DDX_BUCKET_3_TITLE\":\"Iatrogenic\\/metabolic factors\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Hyperglycemia\\/insulin:<\\/strong> Glucose-based dialysate may worsen glycemic control and weight; consider glucose-sparing strategies. \",\"\\ud83d\\udd0e <strong>Sodium sieving:<\\/strong> Early Na+ dip with hypertonic dextrose can raise plasma Na+ and BP; interpret UF and BP accordingly. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'><div class=\'row\'><div class=\'col\'><strong>Dialysate choices (typical UF in 60 min\\/2 L)<\\/strong><br><ul class=\'mb-1\'><li>1.5% dextrose: ~40\\u2013150 mL<\\/li><li>2.5% dextrose: ~100\\u2013300 mL<\\/li><li>4.25% dextrose: ~300\\u2013400 mL<\\/li><\\/ul><small>Use short dwells to maximize osmotic gradient; monitor glucose and BP. <\\/small><\\/div><div class=\'col\'><strong>Composition snapshot<\\/strong><br><small>Typical dextrose solutions: Na+ ~132 mEq\\/L; osmolarity rises with dextrose concentration. Icodextrin 7.5% is iso-osmotic and ideal for long dwell. <\\/small><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Basic panel:<\\/strong> CBC, electrolytes, urea\\/Cr, glucose, albumin; consider BNP and troponin if CHF suspected.\",\"\\ud83e\\uddea <strong>Effluent studies if cloudy\\/pain:<\\/strong> After <span class=\'hl-symbol\'>>=<\\/span>2 h dwell, send cell count\\/diff, Gram stain, culture; start empiric antibiotics per protocol. \",\"\\ud83e\\uddea <strong>Peritoneal Equilibration Test (PET):<\\/strong> Use 4.25% dextrose PET when UF failure suspected to categorize transporter and guide dwell times. \",\"\\ud83e\\uddea <strong>Catheter assessment:<\\/strong> Check outflow\\/inflow, constipation, bladder distension; image for tip position if needed. \",\"\\ud83e\\uddea <strong>Imaging:<\\/strong> CXR for edema\\/pleural effusion; ultrasound IVC\\/lungs if available.\",\"\\ud83e\\uddea <strong>Review device data:<\\/strong> Cycler logs, bag strengths, actual dwell\\/fill volumes, missed exchanges.\"],\"EMERGENCY_ALGORITHM_HTML\":\"<ol class=\'mb-2\'><li><strong>ABC + oxygen<\\/strong> for dyspnea; sit upright; consider NIV if pulmonary edema.<\\/li><li><strong>Confirm hypervolemia<\\/strong> (exam, weight gain, CXR\\/US).<\\/li><li><strong>Start rapid UF via PD<\\/strong>: 2\\u20133 short (1\\u20132 h) exchanges of 2.5\\u20134.25% dextrose using 2\\u20132.5 L fills; reassess after each cycle. <\\/li><li><strong>Add long dwell with icodextrin<\\/strong> (night\\/long day dwell) once stable to maintain net negative balance. <\\/li><li><strong>Troubleshoot<\\/strong>: treat constipation; consider intraperitoneal heparin if fibrin; rule out peritonitis; verify catheter position. <\\/li><li><strong>Address contributors<\\/strong>: sodium restriction, glycemic control; diuretics only if residual urine. <\\/li><li><strong>Escalate to HD\\/UF<\\/strong> if refractory pulmonary edema or instability despite PD optimization. <\\/li><\\/ol>\",\"PILLAR_1\":\"Assess & classify the cause\",\"STEP_1_TITLE\":\"Differentiate type of volume problem\",\"STEP_1_LI\":[\"\\ud83d\\udd0e <strong>True hypervolemia vs. weight misperception:<\\/strong> Corroborate with exam and recent trend.\",\"\\ud83d\\udd0e <strong>Dialysis-related vs. cardiac\\/other:<\\/strong> Screen for missed exchanges, bag strengths, and CHF symptoms.\",\"\\ud83d\\udd0e <strong>Look for PD red flags:<\\/strong> Cloudy effluent, abdominal pain (peritonitis), outflow failure (constipation). \"],\"STEP_2_TITLE\":\"Confirm UF failure and its mechanism\",\"STEP_2_LI\":[\"\\ud83e\\uddea <strong>PET (4.25%):<\\/strong> If net UF on 4-h PET <span class=\'hl-symbol\'><<\\/span>400 mL (4.25%), classify as UF insufficiency and tailor dwells. \",\"\\ud83e\\uddea <strong>Understand sodium sieving:<\\/strong> Early Na+ dip with hypertonic dextrose indicates intact aquaporin water movement; absent dip suggests aquaporin dysfunction. \"],\"PILLAR_2\":\"Treat & prevent recurrence\",\"STEP_3_TITLE\":\"Dialysis prescription maneuvers\",\"STEP_3_LI\":[\"\\u2705 <strong>Short dwells + higher dextrose<\\/strong> (2.5\\u20134.25%) for rapid UF in fast transporters; avoid prolonged hypertonic exposure. \",\"\\u2705 <strong>Use icodextrin<\\/strong> for the longest dwell (overnight\\/daytime) to sustain UF without glucose load; improves technique survival in diabetics.  \",\"\\u2705 <strong>Increase exchange number\\/volume<\\/strong> as needed to meet UF targets. \",\"\\u2705 <strong>Troubleshoot hardware<\\/strong>: relieve constipation, check for kinks\\/migration, consider heparin in dialysate for fibrin. \"],\"STEP_4_TITLE\":\"Medical measures & escalation\",\"STEP_4_LI\":[\"\\ud83d\\udc8a <strong>Sodium restriction<\\/strong> and fluid discipline; reinforce adherence. \",\"\\ud83d\\udc8a <strong>Diuretics<\\/strong> only if residual urine output (loop \\u00b1 thiazide synergy); anuric patients derive no diuretic UF.\",\"\\ud83d\\udc8a <strong>Glycemic control<\\/strong> to mitigate glucose-driven weight gain and hypertension on PD. \",\"\\u26a0\\ufe0f <strong>Switch\\/bridge to HD<\\/strong> for refractory pulmonary edema, uncontrolled hyperkalemia, or severe acidosis. \"],\"TOPIC_BLOCK_A_TITLE\":\"Tailoring PD to transporter type\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83d\\udcc8 <strong>Fast transporter:<\\/strong> Shorter, more frequent dwells with higher dextrose for UF; icodextrin for long dwell to avoid rapid glucose dissipation.  \",\"\\ud83d\\udcc9 <strong>Slow transporter:<\\/strong> Longer dwells (CAPD) may suffice; UF failure due to low surface area is less common. \"],\"TOPIC_BLOCK_B_TITLE\":\"Recognizing and confirming UF failure\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Definition (practical):<\\/strong> Net UF on 4-h PET with 4.25% dextrose <span class=\'hl-symbol\'><<\\/span>400 mL (or with 2.5% <span class=\'hl-symbol\'><<\\/span>100 mL) suggests UF insufficiency. \",\"\\ud83e\\uddea <strong>Next steps:<\\/strong> Re-prescribe based on PET and address reversible causes (peritonitis, leaks, constipation). \",\"\\ud83e\\uddea <strong>Sodium sieving pearls:<\\/strong> Early Na+ dip indicates intact aquaporin; absent dip \\u2192 consider aquaporin dysfunction. \"],\"TOPIC_BLOCK_C_TITLE\":\"PD solutions & UF expectations\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Dextrose strengths:<\\/strong> 1.5% (low UF), 2.5% (moderate UF), 4.25% (high UF) with typical 60-min UF ~40\\u2013150, 100\\u2013300, 300\\u2013400 mL per 2 L, respectively. \",\"\\ud83e\\uddea <strong>Icodextrin (7.5%):<\\/strong> Iso-osmotic colloid; ideal for long dwell UF and may improve technique survival, especially in diabetes. \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udccf <strong>Daily weights & BP logs:<\\/strong> Review at each visit.\",\"\\ud83d\\udccb <strong>Prescription audit:<\\/strong> Cross-check cycler logs, dwell times, and bag strengths monthly.\",\"\\ud83d\\udd01 <strong>PET re-evaluation:<\\/strong> Repeat PET if UF worsens or after major peritonitis. \"],\"QUALITY_OUTCOME_LI\":[\"\\ud83c\\udfaf <strong>Volume targets:<\\/strong> Euvolemia without recurrent pulmonary edema.\",\"\\ud83c\\udfaf <strong>UF adequacy:<\\/strong> Consistent negative balance with acceptable glucose exposure.\",\"\\ud83c\\udfaf <strong>Technique survival:<\\/strong> Maintain on PD where feasible (e.g., icodextrin benefits). \"],\"QUALITY_SAFETY_LI\":[\"\\ud83d\\udee1\\ufe0f <strong>Peritonitis prevention:<\\/strong> Aseptic technique; prompt sampling\\/treatment if cloudy effluent. \",\"\\ud83d\\udee1\\ufe0f <strong>Glycemic & BP safety:<\\/strong> Monitor when using hypertonic dextrose; watch for sodium sieving effects. \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Escalate promptly:<\\/strong> Refractory pulmonary edema or hemodynamic compromise warrants urgent hemodialysis\\/UF per indications. \",\"COMMUNICATION_LI\":\"\\ud83d\\udcac <strong>Shared plan:<\\/strong> Explain the immediate PD changes (bag strengths\\/dwells), sodium restriction, warning signs (cloudy effluent, dyspnea), and when to seek urgent care.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesPDOverload\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Mild edema in CAPD with missed exchanges<\\/button>\\n    <\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDOverload\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Issue:<\\/strong> 2-kg weight gain; admits to skipping one evening exchange.<\\/li>\\n          <li><strong>Action:<\\/strong> 2\\u20133 short exchanges of 2.5% dextrose; reinforce sodium restriction and adherence. <\\/li>\\n          <li><strong>Follow-up:<\\/strong> Review cycler\\/manual logs; schedule PET if recurrent. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>APD fast transporter with edema despite nightly cycles<\\/button>\\n    <\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDOverload\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Issue:<\\/strong> PET shows high transport; net UF poor on long day dwell.<\\/li>\\n          <li><strong>Action:<\\/strong> Shorter nocturnal dwells with higher dextrose; add daytime icodextrin long dwell. <\\/li>\\n          <li><strong>Adjuncts:<\\/strong> Treat constipation to optimize outflow. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Severe dyspnea with pulmonary edema<\\/button>\\n    <\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPDOverload\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Issue:<\\/strong> Hypoxia, crackles, hypertensive emergency.<\\/li>\\n          <li><strong>Action:<\\/strong> Oxygen\\/NIV, rapid PD UF attempts (4.25% short cycles) while arranging urgent HD if no prompt response.  <\\/li>\\n          <li><strong>Aftercare:<\\/strong> Reassess PET and prescription to prevent recurrence. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"List immediate priorities when a PD patient presents with fluid overload.\",\"a\":\"Stabilize ABCs and oxygenate, confirm true hypervolemia, initiate rapid UF via PD (short dwells with higher dextrose), investigate causes, and escalate to HD if refractory pulmonary edema. \"},{\"q\":\"What is practical UF failure on PET?\",\"a\":\"Net UF on 4-h PET with 4.25% dextrose <400 mL (or with 2.5% <100 mL) suggests UF insufficiency needing prescription changes. \"},{\"q\":\"Name three common reversible PD causes of edema.\",\"a\":\"Nonadherence (Na+\\/fluids or exchanges), peritonitis, and catheter outflow failure (constipation\\/kink). \"},{\"q\":\"How does sodium sieving affect interpretation of BP and Na+ early in a hypertonic dwell?\",\"a\":\"Early dialysate Na+ falls (Na+ dip) from aquaporin-driven water flux, which can transiently raise plasma Na+ and BP; absence of a dip suggests aquaporin dysfunction. \"},{\"q\":\"When is icodextrin preferred?\",\"a\":\"For the longest dwell (day or night) to sustain UF in fast transporters or chronic overload; it improves fluid control and technique survival in diabetics. \"},{\"q\":\"Outline a rapid UF PD sequence for moderate overload.\",\"a\":\"2\\u20133 short (1\\u20132 h) exchanges using 2.5\\u20134.25% dextrose, reassessing symptomatic\\/weight response; then transition to icodextrin long dwell.  \"},{\"q\":\"Which diuretic strategy is useful in PD?\",\"a\":\"Use loop diuretics \\u00b1 thiazide synergy only if residual urine output exists; anuric patients do not benefit.\"},{\"q\":\"What are key steps when outflow is sluggish?\",\"a\":\"Aggressively treat constipation, check for bladder distension, verify catheter position, consider heparin in dialysate for fibrin. \"},{\"q\":\"When must you switch to hemodialysis urgently?\",\"a\":\"Refractory pulmonary edema\\/CHF, uncontrolled hyperkalemia, or severe acidosis despite PD optimization. \"},{\"q\":\"What non-dialysis condition commonly masquerades as PD-related volume overload?\",\"a\":\"Decompensated heart failure; confirm clinically and with ECHO as indicated. \"},{\"q\":\"How many exchanges should generally be done to improve UF and nutrition in malnourished PD patients?\",\"a\":\"Increase number\\/volume of exchanges; consider amino acid dialysate selectively alongside icodextrin strategies. \"}],\"PITFALLS_LI\":[\"\\u274c <strong>Overreliance on diuretics in anuria:<\\/strong> Delays definitive UF.\",\"\\u274c <strong>Prolonged 4.25% dextrose dwells:<\\/strong> Risk of hyperglycemia and peritoneal membrane injury; prefer short cycles. \",\"\\u274c <strong>Missing constipation:<\\/strong> Most common cause of outflow failure; always treat. \"],\"ANSWER_STEPS_OL\":[\"Stabilize (oxygen\\/NIV), confirm hypervolemia clinically and with weight\\/CXR.\",\"Start rapid PD UF: 2\\u20133 short exchanges with 2.5\\u20134.25% dextrose (2\\u20132.5 L) and reassess.\",\"Add icodextrin for the long dwell once stable; plan ongoing volume control.\",\"Investigate causes: PET for transporter status\\/UF failure; effluent studies if cloudy; catheter troubleshooting; cardiac assessment.\",\"Enforce sodium restriction and adherence; optimize glycemic control; use diuretics only if residual urine.\",\"Escalate to urgent hemodialysis\\/UF for refractory pulmonary edema or instability.\"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83d\\udcda <strong>Transporter physiology:<\\/strong> Matching dwell time\\/strength to peritoneal transport characteristics. \",\"\\ud83d\\udcda <strong>Colloid vs. crystalloid UF:<\\/strong> Icodextrin sustains UF during long dwells without glucose peaks. \",\"\\ud83d\\udcda <strong>Sodium sieving:<\\/strong> Clinical implications during hypertonic short dwells. \"],\"TEACHING_MISTAKES_LI\":[\"\\u26a0\\ufe0f <strong>Ignoring PET data:<\\/strong> Leads to mismatched dwell times and persistent overload. \",\"\\u26a0\\ufe0f <strong>Not checking for peritonitis:<\\/strong> Treatable cause of sudden UF decline.\",\"\\u26a0\\ufe0f <strong>Delaying escalation:<\\/strong> Persistent hypoxia with edema warrants urgent HD\\/UF. \"],\"ASCII_FLOWCHART_PRE\":\"PD PATIENT WITH OVERLOAD\\n\\n1) ABCs -> O2 -> Upright -> consider NIV\\n2) Confirm hypervolemia (weight, exam, CXR)\\n3) Rapid PD UF:\\n   - 2\\u20133 short dwells (1\\u20132 h) with 2.5% or 4.25% dextrose\\n   - Reassess symptoms\\/weight each cycle\\n4) Add long dwell icodextrin (night\\/day) once stable\\n5) Troubleshoot:\\n   - Check adherence, peritonitis, constipation, catheter position\\n   - PET if UF failure suspected (4.25% PET UF <= 400 mL)\\n6) Contributors: CHF, glycemia -> manage\\n7) If refractory edema\\/instability -> urgent HD\\/UF\",\"EVIDENCE_STUDIES_LI\":[\"\\ud83d\\udcd1 RCTs and trials: Icodextrin improves fluid status and technique survival in PD (Davies 2003; Takatori 2011; Wolfson 2002). \",\"\\ud83d\\udcd1 Observational\\/consensus: Targets for fluid removal and PET-based tailoring; ISPD recommendations for membrane dysfunction evaluation.  \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"\\u2705 Use icodextrin for the longest dwell to sustain UF in chronic overload, especially in fast transporters or diabetes. \",\"\\u2705 Define\\/prioritize UF failure using PET thresholds and re-prescribe accordingly. \",\"\\u2705 Escalate to hemodialysis for refractory pulmonary edema or instability despite optimized PD. \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD recommendations for evaluation of peritoneal membrane dysfunction (2021): Use PET to guide re-prescription and classify UF failure. \",\"ISPD peritonitis guidance (2016 update): Effluent sampling and indications for catheter removal if refractory. \",\"PD solution selection and prescription tailoring per contemporary handbooks. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'6\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#unmapped\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'unmapped\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Heparin in dialysate:<\\/strong> 500\\u20131000 U\\/L can reduce fibrin-related flow issues (See: <em>STEP_3_LI<\\/em>).<\\/li>\\n          <li><strong>Bioimpedance:<\\/strong> May assist in tracking dry weight trends (See: <em>QUALITY_PROCESS_LI<\\/em>). <\\/li>\\n          <li><strong>Glucose-sparing regimens:<\\/strong> Consider mixed prescriptions to reduce metabolic load (See: <em>TOPIC_BLOCK_C_ITEMS_LI<\\/em>). <\\/li>\\n          <li><strong>Pleuroperitoneal leak:<\\/strong> Suspect with unilateral effusion worsening during dwells; temporary dry day and APD often helpful (See: <em>DDX_BUCKET_2_ITEMS_LI<\\/em>).<\\/li>\\n          <li><strong>Nutritional support:<\\/strong> Address hypoalbuminemia to improve edema response (See: <em>DDX_BUCKET_2_ITEMS_LI<\\/em>).<\\/li>\\n          <li><strong>Assisted PD:<\\/strong> For those with self-care barriers to improve adherence (See: <em>QUALITY_PROCESS_LI<\\/em>). <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#edge\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'edge\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Pregnancy on PD:<\\/strong> Favor gentler UF and avoid intraperitoneal hypertension; multidisciplinary planning.<\\/li>\\n          <li><strong>Advanced CHF:<\\/strong> PD may be considered for chronic cardiorenal syndrome to aid decongestion. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#dosing\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'dosing\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Diuretics:<\\/strong> Dose to effect only with residual urine; monitor electrolytes and ototoxicity risk.<\\/li>\\n          <li><strong>Insulin:<\\/strong> Adjust for higher glucose loads when using hypertonic dextrose.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#local\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'local\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Escalation:<\\/strong> Define unit-specific triggers and workflows for urgent HD in PD patients with refractory edema (See: <em>SAFETY_LI<\\/em>).<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extend\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'extend\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>PD_PRESCRIPTION_BLOCK:<\\/strong> Structured fields for exchanges\\/day, dwell durations, bag strengths, and icodextrin use.<\\/li>\\n          <li><strong>TRANSPORTER_STATUS:<\\/strong> PET category and last PET date.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"PD hypervolemia\",\"Ultrafiltration (UF) failure\",\"Icodextrin & 4.25% dextrose\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":6,\"viva_items\":11,\"pitfalls\":3}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53'),
(13, NULL, 3, 1, 1, 'pd-schema-extensions', 'Peritoneal Dialysis msc', NULL, 'published', NULL, '{\"slug\":\"pd-schema-extensions\",\"topic\":\"Peritoneal Dialysis (PD): Schema Extensions & Emergency Blocks\",\"PD_PRESCRIPTION_EXAMPLES_TABLE_HTML\":\"<table class=\'table table-sm table-striped\'><thead><tr><th>Scenario<\\/th><th>Goal<\\/th><th>CAPD Example<\\/th><th>APD\\/CCPD Example<\\/th><th>Notes<\\/th><\\/tr><\\/thead><tbody><tr><td>Volume overload, hemodynamically stable<\\/td><td><strong>Targets:<\\/strong> net UF 1\\u20132 L\\/24 h; <strong>Na removal:<\\/strong> maximize sodium sieving<\\/td><td>5x\\/day, 2.0 L each: 3 exchanges 2.5% dextrose (4\\u20135 h), 2 exchanges 4.25% (3\\u20134 h), dry day optional; last fill icodextrin 2.0 L overnight<\\/td><td>Night: 10\\u201312 cycles, 1.8\\u20132.2 L fills, 75\\u201390 min dwells, 2.5% dextrose; add 1\\u20132 cycles of 4.25% early. Day: 2.0 L icodextrin long day dwell<\\/td><td><strong>Risk mitigation:<\\/strong> avoid consecutive 4.25% if hypotension; monitor serum Na for <span class=\'hl-symbol\'><=<\\/span> 2 mmol\\/L per 24 h drop.<\\/td><\\/tr><tr><td>Volume overload with low transporter (PET D\\/PCr <span class=\'hl-symbol\'><<\\/span> 0.5)<\\/td><td><strong>Targets:<\\/strong> prolong dwelling for UF<\\/td><td>4x\\/day, 2.5 L, 2.5% dextrose, 6 h dwells; last fill icodextrin 2.0 L overnight<\\/td><td>Night: 8\\u201310 cycles, 2.3\\u20132.5 L, 90\\u2013120 min dwells, 2.5% dextrose; Day: icodextrin 2.0 L<\\/td><td><strong>Tip:<\\/strong> larger fills improve UF if tolerated.<\\/td><\\/tr><tr><td>Volume overload with high transporter (PET D\\/PCr <span class=\'hl-symbol\'>>=<\\/span> 0.8)<\\/td><td><strong>Targets:<\\/strong> short dwells to reduce solute backflow<\\/td><td>5\\u20136x\\/day, 2.0 L, 2.5\\u20134.25% dextrose, 2\\u20133 h dwells; no long glucose dwell; night icodextrin 2.0 L<\\/td><td>Night: 12\\u201314 cycles, 1.8\\u20132.0 L, 45\\u201360 min dwells, 2.5\\u20134.25% dextrose; Day: icodextrin 2.0 L<\\/td><td><strong>Warning:<\\/strong> watch for cramps\\/hypotension; split higher strengths early in program.<\\/td><\\/tr><tr><td>Refractory edema with residual kidney function present<\\/td><td><strong>Targets:<\\/strong> augment diuresis + UF<\\/td><td>Standard CAPD plus loop diuretic (e.g., furosemide 120\\u2013240 mg\\/day in divided doses) and thiazide synergy<\\/td><td>Standard APD + high-dose loop and thiazide synergy; retain icodextrin day dwell<\\/td><td><strong>Monitor:<\\/strong> K<span class=\'hl-symbol\'><=<\\/span>3.5 mmol\\/L, Mg, creatinine; avoid over-diuresis.<\\/td><\\/tr><\\/tbody><\\/table>\",\"PD_SAMPLING_BLOCK\":[{\"context\":\"Cloudy effluent \\/ suspected peritonitis\",\"dwell_time_min\":120,\"sampling_method\":\"Collect from effluent bag after <strong>dwell<\\/strong> (not from tubing); agitate bag; send aliquots promptly\",\"bottle_type\":\"Blood culture bottles: aerobic + anaerobic; 10\\u201315 mL each; plus EDTA for cell count\\/differential, plain tube for chemistry\",\"comments\":\"<strong>Pre-antibiotic:<\\/strong> sample before any IP antibiotics; if on APD, program a 2 h manual dwell for sampling.\"},{\"context\":\"Hemoperitoneum (bloody effluent)\",\"dwell_time_min\":60,\"sampling_method\":\"Collect gently to avoid hemolysis; consider centrifuge for supernatant if cell count needed\",\"bottle_type\":\"Plain tube for cytology if malignancy suspected; blood culture bottles if concurrent infection suspected\",\"comments\":\"<strong>Heparinized circuit:<\\/strong> document IP heparin dose (see PD_CATHETER_PROTECTION).\"}],\"PD_CATHETER_PROTECTION\":{\"indication\":\"Bloody effluent\\/hemoperitoneum or fibrin strands threatening catheter patency\",\"ip_heparin_per_bag_units\":500,\"timing\":\"Add to <strong>each<\\/strong> exchange until effluent clears (usually 24\\u201372 h).\",\"maximum_daily_units\":4000,\"contraindications\":\"Active bleeding diathesis, platelet <span class=\'hl-symbol\'><<\\/span> 50 x10^9\\/L, heparin-induced thrombocytopenia\",\"notes\":\"<strong>No systemic effect:<\\/strong> IP heparin at 500\\u20131000 U\\/bag has minimal systemic anticoagulation; do <strong>not<\\/strong> delay sampling for culture.\"},\"DYNAMIC_ANTIBIOTIC_DOSING_TABLE_HTML\":\"<table class=\'table table-bordered table-sm\'><thead><tr><th>Drug<\\/th><th>Route<\\/th><th>Dose (per kg unless stated)<\\/th><th>Regimen (CAPD)<\\/th><th>Regimen (APD)<\\/th><th>Target levels \\/ notes<\\/th><\\/tr><\\/thead><tbody><tr><td>Cefazolin<\\/td><td>IP<\\/td><td>15\\u201320 mg\\/kg<\\/td><td>Loading 500 mg\\/L once; then 125 mg\\/L each exchange<\\/td><td>Loading 20 mg\\/kg at start; then 125 mg\\/L in last long dwell<\\/td><td><strong>Goal:<\\/strong> time above MIC; no routine level.<\\/td><\\/tr><tr><td>Ceftazidime<\\/td><td>IP<\\/td><td>15\\u201320 mg\\/kg<\\/td><td>Loading 500 mg\\/L once; then 125 mg\\/L each exchange<\\/td><td>Loading 20 mg\\/kg; then 125 mg\\/L in last long dwell<\\/td><td>Covers Pseudomonas.<\\/td><\\/tr><tr><td>Vancomycin<\\/td><td>IP<\\/td><td>15\\u201330 mg\\/kg<\\/td><td>Every 5\\u20137 days, aim trough 15\\u201320 mg\\/L; place in long dwell<\\/td><td>Every 3\\u20135 days; dose into longest dwell<\\/td><td><strong>Target serum:<\\/strong> 15\\u201320 mg\\/L (AUC 400\\u2013600 if available).<\\/td><\\/tr><tr><td>Gentamicin<\\/td><td>IP<\\/td><td>0.6 mg\\/kg per exchange or 2 mg\\/kg daily<\\/td><td>Once daily in long dwell<\\/td><td>Once daily in last dwell<\\/td><td><strong>Target serum:<\\/strong> peak 6\\u201310 mg\\/L, trough <span class=\'hl-symbol\'><<\\/span> 2 mg\\/L.<\\/td><\\/tr><tr><td>Fluconazole<\\/td><td>PO<\\/td><td>200 mg loading, then 100\\u2013200 mg daily<\\/td><td colspan=\'2\'>Antifungal prophylaxis when antibiotics <span class=\'hl-symbol\'>>=<\\/span> 3\\u20135 days<\\/td><td>Adjust for eGFR if RKF present.<\\/td><\\/tr><tr><td>Piperacillin-tazobactam<\\/td><td>IV<\\/td><td>4.5 g q8\\u201312 h<\\/td><td colspan=\'2\'>Use if septicemia or bowel perforation suspected<\\/td><td>De-escalate per culture.<\\/td><\\/tr><\\/tbody><\\/table>\",\"LOCAL_ANTIBIOGRAM_NOTES_HTML\":\"<div class=\'small\'><strong>Center-specific empiric choices:<\\/strong> populate organism prevalence (%), ESBL rates, MRSA prevalence, Pseudomonas resistance, and preferred first-line IP regimens. <strong>Update cadence:<\\/strong> quarterly. <strong>Escalation:<\\/strong> carbapenem-sparing whenever feasible.<\\/div>\",\"DYNAMIC_PD_SOLUTION_MODULE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Solution<\\/th><th>Availability<\\/th><th>Typical use<\\/th><th>Funding constraints<\\/th><\\/tr><\\/thead><tbody><tr><td>Icodextrin 7.5%<\\/td><td>\\u2714<\\/td><td>Long day or night dwell for UF<\\/td><td>Cap at 1 bag\\/day in some payors<\\/td><\\/tr><tr><td>Low-GDP neutral pH<\\/td><td>\\u2714\\/\\u2716<\\/td><td>Biocompatible option to preserve membrane<\\/td><td>Tiered pricing; justify for EPS risk<\\/td><\\/tr><tr><td>Amino-acid 1.1%<\\/td><td>\\u2714<\\/td><td>Malnutrition, protein supplementation<\\/td><td>Limit to <span class=\'hl-symbol\'><=<\\/span> 1 exchange\\/day<\\/td><\\/tr><tr><td>2.5% \\/ 4.25% dextrose<\\/td><td>\\u2714<\\/td><td>UF intensification<\\/td><td>Monitor glucose load in diabetics<\\/td><\\/tr><\\/tbody><\\/table>\",\"DYNAMIC_PD_ADEQUACY_MEMBRANE_METRICS_HTML\":\"<ul class=\'small\'><li><strong>Na+ dip (%):<\\/strong> percent fall in dialysate Na during first 60\\u2013120 min of dextrose dwell; <strong>Surrogate:<\\/strong> aquaporin-mediated free water transport.<\\/li><li><strong>Interpretation:<\\/strong> Na+ dip <span class=\'hl-symbol\'><<\\/span> 2% suggests impaired aquaporin water channels; consider biocompatible solutions, avoid very short dwells.<\\/li><li><strong>Other surrogates:<\\/strong> early UF (first hour) and crystalloid osmotic conductance estimates.<\\/li><\\/ul>\",\"UF_DAILY_DIARY_TEMPLATE_TABLE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Date<\\/th><th>Modality<\\/th><th>Fills (L)<\\/th><th>Drains (L)<\\/th><th>Net UF (mL)<\\/th><th>Daytime icodextrin (Y\\/N)<\\/th><th>Weight (kg)<\\/th><th>BP (mmHg)<\\/th><th>Symptoms<\\/th><\\/tr><\\/thead><tbody><tr><td>yyyy-mm-dd<\\/td><td>CAPD\\/APD<\\/td><td>\\u2014<\\/td><td>\\u2014<\\/td><td>\\u2014<\\/td><td>\\u2014<\\/td><td>\\u2014<\\/td><td>\\u2014\\/\\u2014<\\/td><td>\\u2014<\\/td><\\/tr><\\/tbody><\\/table>\",\"DYNAMIC_CATHETER_INSERTION_TECHNIQUE_HTML\":\"<div><strong>Technique selection:<\\/strong> prior surgeries\\/adhesions, hernias, BMI, EPS risk. <ul><li><strong>Open:<\\/strong> fast, limited adhesiolysis.<\\/li><li><strong>Basic laparoscopy:<\\/strong> pelvic fixation reduces migration.<\\/li><li><strong>Advanced laparoscopy:<\\/strong> rectus sheath tunneling, selective omentectomy for recurrent obstruction.<\\/li><li><strong>Adjuncts:<\\/strong> omentopexy, tacking to pelvis, fluoroscopic guidance.<\\/li><\\/ul><\\/div>\",\"DYNAMIC_LEAK_RISK_MITIGATION_HTML\":\"<ol class=\'small\'><li><strong>Post-insertion early-use protocol:<\\/strong> Day 0\\u20133: 0.5\\u20131.0 L supine exchanges only; Day 4\\u20137: 1.0\\u20131.5 L; Week 2: 1.5\\u20132.0 L if no leak.<\\/li><li><strong>Positioning:<\\/strong> strict supine for first week; avoid Valsalva.<\\/li><li><strong>Hernia risk:<\\/strong> screen and repair pre-PD if feasible.<\\/li><\\/ol>\",\"ANTIBIOTIC_TABLE_HTML\":\"<table class=\'table table-striped table-sm\'><thead><tr><th>Organism<\\/th><th>Preferred IP regimen<\\/th><th>Interval (CAPD\\/APD)<\\/th><th>Alternatives<\\/th><th>Comments<\\/th><\\/tr><\\/thead><tbody><tr><td>MSSA\\/MRSE<\\/td><td>Vancomycin 15\\u201330 mg\\/kg<\\/td><td>q5\\u20137 d \\/ q3\\u20135 d<\\/td><td>Cefazolin for MSSA<\\/td><td>Place in longest dwell; monitor level.<\\/td><\\/tr><tr><td>MRSA<\\/td><td>Vancomycin (as above)<\\/td><td>q5\\u20137 d \\/ q3\\u20135 d<\\/td><td>Linezolid PO 600 mg BID<\\/td><td>Consider catheter removal if refractory.<\\/td><\\/tr><tr><td>Pseudomonas<\\/td><td>Ceftazidime 15\\u201320 mg\\/kg<\\/td><td>Each exchange \\/ last dwell<\\/td><td>Pip-tazo IV; add IP aminoglycoside<\\/td><td>Dual therapy if severe.<\\/td><\\/tr><tr><td>Enterococcus<\\/td><td>Vancomycin or ampicillin IP<\\/td><td>Per levels \\/ q8\\u201312 h<\\/td><td>Linezolid<\\/td><td>Assess for intra-abdominal source.<\\/td><\\/tr><tr><td>Culture-negative<\\/td><td>Vancomycin + ceftazidime IP<\\/td><td>Per protocol<\\/td><td>\\u2014<\\/td><td>Reassess at 48\\u201372 h.<\\/td><\\/tr><\\/tbody><\\/table>\",\"EPS_SURGICAL_CENTERS_LI\":[\"Center A \\u2014 EPS surgery & peritonectomy unit, Tel: +XXX-XXXX, Email: [eps@centera.org](mailto:eps@centera.org)\",\"Center B \\u2014 GI\\/EPS combined team, Tel: +YYY-YYYY, Email: [epsreferral@centerb.org](mailto:epsreferral@centerb.org)\",\"Center C \\u2014 Regional EPS referral, Tel: +ZZZ-ZZZZ, Email: [epsclinic@centerc.org](mailto:epsclinic@centerc.org)\"],\"APD_DWELL_STRATEGY_HTML\":\"<ul class=\'small\'><li><strong>Antibiotic delivery on APD:<\\/strong> program a <strong>prolonged last dwell<\\/strong> (6\\u20138 h) to host IP antibiotics.<\\/li><li><strong>Cycle adjustments:<\\/strong> shorten early cycles (45\\u201360 min) to preserve UF; dedicate last dwell for drug absorption.<\\/li><li><strong>Tidal APD:<\\/strong> avoid tidal during antibiotic dwell to optimize concentration-time product.<\\/li><\\/ul>\",\"ANTIFUNGAL_PROPHYLAXIS_OL\":[\"Fluconazole 200 mg PO once, then 100\\u2013200 mg PO daily while on antibacterial therapy (typical duration 7\\u201314 days).\",\"Nystatin 500,000 U PO QID during antibiotic course if fluconazole contraindicated.\",\"Avoid azoles with QT-prolonging agents; adjust fluconazole if residual kidney function present.\"],\"DYNAMIC_POOR_OUTFLOW_CATHETER_DETAILS_TABLE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Field<\\/th><th>Value<\\/th><\\/tr><\\/thead><tbody><tr><td>Tip location (imaging)<\\/td><td>Pelvis \\/ mid-abdomen \\/ migrated<\\/td><\\/tr><tr><td>Cuff status<\\/td><td>Superficial \\/ deep \\/ erosion \\/ tunnel infection<\\/td><\\/tr><tr><td>Recent imaging<\\/td><td>KUB date, ultrasound, CT if needed<\\/td><\\/tr><tr><td>Fibrin\\/clots<\\/td><td>Seen \\/ not seen<\\/td><\\/tr><tr><td>Constipation<\\/td><td>Yes \\/ No; last BM<\\/td><\\/tr><tr><td>Recent surgery<\\/td><td>Type\\/date<\\/td><\\/tr><\\/tbody><\\/table>\",\"DYNAMIC_POOR_OUTFLOW_PD_PRESCRIPTION_TABLE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Parameter<\\/th><th>APD<\\/th><th>CAPD<\\/th><\\/tr><\\/thead><tbody><tr><td>Tidal setting<\\/td><td>Start 70\\u201385% (retain 15\\u201330% to prevent catheter occlusion)<\\/td><td>N\\/A<\\/td><\\/tr><tr><td>Fill volume<\\/td><td>Reduce by 0.2\\u20130.5 L temporarily<\\/td><td>Reduce by 0.5 L temporarily<\\/td><\\/tr><tr><td>Dwell osmolarity<\\/td><td>Increase dextrose strength if UF poor<\\/td><td>As above<\\/td><\\/tr><tr><td>Heparin in bag<\\/td><td>500\\u20131000 U\\/bag if fibrin<\\/td><td>500\\u20131000 U\\/bag if fibrin<\\/td><\\/tr><\\/tbody><\\/table>\",\"PER_BAG_DOSING_TABLE_HTML\":\"<table class=\'table table-bordered table-sm\'><thead><tr><th>Drug<\\/th><th>Per-bag dose<\\/th><th>Systemic (IV\\/PO) alternative<\\/th><th>Required dwell<\\/th><th>Notes<\\/th><\\/tr><\\/thead><tbody><tr><td>Cefazolin<\\/td><td>125 mg\\/L<\\/td><td>IV 1\\u20132 g q8 h<\\/td><td><span class=\'hl-symbol\'>>=<\\/span> 4 h<\\/td><td>Each exchange for CAPD; last dwell for APD.<\\/td><\\/tr><tr><td>Ceftazidime<\\/td><td>125 mg\\/L<\\/td><td>IV 2 g q8 h<\\/td><td><span class=\'hl-symbol\'>>=<\\/span> 4 h<\\/td><td>Consider dual therapy for Pseudomonas.<\\/td><\\/tr><tr><td>Vancomycin<\\/td><td>15\\u201330 mg\\/kg (intermittent)<\\/td><td>IV 15\\u201320 mg\\/kg q8\\u201312 h<\\/td><td>6\\u20138 h<\\/td><td>Level-guided re-dosing.<\\/td><\\/tr><tr><td>Gentamicin<\\/td><td>0.6 mg\\/kg per exchange<\\/td><td>IV 5\\u20137 mg\\/kg q24\\u201348 h<\\/td><td>6\\u20138 h<\\/td><td>Check trough <span class=\'hl-symbol\'><<\\/span> 2 mg\\/L.<\\/td><\\/tr><\\/tbody><\\/table>\",\"RESPONSE_MILESTONE_TRACKER_TABLE_HTML\":\"<table class=\'table table-sm\'><thead><tr><th>Milestone<\\/th><th>Expected response<\\/th><th>Action if not met<\\/th><\\/tr><\\/thead><tbody><tr><td>48 h<\\/td><td>Symptom improvement; effluent WBC <span class=\'hl-symbol\'><=<\\/span> 50% of baseline; culture pending\\/positive<\\/td><td>Verify dosing, dwell timing, add coverage per Gram stain; re-sample.<\\/td><\\/tr><tr><td>96 h<\\/td><td>Effluent clears; WBC <span class=\'hl-symbol\'><<\\/span> 100\\/\\u00b5L; afebrile<\\/td><td>Search for source; consider catheter removal\\/exchange for refractory or fungal peritonitis.<\\/td><\\/tr><\\/tbody><\\/table>\",\"THROMBOLYTIC_PROTOCOLS_TABLE_HTML\":\"<table class=\'table table-sm table-bordered\'><thead><tr><th>Agent<\\/th><th>Recipe (per 2 L bag)<\\/th><th>Dwell<\\/th><th>Max frequency<\\/th><th>Notes<\\/th><\\/tr><\\/thead><tbody><tr><td>tPA (alteplase)<\\/td><td>1\\u20132 mg in 50 mL NS instilled via catheter (not bag)<\\/td><td>1\\u20132 h then attempt drain<\\/td><td>Once daily x 1\\u20133<\\/td><td>Avoid systemic anticoagulation overlap; monitor for bleeding.<\\/td><\\/tr><tr><td>Urokinase<\\/td><td>5,000\\u201310,000 U in 50 mL NS via catheter<\\/td><td>1\\u20132 h<\\/td><td>Once daily x 1\\u20133<\\/td><td>Consider if tPA unavailable.<\\/td><\\/tr><\\/tbody><\\/table>\",\"PD_ACCESS_SERVICE_CONTACTS\":[\"PD Nurse Line \\u2014 +000-000-0000 (24\\/7 triage)\",\"Interventional Radiology \\u2014 +000-000-0001 (catheter fluoroscopy\\/guidewire)\",\"Surgery (On-call) \\u2014 +000-000-0002 (laparoscopic salvage\\/removal)\"],\"TRANSPORTER_STATUS\":{\"PET_category\":\"Low \\/ Low-average \\/ High-average \\/ High\",\"last_PET_date\":\"yyyy-mm-dd\",\"notes\":\"Use PET to tailor dwell times; high transporters need shorter dwells and icodextrin for long dwell.\"},\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-danger\'><strong>Emergency:<\\/strong> Bloody PD effluent on APD (hemoperitoneum)<\\/div><ol><li><strong>Assess hemodynamics:<\\/strong> HR, BP, syncope; resuscitate per ACLS if unstable.<\\/li><li><strong>History:<\\/strong> recent procedures\\/anticoagulants\\/trauma\\/ovulation.<\\/li><li><strong>Protect catheter:<\\/strong> add IP heparin 500 U\\/bag each exchange (see PD_CATHETER_PROTECTION).<\\/li><li><strong>Sampling:<\\/strong> collect effluent (cell count, cytology if malignancy risk), consider imaging if persistent bleeding.<\\/li><li><strong>Program APD:<\\/strong> gentle cycles, reduced fill by 0.5 L, avoid high intra-abdominal pressure; maintain exchanges to prevent clotting.<\\/li><li><strong>Hold\\/adjust<\\/strong> systemic anticoagulants if safe; correct coagulopathy.<\\/li><li><strong>Escalate:<\\/strong> gynecologic\\/urologic\\/surgical consults as indicated.<\\/li><\\/ol>\",\"ASCII_FLOWCHART_PRE\":\"HEMOPERITONEUM ON APD (BLOODY EFFLUENT)\\n|\\n+--> Unstable? --YES--> Resuscitate (fluids\\/blood) --> Hold PD temporarily --> Source control imaging\\n|                              |\\n|                              NO\\n|\\n+--> Protect catheter: IP heparin 500 U\\/bag each exchange\\n|\\n+--> Reduce fills by 0.5 L and keep supine\\n|\\n+--> Sample BEFORE antibiotics (cell count +\\/- cytology)\\n|\\n+--> Review meds: anticoagulants\\/antiplatelets --> hold if safe\\n|\\n+--> Persistent bleeding >48 h or drop Hb >2 g\\/dL --> Imaging +\\/- surgical consult\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'cases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>APD patient with cloudy effluent at midnight<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body small\'>\\n        <strong>Action:<\\/strong> Pause cycles; program 2 h dwell; sample per <em>PD_SAMPLING_BLOCK<\\/em>. Start empiric IP vanc + ceftazidime in last long dwell (see <em>DYNAMIC_ANTIBIOTIC_DOSING_TABLE_HTML<\\/em>). Add antifungal prophylaxis if antibiotics expected <span class=\'hl-symbol\'>>=<\\/span> 5 days. Set <em>RESPONSE_MILESTONE_TRACKER<\\/em> reminders.\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>CAPD patient with poor outflow: 2 L in, 1 L out<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body small\'>\\n        <strong>Checklist:<\\/strong> constipation protocol, position changes, add heparin 500 U\\/bag if fibrin; use <em>DYNAMIC_POOR_OUTFLOW_CATHETER_DETAILS_TABLE_HTML<\\/em> to document; consider tidal APD 80% if on cycler; escalate to imaging\\/guidewire.\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Recurrent peritonitis on APD with weight gain<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#cases\'>\\n      <div class=\'accordion-body small\'>\\n        <strong>Plan:<\\/strong> review <em>ANTIBIOTIC_TABLE_HTML<\\/em>; consider exit-site scoring; evaluate for tunnel infection; adjust APD with shorter cycles + icodextrin day dwell; start UF diary logging; discuss EPS risk and early referral (<em>EPS_SURGICAL_CENTERS_LI<\\/em>).\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_QA_BANK_OL\":[\"<strong>Q1:<\\/strong> What determines sodium sieving in PD? <strong>A:<\\/strong> Aquaporin-mediated free water transport; reflected by early Na+ dip.\",\"<strong>Q2:<\\/strong> When do you use icodextrin? <strong>A:<\\/strong> For the longest dwell to enhance UF, especially in high transporters.\",\"<strong>Q3:<\\/strong> How do you program APD to deliver IP vancomycin? <strong>A:<\\/strong> Place the full dose into a 6\\u20138 h last dwell; monitor serum levels.\",\"<strong>Q4:<\\/strong> First steps in bloody effluent? <strong>A:<\\/strong> Stabilize, sample, add IP heparin 500 U\\/bag, reduce fills, keep exchanges going.\",\"<strong>Q5:<\\/strong> Poor outflow common causes? <strong>A:<\\/strong> Constipation, fibrin\\/clot, catheter migration, kinking, adhesions.\",\"<strong>Q6:<\\/strong> Indications for PD catheter removal in peritonitis? <strong>A:<\\/strong> Fungal peritonitis, refractory bacterial at 96 h, relapsing infections, tunnel abscess.\",\"<strong>Q7:<\\/strong> CAPD vs APD for high transporters? <strong>A:<\\/strong> APD with shorter dwells reduces solute backflow; add icodextrin for long dwell.\",\"<strong>Q8:<\\/strong> Amino-acid dialysate role? <strong>A:<\\/strong> Nutritional supplementation; limit to <span class=\'hl-symbol\'><=<\\/span> 1 exchange\\/day.\",\"<strong>Q9:<\\/strong> Exit-site infection scoring threshold for systemic antibiotics? <strong>A:<\\/strong> Score <span class=\'hl-symbol\'>>=<\\/span> 2 or purulence.\",\"<strong>Q10:<\\/strong> UF target in volume overload? <strong>A:<\\/strong> 1\\u20132 L\\/day initially, avoiding symptomatic hypotension.\",\"<strong>Q11:<\\/strong> When to use tidal APD? <strong>A:<\\/strong> Catheter dysfunction with frequent alarms or poor drains; set tidal 70\\u201385%.\",\"<strong>Q12:<\\/strong> Antifungal prophylaxis indication? <strong>A:<\\/strong> When antibacterial therapy expected <span class=\'hl-symbol\'>>=<\\/span> 3\\u20135 days.\"],\"DYNAMIC_LOCAL_PROTOCOLS\":\"<div class=\'small\'><strong>Site adaptations:<\\/strong> insert your center\'s sampling kits, antibiotic formulary, funding rules for icodextrin\\/low-GDP, and catheter salvage pathways with names and on-call numbers.<\\/div>\",\"DYNAMIC_SPECIAL_POPULATIONS\":\"<ul class=\'small\'><li><strong>Pregnancy:<\\/strong> smaller fills (1.0\\u20131.5 L), more frequent exchanges; avoid hypertonic glucose unless necessary.<\\/li><li><strong>Transplant candidates:<\\/strong> preserve peritoneum with biocompatible solutions; minimize peritonitis episodes; early EPS risk counseling.<\\/li><li><strong>Pediatrics:<\\/strong> weight-based fills 800\\u20131100 mL\\/m^2; family training emphasis.<\\/li><\\/ul>\",\"TOPIC\":\"Peritoneal Dialysis msc\",\"template\":\"dynamic-template.html\"}', '{\"template\":\"dynamic-template.html\"}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(14, NULL, 3, 1, 1, 'pd-peritonitis-cloudy-effluent-approach', 'Cloudy PD Effluent in an APD (CCPD) Patient — Suspected PD Peritonitis', 'PD peritonitis: rapid approach • ISPD-style diagnostic criteria • APD sampling & empiric IP therapy', 'published', 'Scenario: A 56-year-old man with CKD on automated peritoneal dialysis (APD/CCPD) presents with cloudy effluent. Priority: rule in/out PD peritonitis quickly, obtain effluent studies correctly for APD, and start empiric intraperitoneal (IP) antibiotics covering Gram-positive and Gram-negative organisms while anticipating indications for catheter removal if needed.  ', '{\"slug\":\"pd-peritonitis-cloudy-effluent-approach\",\"TOPIC\":\"Cloudy PD Effluent in an APD (CCPD) Patient \\u2014 Suspected PD Peritonitis\",\"CHIP_1\":\"PD peritonitis: rapid approach\",\"CHIP_2\":\"ISPD-style diagnostic criteria\",\"CHIP_3\":\"APD sampling & empiric IP therapy\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Scenario:<\\/strong> A 56-year-old man with CKD on automated peritoneal dialysis (APD\\/CCPD) presents with cloudy effluent. <strong>Priority:<\\/strong> rule in\\/out PD peritonitis quickly, obtain effluent studies correctly for APD, and start empiric intraperitoneal (IP) antibiotics covering Gram-positive and Gram-negative organisms while anticipating indications for catheter removal if needed.  <\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e <strong>Sepsis screen & exam:<\\/strong> vitals, abdominal tenderness\\/ileus, fever\\/chills; inspect exit-site\\/tunnel for erythema, purulence, or pain. \",\"\\ud83e\\uddea <strong>Effluent sampling (APD-aware):<\\/strong> send dialysate for cell count + differential, Gram stain, and culture (prefer blood-culture bottles). If no dwell, instill 1 L dialysate, dwell ~2 h, then drain for testing. For short APD dwells, rely more on %PMN. \",\"\\u2705 <strong>Make presumptive diagnosis & start empiric IP antibiotics immediately<\\/strong> after cultures: cover Gram-positive (e.g., vancomycin or cefazolin) + Gram-negative (e.g., ceftazidime or an aminoglycoside) or use a single broad cephalosporin (e.g., cefepime) per local practice. \",\"\\ud83d\\udc8a <strong>Add antifungal prophylaxis<\\/strong> during antibiotic treatment (e.g., oral nystatin or fluconazole), and apply daily topical gentamicin 0.1% at exit site to reduce infections. \",\"\\ud83e\\uddea <strong>Blood tests as indicated:<\\/strong> CBC, CRP, chemistries; obtain blood cultures if febrile or unstable. <strong>Do not<\\/strong> take effluent from a completely dry abdomen (false negatives). \",\"\\ud83d\\udca7 <strong>Keep a long dwell for drug absorption:<\\/strong> for APD, ensure at least one long dwell containing the IP antibiotic early in therapy. (Principle from APD short-dwell caveat.) \",\"\\ud83e\\uddf5 <strong>Prevent catheter clotting if bloody\\/turbid with fibrin:<\\/strong> consider adding IP heparin to the bags (does not affect systemic coagulation). \",\"\\ud83d\\udcde <strong>Early follow-up<\\/strong> (clinic\\/telephone) to ensure clinical and effluent count improvement and to tailor therapy to cultures. \"],\"DDX_BUCKET_1_TITLE\":\"Infectious causes (most common)\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>Bacterial PD peritonitis:<\\/strong> touch contamination, exit-site\\/tunnel source, GI translocation, hematogenous seeding. \",\"\\u26a0\\ufe0f <strong>Fungal peritonitis:<\\/strong> classically post-antibiotics; serious with higher mortality. \",\"\\u26a0\\ufe0f <strong>Atypical organisms:<\\/strong> mycobacterial, multiple enteric organisms (consider catheter removal). \"],\"DDX_BUCKET_2_TITLE\":\"Noninfectious turbid effluent\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83e\\ude78 <strong>Hemoperitoneum<\\/strong> (e.g., menses\\/ovulation, catheter trauma; consider IP heparin).  \",\"\\ud83e\\uddea <strong>Eosinophilic peritonitis<\\/strong> (allergic reaction; early post-catheter, CCBs, IP antibiotics). \",\"\\ud83e\\udd5b <strong>Chylous ascites<\\/strong> (lipids). \",\"\\ud83e\\uddeb <strong>Chemical peritonitis<\\/strong> (antiseptics, disinfectants). \",\"\\ud83e\\uddf5 <strong>Fibrin\\/proteins<\\/strong> causing turbidity. \"],\"DDX_BUCKET_3_TITLE\":\"Sampling\\/other artifacts\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Specimen from a \'dry\' abdomen<\\/strong> (false low WBC\\/culture). \",\"\\u23f1\\ufe0f <strong>Very short APD dwell:<\\/strong> WBC count may be low despite infection; interpret %PMN. \",\"\\ud83e\\uddef <strong>Prolonged dwell time<\\/strong> increasing turbidity. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-3\'><h5 class=\'mb-2\'>Diagnosis \\u2014 PD Peritonitis (make diagnosis if any <em>2 of 3<\\/em>)<\\/h5><ul class=\'mb-3\'><li><strong>Clinical:<\\/strong> abdominal pain and\\/or <em>cloudy<\\/em> dialysis effluent. <\\/li><li><strong>Effluent cells:<\\/strong> total WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L <em>and<\\/em> <span class=\'hl-symbol\'>><\\/span>50% PMNs after a dwell of at least 2 h (for short APD dwells, %PMN is most informative).  <\\/li><li><strong>Microbiology:<\\/strong> positive effluent culture (prefer blood-culture bottle technique). <\\/li><\\/ul><h5 class=\'mb-2\'>Empiric Treatment (start after cultures)<\\/h5><ul class=\'mb-3\'><li><strong>Route:<\\/strong> Intraperitoneal (preferred); ensure a long dwell for APD. <\\/li><li><strong>Coverage:<\\/strong> Gram-positive (vancomycin or cefazolin) <em>plus<\\/em> Gram-negative (ceftazidime or an aminoglycoside), or a single broad cephalosporin (e.g., cefepime) per local protocol; de-escalate to sensitivities. Typical durations: 14 days (most organisms), 21 days for <em>S. aureus<\\/em> or Pseudomonas, 21\\u201328 days for Pseudomonas\\/stenotrophomonas with 2 agents. <\\/li><li><strong>Antifungal prophylaxis:<\\/strong> nystatin or fluconazole during antibacterial therapy; daily topical gentamicin 0.1% at exit site. <\\/li><\\/ul><h5 class=\'mb-2\'>When to remove the PD catheter<\\/h5><ul class=\'mb-0\'><li><strong>Immediate removal:<\\/strong> fungal peritonitis; <strong>relapsing<\\/strong> peritonitis with same organism within 4 weeks after completion of therapy. <\\/li><li><strong>Also consider removal:<\\/strong> refractory or repeat peritonitis, mycobacterial infection, multiple enteric organisms, refractory exit-site\\/tunnel infection. <\\/li><\\/ul><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Effluent analysis:<\\/strong> cell count with differential, Gram stain, culture in blood-culture bottles. \",\"\\u23f1\\ufe0f <strong>APD dwell standardization:<\\/strong> if no fluid available, instill 1 L, dwell ~2 h, then drain for testing; for short APD dwell, rely on %PMN. \",\"\\ud83e\\uddf4 <strong>Exit-site\\/tunnel swab<\\/strong> if clinically infected.\",\"\\ud83e\\uddeb <strong>Blood cultures<\\/strong> if febrile\\/unstable; baseline labs (CBC, CRP, electrolytes).\",\"\\ud83e\\ude78 <strong>Consider IP heparin<\\/strong> if hemoperitoneum\\/fibrin obstructs catheter (prevents intraluminal clot). \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'algorithm p-2\'><ol class=\'mb-2\'><li><strong>Suspect PD peritonitis<\\/strong> (cloudy effluent +\\/- pain\\/fever) \\u2192 check vitals and examine exit-site\\/tunnel.<\\/li><li><strong>Before antibiotics:<\\/strong> drain current dwell (or instill 1 L if dry), send for cell count\\/diff, Gram, culture (blood-culture bottle).<\\/li><li><strong>Start empiric IP therapy now<\\/strong> (Gram+ and Gram- coverage) + begin antifungal prophylaxis.<\\/li><li><strong>APD settings:<\\/strong> ensure a long dwell containing the antibiotic early in therapy.<\\/li><li><strong>Review at 48\\u201372 h:<\\/strong> check clinical response and effluent WBC fall; tailor antibiotics to sensitivities.<\\/li><li><strong>No response\\/relapse\\/fungal:<\\/strong> remove PD catheter; arrange temporary HD and re-evaluate for PD re-start if appropriate.<\\/li><\\/ol><\\/div>\",\"PILLAR_1\":\"Rapid diagnosis & stabilization\",\"STEP_1_TITLE\":\"At presentation\",\"STEP_1_LI\":[\"\\ud83d\\udd0e <strong>Assess severity:<\\/strong> sepsis screen, abdominal exam, exit-site\\/tunnel inspection. \",\"\\ud83e\\uddea <strong>Obtain effluent correctly:<\\/strong> cell count\\/diff, Gram, culture; standardize dwell for APD. \",\"\\ud83d\\udc8a <strong>Start empiric IP antibiotics<\\/strong> without delay after sampling; keep long dwell for APD. \",\"\\ud83d\\udc8a <strong>Antifungal prophylaxis<\\/strong> (nystatin\\/fluconazole) and exit-site gentamicin 0.1%. \"],\"STEP_2_TITLE\":\"Diagnostic confirmation\",\"STEP_2_LI\":[\"\\ud83e\\uddea <strong>Use ISPD-style criteria:<\\/strong> any 2 of: symptoms\\/cloudy effluent; effluent WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with <span class=\'hl-symbol\'>><\\/span>50% PMN (after <span class=\'hl-symbol\'>\\u2265<\\/span>2 h dwell); positive culture. \",\"\\ud83e\\uddea <strong>APD caveat:<\\/strong> with short night dwells, %PMN carries more weight than absolute WBC. \",\"\\ud83e\\uddeb <strong>Culture technique:<\\/strong> inoculate into blood-culture bottles to increase yield. \"],\"PILLAR_2\":\"Definitive therapy & prevention\",\"STEP_3_TITLE\":\"Tailored antimicrobials & catheter decisions\",\"STEP_3_LI\":[\"\\ud83d\\udc8a <strong>Narrow therapy<\\/strong> to organism\\/sensitivities; typical duration 14 d (most), 21 d for <em>S. aureus<\\/em> and many Gram-negatives; Pseudomonas often 2 agents for 21\\u201328 d. \",\"\\ud83e\\uddf7 <strong>Remove catheter<\\/strong> for fungal, relapsing, refractory peritonitis, refractory exit-site\\/tunnel infection, mycobacterial or multiple enteric organisms; convert to temporary HD.  \"],\"STEP_4_TITLE\":\"Prevent recurrence\",\"STEP_4_LI\":[\"\\u2705 <strong>Technique retraining<\\/strong> after any peritonitis; audit touch contamination risk. \",\"\\ud83d\\udc8a <strong>Exit-site protocol:<\\/strong> daily topical gentamicin 0.1%; prompt treatment of exit-site infection; prophylactic antibiotics for selected procedures. \",\"\\ud83e\\uddc3 <strong>Glycemic\\/glucose load:<\\/strong> avoid excessive peritoneal glucose which increases peritonitis risk. \"],\"TOPIC_BLOCK_A_TITLE\":\"Antibiotic strategy \\u2014 practical notes\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83d\\udc8a <strong>Route:<\\/strong> IP preferred; IV reserved for systemic sepsis or when IP not feasible. (General principle; see regimen table and outpatient feasibility.) \",\"\\u23f1\\ufe0f <strong>APD implementation:<\\/strong> ensure at least one long dwell with antibiotic early; consider temporary CAPD-style daytime dwell to optimize exposure. \",\"\\ud83e\\uddcf <strong>Aminoglycosides:<\\/strong> limit prolonged\\/recurrent courses due to ototoxicity; consider switching to 3rd-gen cephalosporin if possible. \"],\"TOPIC_BLOCK_B_TITLE\":\"Catheter management\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83e\\uddf7 <strong>Remove immediately<\\/strong> for fungal or relapsing peritonitis (same organism within 4 weeks after completion of therapy). \",\"\\ud83e\\uddf7 <strong>Also remove\\/consider removal<\\/strong> for refractory or repeat peritonitis, refractory exit-site\\/tunnel infection, mycobacterial or multiple enteric organisms. \",\"\\ud83d\\udd01 <strong>Plan for KRT continuity:<\\/strong> arrange temporary HD; consider re-insertion after infection clearance.\"],\"TOPIC_BLOCK_C_TITLE\":\"APD\\/CCPD-specific pearls\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\uddea <strong>Sampling:<\\/strong> with short nocturnal dwells, WBC may be lower; interpret %PMN and standardize a 2 h dwell for diagnostics. \",\"\\ud83d\\udce6 <strong>Drug delivery:<\\/strong> ensure a long dwell with antibiotics to achieve peritoneal exposure.\",\"\\u26a0\\ufe0f <strong>Avoid mislabeling:<\\/strong> do not submit specimens from a dry abdomen (can miss peritonitis). \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udd01 <strong>Time-to-antibiotics:<\\/strong> measure from presentation to first IP dose.\",\"\\ud83d\\udcc8 <strong>48\\u201372 h reassessment:<\\/strong> track effluent WBC fall and symptom resolution.\",\"\\ud83e\\uddea <strong>Culture yield:<\\/strong> proportion using blood-culture bottles for effluent.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Reduced relapse rate<\\/strong> within 4 weeks.\",\"\\ud83d\\udcc9 <strong>Technique survival<\\/strong> at 6\\u201312 months post-peritonitis episode.\",\"\\ud83d\\udcc9 <strong>Hospitalization<\\/strong> days per peritonitis episode.\"],\"QUALITY_SAFETY_LI\":[\"\\ud83d\\udc8a <strong>Antibiotic stewardship:<\\/strong> de-escalate to narrow agents on sensitivities.\",\"\\ud83e\\uddbb <strong>Ototoxicity monitoring<\\/strong> if aminoglycosides used (hearing checks). \",\"\\ud83e\\uddef <strong>Antifungal prophylaxis:<\\/strong> during antibiotic course to lower fungal peritonitis risk. \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Do not delay empiric IP antibiotics while awaiting results<\\/strong> after cultures are obtained; ensure at least one long dwell on APD to deliver the drug effectively. \",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Explain the plan:<\\/strong> why antibiotics go into the PD fluid, expected duration, signs that mandate calling back (fever, worsening pain, poor drain), and when catheter removal might be required (e.g., fungal\\/relapsing). \",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesPD\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1 \\u2014 Classic cloudy bag with abdominal pain (APD)<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Action:<\\/strong> drain current dwell; send cell count\\/diff, Gram, culture (blood-culture bottle).<\\/li><li><strong>Start empiric IP:<\\/strong> vancomycin + ceftazidime; add antifungal prophylaxis.<\\/li><li><strong>Ensure long dwell:<\\/strong> program an extended dwell containing antibiotic.<\\/li><li><strong>Confirm diagnosis:<\\/strong> WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and PMN <span class=\'hl-symbol\'>><\\/span>50% after 2 h dwell, or positive culture. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2 \\u2014 Culture shows Pseudomonas<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Therapy:<\\/strong> 2 sensitive anti-pseudomonal agents IP; treat 21\\u201328 days. <\\/li><li><strong>Evaluate catheter:<\\/strong> check for exit-site\\/tunnel infection; low threshold for removal if refractory. <\\/li><li><strong>Monitor:<\\/strong> clinical response and effluent counts at 48\\u201372 h.<\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3 \\u2014 Relapsing peritonitis 3 weeks post-therapy<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Definition:<\\/strong> recurrence within 4 weeks with the same organism or sterile relapse. <\\/li><li><strong>Action:<\\/strong> remove catheter; arrange temporary HD; plan for re-insertion after clearance. <\\/li><li><strong>Prevention:<\\/strong> retraining; review technique and exit-site care. <\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the likely diagnosis in a PD patient with cloudy effluent and abdominal pain?\",\"a\":\"PD-associated peritonitis. Diagnosis is made if any 2 of: (1) typical symptoms\\/cloudy effluent; (2) effluent WBC >100\\/\\u00b5L with >50% PMN after \\u22652 h dwell; (3) positive effluent culture. \"},{\"q\":\"How do you correctly obtain APD effluent for analysis when the abdomen is dry?\",\"a\":\"Instill ~1 L dialysate, dwell ~2 h, then drain and send for cell count\\/diff, Gram, and culture in blood-culture bottles. For short APD dwells rely more on %PMN. \"},{\"q\":\"List common noninfectious causes of cloudy PD effluent.\",\"a\":\"Hemoperitoneum, fibrin\\/proteins, chylous ascites, eosinophilic\\/chemical peritonitis, prolonged dwell; also sampling from a \'dry\' abdomen can mislead.  \"},{\"q\":\"What empiric regimen will you start while awaiting cultures?\",\"a\":\"IP Gram-positive coverage (vancomycin or cefazolin) plus Gram-negative coverage (ceftazidime or an aminoglycoside) or a single broad cephalosporin (e.g., cefepime); tailor to sensitivities. \"},{\"q\":\"What adjunct prophylaxis reduces fungal peritonitis risk during antibiotics?\",\"a\":\"Oral nystatin or fluconazole; maintain daily topical gentamicin 0.1% at exit site. \"},{\"q\":\"Define relapsing peritonitis.\",\"a\":\"Peritonitis within 4 weeks after completion of therapy with the same organism (or sterile). Catheter removal is recommended. \"},{\"q\":\"List indications for PD catheter removal.\",\"a\":\"Fungal, relapsing, refractory peritonitis; refractory exit-site\\/tunnel infection; mycobacterial; multiple enteric organisms; repeated peritonitis. \"},{\"q\":\"Typical treatment durations?\",\"a\":\"Usually 14 days; 21 days for Staphylococcus aureus; 21\\u201328 days and dual therapy for Pseudomonas\\/Stenotrophomonas. \"},{\"q\":\"Name key prevention strategies post-episode.\",\"a\":\"Technique retraining, exit-site care with daily gentamicin, prophylactic antibiotics for selected procedures, address high glucose loads. \"},{\"q\":\"How do you manage fibrin or bloody effluent obstructing drainage?\",\"a\":\"Add IP heparin to the dialysate to prevent intraluminal clotting without systemic anticoagulation. \"},{\"q\":\"What if aminoglycosides are needed?\",\"a\":\"Use judiciously due to ototoxicity risk; avoid prolonged\\/repeated courses and switch to third-gen cephalosporins when possible. \"},{\"q\":\"What is the most common cause of infectious peritonitis in PD?\",\"a\":\"Touch contamination during connections; high peritoneal glucose loads also increase risk. \"}],\"PITFALLS_LI\":[\"\\u274c <strong>Submitting \'dry abdomen\' samples<\\/strong> (false negatives). \",\"\\u274c <strong>Over-relying on absolute WBC in APD<\\/strong> with short dwells; %PMN is more reliable. \",\"\\u274c <strong>Delaying empiric IP antibiotics<\\/strong> pending results.\",\"\\u274c <strong>Skipping antifungal prophylaxis<\\/strong> during antibiotics. \",\"\\u274c <strong>Prolonged aminoglycoside use<\\/strong> causing ototoxicity. \"],\"ANSWER_STEPS_OL\":[\"Recognize suspected PD peritonitis (cloudy effluent +\\/- abdominal pain\\/fever).\",\"Before antibiotics, obtain effluent cell count\\/differential, Gram stain, and culture in blood-culture bottles; for APD, dwell ~2 h if needed. \",\"Start empiric IP Gram+ and Gram- coverage immediately; ensure a long dwell on APD. \",\"Initiate antifungal prophylaxis (nystatin\\/fluconazole) and exit-site gentamicin protocol. \",\"Reassess at 48\\u201372 h; tailor therapy to organism\\/sensitivities; continue 14\\u201321(\\u201328) d as indicated. \",\"Identify indications for catheter removal (fungal, relapsing, refractory, refractory exit-site\\/tunnel infection, mycobacterial\\/multiple enteric organisms) and arrange temporary HD.  \",\"Prevent recurrence: retraining, exit-site care, procedural prophylaxis, moderate glucose load. \"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83d\\udd2c <strong>ISPD-style diagnostic triad:<\\/strong> symptoms, cells, culture \\u2014 need any 2 of 3. \",\"\\ud83e\\uddea <strong>APD nuance:<\\/strong> %PMN is key with short dwells; standardize a 2 h dwell for testing. \",\"\\ud83e\\uddf4 <strong>Prevention bundle:<\\/strong> exit-site gentamicin, antifungal prophylaxis during antibiotics, retraining. \"],\"TEACHING_MISTAKES_LI\":[\"\\u274c Treating without cultures or with specimens from a dry abdomen. \",\"\\u274c Not ensuring a long antibiotic dwell on APD, reducing IP exposure.\",\"\\u274c Missing fungal peritonitis and delaying catheter removal. \"],\"ASCII_FLOWCHART_PRE\":\"PD CLOUDY EFFLUENT (APD)\\n|\\n+--> Take vitals, examine exit site\\/tunnel\\n|\\n+--> If no dwell: instill 1 L, dwell ~2h, then drain\\n|      |\\n|      +--> Send cell count\\/diff, Gram, culture (blood-culture bottles)\\n|\\n+--> Start empiric IP antibiotics (Gram+ AND Gram-)\\n|\\n+--> Ensure long dwell on APD for drug exposure\\n|\\n+--> 48-72h check: symptoms better AND effluent WBC falling?\\n       |\\n       +--> YES: continue, tailor to culture (14-21 d; 21-28 d if Pseudomonas)\\n       |\\n       +--> NO: assess for refractory\\/relapsing\\/fungal --> remove catheter; temp HD\\n\",\"EVIDENCE_STUDIES_LI\":[\"Clinical Handbook of Nephrology (2024): diagnostic criteria; APD sampling caveats; prevention bundle.  \",\"Comprehensive Clinical Nephrology (2023): ISPD 2016\\/2022 peritonitis guidance summarized; regimen durations; aminoglycoside toxicity cautions.   \",\"Manual of Clinical Nephrology (2022): differential of cloudy effluent; catheter removal indications.  \",\"Absolute Nephrology Review (2022): relapsing peritonitis definition; urgent catheter removal. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Diagnose PD peritonitis when any 2 of 3 criteria are met (symptoms\\/cloudy effluent; effluent WBC >100\\/\\u00b5L with >50% PMN after \\u22652 h dwell; positive culture). \",\"For APD, standardize sampling (2 h dwell) and interpret %PMN with short dwells; culture into blood-culture bottles. \",\"Start empiric IP therapy covering Gram+ and Gram- promptly; typical durations 14\\u201321 d, with longer and dual therapy for Pseudomonas. \",\"Provide antifungal prophylaxis during antibacterial therapy; maintain exit-site gentamicin to prevent infections. \",\"Remove PD catheter for fungal, relapsing, refractory peritonitis or refractory exit-site\\/tunnel infection (and selected atypicals); arrange temporary HD.  \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD Peritonitis Guideline Recommendations (2022 update) \\u2014 durations and organism-specific notes (summarized in Comprehensive Clinical Nephrology). \",\"ISPD Catheter-Related Infections (2017) \\u2014 exit-site\\/tunnel infection management (see CND\\/ISPD summaries). \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u1\'>Unmapped pearls<\\/button><\\/h2><div id=\'u1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Home management:<\\/strong> Some mild cases can start empiric antibiotics at home with close follow-up if reliable access to lab review exists. See: <em>QUALITY_PROCESS_LI<\\/em>. <\\/li><li><strong>Touch contamination risk:<\\/strong> review connectors and \'flush-before-fill\' systems post-episode. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'u2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Pregnancy\\/menstruation:<\\/strong> hemoperitoneum can cloud effluent; manage expectantly if benign. See: <em>DDX_BUCKET_2_TITLE<\\/em>. <\\/li><li><strong>Mycobacterial peritonitis:<\\/strong> needs specialized workup and often catheter removal. See: <em>TOPIC_BLOCK_B_TITLE<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'u3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Aminoglycosides:<\\/strong> limit duration; monitor for ototoxicity; consider safer alternatives when possible. See: <em>TOPIC_BLOCK_A_TITLE<\\/em>. <\\/li><li><strong>Heparin:<\\/strong> IP heparin prevents catheter clot without systemic anticoagulation in hemoperitoneum\\/fibrin. See: <em>INVESTIGATIONS_LI<\\/em>. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'u4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antibiotic selection:<\\/strong> align empiric choices with unit-specific antibiogram and ISPD-based protocols (e.g., vancomycin\\/cefazolin + ceftazidime vs cefepime). <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'u5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>ADD FIELD:<\\/strong> \'APD dwell strategy\' to capture programming changes for antibiotic delivery.<\\/li><li><strong>ADD FIELD:<\\/strong> \'Antifungal prophylaxis choice & duration\' to standardize prevention steps.<\\/li><\\/ul><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"PD peritonitis: rapid approach\",\"ISPD-style diagnostic criteria\",\"APD sampling & empiric IP therapy\"],\"section_counts\":{\"immediate_priorities\":8,\"investigations\":5,\"viva_items\":12,\"pitfalls\":5}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(15, NULL, 3, 1, 1, 'pd-peritonitis-dosing-and-catheter-removal', 'Peritoneal dialysis–associated peritonitis (adult): drug dosing, route of administration, and indications for PD catheter removal', 'Empiric IP antibiotic dosing • When to remove the PD catheter • ISPD-aligned approach (adult)', 'published', 'Peritoneal dialysis (PD) peritonitis is a time-critical infection. Start empiric antibiotics after effluent sampling, preferably via the intraperitoneal (IP) route unless the patient is septic/bacteremic; tailor to culture and sensitivities, and know the clear indications for catheter removal. ', '{\"slug\":\"pd-peritonitis-dosing-and-catheter-removal\",\"TOPIC\":\"Peritoneal dialysis\\u2013associated peritonitis (adult): drug dosing, route of administration, and indications for PD catheter removal\",\"CHIP_1\":\"Empiric IP antibiotic dosing\",\"CHIP_2\":\"When to remove the PD catheter\",\"CHIP_3\":\"ISPD-aligned approach (adult)\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Peritoneal dialysis (PD) peritonitis is a time-critical infection. Start empiric antibiotics after effluent sampling, preferably via the intraperitoneal (IP) route unless the patient is septic\\/bacteremic; tailor to culture and sensitivities, and know the clear indications for catheter removal. \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e <strong>Sample first:<\\/strong> Send PD effluent for WBC with differential, Gram stain, and culture; WBC >100\\/mm\\u00b3 with <strong>\\u2265<\\/strong>50% PMNs supports diagnosis. \",\"\\ud83d\\udc8a <strong>Start empiric therapy promptly:<\\/strong> IP vancomycin OR first-generation cephalosporin <em>plus<\\/em> IP ceftazidime OR an aminoglycoside; IP route preferred unless septic\\/bacteremic (then IV). \",\"\\ud83e\\uddea <strong>Reassess at 48\\u201396 h:<\\/strong> Expect clinical clearing by ~48 h; if no response by 96 h, repeat cell count\\/Gram\\/culture and evaluate for refractory\\/secondary causes. \",\"\\u26a0\\ufe0f <strong>Avoid prolonged aminoglycosides:<\\/strong> Minimize to protect residual kidney function; switch early to cephalosporin if possible. \",\"\\ud83e\\uddf5 <strong>If fibrin or bloody effluent:<\\/strong> Add heparin 500 units\\/L IP; allow antibiotic-containing dwell for <strong>\\u2265<\\/strong>6 h. \",\"\\ud83e\\uddeb <strong>Cover intra-abdominal source if suspected:<\\/strong> Add metronidazole and ensure broad gram-negative and gram-positive coverage. \"],\"DDX_BUCKET_1_TITLE\":\"Infectious peritonitis (PD-related)\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83d\\udca1 <strong>Typical bacteria:<\\/strong> Coagulase-negative staphylococci, S. aureus, enterococci, streptococci, and gram-negative bacilli (incl. Pseudomonas). \",\"\\ud83e\\udda0 <strong>Fungal peritonitis:<\\/strong> Candida\\/yeasts\\u2014requires prompt catheter removal and antifungal therapy. \",\"\\ud83e\\uddec <strong>NTM\\/mycobacteria:<\\/strong> Consider with indolent course or poor response; often mandates catheter removal. \"],\"DDX_BUCKET_2_TITLE\":\"Secondary peritonitis \\/ intra-abdominal pathology\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>Polymicrobial\\/anaerobes, stool in dialysate, high amylase:<\\/strong> Evaluate for bowel perforation or pancreatitis and broaden coverage. \",\"\\ud83e\\ude7b <strong>No improvement by day 4\\u20135:<\\/strong> Reassess for intraabdominal\\/gynecologic disease; consider surgical evaluation. \"],\"DDX_BUCKET_3_TITLE\":\"Noninfectious mimics\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83e\\uddef <strong>Eosinophilic peritonitis<\\/strong> or chemical irritation.\",\"\\ud83e\\uddf5 <strong>Hemoperitoneum:<\\/strong> Catheter trauma, gynecologic causes\\u2014add IP heparin for catheter patency. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>Empiric IP Antibiotics (adult)<\\/h5><ul class=\'mb-2\'><li><strong>Cefazolin:<\\/strong> 15\\u201320 mg\\/kg per bag once daily (long dwell). <\\/li><li><strong>Cephalothin:<\\/strong> 15 mg\\/kg or 1 g per 2\\u20133 L bag once daily (long dwell). <\\/li><li><strong>Ceftazidime:<\\/strong> 10\\u201320 mg\\/kg or 1 g per 2\\u20133 L bag once daily (long dwell). <\\/li><li><strong>Cefepime:<\\/strong> 1 g once daily IP. <\\/li><li><strong>Gentamicin\\/Tobramycin:<\\/strong> 0.6 mg\\/kg in one exchange per day (avoid prolonged use if RKF). <\\/li><li><strong>Vancomycin (MRSA\\/enterococci):<\\/strong> 15\\u201330 mg\\/kg in 1 bag; repeat in 3\\u20137 days to maintain serum level <span class=\'hl-symbol\'>>=<\\/span>15 mcg\\/mL. <\\/li><\\/ul><ul class=\'mb-2\'><li><strong>Route:<\\/strong> IP preferred; use IV if septic\\/bacteremic. <\\/li><li><strong>Dwell:<\\/strong> Allow antibiotic-containing dwell for <span class=\'hl-symbol\'>>=<\\/span>6 h; inject vancomycin and gentamicin in different dwells. <\\/li><li><strong>Durations (guide):<\\/strong> Gram-positive 14 d (S. aureus 21 d), culture-negative 14 d, other gram-negatives 21 d; Pseudomonas 21\\u201328 d with two active agents. <\\/li><\\/ul><p class=\'mb-0\'><strong>Oral options (select cases):<\\/strong> Levofloxacin 500 mg once then 250 mg daily, or ciprofloxacin 750 mg BID (program-specific). <\\/p><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>PD effluent:<\\/strong> WBC with differential, Gram stain, culture prior to antibiotics; WBC >100\\/mm\\u00b3 with <strong>\\u2265<\\/strong>50% PMNs is supportive. \",\"\\ud83e\\uddeb <strong>Repeat testing at 72\\u201396 h<\\/strong> if no improvement; consider secondary causes. \",\"\\ud83e\\ude78 <strong>Blood cultures and sepsis workup<\\/strong> if febrile\\/unstable; consider IV route. \",\"\\ud83d\\uddbc\\ufe0f <strong>Imaging\\/surgical consult<\\/strong> if polymicrobial\\/enteric features or persistent failure to clear. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-danger\'><strong>Emergency (sepsis\\/instability):<\\/strong> Begin IV broad-spectrum antibiotics (per local policy), obtain blood cultures, consider urgent transfer to HD, and evaluate for catheter removal if fungal, refractory, or perforation suspected. <\\/div><ol class=\'list-group list-group-numbered\'><li class=\'list-group-item\'><strong>Stabilize:<\\/strong> ABCs, fluids\\/pressors as indicated; draw labs and cultures.<\\/li><li class=\'list-group-item\'><strong>Source control:<\\/strong> If fungal or fecal peritonitis suspected, plan early catheter removal and surgical evaluation. <\\/li><li class=\'list-group-item\'><strong>Antibiotics:<\\/strong> Start IV route; de-escalate\\/convert to IP when stable and organism known. <\\/li><li class=\'list-group-item\'><strong>Reassess at 48\\u201396 h:<\\/strong> If no improvement by day 5 on appropriate therapy, remove catheter (earlier if severe). <\\/li><\\/ol>\",\"PILLAR_1\":\"Empiric & targeted antimicrobial therapy\",\"STEP_1_TITLE\":\"Start empiric therapy after sampling\",\"STEP_1_LI\":[\"\\u2705 <strong>Coverage:<\\/strong> Gram-positive (vancomycin or cefazolin) + gram-negative (ceftazidime or aminoglycoside) via IP. \",\"\\ud83d\\udc89 <strong>Route:<\\/strong> IP preferred; IV for sepsis\\/bacteremia. \",\"\\ud83d\\udd52 <strong>Dwell:<\\/strong> Antibiotic dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; separate vancomycin and gentamicin dwells. \"],\"STEP_2_TITLE\":\"Adjust to Gram\\/culture and monitor\",\"STEP_2_LI\":[\"\\ud83e\\uddeb <strong>Durations:<\\/strong> 14 d for most gram-positive (21 d for S. aureus); gram-negatives typically 21 d; Pseudomonas 21\\u201328 d with two agents. \",\"\\ud83d\\udcc8 <strong>Vancomycin:<\\/strong> 15\\u201330 mg\\/kg IP; repeat in 3\\u20137 d to keep trough <span class=\'hl-symbol\'>>=<\\/span>15 mcg\\/mL. \",\"\\ud83e\\udda0 <strong>Fungal:<\\/strong> Immediate catheter removal + systemic antifungal; treat <span class=\'hl-symbol\'>>=<\\/span>2 weeks post-removal. \"],\"PILLAR_2\":\"Catheter management & technique preservation\",\"STEP_3_TITLE\":\"Recognize indications for PD catheter removal\",\"STEP_3_LI\":[\"\\u23f1\\ufe0f <strong>Refractory peritonitis:<\\/strong> Effluent fails to clear after 5 days of appropriate antibiotics. \",\"\\u267b\\ufe0f <strong>Relapsing\\/recurrent peritonitis:<\\/strong> Especially same organism within 4 weeks (relapse). \",\"\\ud83e\\uddf5 <strong>Refractory exit-site\\/tunnel infection<\\/strong> or concomitant S. aureus\\/Pseudomonas exit-site infection. \",\"\\ud83e\\uddeb <strong>Unresponsive Pseudomonas or fungal peritonitis; NTM peritonitis.<\\/strong> \",\"\\ud83d\\udca9 <strong>Fecal peritonitis\\/major intra-abdominal pathology.<\\/strong> \",\"\\ud83e\\uddf0 <strong>Mechanical failure\\/adhesions\\/loculations\\/malposition\\/poor peritoneal blood flow.<\\/strong> \",\"\\ud83e\\uddea <strong>Also remove if fungal peritonitis:<\\/strong> prompt removal recommended. \"],\"STEP_4_TITLE\":\"Resumption of PD after removal\",\"STEP_4_LI\":[\"\\ud83d\\udd04 <strong>Reinsert after resolution:<\\/strong> Consider reinsertion and PD resumption only after full clinical resolution and a holiday of <span class=\'hl-symbol\'>>=<\\/span>2 weeks post-removal. \"],\"TOPIC_BLOCK_A_TITLE\":\"Targeted therapy highlights (examples)\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83e\\uddeb <strong>CoNS:<\\/strong> IP vancomycin typically 14 d. \",\"\\ud83e\\uddeb <strong>MSSA:<\\/strong> IP cefazolin (\\u00b1 rifampin per protocol) ~3 weeks. \",\"\\ud83e\\uddeb <strong>MRSA:<\\/strong> IP vancomycin 15\\u201330 mg\\/kg; repeat 3\\u20137 d to keep level <span class=\'hl-symbol\'>>=<\\/span>15 mcg\\/mL; treat ~3 weeks. \",\"\\ud83e\\udda0 <strong>Pseudomonas:<\\/strong> Two active agents (e.g., ceftazidime + aminoglycoside) for 21\\u201328 d; consider catheter removal if exit-site\\/tunnel infection. \"],\"TOPIC_BLOCK_B_TITLE\":\"Route of administration\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\udc89 <strong>Intraperitoneal (preferred):<\\/strong> Achieves high peritoneal levels; start unless patient is septic\\/bacteremic. \",\"\\ud83e\\uddea <strong>Intravenous:<\\/strong> Use when systemic sepsis or bacteremia present; may convert to IP once stable and organism known. \"],\"TOPIC_BLOCK_C_TITLE\":\"Adjuncts & practical tips\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\uddf5 <strong>Heparin:<\\/strong> 500 units\\/L IP if bloody\\/fibrinous effluent to prevent catheter clotting. \",\"\\ud83d\\udd52 <strong>Dwell time:<\\/strong> Ensure antibiotic dwell <span class=\'hl-symbol\'>>=<\\/span>6 h for efficacy. \",\"\\ud83c\\udf44 <strong>Antifungal prophylaxis:<\\/strong> Consider oral nystatin\\/fluconazole during prolonged antibiotics to reduce fungal overgrowth (program-specific). \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udccf <strong>Time to antibiotics:<\\/strong> Start empiric therapy immediately after sampling.\",\"\\ud83d\\udd01 <strong>72\\u201396 h review:<\\/strong> Document response; repeat effluent studies if not improving. \",\"\\ud83e\\uddfe <strong>Dose documentation:<\\/strong> Record mg\\/kg per bag and dwell duration in the chart.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Clinical resolution by 48\\u201372 h:<\\/strong> Less pain\\/cloudiness, improving cell counts. \",\"\\ud83d\\udd12 <strong>Technique survival:<\\/strong> Avoid unnecessary aminoglycoside exposure; preserve residual kidney function. \"],\"QUALITY_SAFETY_LI\":[\"\\u26a0\\ufe0f <strong>Vancomycin stewardship:<\\/strong> Use when indicated; monitor levels if available.\",\"\\u26a0\\ufe0f <strong>Aminoglycoside caution:<\\/strong> Limit duration; avoid if significant RKF; monitor ototoxicity. \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Do not co-instill vancomycin and gentamicin in the same dwell<\\/strong>; allow antibiotic dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; convert to IV if septic. \",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Explain plan and durations:<\\/strong> Review dosing-by-bag, dwell time, symptom monitoring, and when catheter removal is necessary; give clear return\\/ER precautions.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdPeritonitisCases\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Stable CAPD patient with cloudy effluent<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#pdPeritonitisCases\'><div class=\'accordion-body\'><ul><li><strong>Sample first:<\\/strong> Send effluent for WBC, Gram, culture. <\\/li><li><strong>Start IP empiric:<\\/strong> Cefazolin 15\\u201320 mg\\/kg per bag + ceftazidime 10\\u201320 mg\\/kg per bag in long dwell. <\\/li><li><strong>Dwell:<\\/strong> <span class=\'hl-symbol\'>>=<\\/span>6 h; separate vanc\\/gent if used. <\\/li><li><strong>Reassess 72\\u201396 h:<\\/strong> If not improved, repeat studies and consider refractory peritonitis. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Septic PD patient<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdPeritonitisCases\'><div class=\'accordion-body\'><ul><li><strong>Route:<\\/strong> Start IV broad-spectrum therapy; obtain blood cultures. <\\/li><li><strong>Source control:<\\/strong> Evaluate for secondary peritonitis; surgical consult if indicated. <\\/li><li><strong>Switch:<\\/strong> Consider switch to IP targeted therapy once stable and pathogen known.<\\/li><li><strong>Remove catheter if fungal\\/perforation:<\\/strong> Early removal + antifungals as indicated. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Refractory peritonitis (effluent still cloudy on day 5)<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdPeritonitisCases\'><div class=\'accordion-body\'><ul><li><strong>Definition:<\\/strong> Effluent not clear after 5 days of appropriate antibiotics. <\\/li><li><strong>Action:<\\/strong> Remove PD catheter; consider temporary HD; evaluate for exit-site\\/tunnel infection. <\\/li><li><strong>Reinsertion:<\\/strong> Only after complete resolution and <span class=\'hl-symbol\'>>=<\\/span>2-week holiday. <\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the preferred route for empiric antibiotics in PD peritonitis?\",\"a\":\"Intraperitoneal (IP) is preferred for most cases; use IV if the patient is septic or bacteremic. \"},{\"q\":\"Give IP dosing for cefazolin and ceftazidime in empiric therapy.\",\"a\":\"Cefazolin 15\\u201320 mg\\/kg per bag once daily; ceftazidime 10\\u201320 mg\\/kg (or 1 g\\/2\\u20133 L bag) once daily in the long dwell. \"},{\"q\":\"State an IP vancomycin regimen for MRSA peritonitis.\",\"a\":\"15\\u201330 mg\\/kg in one bag; repeat in 3\\u20137 days to maintain serum level \\u226515 mcg\\/mL; treat ~3 weeks. \"},{\"q\":\"How long should antibiotic dwells be and can vancomycin and gentamicin share a dwell?\",\"a\":\"Allow antibiotic-containing dwell \\u22656 h; do not co-instill vancomycin and gentamicin in the same dwell. \"},{\"q\":\"List three indications for PD catheter removal in peritonitis.\",\"a\":\"Refractory peritonitis (effluent not clear by day 5), relapsing\\/recurrent peritonitis, refractory exit-site\\/tunnel infection; also fungal or unresponsive Pseudomonas. \"},{\"q\":\"When must the catheter be removed immediately?\",\"a\":\"Fungal peritonitis mandates prompt catheter removal with antifungal therapy. \"},{\"q\":\"What duration of therapy is recommended for S. aureus peritonitis?\",\"a\":\"Typically 21 days (longer than other gram-positive infections). \"},{\"q\":\"Outline IP aminoglycoside dosing.\",\"a\":\"Gentamicin\\/tobramycin 0.6 mg\\/kg in one exchange per day; avoid prolonged use to preserve RKF. \"},{\"q\":\"What is the definition of refractory peritonitis?\",\"a\":\"Failure of effluent to clear after 5 days of appropriate antibiotics. \"},{\"q\":\"When can PD be resumed after catheter removal?\",\"a\":\"After complete clinical resolution and a holiday of \\u22652 weeks post-removal before reinsertion. \"},{\"q\":\"What initial lab threshold supports PD peritonitis?\",\"a\":\"Effluent WBC >100\\/mm\\u00b3 with \\u226550% PMNs is supportive of diagnosis. \"},{\"q\":\"How should suspected secondary peritonitis be managed?\",\"a\":\"Broaden coverage (e.g., add metronidazole), obtain surgical evaluation, and consider early catheter removal. \"}],\"PITFALLS_LI\":[\"\\u26a0\\ufe0f <strong>Delaying antibiotics<\\/strong> while awaiting cultures.\",\"\\u26a0\\ufe0f <strong>Using IV when IP is feasible,<\\/strong> reducing peritoneal drug levels. \",\"\\u26a0\\ufe0f <strong>Insufficient dwell time<\\/strong> (<span class=\'hl-symbol\'><<\\/span>6 h) limiting efficacy. \",\"\\u26a0\\ufe0f <strong>Not removing catheter<\\/strong> in fungal or refractory cases. \"],\"ANSWER_STEPS_OL\":[\"Confirm diagnosis with effluent cell count, Gram stain, and culture; draw blood cultures if ill. \",\"Start empiric IP antibiotics covering gram-positive and gram-negative organisms; use IV if septic. \",\"Dose per bag by weight (e.g., cefazolin 15\\u201320 mg\\/kg; ceftazidime 10\\u201320 mg\\/kg; vancomycin 15\\u201330 mg\\/kg) and ensure \\u22656 h dwell. \",\"Reassess at 72\\u201396 h; if no improvement by day 5 on appropriate therapy, remove catheter. \",\"Tailor therapy to cultures and treat for recommended durations; plan for PD resumption \\u22652 weeks after removal when appropriate. \"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83d\\udce6 <strong>Per-bag dosing concept<\\/strong> vs systemic dosing in PD.\",\"\\ud83e\\uddeb <strong>Organism-specific durations<\\/strong> (e.g., S. aureus longer). \",\"\\ud83e\\uddf5 <strong>Catheter as foreign body:<\\/strong> When and why removal aids cure. \",\"\\ud83d\\udc8a <strong>Aminoglycoside stewardship<\\/strong> to protect RKF. \"],\"TEACHING_MISTAKES_LI\":[\"\\u274c Mixing vancomycin and gentamicin in the same dwell. \",\"\\u274c Stopping empiric therapy before cultures return or without reassessment.\",\"\\u274c Ignoring polymicrobial\\/enteric signals of secondary peritonitis. \"],\"ASCII_FLOWCHART_PRE\":\"SUSPECT PD PERITONITIS (cloudy bag, pain, fever)\\n  |\\n  +--> SAMPLE EFFLUENT (WBC, Gram, culture) BEFORE ANTIBIOTICS\\n  |\\n  +--> HEMODYNAMICALLY STABLE?\\n        |-- YES --> START IP EMPIRIC: GP (vanc\\/cefazolin) + GN (ceftazidime\\/aminoglycoside)\\n        |           DOSE PER BAG, DWELL >=6H\\n        |           REASSESS 48-96H; TAILOR TO CULTURE\\n        |           IF NO IMPROVEMENT BY DAY 5 --> REMOVE CATHETER\\n        |\\n        |-- NO (SEPSIS) --> START IV BROAD SPECTRUM, BLOOD CULTURES\\n                           EVALUATE FOR SECONDARY CAUSE\\n                           REMOVE CATHETER IF FUNGAL\\/REFRACTORY\\/FE CAL PERITONITIS\\n                           CONSIDER TEMP HD\\n\",\"EVIDENCE_STUDIES_LI\":[\"ISPD-aligned empiric coverage and route summarized in Washington Manual and Comprehensive Clinical Nephrology tables. \",\"Antibiotic duration guidance (e.g., S. aureus 21 d; Pseudomonas 21\\u201328 d) per CCN table. \",\"Fungal peritonitis requires prompt catheter removal with systemic antifungal therapy. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Start IP empiric therapy covering gram-positive and gram-negative organisms after sampling; reserve IV for sepsis. \",\"Use weight-based per-bag dosing with \\u22656 h dwell; avoid prolonged aminoglycosides. \",\"Remove catheter for refractory (\\u22655 days), relapsing\\/recurrent, fungal, unresponsive Pseudomonas, NTM, or fecal peritonitis; reinsert after \\u22652 weeks when resolved. \"],\"GUIDELINE_ANCHORS_LI\":[\"Washington Manual Nephrology: IP empiric regimens, dosing per bag, and route selection. \",\"Clinical Handbook of Nephrology (2024): Practical dosing, dwell time, heparin, and catheter removal criteria. \",\"Comprehensive Clinical Nephrology (2023): Durations by organism, refractory definition\\/management, fungal removal. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'6\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ex1h\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex1\'>Unmapped pearls<\\/button><\\/h2><div id=\'ex1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>After-hours mild cases:<\\/strong> Some programs use short oral regimens pending evaluation (e.g., cephalexin\\/cefdinir\\/TMP-SMX) with next-day review. See: <em>TOPIC_BLOCK_B_TITLE<\\/em>. <\\/li><li><strong>Metronidazole add-on:<\\/strong> Consider for polymicrobial\\/anaerobic features or suspected secondary peritonitis. See: <em>IMMEDIATE_PRIORITIES_LI<\\/em>. <\\/li><li><strong>Oral quinolone options:<\\/strong> Levofloxacin\\/ciprofloxacin may be used per local protocol. See: <em>QUICK_REF_CARD_HTML<\\/em>. <\\/li><li><strong>NAC with aminoglycosides:<\\/strong> Some evidence suggests N-acetylcysteine may mitigate ototoxicity risk when aminoglycosides are necessary. <\\/li><li><strong>Refractory with exit-site\\/tunnel infection:<\\/strong> Catheter removal is advised in Pseudomonas\\/S. aureus peritonitis with exit-site or tunnel infection. <\\/li><li><strong>Culture-negative episodes:<\\/strong> Treat ~14 days if clinically improving; stop empiric once sensitivities\\/negatives guide. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ex2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'ex2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Pediatrics\\/pregnancy\\/transplant:<\\/strong> Dose adjustments and organism profiles vary; follow local pediatric\\/ob-med guidance.<\\/li><li><strong>No RKF:<\\/strong> Consider avoiding aminoglycosides when alternatives exist to preserve any residual function. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ex3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'ex3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Per-bag dosing principle:<\\/strong> Dose to the longest dwell (e.g., nighttime CAPD\\/daytime CCPD). <\\/li><li><strong>Vancomycin monitoring:<\\/strong> Keep trough \\u226515 mcg\\/mL when used for MRSA\\/enterococci. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ex4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'ex4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antibiogram-driven choices:<\\/strong> Adjust empiric regimens to local resistance patterns and program MRSA prevalence. <\\/li><\\/ul><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ex5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'ex5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Per-bag dosing table:<\\/strong> Structured fields for per-bag vs systemic dosing and dwell requirements.<\\/li><li><strong>Response milestone tracker:<\\/strong> Fields for 48 h and 96 h checkpoints.<\\/li><\\/ul><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"Empiric IP antibiotic dosing\",\"When to remove the PD catheter\",\"ISPD-aligned approach (adult)\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":4,\"viva_items\":12,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53'),
(16, NULL, 3, 1, 1, 'pd-peritonitis', 'Peritoneal Dialysis–Associated Peritonitis (Adult)', 'ISPD 2022-aligned • Empiric IP antibiotics • Catheter decision-making', 'published', 'Definition: PD peritonitis is suspected with cloudy effluent and abdominal pain; supportive diagnostic criteria include PD effluent WBC count >100 cells/mm3 with >=50% PMNs after an adequate dwell, alongside Gram stain/culture before antibiotics.  Initial treatment: Start empiric intraperitoneal (IP) antibiotics covering Gram-positive and Gram-negative organisms immediately after sampling; IP route is preferred unless septic. ', '{\"slug\":\"pd-peritonitis\",\"TOPIC\":\"Peritoneal Dialysis\\u2013Associated Peritonitis (Adult)\",\"CHIP_1\":\"ISPD 2022-aligned\",\"CHIP_2\":\"Empiric IP antibiotics\",\"CHIP_3\":\"Catheter decision-making\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Definition:<\\/strong> PD peritonitis is suspected with cloudy effluent and abdominal pain; supportive diagnostic criteria include PD effluent WBC count <span class=\'hl-symbol\'>><\\/span>100 cells\\/mm<sup>3<\\/sup> with <span class=\'hl-symbol\'>><\\/span>=50% PMNs after an adequate dwell, alongside Gram stain\\/culture before antibiotics.  <strong>Initial treatment:<\\/strong> Start empiric intraperitoneal (IP) antibiotics covering Gram-positive and Gram-negative organisms immediately after sampling; IP route is preferred unless septic. <\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e Assessment: Check vitals, sepsis screen, fluid status; obtain PD effluent for cell count\\/differential, Gram stain, and culture before antibiotics. \",\"\\ud83e\\uddea Sampling technique: Use the first cloudy bag (or after a 1\\u20132 h dwell) for analyses; send exit-site\\/tunnel swab if inflamed. \",\"\\ud83d\\udc8a Empiric IP therapy: Cover Gram-positive (vancomycin or 1st-gen cephalosporin) plus Gram-negative (3rd-gen cephalosporin or aminoglycoside) or a 4th-gen cephalosporin monotherapy. Prefer IP unless septic. \",\"\\ud83d\\udc89 Catheter care: Add intraperitoneal heparin 200\\u2013500 units\\/L if fibrin strands are present to prevent catheter occlusion. \",\"\\ud83d\\udcc8 Review at 48\\u201396 h: Expect clinical clearing within ~48 h; if no improvement by 96 h despite correct antibiotics, repeat cell count\\/Gram\\/culture and reassess source. \"],\"DDX_BUCKET_1_TITLE\":\"Infectious causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Gram-positive: Coagulase-negative staphylococci, S. aureus (MSSA\\/MRSA), streptococci, enterococci. \",\"Gram-negative: Enterobacterales, Pseudomonas spp., mixed\\/anaerobes (consider bowel pathology). \",\"Fungal peritonitis: Often post antibiotics; high mortality\\u2014prompt catheter removal plus antifungals. \",\"Mycobacterial (TB\\/NTM): Consider with subacute course or poor response. \"],\"DDX_BUCKET_2_TITLE\":\"Noninfectious mimics\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Eosinophilic\\/chemical peritonitis (allergic reaction to solution\\/equipment): Eosinophils on differential. \",\"Intra-abdominal pathology: Appendicitis, ischemia, pancreatitis; evaluate if atypical or refractory. \",\"Malignancy-related or hemorrhagic effluent (cytology if indicated). \"],\"DDX_BUCKET_3_TITLE\":\"Catheter & exit-site\\/tunnel factors\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Exit-site or tunnel infection with S. aureus or Pseudomonas: assess and treat; may necessitate catheter removal if concomitant peritonitis. \",\"Mechanical contributors (constipation, kinking, fibrin\\/clot) that mimic\\/worsen symptoms\\u2014treat constipation, restore patency. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>PD Peritonitis \\u2013 Quick Rx<\\/h5><ul class=\'mb-2\'><li><strong>Empiric IP options:<\\/strong> Vancomycin or cefazolin <em>plus<\\/em> ceftazidime\\/aminoglycoside; or cefepime monotherapy. Prefer IP route unless sepsis. <\\/li><li><strong>Durations (guide):<\\/strong> CoNS\\/streptococci <span class=\'hl-symbol\'>\\u2265<\\/span>14 d; <em>S. aureus<\\/em> 21 d; single-organism Gram-negative ~14\\u201321 d; Pseudomonas\\/Stenotrophomonas 21\\u201328 d (2 active agents).  <\\/li><li><strong>Catheter removal (consider):<\\/strong> No improvement by day 5, relapsing\\/recurrent, refractory exit-site\\/tunnel infection, fungal, pseudomonal with exit\\/tunnel, fecal peritonitis, NTM.  <\\/li><li><strong>Heparin in bag:<\\/strong> 200\\u2013500 U\\/L if fibrin strands. <\\/li><li><strong>Aminoglycoside caution:<\\/strong> Limit\\/review due to ototoxicity risk; consider early switch to 3rd-gen cephalosporin. <\\/li><li><strong>After-hours mild cases:<\\/strong> Some centers use short oral protocols with next-day review (local policy dependent). <\\/li><\\/ul><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea Effluent WBC & differential: Supportive if WBC <span class=\'hl-symbol\'>><\\/span>100\\/mm\\u00b3 with <span class=\'hl-symbol\'>><\\/span>=50% PMNs after dwell. \",\"\\ud83e\\uddeb Gram stain & culture: Inoculate promptly before antibiotics; repeat if no improvement at 96 h. \",\"\\ud83e\\uddcd\\u200d\\u2640\\ufe0f Exit-site\\/tunnel exam: Swab if erythema, tenderness, or discharge. \",\"\\ud83e\\ude7a Blood cultures: If febrile, hypotensive, or systemic signs.\",\"\\ud83d\\uddbc\\ufe0f Imaging: Consider CT\\/US if severe pain, peritoneal signs, or poor response (rule out intraabdominal source). \"],\"EMERGENCY_ALGORITHM_HTML\":\"<ol><li><strong>Recognize:<\\/strong> Cloudy bag \\u00b1 pain\\/fever; check vitals and sepsis markers.<\\/li><li><strong>Sample before Rx:<\\/strong> Send effluent for cell count\\/diff, Gram, culture; consider exit-site swab.<\\/li><li><strong>Start empiric IP antibiotics:<\\/strong> Gram-positive coverage (vancomycin or cefazolin) + Gram-negative (ceftazidime\\/aminoglycoside) or cefepime monotherapy; switch to IV if septic. <\\/li><li><strong>Adjuncts:<\\/strong> Add heparin 200\\u2013500 U\\/L for fibrin; manage pain; address constipation.<\\/li><li><strong>Reassess 48\\u201396 h:<\\/strong> Expect clearing; if not improved, repeat studies, check sensitivities, evaluate for exit\\/tunnel issues and intraabdominal pathology. <\\/li><li><strong>Catheter decisions:<\\/strong> If refractory by day 5, fungal, pseudomonal with exit\\/tunnel, or relapsing\\u2014plan removal\\/exchange and definitive source control.  <\\/li><\\/ol>\",\"PILLAR_1\":\"Stabilize & Diagnose\",\"STEP_1_TITLE\":\"Resuscitation & sampling\",\"STEP_1_LI\":[\"Sepsis screening and hemodynamic support as needed.\",\"Obtain effluent WBC\\/diff, Gram, culture before first antibiotic dose. \"],\"STEP_2_TITLE\":\"Empiric coverage (IP preferred)\",\"STEP_2_LI\":[\"Vancomycin or cefazolin for Gram-positive coverage. \",\"Ceftazidime or an aminoglycoside for Gram-negative coverage; cefepime monotherapy is an option. \"],\"PILLAR_2\":\"Targeted Therapy & Source Control\",\"STEP_3_TITLE\":\"Tailor to culture & response\",\"STEP_3_LI\":[\"CoNS\\/streptococci: total ~14 d; S. aureus: ~21 d. \",\"Single-organism Gram-negatives: ~14\\u201321 d; Pseudomonas\\/Stenotrophomonas: 21\\u201328 d with 2 active agents. \"],\"STEP_4_TITLE\":\"Catheter & complications\",\"STEP_4_LI\":[\"Remove catheter for fungal peritonitis; continue antifungal \\u22652 weeks post-removal. \",\"Remove or exchange catheter if refractory by day 5, relapsing\\/recurrent, or with refractory exit\\/tunnel infection. \"],\"TOPIC_BLOCK_A_TITLE\":\"Empiric antibiotic choices\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"Recommended IP empiric: cefazolin + ceftazidime; alternative: vancomycin + aminoglycoside; or cefepime monotherapy. \",\"Use IV route if systemic sepsis or unable to use IP route.\",\"Avoid prolonged aminoglycosides\\u2014ototoxicity risk; consider early de-escalation\\/switch. \"],\"TOPIC_BLOCK_B_TITLE\":\"Treat by organism (typical durations)\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"CoNS\\/other streptococci: ~14 d. \",\"S. aureus: ~21 d; screen for carriage and manage exit-site\\/tunnel if present. \",\"Enterococci: ~21 d (consider vancomycin if susceptible). \",\"Pseudomonas\\/Stenotrophomonas: 21\\u201328 d with two active agents; consider catheter removal if exit\\/tunnel infection.  \",\"Mixed\\/anaerobes: Add anaerobic cover and evaluate for intraabdominal source. \"],\"TOPIC_BLOCK_C_TITLE\":\"Catheter & exit-site\\/tunnel management\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"Indications for removal: refractory peritonitis (no clearing by day 5), relapsing\\/recurrent, refractory exit-site\\/tunnel infection, fungal, NTM, fecal peritonitis, mechanical failure. \",\"Fungal peritonitis: remove catheter promptly and treat with appropriate antifungal \\u22652 weeks post-removal. \"],\"QUALITY_PROCESS_LI\":[\"Time-to-antibiotics: <2 h from presentation after sampling.\",\"48\\u201396 h review: document clinical and effluent response; repeat labs if not improving. \",\"Culture stewardship: narrow to sensitivities and set stop dates per organism.\"],\"QUALITY_OUTCOME_LI\":[\"Technique survival: minimize catheter removal through early, appropriate therapy. \",\"Symptom resolution within 48\\u201372 h in uncomplicated cases. \"],\"QUALITY_SAFETY_LI\":[\"Avoid aminoglycoside overexposure (ototoxicity); track cumulative dosing and consider NAC if used per local practice. \",\"Flag high-risk pathogens (Pseudomonas, fungi) for early senior review and catheter planning.  \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f Ototoxicity risk with aminoglycosides\\u2014limit duration, monitor levels\\/residual hearing, and switch to safer alternatives when possible. \",\"COMMUNICATION_LI\":\"Discuss antibiotic plan, expected timeline (48\\u201396 h), and criteria for catheter removal with patient\\/caregiver; provide home instructions for after-hours deterioration and when to call.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesPD\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>CAPD patient with first episode of cloudy effluent<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Sampling:<\\/strong> Send WBC\\/diff, Gram, culture from the first cloudy bag before antibiotics. <\\/li><li><strong>Empiric IP:<\\/strong> Cefazolin + ceftazidime. <\\/li><li><strong>Adjunct:<\\/strong> Add heparin 200\\u2013500 U\\/L if fibrin noted. <\\/li><li><strong>Follow-up:<\\/strong> Reassess at 48\\u201372 h for clearing; if not improved by 96 h, re-evaluate. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Pseudomonas peritonitis with tender exit-site<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Therapy:<\\/strong> Two active agents (e.g., ceftazidime + aminoglycoside) for 21\\u201328 d. <\\/li><li><strong>Catheter:<\\/strong> Remove if concomitant exit\\/tunnel infection. <\\/li><li><strong>Evaluate source:<\\/strong> Consider GI source if polymicrobial\\/anaerobes. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Culture-negative peritonitis<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'><div class=\'accordion-body\'><ul><li><strong>Definition:<\\/strong> Persistence of symptoms with supportive WBC criteria and negative cultures.<\\/li><li><strong>Duration:<\\/strong> Treat for ~14 d if improving. <\\/li><li><strong>If not improving:<\\/strong> Repeat cell count\\/Gram\\/culture; reassess for TB\\/NTM, fungi, or noninfectious mimics.  <\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the supportive diagnostic threshold for PD peritonitis on effluent analysis?\",\"a\":\"WBC >100\\/mm\\u00b3 with \\u226550% PMNs after an adequate dwell, alongside compatible symptoms and microscopy. \"},{\"q\":\"Which route is preferred for empiric antibiotics in PD peritonitis?\",\"a\":\"Intraperitoneal, unless the patient is septic or IP route is not feasible. \"},{\"q\":\"Give a standard empiric IP regimen.\",\"a\":\"Cefazolin plus ceftazidime (or vancomycin plus aminoglycoside). \"},{\"q\":\"How long do you treat S. aureus PD peritonitis?\",\"a\":\"About 21 days, tailored to sensitivities and clinical response. \"},{\"q\":\"List two indications to remove the PD catheter.\",\"a\":\"Refractory peritonitis (no clearing by day 5) and fungal peritonitis; also relapsing\\/recurrent or refractory exit-site\\/tunnel infection.  \"},{\"q\":\"How do you manage fibrin strands obstructing drainage?\",\"a\":\"Add 200\\u2013500 U\\/L heparin to dialysate to prevent catheter clotting. \"},{\"q\":\"When should you suspect intraabdominal pathology?\",\"a\":\"Polymicrobial\\/anaerobic peritonitis or lack of improvement by 96 h warrants evaluation for bowel disease.  \"},{\"q\":\"What is a key toxicity concern with aminoglycosides in PD peritonitis?\",\"a\":\"Ototoxicity; limit exposure and consider switching to cephalosporins when possible. \"},{\"q\":\"Define relapsing peritonitis.\",\"a\":\"Recurrence with the same organism or sterile peritonitis within 4 weeks after completing therapy; consider catheter removal. \"},{\"q\":\"What is the approach to culture-negative peritonitis?\",\"a\":\"If clinically improving, treat ~14 days; if not, repeat studies and broaden differential (TB\\/NTM, fungi, noninfectious).  \"},{\"q\":\"When is exit-site\\/tunnel assessment crucial in peritonitis?\",\"a\":\"Always; especially with S. aureus or Pseudomonas peritonitis\\u2014concomitant infection can mandate catheter removal. \"}],\"PITFALLS_LI\":[\"Delaying antibiotics while waiting for culture\\u2014sample first, then treat immediately. \",\"Under-dosing or omitting Gram-negative coverage in empiric therapy. \",\"Prolonged aminoglycoside use causing ototoxicity\\u2014avoid repeated\\/prolonged courses. \",\"Failure to re-evaluate at 96 h if not improving\\u2014missed intraabdominal or atypical infections. \",\"Not inspecting exit-site\\/tunnel in S. aureus\\/Pseudomonas infections\\u2014miss indication for catheter removal. \"],\"ANSWER_STEPS_OL\":[\"Confirm suspicion from symptoms and cloudy effluent.\",\"Send effluent for WBC\\/differential, Gram stain, and culture before antibiotics. \",\"Start IP empiric antibiotics covering Gram-positive and Gram-negative organisms. \",\"Add heparin if fibrin present; address constipation and pain. \",\"Review at 48\\u201396 h; narrow to sensitivities and set duration by organism.  \",\"Plan catheter removal if refractory by day 5, fungal, pseudomonal with exit\\/tunnel, or relapsing.  \"],\"TEACHING_CONCEPTS_LI\":[\"Why IP route is preferred in PD peritonitis and when to use IV. \",\"Interpreting effluent WBC\\/differential thresholds. \",\"Duration logic by pathogen (14 vs 21\\u201328 days).  \"],\"TEACHING_MISTAKES_LI\":[\"Treating without sampling the first bag.\",\"Not reassessing at 96 h when failing to improve. \",\"Ignoring exit-site\\/tunnel status in S. aureus or Pseudomonas. \"],\"ASCII_FLOWCHART_PRE\":\"Suspected PD peritonitis (cloudy bag +\\/- pain)\\n        |\\n        v\\nSample FIRST -> cell count\\/diff, Gram, culture (before antibiotics)\\n        |\\n        v\\nStart empiric IP: (vanco OR cefazolin) + (ceftazidime OR aminoglycoside) OR cefepime\\n        |\\n        v\\nAdjuncts: heparin 200-500 U\\/L if fibrin; constipation tx; analgesia\\n        |\\n        v\\nReassess 48-96 h -> improving? --yes--> continue, total duration by organism (14-28 d)\\n                           |\\n                           no\\n                           v\\nRepeat studies; evaluate exit\\/tunnel & intraabdominal source; consider catheter removal by day 5 or earlier if fungal\\/complex\",\"EVIDENCE_STUDIES_LI\":[\"ISPD Peritonitis Guideline Recommendations: 2022 update on prevention and treatment (summary referenced). \",\"Antibiotic duration heuristics and need for early reassessment (Comprehensive Clinical Nephrology).  \",\"Catheter removal triggers including fungal and refractory courses (textbook synthesis).  \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Empiric therapy should start immediately after sampling, preferably via the IP route, with Gram-positive and Gram-negative coverage. \",\"If no improvement within 96 h despite appropriate antibiotics, repeat diagnostics and assess for exit\\/tunnel involvement and intraabdominal sources; plan catheter removal if refractory by day 5. \",\"Avoid prolonged aminoglycosides due to ototoxicity; de-escalate when possible. \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD Peritonitis Guideline Recommendations: 2022 update (Perit Dial Int. 2022). \",\"ISPD Catheter-Related Infections Recommendations: 2017 update (context for exit-site\\/tunnel). \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'8\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extras1\'>Unmapped pearls<\\/button><\\/h2><div id=\'extras1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Outpatient vs inpatient:<\\/strong> Many episodes can be managed as outpatient with close follow-up; ensure next-day review. <\\/li><li><strong>After-hours protocol:<\\/strong> Some centers use limited oral cover until in-clinic review for mild cases\\u2014follow local policy. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extras2\'>Edge cases & special populations<\\/button><\\/h2><div id=\'extras2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>NTM\\/TB peritonitis:<\\/strong> Consider in subacute, culture-negative cases with poor response; obtain mycobacterial cultures\\/biopsy. <\\/li><li><strong>Polymicrobial\\/anaerobic infections:<\\/strong> Evaluate for bowel pathology (e.g., perforation\\/diverticulitis). <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extras3\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'extras3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Aminoglycosides:<\\/strong> Use sparingly; monitor for ototoxicity; consider early switch to cephalosporin. <\\/li><li><strong>Heparin adjunct:<\\/strong> 200\\u2013500 U\\/L intraperitoneal for fibrin; does not anticoagulate systemically. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extras4\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'extras4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Culture logistics:<\\/strong> Ensure lab can process PD effluent appropriately; use blood culture bottles if required (local SOP). See: <em>INVESTIGATIONS_LI<\\/em>.<\\/li><li><strong>Sepsis escalation:<\\/strong> If unstable, give IV broad-spectrum therapy, blood cultures, and consider temporary HD support. See: <em>EMERGENCY_ALGORITHM_HTML<\\/em>.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extras5\'>Suggested schema extensions<\\/button><\\/h2><div id=\'extras5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antibiotic dosing table (IP vs IV):<\\/strong> Add per-kg dose, intervals by CAPD\\/APD, and target serum levels.<\\/li><li><strong>Local antibiogram field:<\\/strong> Capture center-specific empiric choices based on resistance trends.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"ISPD 2022-aligned\",\"Empiric IP antibiotics\",\"Catheter decision-making\"],\"section_counts\":{\"immediate_priorities\":5,\"investigations\":5,\"viva_items\":11,\"pitfalls\":5}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(17, NULL, 3, 1, 1, 'pd-poor-outflow-2l-in-1l-out-approach', 'Peritoneal dialysis (PD) poor outflow: 2 L infused, 1 L drained — structured approach', 'PD catheter malfunction • Outflow failure troubleshooting • Constipation • fibrin • migration', 'published', 'Presentation: A stable 40-year-old on PD reports that after instilling 2 L, only ~1 L drains. This is classic for outflow failure (volume out < volume in) and is most often mechanical. Start with bedside fixes, rapidly exclude peritonitis and leaks, then escalate to imaging and catheter salvage.', '{\"slug\":\"pd-poor-outflow-2l-in-1l-out-approach\",\"TOPIC\":\"Peritoneal dialysis (PD) poor outflow: 2 L infused, 1 L drained \\u2014 structured approach\",\"CHIP_1\":\"PD catheter malfunction\",\"CHIP_2\":\"Outflow failure troubleshooting\",\"CHIP_3\":\"Constipation \\u2022 fibrin \\u2022 migration\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Presentation:<\\/strong> A stable 40-year-old on PD reports that after instilling 2 L, only ~1 L drains. This is classic for <em>outflow failure<\\/em> (volume out < volume in) and is most often mechanical. Start with bedside fixes, rapidly exclude peritonitis and leaks, then escalate to imaging and catheter salvage.<\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83d\\udd0e <strong>Confirm true retention:<\\/strong> check weight change from pre-fill, inspect lines\\/clamps for kinks, ensure all clamps are open; attempt gravity drain with the patient supine then sitting\\/side-to-side.\",\"\\ud83e\\uddfb <strong>Treat constipation now:<\\/strong> it is the most common cause of PD catheter malfunction; start an aggressive bowel regimen and reassess drainage. \",\"\\ud83e\\uded9 <strong>Rule out bladder distension:<\\/strong> scan bladder; decompress if needed to relieve extrinsic compression on the catheter. \",\"\\ud83e\\uddea <strong>Exclude peritonitis early:<\\/strong> if effluent is cloudy or patient has pain\\/fever, send cell count, Gram stain, and culture and treat per guideline; refractory or fungal infection may mandate catheter removal. \",\"\\ud83e\\ude78 <strong>Try intraluminal clearance:<\\/strong> flush with 20\\u201350 mL heparinized normal saline; if persistent, instill tPA 1 mg\\/mL (8 mL) for 1\\u20132 h, then aspirate\\/flush. If flow returns, add heparin 500 U\\/L to subsequent PD bags to suppress fibrin.   \",\"\\ud83d\\uddbc\\ufe0f <strong>Imaging if still poor outflow:<\\/strong> obtain KUB to confirm catheter tip in pelvis and check for kinking\\/migration; CT if plain film is non-diagnostic. \"],\"DDX_BUCKET_1_TITLE\":\"Mechanical outflow problems (most likely)\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Severe constipation causing extrinsic compression of catheter\\/rectosigmoid crowding. \",\"Catheter tip migration to upper abdomen or kinking. \",\"Omental wrapping\\/adhesions acting like a flap valve at side holes. \",\"Intraluminal fibrin or clot causing two-way obstruction. \"],\"DDX_BUCKET_2_TITLE\":\"Inflammatory\\/infectious\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Peritonitis with fibrin and pain; may impair drainage; manage per ISPD peritonitis guidance (consider removal if refractory). \",\"Exit-site\\/tunnel infection causing pain\\/guarding limiting drainage; escalate if refractory. \"],\"DDX_BUCKET_3_TITLE\":\"Dialysate leak \\/ compartmentalization\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Early\\/late leaks (scrotal\\/labial, abdominal wall) or hernia with sequestration; suspect if weight up, edema, or genital swelling; use low volumes and rest PD; investigate if persistent. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'row g-2\'><div class=\'col-md-6\'><div class=\'card p-2\'><h6>Do first<\\/h6><ul class=\'mb-0\'><li><strong>Unkink\\/unclamp<\\/strong> lines; try position changes.<\\/li><li><strong>Bowel regimen<\\/strong> (oral laxative \\u00b1 enema).<\\/li><li><strong>Rule out peritonitis<\\/strong> (cell count & culture if cloudy\\/pain).<\\/li><\\/ul><\\/div><\\/div><div class=\'col-md-6\'><div class=\'card p-2\'><h6>Then<\\/h6><ul class=\'mb-0\'><li><strong>Flush<\\/strong> 20\\u201350 mL heparinized NS.<\\/li><li><strong>tPA<\\/strong> 8 mL (1 mg\\/mL) dwell 1\\u20132 h if needed.<\\/li><li><strong>KUB<\\/strong> for tip\\/kink; CT if unclear.<\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"Line check: clamps open, no kinks; try gravity drain in multiple positions.\",\"Vitals\\/weight; abdominal and exit-site exam; bladder scan for distension. \",\"PD effluent if suspicious: WBC with differential, Gram stain, culture; follow per peritonitis algorithm. \",\"KUB (AP \\u00b1 lateral): confirm pelvic tip; look for kinking\\/migration; CT if non-diagnostic. \",\"Trial heparinized NS flush; if unsuccessful, intraluminal tPA dwell and reassess flow. \",\"If persistent: consider fluoroscopic manipulation (Fogarty\\/guidewire) or laparoscopic revision. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'algorithm\'><ol class=\'mb-2\'><li><strong>Assess stability:<\\/strong> pain, fever, dyspnea, severe distension \\u2192 manage ABCs; if peritonitis suspected, send effluent and start empiric therapy.<\\/li><li><strong>Immediate bedside measures:<\\/strong> unkink\\/unclamp; position changes; gravity drain; initiate bowel regimen.<\\/li><li><strong>Patency attempt:<\\/strong> 20\\u201350 mL heparinized saline flush \\u2192 if no flow, tPA 8 mL (1 mg\\/mL) dwell 1\\u20132 h \\u2192 aspirate\\/flush.<\\/li><li><strong>Imaging:<\\/strong> KUB for tip\\/kink \\u2192 CT if needed. If malposition\\/entrapment, consider fluoroscopic or surgical correction.<\\/li><li><strong>Prevent recurrence:<\\/strong> add heparin 500 U\\/L to bags if fibrin; maintain bowel regularity; adjust PD prescription (e.g., tidal) if needed.<\\/li><\\/ol><\\/div>\",\"PILLAR_1\":\"Identify and reverse common mechanical causes\",\"STEP_1_TITLE\":\"Constipation relief & external factors\",\"STEP_1_LI\":[\"Start laxatives \\u00b1 enema immediately; constipation is the leading cause of poor outflow. \",\"Ensure no clamps\\/kinks; check patient posture; try side-to-side and sitting to drain.\"],\"STEP_2_TITLE\":\"Intraluminal obstruction relief\",\"STEP_2_LI\":[\"Heparinized NS flush 20\\u201350 mL; repeat if partially successful. \",\"tPA 1 mg\\/mL, 8 mL dwell for 1\\u20132 h, then aspirate\\/flush; if flow returns, add heparin 500 U\\/L to each bag thereafter.   \"],\"PILLAR_2\":\"Escalate imaging and procedural management\",\"STEP_3_TITLE\":\"Imaging to localize the problem\",\"STEP_3_LI\":[\"KUB to confirm pelvic tip and detect kinks\\/migration; CT if not visualized. \",\"Outflow failure definition: failure to drain dwelling fluid within ~45 min supports mechanical malfunction. \"],\"STEP_4_TITLE\":\"Catheter salvage or revision\",\"STEP_4_LI\":[\"Fluoroscopic manipulation (Fogarty\\/guidewire) can reposition; long-term success ~27\\u201348%; consider surgical revision\\/new catheter if recurrent entrapment\\/omental wrap. \",\"Consider removal for refractory peritonitis, adhesions\\/loculation, malposition, or poor peritoneal blood flow. \"],\"TOPIC_BLOCK_A_TITLE\":\"Common causes & bedside fixes\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>Constipation<\\/strong>: most common; treat aggressively and maintain regular bowel care. \",\"\\ud83e\\uddf5 <strong>Fibrin\\/clot<\\/strong>: heparinized flush; add 500 U\\/L to subsequent bags; consider tPA if persistent.  \",\"\\ud83d\\udd04 <strong>Tip migration\\/kink<\\/strong>: KUB to confirm pelvic tip; CT if needed. \"],\"TOPIC_BLOCK_B_TITLE\":\"When to suspect complications\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\udd25 <strong>Peritonitis<\\/strong>: cloudy effluent, pain, fever; treat per protocol; refractory cases need catheter removal. \",\"\\ud83d\\udca7 <strong>Dialysate leak<\\/strong>: genital\\/abdominal wall swelling, weight gain; reduce volumes, daytime dry; evaluate if persistent. \",\"\\ud83e\\uddf2 <strong>Omental wrap\\/adhesions<\\/strong>: recurrent outflow failure despite bowel care\\/flushes; consider fluoroscopic or surgical correction. \"],\"TOPIC_BLOCK_C_TITLE\":\"Prescription tweaks to mitigate symptoms\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83d\\udecf\\ufe0f <strong>Tidal APD<\\/strong> with residual volume can reduce drain pain\\/alarms in slow outflow; ensure safety checks for total intraperitoneal volume. \",\"\\ud83e\\ude7a <strong>Temporary low-volume exchanges<\\/strong> (e.g., 1\\u20131.5 L) while troubleshooting to avoid overdistension\\/leaks. \"],\"QUALITY_PROCESS_LI\":[\"Document drain failure episodes (timing, positions tried, interventions, volumes) and response.\",\"Standardize bowel regimen protocol for all PD patients to prevent constipation-related failures. \",\"Standing order set for heparinized flush and tPA dwell with clear aseptic technique steps. \"],\"QUALITY_OUTCOME_LI\":[\"Reduced unplanned HD transfers due to PD malfunction.\",\"Shorter time to restored catheter function after drain failure.\",\"Lower rate of catheter revisions\\/replacements for mechanical causes.\"],\"QUALITY_SAFETY_LI\":[\"Aseptic technique for any intraluminal manipulation to avoid introducing peritonitis. \",\"Avoid excessive intraperitoneal volumes during troubleshooting to reduce leak risk. \"],\"SAFETY_LI\":\"If severe abdominal pain, peritonitis signs, or respiratory compromise from retained fluid develops, treat as urgent: send effluent, start empiric antibiotics if indicated, and escalate to imaging\\/procedural relief.\",\"COMMUNICATION_LI\":\"Explain to the patient that constipation and catheter position are common, fixable causes; review bowel regimen, positioning tricks, and when to call for cloudy effluent or severe pain.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'casesPD\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: CAPD with new poor drainage<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> 2 L in, ~1 L out; no fever; mild bloating; constipated.<\\/li>\\n          <li><strong>Actions:<\\/strong> start laxative + enema; line check; posture maneuvers; gravity drain.<\\/li>\\n          <li><strong>If persistent:<\\/strong> heparinized NS flush; add heparin 500 U\\/L to bags if fibrin noted. <\\/li>\\n          <li><strong>Outcome:<\\/strong> full drains resumed after bowel movement.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: APD with repeated drain alarms<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> slow outflow on cycler; no peritonitis signs.<\\/li>\\n          <li><strong>Actions:<\\/strong> KUB shows tip high; attempt tPA dwell failed; fluoroscopic reposition performed.  <\\/li>\\n          <li><strong>Prescription:<\\/strong> tidal APD temporarily to reduce alarms. <\\/li>\\n          <li><strong>Outcome:<\\/strong> improved drainage; later elective surgical omentopexy.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: Cloudy effluent and pain with poor drain<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#casesPD\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> pain, fever, cloudy effluent; drain sluggish.<\\/li>\\n          <li><strong>Actions:<\\/strong> send effluent for analysis; start empiric IP antibiotics per protocol. <\\/li>\\n          <li><strong>Course:<\\/strong> effluent failed to clear by day 5 \\u2192 catheter removed; PD restarted after holiday and clinical resolution. <\\/li>\\n          <li><strong>Prevention:<\\/strong> reinforce asepsis; early reporting of symptoms.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"Define PD outflow failure at the bedside.\",\"a\":\"Failure to drain the dwelling fluid within about 45 minutes (often preceded by sluggish outflow) suggests mechanical malfunction. \"},{\"q\":\"List four common causes of PD poor outflow.\",\"a\":\"Constipation; catheter tip migration\\/kink; omental wrapping\\/adhesions; intraluminal fibrin or clot.  \"},{\"q\":\"First-line bedside maneuvers to restore drainage?\",\"a\":\"Unkink\\/unclamp lines; position changes; aggressive bowel regimen; gravity drain trials.\"},{\"q\":\"Heparin and tPA roles and doses?\",\"a\":\"Flush 20\\u201350 mL heparinized NS; if persistent obstruction, tPA 1 mg\\/mL (8 mL) dwell for 1\\u20132 h, then aspirate\\/flush; if flow returns, add heparin 500 U\\/L to bags to suppress fibrin.   \"},{\"q\":\"Which imaging do you order and why?\",\"a\":\"Start with KUB to confirm pelvic tip and look for kinks\\/migration; CT if plain film is non-diagnostic. \"},{\"q\":\"When do you suspect a leak?\",\"a\":\"If weight increases, genital\\/abdominal wall swelling, or hernia; reduce volumes and consider rest\\/daytime dry while evaluating. \"},{\"q\":\"What peritonitis feature mandates catheter removal?\",\"a\":\"Refractory peritonitis\\u2014effluent fails to clear after 5 days of appropriate therapy; fungal peritonitis also often requires removal. \"},{\"q\":\"Role and success of fluoroscopic catheter repositioning?\",\"a\":\"Useful for migration\\/entrapment (Fogarty\\/guidewire), but long-term success ~27\\u201348%; many require surgical solution\\/new catheter. \"},{\"q\":\"How can APD prescription be adjusted for slow outflow?\",\"a\":\"Use tidal APD with residual volume to reduce drain alarms\\/pain (ensure algorithm safeguards to limit total intraperitoneal volume). \"},{\"q\":\"Name indications for PD catheter removal unrelated to infection.\",\"a\":\"Adhesions\\/loculation, malpositioned catheter, poor peritoneal blood flow, and mechanical failure unamenable to salvage. \"},{\"q\":\"What is the simplest and most effective prevention strategy for outflow failure?\",\"a\":\"Proactive constipation prevention with a standing bowel regimen and patient education. \"}],\"PITFALLS_LI\":[\"Missing constipation and escalating to invasive steps prematurely. \",\"Forgetting to check for a closed clamp\\/kink or bladder distension.\",\"Aggressive repeated negative pressure aspiration risking catheter injury\\/infection.\",\"Delaying peritonitis workup when effluent is cloudy or pain\\/fever present. \",\"Using large dwell volumes during troubleshooting, precipitating leaks. \"],\"ANSWER_STEPS_OL\":[\"Confirm malfunction (lines\\/clamps\\/posture) and attempt gravity drain.\",\"Immediate bowel regimen; reassess.\",\"Screen for peritonitis if any red flags (cloudy\\/pain\\/fever) and treat per protocol.\",\"Heparinized NS flush 20\\u201350 mL; repeat if partial response.\",\"If no flow: tPA 1 mg\\/mL, 8 mL dwell 1\\u20132 h \\u2192 aspirate\\/flush; then add heparin 500 U\\/L to bags if fibrin identified.\",\"KUB \\u00b1 CT to confirm pelvic tip and exclude kinking\\/migration.\",\"If malposition\\/entrapment: fluoroscopic manipulation vs surgical revision; consider new catheter if recurrence.\",\"Address contributing factors (bowel care, prescription tweaks like tidal APD) and educate on prevention.\"],\"TEACHING_CONCEPTS_LI\":[\"Outflow failure is typically mechanical; constipation leads the list. \",\"tPA and heparin have complementary roles for fibrin-related obstruction.  \",\"KUB is often sufficient to diagnose migration\\/kink; CT for equivocal cases. \",\"Tidal APD can be a symptom-relieving bridge when outflow is slow. \"],\"TEACHING_MISTAKES_LI\":[\"Assuming ultrafiltration failure when the problem is actually outflow obstruction.\",\"Skipping aseptic technique during catheter manipulations, causing iatrogenic peritonitis. \",\"Persisting with large-volume fills despite suspected leak, worsening extravasation. \"],\"ASCII_FLOWCHART_PRE\":\"START -> Line\\/kink check & position changes -> drains?\\n  YES -> Observe & prevent recurrence (bowel regimen, +\\/- heparin 500 U\\/L)\\n  NO -> Treat constipation NOW -> drains?\\n    YES -> Continue bowel plan; add prevention\\n    NO -> Heparinized NS flush 20-50 mL -> flow?\\n      YES -> Add heparin 500 U\\/L to bags; monitor\\n      NO -> tPA 1 mg\\/mL, 8 mL dwell 1-2 h -> flow?\\n        YES -> Add heparin 500 U\\/L; monitor\\n        NO -> KUB (pelvic tip? kink?) +\\/- CT -> malposition\\/entrapment?\\n          YES -> Fluoro manipulation or surgical revision\\/new catheter\\n          NO -> Evaluate for peritonitis\\/leak; manage accordingly\",\"EVIDENCE_STUDIES_LI\":[\"Handbook algorithm for PD catheter malfunction: causes (constipation, migration, fibrin\\/clot), definition of outflow failure, and stepwise management including heparinized flush and tPA dwell.   \",\"Comprehensive Clinical Nephrology: omental wrap mechanism, success rates of repositioning (27\\u201348%), and heparin 500 U\\/L for fibrin-related flow restriction.  \",\"Leak risk and low-volume strategies after catheter placement and during troubleshooting. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Begin with conservative measures (bowel care, line checks, positioning) before invasive steps in PD outflow failure. \",\"Use heparinized saline flush; if needed, tPA dwell for intraluminal obstruction; add heparin 500 U\\/L to dialysate when fibrin present.   \",\"Obtain KUB to verify tip position; escalate to CT\\/fluoroscopic or surgical management if malposition\\/entrapment suspected.  \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD access and membrane function recommendations summarized in the clinical handbook (technique failure, UF failure, imaging and interventions).  \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'7\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'u1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u1\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'u1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Triage:<\\/strong> If >=1 L retained and symptomatic, consider temporary low-volume exchanges to avoid overdistension while troubleshooting. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li>\\n          <li><strong>Drain pain:<\\/strong> Tidal APD can mitigate pain from complete drains. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li>\\n          <li><strong>Two-way block:<\\/strong> Fibrin\\/clot may impair both inflow and outflow; escalate early to tPA if flush fails. See: <em>STEP_2_TITLE<\\/em>. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'u2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u2\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'u2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Early post-insertion:<\\/strong> Prefer low-volume supine APD to reduce leak risk. <\\/li>\\n          <li><strong>Hernias\\/leaks:<\\/strong> Consider temporary PD rest or surgical repair if persistent. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'u3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u3\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'u3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Heparin in dialysate:<\\/strong> 500 U\\/L when fibrin is present; avoid if active bleeding risk. <\\/li>\\n          <li><strong>tPA dwell:<\\/strong> 8 mL of 1 mg\\/mL for 1\\u20132 h intra-catheter; use aseptic technique to minimize infection risk. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'u4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u4\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'u4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Standing order set:<\\/strong> Nursing protocol for heparinized flush\\/tPA dwell with criteria to escalate to imaging\\/intervention. See: <em>QUALITY_PROCESS_LI<\\/em>.<\\/li>\\n          <li><strong>Documentation:<\\/strong> Standardize drain failure note (volumes in\\/out, interventions, response).<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'u5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#u5\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'u5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Catheter-specific details:<\\/strong> Fields for tip location, cuff status, and recent imaging.<\\/li>\\n          <li><strong>PD prescription:<\\/strong> Fields for APD vs CAPD, tidal settings, dwell volumes\\/osmolarity.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"PD catheter malfunction\",\"Outflow failure troubleshooting\",\"Constipation \\u2022 fibrin \\u2022 migration\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":6,\"viva_items\":11,\"pitfalls\":5}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(18, NULL, 3, 1, 1, 'pd-recurrent-peritonitis-eps', 'Peritoneal dialysis (PD) recurrent peritonitis and Encapsulating Peritoneal Sclerosis (EPS)', 'ISPD 2022 peritonitis definitions • When to remove the PD catheter • EPS recognition, CT features, and management', 'published', 'Essentials: Recurrent PD peritonitis signals technique or anatomical problems, raises risk of membrane damage, and is linked to later EPS. Apply ISPD definitions (relapsing vs recurrent vs repeat), treat according to organism and duration, and have a low threshold for catheter removal in refractory/relapsing or fungal episodes. Screen EPS in long-term PD with ultrafiltration failure, weight loss, and abdominal symptoms; CT can show the classic \'cocoon\'.   ', '{\"slug\":\"pd-recurrent-peritonitis-eps\",\"TOPIC\":\"Peritoneal dialysis (PD) recurrent peritonitis and Encapsulating Peritoneal Sclerosis (EPS)\",\"CHIP_1\":\"ISPD 2022 peritonitis definitions\",\"CHIP_2\":\"When to remove the PD catheter\",\"CHIP_3\":\"EPS recognition, CT features, and management\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p><strong>Essentials:<\\/strong> Recurrent PD peritonitis signals technique or anatomical problems, raises risk of membrane damage, and is linked to later EPS. Apply ISPD definitions (relapsing vs recurrent vs repeat), treat according to organism and duration, and have a low threshold for catheter removal in refractory\\/relapsing or fungal episodes. Screen EPS in long-term PD with ultrafiltration failure, weight loss, and abdominal symptoms; CT can show the classic \'cocoon\'.   <\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Stabilize sepsis:<\\/strong> Assess vitals, perfusion, and start broad empiric intraperitoneal (IP) antibiotics without delay after drawing dialysate\\/blood cultures. Escalate care if hemodynamically unstable. \",\"\\ud83e\\uddea <strong>Sample correctly:<\\/strong> Send effluent cell count\\/differential and culture after a dwell of about 2 hours when possible; repeat if initial WBC is <span class=\'hl-symbol\'><<\\/span>100\\/\\u00b5L but symptoms persist. \",\"\\ud83d\\udc8a <strong>Choose regimen + duration by organism:<\\/strong> Typical courses: Gram-positives 14 days (S. aureus 21 days); Gram-negatives 21 days; Pseudomonas 21\\u201328 days (often 2 agents). Avoid prolonged aminoglycosides; consider N-acetylcysteine with aminoglycoside to limit ototoxicity.  \",\"\\ud83e\\uddf7 <strong>Know removal triggers:<\\/strong> Remove catheter for refractory (no improvement by day 5), relapsing, fungal, and refractory exit-site\\/tunnel infection; continue systemic antibiotics after removal.  \",\"\\ud83d\\udd0e <strong>Look for secondary causes:<\\/strong> Mixed\\/anaerobic growth suggests intra-abdominal source\\u2014obtain surgical consult and imaging. \",\"\\ud83e\\udded <strong>Flag EPS risk:<\\/strong> Long PD duration, recurrent peritonitis, UF failure, weight loss; evaluate with contrast CT if suspected. \"],\"DDX_BUCKET_1_TITLE\":\"Recurrent\\/relapsing infectious peritonitis on PD\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\u2705 <strong>Relapsing peritonitis:<\\/strong> Same organism within 4 weeks of completing therapy. \",\"\\u2705 <strong>Recurrent peritonitis:<\\/strong> Different organism within 4 weeks of completing therapy. \",\"\\u2705 <strong>Repeat peritonitis:<\\/strong> Same organism <span class=\'hl-symbol\'>><\\/span>4 weeks after completing therapy (often prompts search for biofilm\\/focus). \",\"\\u2705 <strong>Fungal peritonitis:<\\/strong> Requires prompt catheter removal and antifungals (at least 2 weeks after removal). \"],\"DDX_BUCKET_2_TITLE\":\"Noninfectious\\/secondary causes mimicking PD peritonitis\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Secondary peritonitis:<\\/strong> Multiple organisms\\/anaerobes\\u2014consider perforated viscus; surgical evaluation. \",\"\\ud83d\\udd0e <strong>Eosinophilic\\/allergic peritonitis:<\\/strong> Consider drug\\/allergy if eosinophils predominate. \",\"\\ud83d\\udd0e <strong>Chemical peritonitis:<\\/strong> Avoid intraperitoneal amphotericin B. \"],\"DDX_BUCKET_3_TITLE\":\"Encapsulating Peritoneal Sclerosis (EPS) and PD membrane failure\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>EPS:<\\/strong> Long PD duration strongest risk; recurrent peritonitis adds risk. Progressive UF failure, weight loss, abdominal pain. \",\"\\ud83d\\udda5\\ufe0f <strong>CT findings:<\\/strong> Peritoneal thickening\\/calcification, tethered\\/dilated loops, loculated ascites, \'cocoon\' encapsulation. \",\"\\ud83e\\uddea <strong>Transport changes:<\\/strong> Fast transport with low sodium dip may herald fibrosis and EPS risk\\u2014consider modality change. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card\'><div class=\'card-body\'><h5 class=\'card-title\'>PD Recurrent Peritonitis: 30\\u201360 sec plan<\\/h5><ul class=\'mb-2\'><li><strong>Draw labs:<\\/strong> Effluent cell count\\/diff, Gram stain, culture (2h dwell if feasible) + blood cultures if septic. <\\/li><li><strong>Start empiric IP antibiotics:<\\/strong> Cover GP + GN per local antibiogram; refine to sensitivities. <\\/li><li><strong>Duration:<\\/strong> GP 14d (S. aureus 21d); GN 21d; Pseudomonas 21\\u201328d (dual).  <\\/li><li><strong>Avoid<\\/strong> prolonged aminoglycosides; consider NAC otoprotection. <\\/li><li><strong>Remove catheter if:<\\/strong> Refractory by day 5, relapsing, fungal, or refractory exit-site\\/tunnel infection.  <\\/li><li><strong>Image<\\/strong> if severe pain, ileus, or mixed flora (CT abdomen; surgical consult). <\\/li><\\/ul><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Dialysate cell count\\/diff:<\\/strong> WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and <span class=\'hl-symbol\'>><\\/span>50% PMNs after a ~2 h dwell supports PD peritonitis; repeat if symptoms persist with low count. \",\"\\ud83e\\uddeb <strong>Culture methods:<\\/strong> Gram stain; culture with appropriate technique; consider atypical mycobacteria\\/yeast if culture-negative but persistent inflammation.  \",\"\\ud83e\\ude78 <strong>Bloods:<\\/strong> CRP, albumin, full blood count; electrolytes; consider lactate if septic.\",\"\\ud83d\\udda5\\ufe0f <strong>Imaging:<\\/strong> CT abdomen if secondary peritonitis suspected or EPS evaluation needed.  \",\"\\ud83e\\uddea <strong>Membrane assessment (if UF failure):<\\/strong> PET; note low 1h Na dip may indicate fibrosis and EPS risk. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-danger\'><strong>Emergency algorithm:<\\/strong> suspected recurrent PD peritonitis<\\/div><ol class=\'ps-3\'><li><strong>Recognize:<\\/strong> Abdominal pain\\/cloudy effluent with prior recent episode (within 4 weeks).<\\/li><li><strong>Sample before antibiotics:<\\/strong> Effluent cell count\\/diff, Gram stain, culture (2 h dwell if feasible) + blood cultures if unstable. <\\/li><li><strong>Start empiric IP therapy:<\\/strong> Cover GP+GN; avoid prolonged aminoglycosides; consider NAC if used. <\\/li><li><strong>Reassess at 48\\u201396 h:<\\/strong> If no improvement by day 5 despite correct antibiotics \\u2192 remove catheter; evaluate for exit-site\\/tunnel infection or intra-abdominal source. <\\/li><li><strong>Define the episode:<\\/strong> Relapsing (same organism <span class=\'hl-symbol\'><<\\/span>4 wk) vs recurrent (different organism <span class=\'hl-symbol\'><<\\/span>4 wk) vs repeat (same organism <span class=\'hl-symbol\'>><\\/span>4 wk).  <\\/li><li><strong>Plan prevention:<\\/strong> Address technique, exit-site care, constipation, and water source; consider modality switch if frequent episodes or UF failure; screen for EPS when indicated.  <\\/li><\\/ol>\",\"PILLAR_1\":\"Infection control & catheter strategy\",\"STEP_1_TITLE\":\"Classify the peritonitis episode (ISPD)\",\"STEP_1_LI\":[\"\\ud83d\\udd0e <strong>Relapsing:<\\/strong> same organism within 4 weeks post-therapy. \",\"\\ud83d\\udd0e <strong>Recurrent:<\\/strong> different organism within 4 weeks post-therapy. \",\"\\ud83d\\udd0e <strong>Repeat:<\\/strong> same organism after <span class=\'hl-symbol\'>><\\/span>4 weeks. \"],\"STEP_2_TITLE\":\"Treat, monitor, and decide on catheter removal\",\"STEP_2_LI\":[\"\\ud83d\\udc8a <strong>Empiric IP antibiotics:<\\/strong> Local protocol (e.g., first-gen cephalosporin + aminoglycoside\\/ceftazidime), then tailor to culture. \",\"\\u23f1\\ufe0f <strong>Durations:<\\/strong> GP 14 d (S. aureus 21 d), culture-negative 14 d, GN 21 d, Pseudomonas 21\\u201328 d (dual therapy).  \",\"\\ud83e\\uddf7 <strong>Remove catheter if:<\\/strong> refractory by day 5, relapsing, fungal, refractory exit-site\\/tunnel; bridge with HD and reinsert after infection control (often ~3 weeks).  \"],\"PILLAR_2\":\"EPS risk mitigation, detection, and management\",\"STEP_3_TITLE\":\"Who to screen and how\",\"STEP_3_LI\":[\"\\ud83e\\udded <strong>High-risk:<\\/strong> long PD vintage (strongest risk), recurrent peritonitis, UF failure, weight loss. \",\"\\ud83d\\udda5\\ufe0f <strong>Imaging:<\\/strong> Contrast CT abdomen for peritoneal thickening\\/calcification, loculated ascites, tethered\\/dilated loops, encapsulation. \"],\"STEP_4_TITLE\":\"Treat suspected\\/confirmed EPS\",\"STEP_4_LI\":[\"\\ud83d\\uded1 <strong>Stop PD:<\\/strong> switch to HD; optimize nutrition (enteral preferred; TPN when necessary). \",\"\\ud83d\\udc8a <strong>Medical:<\\/strong> consider corticosteroids and\\/or tamoxifen (antifibrotic signal); weigh risks (VTE, endometrial cancer). Evidence mainly case series. \",\"\\ud83d\\udd2a <strong>Surgical:<\\/strong> in advanced obstructive EPS, specialized adhesiolysis\\/peritonectomy yields 70\\u201380% cure in expert centers. \"],\"TOPIC_BLOCK_A_TITLE\":\"Key definitions that change management\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83d\\udccc <strong>Relapsing:<\\/strong> same organism <span class=\'hl-symbol\'><<\\/span>4 weeks after completing therapy. \",\"\\ud83d\\udccc <strong>Recurrent:<\\/strong> different organism <span class=\'hl-symbol\'><<\\/span>4 weeks after completing therapy. \",\"\\ud83d\\udccc <strong>Repeat:<\\/strong> same organism after <span class=\'hl-symbol\'>><\\/span>4 weeks. \",\"\\ud83d\\udccc <strong>Refractory:<\\/strong> no improvement by day 5 on appropriate antibiotics. \"],\"TOPIC_BLOCK_B_TITLE\":\"When to remove the PD catheter\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83e\\uddf7 <strong>Mandatory:<\\/strong> refractory, relapsing, fungal, or refractory exit-site\\/tunnel infection. \",\"\\ud83e\\uddf7 <strong>Often indicated:<\\/strong> repeat peritonitis; Pseudomonas\\/S. aureus with tunnel\\/exit-site infection.  \",\"\\ud83e\\uddf7 <strong>Timing of reinsertion:<\\/strong> typically after ~3 weeks of control; bridge with HD. \"],\"TOPIC_BLOCK_C_TITLE\":\"EPS pearls\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83e\\udded <strong>Risk factors:<\\/strong> PD duration (strongest), recurrent peritonitis, bioincompatible solutions, inflammation. \",\"\\ud83d\\udda5\\ufe0f <strong>Diagnosis:<\\/strong> CT shows peritoneal thickening\\/calcification, loculated ascites, bowel tethering\\/encapsulation. \",\"\\ud83d\\udee0\\ufe0f <strong>Management bundle:<\\/strong> stop PD, nutrition, consider steroids\\/tamoxifen; surgical referral if obstructive.  \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udd04 <strong>Antibiotic stewardship:<\\/strong> de-escalate by culture; avoid repeated aminoglycoside courses. \",\"\\ud83e\\uddfc <strong>Technique retraining:<\\/strong> supervised exchanges post-episode; exit-site care protocol.\",\"\\ud83d\\uddc2\\ufe0f <strong>Episode registry:<\\/strong> track organisms, durations, relapses, and catheter removals; audit quarterly.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Peritonitis rate:<\\/strong> target <span class=\'hl-symbol\'><<\\/span>0.5 episodes\\/patient-year.\",\"\\u23f1\\ufe0f <strong>Time-to-appropriate therapy:<\\/strong> median <span class=\'hl-symbol\'><<\\/span>4 h from presentation.\",\"\\ud83e\\uddf7 <strong>Unplanned HD transfer:<\\/strong> reduction after implementing removal criteria and retraining.\"],\"QUALITY_SAFETY_LI\":[\"\\ud83e\\uddbb <strong>Ototoxicity prevention:<\\/strong> minimize aminoglycoside exposure; consider NAC if used. \",\"\\ud83e\\udda0 <strong>Fungal prophylaxis consideration:<\\/strong> per local policy when prolonged antibiotics are used.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Red flags:<\\/strong> hemodynamic instability, severe abdominal pain with guarding, mixed\\/anaerobic culture, or ileus\\u2014evaluate urgently for secondary peritonitis and involve surgery.\",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Discuss expectations:<\\/strong> explain definitions (relapse\\/recurrent\\/repeat), likely durations, removal triggers, and EPS risk; document preferences for modality switch and nutrition support.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdCases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\' aria-expanded=\'false\' aria-controls=\'c1\'>1) Relapsing CoNS peritonitis within 2 weeks of cure<\\/button>\\n    <\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse\' aria-labelledby=\'c1h\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Definition fit:<\\/strong> Same organism <span class=\'hl-symbol\'><<\\/span>4 weeks \\u2192 relapsing. <\\/li>\\n          <li><strong>Action:<\\/strong> Treat as primary but search for biofilm\\/pericatheter source. <\\/li>\\n          <li><strong>Catheter decision:<\\/strong> Relapsing warrants removal; plan HD bridge and delayed reinsertion.  <\\/li>\\n          <li><strong>Prevent:<\\/strong> retrain technique; address exit-site care.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\' aria-expanded=\'false\' aria-controls=\'c2\'>2) Pseudomonas peritonitis with tunnel erythema<\\/button>\\n    <\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' aria-labelledby=\'c2h\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Antibiotics:<\\/strong> Dual anti-pseudomonal coverage for 21\\u201328 d. <\\/li>\\n          <li><strong>Remove catheter:<\\/strong> Pseudomonas peritonitis with tunnel\\/exit-site infection requires removal. <\\/li>\\n          <li><strong>Bridge:<\\/strong> Temporary HD; consider new catheter after infection control.<\\/li>\\n          <li><strong>Evaluate source:<\\/strong> Water exposure; review connection technique.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\' aria-expanded=\'false\' aria-controls=\'c3\'>3) Long-vintage PD with UF failure, weight loss, intermittent obstruction<\\/button>\\n    <\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' aria-labelledby=\'c3h\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Suspect EPS:<\\/strong> Duration on PD, UF failure, prior peritonitis increase risk. <\\/li>\\n          <li><strong>Imaging:<\\/strong> CT for thickened\\/calcified peritoneum, loculated ascites, encapsulated loops. <\\/li>\\n          <li><strong>Management:<\\/strong> Stop PD \\u2192 HD; nutrition; consider steroids\\/tamoxifen; refer to specialized surgery if obstructive.  <\\/li>\\n          <li><strong>Follow-up:<\\/strong> Multidisciplinary review (nephrology, surgery, nutrition).<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"Define relapsing vs recurrent vs repeat peritonitis per ISPD.\",\"a\":\"Relapsing: same organism <4 weeks; recurrent: different organism <4 weeks; repeat: same organism >4 weeks after therapy.  \"},{\"q\":\"When must you remove a PD catheter for infection?\",\"a\":\"Refractory (no improvement by day 5), relapsing, fungal, or refractory exit-site\\/tunnel infection. \"},{\"q\":\"Empiric and targeted antibiotic durations?\",\"a\":\"GP 14d (S. aureus 21d), culture-negative 14d, GN 21d, Pseudomonas 21\\u201328d (often dual).  \"},{\"q\":\"How to reduce aminoglycoside ototoxicity risk in PD peritonitis?\",\"a\":\"Avoid repeated\\/prolonged courses; if used, consider concomitant N-acetylcysteine for otoprotection. \"},{\"q\":\"What suggests secondary peritonitis?\",\"a\":\"Culture with multiple organisms\\/anaerobes; obtain surgical evaluation and imaging. \"},{\"q\":\"Sampling tip for suspected PD peritonitis?\",\"a\":\"Send effluent after ~2 h dwell; if WBC <100\\/\\u00b5L but symptoms persist, repeat next exchange. \"},{\"q\":\"Strongest risk factor for EPS?\",\"a\":\"Duration on PD; recurrent peritonitis adds risk. \"},{\"q\":\"CT features of EPS?\",\"a\":\"Peritoneal thickening\\/calcification, bowel tethering\\/dilation, loculated ascites, \'cocoon\'. \"},{\"q\":\"Medical therapies tried in EPS?\",\"a\":\"Nutrition, corticosteroids, and tamoxifen (case-series level); surgery for obstructive disease.  \"},{\"q\":\"How long after catheter removal before reinsertion?\",\"a\":\"Commonly ~3 weeks once infection is controlled; bridge with HD. \"},{\"q\":\"When suspect EPS in post-transplant patients?\",\"a\":\"If prior long-term PD and new GI obstructive symptoms or weight loss\\u2014EPS can present after PD cessation. \"},{\"q\":\"Which organism often mandates dual therapy and longer duration?\",\"a\":\"Pseudomonas aeruginosa (typically 2 agents for 21\\u201328 days). \"}],\"PITFALLS_LI\":[\"\\u274c <strong>Delaying antibiotics until culture result:<\\/strong> start empiric IP therapy immediately after sampling. \",\"\\u274c <strong>Missing relapsing pattern:<\\/strong> not recognizing same-organism recurrence <span class=\'hl-symbol\'><<\\/span>4 weeks delays catheter removal. \",\"\\u274c <strong>Ignoring mixed flora:<\\/strong> may indicate perforation; needs urgent surgical input. \",\"\\u274c <strong>Prolonged aminoglycosides:<\\/strong> ototoxicity risk; avoid repeated courses. \"],\"ANSWER_STEPS_OL\":[\"Open with ISPD definitions\\u2014classify episode (relapse\\/recurrent\\/repeat).\",\"Describe immediate sampling and empiric IP therapy with organism-specific durations.\",\"State firm catheter removal criteria and bridging strategy.\",\"Discuss prevention (technique retraining, exit-site care) and when to consider modality switch.\",\"Explain EPS risk factors, CT diagnosis, and a tiered management plan (stop PD, nutrition, medical, surgical).\"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83e\\udde0 <strong>Biofilm & relapse:<\\/strong> same-organism relapse often implies a catheter focus. \",\"\\ud83e\\udde0 <strong>Membrane fibrosis & UF failure:<\\/strong> fast transport and low sodium dip can signal evolving fibrosis\\/EPS risk. \",\"\\ud83e\\udde0 <strong>Organism-driven duration:<\\/strong> why S. aureus and Pseudomonas need longer therapy.  \"],\"TEACHING_MISTAKES_LI\":[\"\\u274c <strong>Treating all peritonitis for 14 days:<\\/strong> under-treats S. aureus and Pseudomonas.  \",\"\\u274c <strong>Not reassessing by day 5:<\\/strong> delays removal in refractory cases. \",\"\\u274c <strong>Overlooking EPS in UF failure:<\\/strong> missing early signs (weight loss, pain) delays referral. \"],\"ASCII_FLOWCHART_PRE\":\"PD patient with abdominal pain\\/cloudy effluent\\n|\\n+--> Draw effluent (2 h dwell if feasible) -> cell count\\/diff + Gram + culture\\n|     If WBC >= 100\\/ul OR strong clinical suspicion -> start empiric IP GP+GN\\n|\\n+--> 48-96 h review\\n      |\\n      +--> Improving -> complete organism-specific duration (GP 14d; S. aureus 21d; GN 21d; Pseudomonas 21-28d)\\n      |\\n      +--> No improvement by day 5 -> remove catheter; search for exit-site\\/tunnel or secondary source; bridge with HD\\n            |\\n            +--> Define pattern: relapsing (same org <4 wk) \\/ recurrent (different org <4 wk) \\/ repeat (same org >4 wk)\\n\\nEPS suspicion (UF failure, weight loss, recurrent peritonitis)\\n|\\n+--> CT abdomen -> thickened\\/calcified peritoneum; loculated ascites; tethered\\/encapsulated loops\\n|\\n+--> Stop PD -> HD; nutrition; consider steroids\\/tamoxifen; surgical referral if obstruction\",\"EVIDENCE_STUDIES_LI\":[\"\\ud83d\\udcda <strong>ISPD peritonitis guideline (2022) & antibiotic durations summary:<\\/strong> Comprehensive Clinical Nephrology Ch.102 Box\\/Table summarizing ISPD recommendations.  \",\"\\ud83d\\udcda <strong>Relapsing\\/recurrent definitions and catheter strategy:<\\/strong> Comprehensive Clinical Nephrology Ch.102. \",\"\\ud83d\\udcda <strong>Refractory peritonitis removal by day 5:<\\/strong> Comprehensive Clinical Nephrology Ch.102. \",\"\\ud83d\\udcda <strong>EPS risk and staging; CT performance:<\\/strong> Absolute Nephrology Review PD chapter.  \",\"\\ud83d\\udcda <strong>EPS therapies (nutrition, steroids, tamoxifen, surgery):<\\/strong> Absolute Nephrology Review PD chapter Q&A.  \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"\\u2705 <strong>Classify episode correctly<\\/strong> (relapsing\\/recurrent\\/repeat) to guide catheter strategy. \",\"\\u2705 <strong>Treat to organism-specific durations<\\/strong> and avoid prolonged aminoglycosides. \",\"\\u2705 <strong>Remove the catheter by day 5<\\/strong> if refractory, and immediately for fungal peritonitis. \",\"\\u2705 <strong>Screen for EPS<\\/strong> in long-vintage PD with UF failure\\/weight loss; confirm on CT.  \",\"\\u2705 <strong>Manage EPS with a bundle<\\/strong>: stop PD, nutrition, consider steroids\\/tamoxifen, and refer for surgery when obstructive.  \"],\"GUIDELINE_ANCHORS_LI\":[\"ISPD Peritonitis Recommendations: 2022 Update\\u2014prevention & treatment (ISPD.org). \",\"ISPD Catheter-Related Infections: 2017 Update. \",\"ISPD PD Access: 2019 Update. \",\"ISPD Position Paper: Length of time on PD and EPS (2017). \",\"ISPD Recommendation: Peritoneal membrane dysfunction evaluation (2021). \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex1h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex1\' aria-expanded=\'false\' aria-controls=\'ex1\'>Unmapped pearls<\\/button>\\n    <\\/h2>\\n    <div id=\'ex1\' class=\'accordion-collapse collapse\' aria-labelledby=\'ex1h\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Decolonization:<\\/strong> Some centers use nasal mupirocin for S. aureus carriers to reduce relapses (align with local policy). See: <em>TOPIC_BLOCK_B_TITLE<\\/em>.<\\/li>\\n          <li><strong>Antifungal prophylaxis:<\\/strong> Consider during prolonged antibacterial therapy per unit protocol (e.g., nystatin\\/fluconazole). See: <em>DDX_BUCKET_1_ITEMS_LI<\\/em>.<\\/li>\\n          <li><strong>Technique review:<\\/strong> Post-episode supervised exchanges and home visit can lower recurrence. See: <em>QUALITY_PROCESS_LI<\\/em>.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex2h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex2\' aria-expanded=\'false\' aria-controls=\'ex2\'>Edge cases & special populations<\\/button>\\n    <\\/h2>\\n    <div id=\'ex2\' class=\'accordion-collapse collapse\' aria-labelledby=\'ex2h\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Pregnancy on PD:<\\/strong> Lower volumes; rapid catheter removal if refractory peritonitis; obstetric input.<\\/li>\\n          <li><strong>Transplant recipients:<\\/strong> EPS can present post-transplant after PD cessation\\u2014sustain high suspicion. See: <em>VIVA_ITEMS<\\/em>.<\\/li>\\n          <li><strong>Pediatrics:<\\/strong> Sampling volumes\\/antibiotic dosing differ; follow pediatric ISPD guidance.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex3h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex3\' aria-expanded=\'false\' aria-controls=\'ex3\'>Drug dosing & adjustments<\\/button>\\n    <\\/h2>\\n    <div id=\'ex3\' class=\'accordion-collapse collapse\' aria-labelledby=\'ex3h\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>IP dosing tables:<\\/strong> Follow local antibiogram and pharmacy tables for IP vancomycin\\/cephalosporins\\/aminoglycosides.<\\/li>\\n          <li><strong>Ototoxicity mitigation:<\\/strong> Limit aminoglycoside exposure and monitor hearing; consider NAC if used. See: <em>QUALITY_SAFETY_LI<\\/em>.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex4h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex4\' aria-expanded=\'false\' aria-controls=\'ex4\'>Local policy & pathway notes<\\/button>\\n    <\\/h2>\\n    <div id=\'ex4\' class=\'accordion-collapse collapse\' aria-labelledby=\'ex4h\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Fast-track removal pathway:<\\/strong> Define who can authorize day-5 removal and HD bridging.<\\/li>\\n          <li><strong>EPS referral network:<\\/strong> Identify regional centers experienced in EPS surgery.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex5h\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex5\' aria-expanded=\'false\' aria-controls=\'ex5\'>Suggested schema extensions<\\/button>\\n    <\\/h2>\\n    <div id=\'ex5\' class=\'accordion-collapse collapse\' aria-labelledby=\'ex5h\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>ANTIBIOTIC_TABLE_HTML:<\\/strong> to house site-specific IP dosing and intervals.<\\/li>\\n          <li><strong>EPS_SURGICAL_CENTERS_LI:<\\/strong> vetted referral sites with contact details.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"ISPD 2022 peritonitis definitions\",\"When to remove the PD catheter\",\"EPS recognition, CT features, and management\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":5,\"viva_items\":12,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(19, NULL, 3, 1, 1, 'pd-volume-overload', 'Volume overload in a patient on peritoneal dialysis (PD)', 'PD ultrafiltration failure • Icodextrin vs dextrose • Salt & fluid management', 'published', 'Volume overload in PD is common and multifactorial: dietary sodium/fluid excess, suboptimal prescription, membrane transport–related ultrafiltration (UF) failure, dialysate leaks, and comorbid heart failure. Management requires rapid stabilization, rooting out the mechanism (membrane vs mechanical vs adherence), and a targeted prescription change (hypertonic dextrose for short dwells, icodextrin for long dwell) with strict sodium control and diuretics if residual kidney function (RKF) remains.  ', '{\"slug\":\"pd-volume-overload\",\"TOPIC\":\"Volume overload in a patient on peritoneal dialysis (PD)\",\"CHIP_1\":\"PD ultrafiltration failure\",\"CHIP_2\":\"Icodextrin vs dextrose\",\"CHIP_3\":\"Salt & fluid management\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Volume overload in PD is common and multifactorial: dietary sodium\\/fluid excess, suboptimal prescription, membrane transport\\u2013related ultrafiltration (UF) failure, dialysate leaks, and comorbid heart failure. Management requires rapid stabilization, rooting out the mechanism (membrane vs mechanical vs adherence), and a targeted prescription change (hypertonic dextrose for short dwells, icodextrin for long dwell) with strict sodium control and diuretics if residual kidney function (RKF) remains.  \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Stabilize airway\\/breathing\\/circulation:<\\/strong> oxygen, elevate head, treat hypertensive crisis; consider IV loop diuretics if RKF and pulmonary edema.  \",\"\\ud83d\\udd0e <strong>Confirm true fluid overload:<\\/strong> compare weight to baseline, edema, BP, lung exam, I\\/O from PD logs, net UF on each exchange.\",\"\\ud83e\\uddea <strong>Rule out peritonitis\\/mechanical issues:<\\/strong> effluent cell count & culture; inspect for peri-catheter swellings\\/leaks and constipation.  \",\"\\ud83e\\uddea <strong>Assess membrane & UF:<\\/strong> perform\\/review PET; if net UF from 4-hr 4.25% dextrose <400 mL (or <100 mL with 2.5%), suspect UF failure. \",\"\\ud83d\\udc8a <strong>Immediate PD prescription tweak (acute):<\\/strong> use short dwells with hypertonic dextrose (2.5%\\u20134.25%) to raise UF; avoid prolonged hypertonic exposure; add icodextrin for the long dwell once stable.  \",\"\\ud83c\\udf7d\\ufe0f <strong>Enforce sodium restriction:<\\/strong> target <2 g sodium\\/day; pair with fluid restriction tailored to RKF. \",\"\\ud83d\\udd01 <strong>Escalate if refractory:<\\/strong> check for cardiac decompensation; consider temporary HD\\/isolated UF if life-threatening pulmonary edema or PD fails. (Mechanism-driven; see algorithm below.)\"],\"DDX_BUCKET_1_TITLE\":\"PD-related causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83d\\udd27 <strong>Ultrafiltration failure (transport\\/aquaporin):<\\/strong> high transport (rapid glucose dissipation), aquaporin dysfunction (absent early Na+ dip), low peritoneal surface area, increased lymphatic absorption.  \",\"\\ud83e\\ude79 <strong>Dialysate leak:<\\/strong> peri-catheter swelling with reduced UF. \",\"\\ud83e\\uddeb <strong>Peritonitis:<\\/strong> inflammation reduces UF; treat per ISPD pathways. \"],\"DDX_BUCKET_2_TITLE\":\"Non\\u2013PD causes\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\u2764\\ufe0f <strong>Heart failure\\/cardiorenal syndrome:<\\/strong> fluid redistribution and intake excess; PD can be considered chronically. \",\"\\ud83e\\uddc2 <strong>Sodium\\/fluid nonadherence:<\\/strong> common trigger of edema and weight gain. \",\"\\ud83d\\udc8a <strong>Iatrogenic fluid\\/salt load:<\\/strong> IV fluids, high-sodium drugs (e.g., NaHCO3).\"],\"DDX_BUCKET_3_TITLE\":\"Prescription\\/technique issues\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83d\\udd52 <strong>Inappropriate dwell times:<\\/strong> long dwells with glucose in high transporters \\u2192 poor UF; mismatch of PD modality to transport type. \",\"\\ud83e\\uddea <strong>Suboptimal osmotic agent:<\\/strong> lack of icodextrin for long dwell; underuse of 2.5\\u20134.25% dextrose in acute overload. \",\"\\ud83d\\udd01 <strong>Insufficient exchange frequency\\/volume:<\\/strong> low total daily volume or too few cycles.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'><div class=\'card-body\'><h6 class=\'card-title\'>PD Osmotic Options & Expected UF<\\/h6><table class=\'table table-sm\'><thead><tr><th>Solution<\\/th><th>Osm (mOsm\\/L)<\\/th><th>UF in ~60 min (per 2 L)<\\/th><\\/tr><\\/thead><tbody><tr><td>1.5% (1.36%) dextrose<\\/td><td>~346<\\/td><td>~40\\u2013150 mL<\\/td><\\/tr><tr><td>2.5% (2.27%) dextrose<\\/td><td>~396<\\/td><td>~100\\u2013300 mL<\\/td><\\/tr><tr><td>4.25% (3.86%) dextrose<\\/td><td>~486<\\/td><td>~300\\u2013400 mL<\\/td><\\/tr><tr><td>7.5% icodextrin (long dwell)<\\/td><td>~285 (iso)<\\/td><td>Colloid UF over long dwell<\\/td><\\/tr><\\/tbody><\\/table><p class=\'mb-0\'><em>Notes:<\\/em> Use hypertonic dextrose for short dwells; icodextrin for the long dwell.  <\\/p><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Effluent analysis:<\\/strong> cell count\\/differential and culture if cloudy or pain; peritonitis delays UF. \",\"\\ud83d\\udd0e <strong>PD logs & I\\/O:<\\/strong> measure net UF per exchange; trend daily weights and BP.\",\"\\ud83e\\uddea <strong>PET (with 4.25% dextrose):<\\/strong> classify transport; evaluate early Na+ dip (sieving) and 4-hr UF volume.  \",\"\\ud83d\\uddbc\\ufe0f <strong>Leak workup:<\\/strong> exam for peri-catheter edema; consider imaging if suspected. \",\"\\ud83e\\udec0 <strong>Cardiac assessment:<\\/strong> CXR, BNP, echocardiography when HF suspected.\",\"\\ud83e\\uddc2 <strong>Diet review:<\\/strong> sodium intake; target <2 g\\/day. \",\"\\ud83e\\uddee <strong>Adequacy:<\\/strong> weekly Kt\\/V target \\u22651.7\\u20132.0; include RKF if UO >100 mL\\/day.  \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'accordion\' id=\'algoPDOverload\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#stepA\'>Acute dyspnea\\/pulmonary edema in PD<\\/button><\\/h2><div id=\'stepA\' class=\'accordion-collapse collapse\' data-bs-parent=\'#algoPDOverload\'><div class=\'accordion-body\'><ul><li><strong>ABC + O2<\\/strong>; upright position; IV access; consider nitrates if hypertensive.<\\/li><li><strong>If RKF present:<\\/strong> trial IV loop diuretic (dose escalate; add thiazide if resistant). <\\/li><li><strong>Immediate PD tweak:<\\/strong> 2\\u20133 rapid short dwells with 2.5\\u20134.25% dextrose (avoid long glucose dwells in high transporters).  <\\/li><li><strong>Long dwell:<\\/strong> switch to icodextrin once stable. <\\/li><li><strong>Rule out peritonitis\\/leak<\\/strong> if UF remains poor. <\\/li><li><strong>Refractory hypoxemia:<\\/strong> consider temporary HD\\/isolated UF; ICU care.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"PILLAR_1\":\"Fix the cause & optimize PD prescription\",\"STEP_1_TITLE\":\"Identify mechanism of overload\",\"STEP_1_LI\":[\"\\ud83d\\udd0e Review diet\\/adherence, PD logs, recent weight\\/BP; look for peri-catheter edema\\/leak. \",\"\\ud83e\\uddea Perform PET & check 4-hr UF with 4.25% dextrose; <span class=\'hl-symbol\'><<\\/span>400 mL suggests UF failure. \",\"\\ud83e\\uddea Inspect for early Na+ dip (sieving) as a marker of aquaporin function; absent dip suggests UF failure. \"],\"STEP_2_TITLE\":\"Acute prescription changes\",\"STEP_2_LI\":[\"\\ud83d\\udd52 Shorten dwells and increase cycle number with 2.5\\u20134.25% dextrose to boost UF acutely. \",\"\\ud83c\\udf19 Use icodextrin for the single longest dwell (usually daytime in APD or overnight in CAPD) to sustain UF.  \",\"\\ud83d\\udd01 Match modality to transport type (e.g., high transport \\u2192 rapid short exchanges\\/CCPD). \"],\"PILLAR_2\":\"Adjuncts & prevention\",\"STEP_3_TITLE\":\"Non-dialytic measures\",\"STEP_3_LI\":[\"\\ud83e\\uddc2 Sodium restriction <2 g\\/day; align fluid limit with RKF\\/UF performance. \",\"\\ud83d\\udc8a Maximize diuretics if RKF present (loop \\u2192 add thiazide for synergy when needed). \",\"\\ud83d\\udcc8 Monitor adequacy (weekly Kt\\/V \\u22651.7\\u20132.0) and nutrition (protein 1.2\\u20131.4 g\\/kg for PD).  \"],\"STEP_4_TITLE\":\"Reassess & escalate\",\"STEP_4_LI\":[\"\\ud83e\\uddea Recheck PET and UF after changes; treat peritonitis per protocol if present. \",\"\\ud83d\\udd04 Consider temporary HD\\/isolated UF for refractory pulmonary edema or failed PD UF.\",\"\\ud83e\\udde0 Address technique issues; consider catheter problems and leaks; plan long-term modality if persistent UF failure. \"],\"TOPIC_BLOCK_A_TITLE\":\"Ultrafiltration failure: definition & bedside clues\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83d\\udd0e <strong>Definition:<\\/strong> Net UF from 4-hr PET with 4.25% dextrose <span class=\'hl-symbol\'><<\\/span>400 mL (or with 2.5% <span class=\'hl-symbol\'><<\\/span>100 mL). \",\"\\ud83e\\uddea <strong>Early Na+ dip:<\\/strong> during first hour with hypertonic glucose indicates aquaporin-mediated water flow; absent dip suggests UF failure.  \",\"\\ud83e\\udde9 <strong>Etiologies:<\\/strong> high transport state, reduced surface (adhesions), increased lymphatic absorption, peritonitis, leaks.  \"],\"TOPIC_BLOCK_B_TITLE\":\"Therapeutic levers in PD\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83d\\udca7 <strong>Osmotic agent choice:<\\/strong> 1.5\\u20134.25% dextrose for short dwells (glucose-dependent UF); icodextrin (iso-osmotic colloid) for long dwell. \",\"\\ud83d\\udd52 <strong>Dwell time modulation:<\\/strong> high transport \\u2192 shorter dwells\\/CCPD; low transport \\u2192 longer dwells\\/higher dose CAPD. \",\"\\u2705 <strong>Icodextrin benefits:<\\/strong> improves fluid status and technique survival in RCTs.  \"],\"TOPIC_BLOCK_C_TITLE\":\"Residual kidney function (RKF), diuretics & diet\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83d\\udc8a <strong>Diuretics:<\\/strong> loop diuretics remain effective at low GFR; overcome resistance with dose escalation and add a thiazide (e.g., metolazone). \",\"\\ud83e\\uddc2 <strong>Sodium target:<\\/strong> <span class=\'hl-symbol\'><<\\/span>2 g\\/day to aid BP\\/volume control. \",\"\\ud83d\\udcca <strong>Adequacy & protein:<\\/strong> weekly Kt\\/V \\u22651.7\\u20132.0; protein 1.3 g\\/kg\\/day for PD.  \"],\"QUALITY_PROCESS_LI\":[\"\\ud83d\\udd01 Document daily weights, BP, exchange UF, and dietary sodium adherence.\",\"\\ud83e\\uddea Repeat PET when UF failure suspected and after major prescription changes. \",\"\\ud83e\\uddeb Standardize peritonitis evaluation\\/treatment pathways; track time-to-antibiotics. \"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 Reduction in unplanned HD transfers for fluid overload.\",\"\\ud83d\\udcc8 Achieve proportion of long dwells on icodextrin when indicated.\",\"\\ud83e\\ude7a Maintain weekly Kt\\/V \\u22651.7 and euvolemia rates on monthly audits. \"],\"QUALITY_SAFETY_LI\":[\"\\u26a0\\ufe0f Limit cumulative hypertonic glucose exposure (metabolic risk); monitor for hyperglycemia and sodium sieving\\u2013related symptoms. \",\"\\ud83e\\uddea Monitor for icodextrin adverse effects and volume status changes. \"],\"SAFETY_LI\":\"Watch for rapid electrolyte shifts (Na+, K+) with aggressive UF, hyperglycemia with hypertonic dextrose, and symptomatic hypotension; reassess within hours after prescription changes. \",\"COMMUNICATION_LI\":\"Counsel on strict sodium target (<2 g\\/day), daily weight logging, recognition of leak\\/peritonitis signs (cloudy effluent, peri-catheter swelling), and when to call the PD team.  \",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdCases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Anuric APD patient with 3 kg gain in 2 weeks<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> edema, BP up, low net UF on long dwell.<\\/li>\\n          <li><strong>Actions:<\\/strong> short overnight dwells with 2.5\\u20134.25% dextrose; daytime icodextrin; sodium <2 g\\/day.  <\\/li>\\n          <li><strong>Plan:<\\/strong> PET next visit; reinforce adherence and daily weights. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>CAPD patient with peri-catheter swelling and declining UF<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> subcutaneous edema near catheter; UF drops. <\\/li>\\n          <li><strong>Actions:<\\/strong> hold long daytime dwell; imaging for leak; lower fill volumes; consider temporary HD if severe. <\\/li>\\n          <li><strong>Plan:<\\/strong> repair pathway; resume PD with adjusted volumes once leak resolves.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>High transporter with recurrent edema despite 1.5% glucose<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Findings:<\\/strong> PET high transport; long dwell UF poor.<\\/li>\\n          <li><strong>Actions:<\\/strong> switch to CCPD with rapid short exchanges; add icodextrin for long dwell.  <\\/li>\\n          <li><strong>Plan:<\\/strong> sodium <2 g\\/day; evaluate for RKF and adjunct diuretics as appropriate.  <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"How do you define ultrafiltration failure in PD?\",\"a\":\"Net UF <400 mL on a 4-hr PET using 4.25% dextrose (or <100 mL with 2.5%) indicates UF failure. \"},{\"q\":\"What is the role of the early sodium dip?\",\"a\":\"An early fall in dialysate Na+ with hypertonic glucose reflects aquaporin-mediated water flow; absent dip suggests aquaporin dysfunction and UF failure.  \"},{\"q\":\"Which osmotic agent should be used for the long dwell?\",\"a\":\"Icodextrin (7.5%) provides colloid osmosis suited for long dwells and improves fluid status in trials.  \"},{\"q\":\"What sodium intake do you advise a fluid-overloaded PD patient?\",\"a\":\"<2 g\\/day to aid UF and BP control, with individualized fluid limits. \"},{\"q\":\"How do you adjust PD for a high transporter?\",\"a\":\"Shorten dwells and prefer CCPD with more rapid exchanges; avoid very long glucose dwells; use icodextrin for the longest dwell. \"},{\"q\":\"What are expected UF yields with common dextrose solutions?\",\"a\":\"Approx. per 2 L over ~60 min: 1.5% ~40\\u2013150 mL; 2.5% ~100\\u2013300 mL; 4.25% ~300\\u2013400 mL. \"},{\"q\":\"Name common mechanical causes of poor UF.\",\"a\":\"Peri-catheter dialysate leak, catheter malfunction, constipation; look for peri-catheter swelling and low UF.  \"},{\"q\":\"What is the weekly Kt\\/V adequacy target in PD?\",\"a\":\"\\u22651.7 (dialysis \\u00b1 RKF); calculate with 24-hr dialysate\\/urine collections when UO >100 mL\\/day. \"},{\"q\":\"How do you use diuretics in PD patients with RKF?\",\"a\":\"Loop diuretics remain effective at low GFR; overcome resistance by dose escalation and adding a thiazide (e.g., metolazone). \"},{\"q\":\"How does sodium sieving affect serum sodium early in a hypertonic dwell?\",\"a\":\"Aquaporin-mediated water shifts can transiently raise plasma Na+ (and lower dialysate Na+), producing the Na+ dip. \"},{\"q\":\"When should you consider temporary HD?\",\"a\":\"If life-threatening pulmonary edema or refractory UF failure persists despite optimized PD and diuretics, consider temporary HD\\/isolated UF.\"}],\"PITFALLS_LI\":[\"Relying on long glucose dwells in high transporters \\u2192 rapid glucose absorption and poor UF. \",\"Forgetting to add icodextrin for the longest dwell in chronic fluid overload. \",\"Treating edema without checking for a dialysate leak or peritonitis first.  \",\"Not enforcing sodium restriction; UF gains are undone by high salt intake. \"],\"ANSWER_STEPS_OL\":[\"Stabilize ABCs; start oxygen; assess for pulmonary edema; give IV loop diuretic if RKF. \",\"Verify volume overload with weight\\/BP\\/edema and PD UF logs.\",\"Send effluent if peritonitis suspected; examine for leaks; address constipation.\",\"Perform\\/review PET; note early Na+ dip and 4-hr UF thresholds.  \",\"Change prescription: short dwells with 2.5\\u20134.25% dextrose; increase cycles; add icodextrin for the long dwell. \",\"Institute sodium <2 g\\/day; set fluid limit; add\\/optimize diuretics if RKF.  \",\"Reassess UF, symptoms, and adequacy (weekly Kt\\/V \\u22651.7); escalate to temporary HD if refractory. \"],\"TEACHING_CONCEPTS_LI\":[\"Three-pore model, aquaporins, and sodium sieving in PD. \",\"Transport type dictates modality\\/dwell strategy. \",\"Colloid (icodextrin) vs crystalloid (glucose) UF mechanics. \"],\"TEACHING_MISTAKES_LI\":[\"Equating adequate Kt\\/V with adequate volume status\\u2014UF failure can coexist with adequate solute clearance. \",\"Using only 1.5% glucose in a high transporter with edema.\",\"Ignoring mechanical causes (leak) when UF suddenly drops. \"],\"ASCII_FLOWCHART_PRE\":\"PD PATIENT WITH SUSPECTED VOLUME OVERLOAD\\n|\\n+-- Check ABCs --> O2, upright, consider IV loop diuretic if RKF\\n|\\n+-- Confirm overload --> weight up? edema? low net UF?\\n|\\n+-- Screen for complications --> peritonitis? leak? constipation?\\n|\\n+-- PET (4.25% 4h) & early Na+ dip --> UF < 400 mL = UF failure\\n|\\n+-- ACUTE PD TWEAKS\\n|     +-- Short dwells with 2.5-4.25% dextrose (increase cycles)\\n|     +-- Longest dwell on icodextrin\\n|\\n+-- NON-DIALYTIC\\n|     +-- Sodium < 2 g\\/day; fluid limit\\n|     +-- Diuretics if RKF (loop +\\/- thiazide)\\n|\\n+-- REASSESS in hours-days --> if refractory or hypoxemic --> TEMP HD\\/UF\",\"EVIDENCE_STUDIES_LI\":[\"Randomized trials show icodextrin improves fluid status in PD and supports technique survival, including in diabetes.  \",\"Classic guidance on UF\\/solute targets and PD adequacy underpin monitoring (e.g., Kt\\/V). \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"Use hypertonic glucose for short dwells during acute overload; switch the longest dwell to icodextrin. \",\"Aim for weekly Kt\\/V \\u22651.7 and regular volume status assessment as part of high-quality PD. \",\"Advise sodium intake <2 g\\/day to support BP and volume control. \"],\"GUIDELINE_ANCHORS_LI\":[\"PD adequacy: weekly Kt\\/V urea \\u22651.7\\u20132.0; incorporate RKF when UO >100 mL\\/day. \",\"Dietary sodium: suggest <2 g\\/day in CKD\\/diabetes; apply pragmatically in PD volume control. \",\"PD solutions & modalities: choose glucose concentration and dwell times by transport type; consider icodextrin for long dwell.  \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button\' data-bs-toggle=\'collapse\' data-bs-target=\'#unmapped\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'unmapped\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'><ul class=\'mb-0\'>\\n        <li><strong>Icodextrin glycemic artifact:<\\/strong> certain glucose meters overestimate glucose; ensure appropriate meter selection (see: <em>Therapeutic levers in PD<\\/em>).<\\/li>\\n      <\\/ul><\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#edge\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'edge\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'><ul class=\'mb-0\'>\\n        <li><strong>Cardiorenal syndrome:<\\/strong> PD can be chronic adjunct therapy for recurrent congestion when diuretics fail (see: <em>DDX non\\u2013PD causes<\\/em>).<\\/li>\\n      <\\/ul><\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#drug\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'drug\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'><ul class=\'mb-0\'>\\n        <li><strong>Loop + thiazide synergy:<\\/strong> sequence dosing (thiazide hours before loop) to augment natriuresis in resistant edema (see: <em>RKF, diuretics & diet<\\/em>).<\\/li>\\n      <\\/ul><\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#local\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'local\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'><ul class=\'mb-0\'>\\n        <li><strong>Rapid access HD\\/UF:<\\/strong> define an internal escalation pathway for refractory pulmonary edema in PD patients.<\\/li>\\n      <\\/ul><\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' data-bs-toggle=\'collapse\' data-bs-target=\'#schema\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'schema\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'><ul class=\'mb-0\'>\\n        <li>Add <em>PD Prescription Examples<\\/em> key to host context-specific exchange schedules (cyclers, fill volumes) for common scenarios.<\\/li>\\n      <\\/ul><\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"PD ultrafiltration failure\",\"Icodextrin vs dextrose\",\"Salt & fluid management\"],\"section_counts\":{\"immediate_priorities\":7,\"investigations\":7,\"viva_items\":11,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53'),
(20, NULL, 3, 1, 1, 'peritoneal-dialysis-adequacy', 'Peritoneal Dialysis Adequacy (Adults)', 'Weekly Kt/V urea ≥ 1.7 • Include residual kidney function (RKF) • Fluid & symptom-centered outcomes', 'published', 'Peritoneal dialysis (PD) adequacy integrates small-solute clearance, volume control, and patient-centered outcomes (nutrition, symptoms, quality of life). Contemporary guidance uses total weekly Kt/V urea (peritoneal + residual kidney) as the primary clearance metric; targets commonly align around weekly Kt/V urea ≥ 1.7, with clinical judgment beyond numbers.  ', '{\"slug\":\"peritoneal-dialysis-adequacy\",\"TOPIC\":\"Peritoneal Dialysis Adequacy (Adults)\",\"CHIP_1\":\"Weekly Kt\\/V urea \\u2265 1.7\",\"CHIP_2\":\"Include residual kidney function (RKF)\",\"CHIP_3\":\"Fluid & symptom-centered outcomes\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Peritoneal dialysis (PD) adequacy integrates small-solute clearance, volume control, and patient-centered outcomes (nutrition, symptoms, quality of life). Contemporary guidance uses total weekly Kt\\/V urea (peritoneal + residual kidney) as the primary clearance metric; targets commonly align around <strong>weekly Kt\\/V urea \\u2265 1.7<\\/strong>, with clinical judgment beyond numbers.  \",\"IMMEDIATE_PRIORITIES_LI\":[\"<strong>Confirm target met:<\\/strong> Total weekly Kt\\/V urea <span class=\'hl-symbol\'>\\u2265<\\/span>1.7 (include RKF) before labeling \'inadequate\'. \",\"<strong>Assess volume status:<\\/strong> Aim daily net UF sufficient for euvolemia; in anuric patients, <strong>net UF \\u2265 ~750 mL\\/day<\\/strong> is associated with better outcomes. \",\"<strong>Screen for UF failure:<\\/strong> 4-h dwell test (2 L 4.25%): UF <span class=\'hl-symbol\'><<\\/span>400 mL suggests UF failure. \",\"<strong>Check symptoms & nutrition:<\\/strong> Appetite, nausea, pruritus, albumin, unintended weight loss; consider increasing dose if symptomatic. \",\"<strong>Protect RKF:<\\/strong> Avoid nephrotoxins\\/contrast; incremental PD is reasonable with preserved RKF.  \",\"<strong>Technique verification:<\\/strong> 24-h urine\\/dialysate collection accuracy, leaks, constipation, catheter function.\"],\"DDX_BUCKET_1_TITLE\":\"Apparent \'Low Clearance\' (False or Remediable)\",\"DDX_BUCKET_1_ITEMS_LI\":[\"<strong>Collection errors:<\\/strong> Incomplete 24-h urine or dialysate collections; mislabeled samples.\",\"<strong>Nonadherence:<\\/strong> Missed exchanges\\/short dwells; incorrect dextrose strengths.\",\"<strong>Catheter\\/mechanical:<\\/strong> Outflow obstruction, leaks; constipation causing flow issues. \",\"<strong>Calculation issues:<\\/strong> Wrong V (Watson), not standardizing weekly totals. \"],\"DDX_BUCKET_2_TITLE\":\"True Small-Solute Clearance Deficit\",\"DDX_BUCKET_2_ITEMS_LI\":[\"<strong>Loss of RKF:<\\/strong> Anuria or rapid RKF decline (common driver of lower total Kt\\/V). \",\"<strong>Underdosing:<\\/strong> Too few exchanges\\/low fill volumes\\/short total dwell time; adjust CAPD\\/APD dose. \",\"<strong>High transporter with long dwells:<\\/strong> Rapid equilibration reduces net clearance benefit per dwell; favor shorter, more frequent cycles. \"],\"DDX_BUCKET_3_TITLE\":\"Volume Overload \\/ UF Problems\",\"DDX_BUCKET_3_ITEMS_LI\":[\"<strong>Type 2 UF failure:<\\/strong> Low osmotic conductance to glucose (aquaporin dysfunction); minimal Na+ dip early in dwell. \",\"<strong>High transporter leak-back:<\\/strong> Rapid glucose absorption blunts gradient; benefit from shorter dwells\\/APD; use icodextrin for long dwell. \",\"<strong>Lymphatic reabsorption\\/adhesions:<\\/strong> Increased reabsorption or reduced surface area. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card shadow-sm rounded-4 p-3\'><h5 class=\'mb-2\'>PD Adequacy \\u2014 Pocket Card<\\/h5><ul class=\'small mb-2\'><li><strong>Primary metric:<\\/strong> Total weekly Kt\\/V urea (PD + RKF) <span class=\'hl-symbol\'>\\u2265<\\/span>1.7. <\\/li><li><strong>Creatinine clearance (optional):<\\/strong> Weekly CrCl target historically ~<span class=\'hl-symbol\'>\\u2265<\\/span>60 L\\/1.73 m<sup>2<\\/sup> (context-dependent; use clinically, not as sole metric). <\\/li><li><strong>Watson V (L):<\\/strong> Men V=2.447\\u22120.09516\\u00d7Age+0.1704\\u00d7Ht(cm)+0.3362\\u00d7Wt(kg); Women V=2.097+0.1069\\u00d7Ht+0.2466\\u00d7Wt. <\\/li><li><strong>Traditional PET:<\\/strong> 2 L of 2.5% dextrose; samples at 0, 2, 4 h; classify transport (D\\/P Cr; D\\/D0 glucose). <\\/li><li><strong>UF failure screen:<\\/strong> 4.25% 2 L, 4 h; UF <span class=\'hl-symbol\'><<\\/span>400 mL suggests failure; consider APD\\/short dwells\\/icodextrin. <\\/li><\\/ul><div class=\'alert alert-info p-2\'><strong>Tip:<\\/strong> Recheck adequacy 4\\u20136 weeks after prescription change or clinical status shift.<\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<strong>24-h dialysate & urine collections:<\\/strong> Measure volumes and urea\\/creatinine to compute weekly Kt\\/V and CrCl (include RKF). \",\"<strong>PET (peritoneal equilibration test):<\\/strong> Traditional 2 L 2.5% dextrose; D\\/P Cr and D\\/D0 glucose at 0\\/2\\/4 h; classify transport. \",\"<strong>Modified PET for UF:<\\/strong> 2 L 4.25% dextrose; UF <span class=\'hl-symbol\'><<\\/span>400 mL indicates UF failure. \",\"<strong>Volume evaluation:<\\/strong> Weight, edema, BP trends; dietary sodium review; consider home BP where relevant. \",\"<strong>Laboratory panel:<\\/strong> BUN\\/Cr, electrolytes (Na+ for sieving), bicarbonate, albumin, Hb; CRP if inflamed.\",\"<strong>Technique\\/catheter check:<\\/strong> Inspect for leaks, constipation; ensure correct exchange timing and dextrose strength. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-danger rounded-4 p-3\'><h5>Emergency: Symptomatic Uremia or Refractory Volume Overload on PD<\\/h5><ol class=\'mb-2\'><li><strong>Stabilize:<\\/strong> Airway\\/Breathing\\/Circulation; oxygen; IV access; ECG; correct severe hyperkalemia.<\\/li><li><strong>Assess PD feasibility:<\\/strong> Confirm catheter function; rapid exchange if feasible; consider hypertonic (4.25%) short cycles for UF while monitoring glucose.<\\/li><li><strong>Switch pathway:<\\/strong> If encephalopathy, severe hyperkalemia, refractory pulmonary edema, or peritonitis with sepsis, arrange urgent HD (temporary catheter) or CRRT; document rationale.<\\/li><li><strong>After stabilization:<\\/strong> Revisit adequacy (collections, PET), root-cause (RKF loss, dose, transport), and long-term modality fit.<\\/li><\\/ol><p class=\'small text-muted mb-0\'>Note: Encode comparator symbols as < \\/ > when displayed in plain text contexts.<\\/p><\\/div>\",\"PILLAR_1\":\"Quantify & Diagnose\",\"STEP_1_TITLE\":\"Measure delivered dose & UF\",\"STEP_1_LI\":[\"<strong>Compute weekly Kt\\/V urea:<\\/strong> Sum peritoneal + RKF components; target <span class=\'hl-symbol\'>\\u2265<\\/span>1.7. \",\"<strong>Check creatinine clearance:<\\/strong> Use as adjunct (historical target ~~<span class=\'hl-symbol\'>\\u2265<\\/span>60 L\\/1.73 m<sup>2<\\/sup>), not sole metric. \",\"<strong>Assess UF:<\\/strong> Daily net UF trends; screen with 4.25% 4-h UF test if overloaded. \"],\"STEP_2_TITLE\":\"Characterize membrane & technique\",\"STEP_2_LI\":[\"<strong>PET-based transport typing:<\\/strong> Tailor dwell length\\/modality (APD vs CAPD). \",\"<strong>Sodium sieving (Na+ dip):<\\/strong> Present <span class=\'hl-symbol\'>\\u2192<\\/span> intact aquaporin; absent <span class=\'hl-symbol\'>\\u2192<\\/span> UF impairment. \",\"<strong>Technique audit:<\\/strong> Collections, exchange timing, constipation, leaks; retrain if needed. \"],\"PILLAR_2\":\"Optimize Prescription & Outcomes\",\"STEP_3_TITLE\":\"Adjust dose & modality\",\"STEP_3_LI\":[\"<strong>Increase dose pragmatically:<\\/strong> Add exchanges, increase fill volumes, or shorten dwells (high transporters); beware diminishing returns and IAP. \",\"<strong>Use icodextrin:<\\/strong> Prefer for the long\\/overnight dwell, esp. high transporters; improves technique survival. \",\"<strong>Consider APD:<\\/strong> Shorter, frequent cycles benefit high transporters; personalize schedule.\"],\"STEP_4_TITLE\":\"Protect RKF & address symptoms\",\"STEP_4_LI\":[\"<strong>Preserve RKF:<\\/strong> Avoid nephrotoxins\\/contrast; use diuretics if urine output persists. \",\"<strong>Nutrition:<\\/strong> Address malnutrition; consider amino acid exchanges in select patients. \",\"<strong>Holistic outcomes:<\\/strong> Symptom burden, QOL, blood pressure, hospitalizations.\"],\"TOPIC_BLOCK_A_TITLE\":\"Residual Kidney Function (RKF) & Incremental PD\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<strong>Why it matters:<\\/strong> RKF loss associates with higher mortality; preserve RKF when possible. \",\"<strong>Incremental PD:<\\/strong> Start with fewer exchanges leveraging RKF, titrate as RKF declines. \",\"<strong>Measuring RKF:<\\/strong> Use 24-h urine (urea\\/creatinine clearance) and integrate into total Kt\\/V.\"],\"TOPIC_BLOCK_B_TITLE\":\"Ultrafiltration (UF) Failure \\u2014 Recognition & Workup\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<strong>Screening test:<\\/strong> 2 L 4.25% dextrose, 4 h; UF <span class=\'hl-symbol\'><<\\/span>400 mL suggests UF failure. \",\"<strong>Mechanisms:<\\/strong> High transport (rapid glucose absorption), low aquaporin conductance (type 2), lymphatic reabsorption, adhesions. \",\"<strong>Sodium sieving:<\\/strong> Early Na+ dip indicates intact aquaporin; absent dip suggests aquaporin dysfunction. \",\"<strong>Management:<\\/strong> Shorter dwells\\/APD; long dwell with icodextrin; address constipation\\/leaks; consider modality switch if refractory. \"],\"TOPIC_BLOCK_C_TITLE\":\"Nutrition, Metabolic Control & Malnutrition\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<strong>Screen routinely:<\\/strong> Albumin, BMI, unintentional weight loss; PD patients at risk of malnutrition. \",\"<strong>Adjust dose:<\\/strong> If malnourished and not rapid transporter, increase dialysis dose to improve appetite. \",\"<strong>Amino acid exchange:<\\/strong> Consider 1 exchange\\/day to support intake in selected patients. \"],\"QUALITY_PROCESS_LI\":[\"<strong>Monthly adequacy review:<\\/strong> Track Kt\\/V, weight, BP, symptoms; document changes.\",\"<strong>Collection quality checks:<\\/strong> Audit 24-h collections and retrain quarterly.\",\"<strong>Technique surveillance:<\\/strong> Catheter function, constipation screening, leak checks.\",\"<strong>Membrane re-evaluation:<\\/strong> Repeat PET when clearance\\/UF deteriorate. \"],\"QUALITY_OUTCOME_LI\":[\"<strong>Clearance goal:<\\/strong> Proportion with weekly Kt\\/V <span class=\'hl-symbol\'>\\u2265<\\/span>1.7.\",\"<strong>Volume goal:<\\/strong> Proportion euvolemic (target weight, edema-free).\",\"<strong>Technique survival:<\\/strong> Annual death-censored technique survival rate. \",\"<strong>Hospitalization:<\\/strong> Days admitted per patient-year.\"],\"QUALITY_SAFETY_LI\":[\"<strong>Peritonitis rate:<\\/strong> Episodes per patient-year.\",\"<strong>Hypoglycemia risk:<\\/strong> In diabetics using higher dextrose concentrations.\",\"<strong>UF-related hypotension:<\\/strong> Monitor when shortening dwells\\/increasing dextrose.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Safety first:<\\/strong> Avoid nephrotoxins to preserve RKF; monitor glucose with high-dextrose prescriptions; intervene early for UF failure to prevent pulmonary edema. \",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Shared decisions:<\\/strong> Discuss targets (Kt\\/V, UF), transport type, lifestyle fit (CAPD vs APD), and when to escalate or switch modality.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdAdequacyCases\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1 \\u2014 Kt\\/V 1.5 with preserved RKF<\\/button><\\/h2><div id=\'c1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#pdAdequacyCases\'><div class=\'accordion-body\'><ul><li><strong>Findings:<\\/strong> Weekly Kt\\/V 1.5 (PD 1.0 + RKF 0.5); euvolemic; PET: low-average transporter.<\\/li><li><strong>Actions:<\\/strong> Verify collections; increase fill volume to 2.5 L; add one exchange; recheck in 4\\u20136 weeks.<\\/li><li><strong>Rationale:<\\/strong> Dose-response by volume\\/frequency; preserve RKF and avoid unnecessary intensification. <\\/li><li><strong>Contingency:<\\/strong> If poor appetite\\/symptoms persist, escalate to APD nights + day dwell icodextrin.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2 \\u2014 Volume overload, suspected UF failure<\\/button><\\/h2><div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdAdequacyCases\'><div class=\'accordion-body\'><ul><li><strong>Findings:<\\/strong> Edema, HTN, anuric; PET high transporter; minimal Na+ dip.<\\/li><li><strong>Actions:<\\/strong> Perform 4.25% 4-h UF test; if UF <span class=\'hl-symbol\'><<\\/span>400 mL, diagnose UF failure; switch long dwell to icodextrin; move to APD with shorter cycles. <\\/li><li><strong>Support:<\\/strong> Sodium restriction; review technique; consider diuretics only if any RKF remains. <\\/li><li><strong>Reassess:<\\/strong> Weight\\/BP and symptoms within 1\\u20132 weeks.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3 \\u2014 Malnutrition with Kt\\/V 1.6 (slow transporter)<\\/button><\\/h2><div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdAdequacyCases\'><div class=\'accordion-body\'><ul><li><strong>Findings:<\\/strong> Weight loss, albumin 28 g\\/L; Kt\\/V 1.6; PET slow.<\\/li><li><strong>Actions:<\\/strong> Increase daily volume (e.g., +2 L) and consider 1 amino acid exchange; dietitian referral. <\\/li><li><strong>Rationale:<\\/strong> More exchanges improve small-solute clearance; amino acid exchange can support intake. <\\/li><li><strong>Follow-up:<\\/strong> Recheck Kt\\/V and nutrition in 4\\u20136 weeks.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the primary clearance metric for PD adequacy and its usual target?\",\"a\":\"Total weekly Kt\\/V urea (peritoneal + RKF) with a common target of \\u22651.7, interpreted in clinical context. \"},{\"q\":\"How do you account for residual kidney function (RKF) in adequacy?\",\"a\":\"Add RKF urea clearance (from 24-h urine) to peritoneal clearance to obtain total weekly Kt\\/V. Preserve RKF by avoiding nephrotoxins. \"},{\"q\":\"Outline the traditional PET.\",\"a\":\"After morning drain, instill 2 L of 2.5% dextrose; sample dialysate at 0\\/2\\/4 h and plasma at 2 h for D\\/P creatinine and D\\/D0 glucose to classify transport. \"},{\"q\":\"Define UF failure on the 4.25% test.\",\"a\":\"Net UF <400 mL after a 4-h dwell of 2 L 4.25% dextrose suggests UF failure. \"},{\"q\":\"What does the early sodium \'dip\' indicate?\",\"a\":\"Sodium sieving (Na+ dip) indicates intact aquaporin-mediated free-water transport; absent dip suggests aquaporin dysfunction and UF impairment. \"},{\"q\":\"When is icodextrin preferred?\",\"a\":\"For the long\\/overnight dwell, especially in high transporters or UF failure, as it sustains osmotic gradient without sodium sieving. \"},{\"q\":\"Give two ways to increase PD dose.\",\"a\":\"Increase fill volume or number of exchanges; consider APD with shorter cycles for high transporters. \"},{\"q\":\"State a daily UF target surrogate in anuric patients.\",\"a\":\"Approximately \\u2265750 mL\\/day net UF associates with better outcomes. \"},{\"q\":\"How is V estimated for Kt\\/V?\",\"a\":\"Use Watson formula (sex-, height-, weight-, age-based) to estimate urea distribution volume. \"},{\"q\":\"Name two landmark studies informing PD adequacy targets.\",\"a\":\"CANUSA (importance of RKF) and ADEMEX\\/Lo et al. (no survival benefit above Kt\\/V~~2). \"},{\"q\":\"What historical creatinine clearance threshold was used?\",\"a\":\"Weekly CrCl \\u2265~60 L\\/1.73 m\\u00b2 was historically referenced; now de-emphasized versus Kt\\/V and clinical outcomes. \"},{\"q\":\"List three common \'false low\' adequacy causes.\",\"a\":\"Poor collections, missed\\/short exchanges, and catheter\\/mechanical issues (e.g., constipation-related outflow). \"}],\"PITFALLS_LI\":[\"<strong>Ignoring RKF:<\\/strong> Underestimates total Kt\\/V and leads to unnecessary intensification. \",\"<strong>Relying on daily Kt\\/V:<\\/strong> Adequacy is weekly; multiply appropriately. \",\"<strong>Overlong dwells in high transporters:<\\/strong> Gradient loss reduces UF and clearance; prefer shorter cycles\\/APD. \",\"<strong>Missing UF failure:<\\/strong> Not performing the 4.25% 4-h test in overloaded patients. \",\"<strong>Inaccurate collections:<\\/strong> Skews Kt\\/V and CrCl; retrain technique.\",\"<strong>Neglecting nutrition:<\\/strong> Low albumin\\/weight loss warrant dose review and dietary intervention. \"],\"ANSWER_STEPS_OL\":[\"<strong>Verify collections & inputs:<\\/strong> 24-h urine\\/dialysate volumes and labs; compute total weekly Kt\\/V.\",\"<strong>Assess volume & symptoms:<\\/strong> Weight, edema, BP, appetite, pruritus; check daily UF.\",\"<strong>Characterize membrane:<\\/strong> PET (transport type) and sodium dip if UF concerns.\",\"<strong>Optimize prescription:<\\/strong> Adjust cycles, volumes, and dextrose; use APD and icodextrin strategically.\",\"<strong>Protect RKF & comorbidities:<\\/strong> Avoid nephrotoxins; diuretics if urine output; nutrition plan.\",\"<strong>Reassess in 4\\u20136 weeks:<\\/strong> Repeat adequacy, UF, symptoms; escalate or consider HD if refractory.\"],\"TEACHING_CONCEPTS_LI\":[\"<strong>Small vs middle molecules:<\\/strong> Frequency\\/volume vs dwell time trade-offs. \",\"<strong>Three-pore model:<\\/strong> Aquaporin-mediated free-water explains sodium sieving. \",\"<strong>Incremental PD:<\\/strong> Patient-friendly starts leveraging RKF. \",\"<strong>Technique survival:<\\/strong> UF failure and low clearance drive attrition; icodextrin helps. \",\"<strong>Outcome-oriented adequacy:<\\/strong> Numbers plus symptoms\\/QOL\\/hospitalizations.\"],\"TEACHING_MISTAKES_LI\":[\"<strong>Chasing Kt\\/V alone:<\\/strong> Ignoring volume control and symptoms.\",\"<strong>Not individualizing by transport:<\\/strong> One-size CAPD prescriptions underperform for high transporters.\",\"<strong>Skipping retraining:<\\/strong> Collection and exchange errors are common.\",\"<strong>Delaying UF assessment:<\\/strong> Missing early signs (no Na+ dip, rapid gradient loss). \",\"<strong>Overusing hypertonic glucose:<\\/strong> Glycemic complications and thirst; prefer icodextrin for long dwell. \"],\"ASCII_FLOWCHART_PRE\":\"PD ADEQUACY (ADULT)\\n\\nstart\\n  |\\n  v\\nCollect 24h urine + dialysate --> compute weekly Kt\\/V (PD + RKF)\\n  |\\n  |-- if Kt\\/V >= 1.7 AND euvolemic --> maintain; reassess 4-6 wks\\n  |\\n  |-- if Kt\\/V < 1.7 OR symptoms --> verify collections -> PET -> review technique\\n        |\\n        |-- High transporter? --> shorten dwells \\/ APD; long dwell = icodextrin\\n        |\\n        |-- Low\\/avg transporter? --> increase fill volume\\/exchanges\\n        |\\n        |-- Volume overload? --> 4.25% 4h UF test; if UF < 400 mL --> manage UF failure\\n        |\\n        `--> Recompute weekly Kt\\/V in 4-6 wks; consider HD if refractory\",\"EVIDENCE_STUDIES_LI\":[\"<strong>CANUSA:<\\/strong> Reanalysis emphasized RKF\\u2014each 5 mL\\/min residual GFR \\u2193 mortality risk; urine output benefit. \",\"<strong>ADEMEX (Mexico):<\\/strong> No survival benefit by increasing PD dose above Kt\\/V ~2.0. \",\"<strong>Lo et al. trial:<\\/strong> Lower Kt\\/V (\\u22641.5) associated with more clinical issues vs 1.7\\u20132.0. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"<strong>Use total weekly Kt\\/V urea as primary adequacy measure;<\\/strong> include RKF in PD patients. \",\"<strong>Common target:<\\/strong> Weekly Kt\\/V urea <span class=\'hl-symbol\'>\\u2265<\\/span>1.7; individualize based on symptoms and volume. \",\"<strong>UF failure threshold:<\\/strong> Consider UF failure if 4-h 4.25% dwell UF <span class=\'hl-symbol\'><<\\/span>400 mL. \"],\"GUIDELINE_ANCHORS_LI\":[\"<strong>KDOQI & ISPD:<\\/strong> Endorse small-solute clearance targets (weekly Kt\\/V urea) for PD adequacy; include RKF. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'9\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#unmappedPearls\'>Unmapped pearls<\\/button><\\/h2><div id=\'unmappedPearls\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Daily vs weekly metrics:<\\/strong> Daily Kt\\/V must be multiplied by 7; avoid misinterpretation. See: <em>QUICK_REF_CARD_HTML<\\/em>. <\\/li><li><strong>Icodextrin physiology:<\\/strong> Colloid osmotic agent without Na+ sieving\\u2014useful for long dwell. See: <em>TOPIC_BLOCK_B_TITLE<\\/em>. <\\/li><li><strong>High transporter strategy:<\\/strong> APD with short cycles often superior to long CAPD dwells. See: <em>STEP_3_LI<\\/em>. <\\/li><li><strong>Malnutrition linkage:<\\/strong> Consider dose increase and amino acid exchange in non\\u2013rapid transporters. See: <em>TOPIC_BLOCK_C_TITLE<\\/em>. <\\/li><li><strong>Technique failure metrics:<\\/strong> Inadequate solute clearance (weekly Kt\\/V <span class=\'hl-symbol\'><<\\/span>1.7) and UF insufficiency are common causes. See: <em>QUALITY_OUTCOME_LI<\\/em>. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#edgePop\'>Edge cases & special populations<\\/button><\\/h2><div id=\'edgePop\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Diabetes:<\\/strong> Monitor glycemia closely when increasing dextrose strength; consider icodextrin. <\\/li><li><strong>Cardiorenal syndrome:<\\/strong> PD can aid chronic volume control when diuretics fail. <\\/li><li><strong>Elderly\\/frail:<\\/strong> Incremental PD and assisted PD to match capability and goals. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#drugDosing\'>Drug dosing & adjustments<\\/button><\\/h2><div id=\'drugDosing\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Antibiotics in PD peritonitis:<\\/strong> Follow ISPD guidance; consider catheter removal criteria in refractory cases. <\\/li><li><strong>Diuretics with RKF:<\\/strong> Can enhance sodium\\/water excretion; avoid when anuric. <\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#localPolicy\'>Local policy & pathway notes<\\/button><\\/h2><div id=\'localPolicy\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Retraining cadence:<\\/strong> Quarterly technique refreshers to reduce collection and exchange errors.<\\/li><li><strong>Emergency switch protocol:<\\/strong> Clear criteria for urgent HD access in refractory cases; document shared decisions.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#schemaExt\'>Suggested schema extensions<\\/button><\\/h2><div id=\'schemaExt\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>Membrane metrics:<\\/strong> Fields for Na+ dip percentage and aquaporin conductance surrogates.<\\/li><li><strong>UF diary:<\\/strong> Daily net UF log integration for trend analysis.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\"}', '{\"chips\":[\"Weekly Kt\\/V urea \\u2265 1.7\",\"Include residual kidney function (RKF)\",\"Fluid & symptom-centered outcomes\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":6,\"viva_items\":12,\"pitfalls\":6}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(21, NULL, 3, 1, 1, 'peritoneal-dialysis-viva', 'Peritoneal Dialysis (PD): indications, contraindications, prescriptions & viva pearls', 'Indications & patient selection • Contraindications (absolute/relative) • Peritonitis, PET & adequacy', 'published', 'Peritoneal dialysis (PD) is a home-based kidney replacement therapy suitable across ages when patient factors and peritoneal membrane function permit. Viva focus: who to choose, who to avoid, how to start, how to recognize/treat peritonitis, and how to judge adequacy. Weekly Kt/V urea targets and PET-driven prescriptions remain core, with modern emphasis on patient-centred outcomes and incremental PD.  ', '{\"slug\":\"peritoneal-dialysis-viva\",\"TOPIC\":\"Peritoneal Dialysis (PD): indications, contraindications, prescriptions & viva pearls\",\"CHIP_1\":\"Indications & patient selection\",\"CHIP_2\":\"Contraindications (absolute\\/relative)\",\"CHIP_3\":\"Peritonitis, PET & adequacy\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Peritoneal dialysis (PD) is a home-based kidney replacement therapy suitable across ages when patient factors and peritoneal membrane function permit. Viva focus: who to choose, who to avoid, how to start, how to recognize\\/treat peritonitis, and how to judge adequacy. Weekly Kt\\/V urea targets and PET-driven prescriptions remain core, with modern emphasis on patient-centred outcomes and incremental PD.  \",\"IMMEDIATE_PRIORITIES_LI\":[\"\\u26a0\\ufe0f <strong>Suspected PD peritonitis:<\\/strong> Send PD effluent for cell count\\/differential, Gram stain, and culture (prefer blood culture bottles), then start empiric IP antibiotics; diagnose if total WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with <span class=\'hl-symbol\'>><\\/span>50% PMNs after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell plus positive culture and compatible symptoms. \",\"\\ud83d\\udd0e <strong>Short dwell\\/CCPD:<\\/strong> If no long dwell available, rely more on %PMNs; if no fluid to drain, instill 1 L, dwell 2 h, then sample. \",\"\\ud83d\\udc8a <strong>Empiric therapy (IP preferred):<\\/strong> e.g., cefazolin\\/cephalothin + ceftazidime or aminoglycoside; allow antibiotic dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; consider antifungal prophylaxis (nystatin\\/fluconazole). Avoid combining vanc+gent in same bag.   \",\"\\ud83e\\uddea <strong>Severity\\/complicated cases:<\\/strong> If intra-abdominal source suspected, add metronidazole and broaden Gram-negative cover; fungal peritonitis often needs catheter removal.  \",\"\\ud83d\\ude91 <strong>Urgent-start PD:<\\/strong> Possible if needed, but ideally place catheter <span class=\'hl-symbol\'>>=<\\/span>2 weeks before starting to reduce leaks. \",\"\\ud83e\\uddee <strong>Adequacy flag:<\\/strong> Weekly total (peritoneal + residual) Kt\\/V urea target typically <span class=\'hl-symbol\'>>=<\\/span>1.7; reassess with PET and clinical outcomes, not clearance alone.  \"],\"DDX_BUCKET_1_TITLE\":\"Cloudy PD effluent \\/ abdominal pain\",\"DDX_BUCKET_1_ITEMS_LI\":[\"\\ud83e\\uddeb <strong>Infectious peritonitis:<\\/strong> Bacterial (coagulase-negative staph, S. aureus, Enterococci, Gram-negatives incl. Pseudomonas), fungal, mycobacterial. \",\"\\ud83d\\udd25 <strong>Sterile causes:<\\/strong> Chemical irritation, eosinophilic peritonitis, intra-abdominal pathology (perforation, pancreatitis), malignancy. \",\"\\ud83c\\udf0a <strong>Mechanical issues:<\\/strong> Catheter malposition\\/outflow failure, constipation causing poor drain.  \"],\"DDX_BUCKET_2_TITLE\":\"Volume overload or poor ultrafiltration (UF)\",\"DDX_BUCKET_2_ITEMS_LI\":[\"\\ud83e\\uddc2 <strong>Dietary\\/Prescription:<\\/strong> Excess salt\\/fluid intake, non-adherence, inadequate dextrose\\/osmotic prescription. \",\"\\ud83d\\udd73\\ufe0f <strong>Membrane factors:<\\/strong> Fast transporter with UF failure; consider PET and 4.25% PET. \",\"\\ud83d\\udcc9 <strong>Objective UFF:<\\/strong> UF <span class=\'hl-symbol\'><<\\/span>400 mL after 4 h dwell with 3.86\\u20134.25% dextrose is consistent with UFF. \"],\"DDX_BUCKET_3_TITLE\":\"Dyspnea during PD\",\"DDX_BUCKET_3_ITEMS_LI\":[\"\\ud83d\\udca8 <strong>Hydrothorax (pleuroperitoneal leak):<\\/strong> Right-sided effusion, glucose-rich pleural fluid; stop PD and refer. (Clinical staple; manage per local protocol.)\",\"\\ud83e\\udec1 <strong>Respiratory compromise:<\\/strong> Large fills in severe COPD\\/CHF; consider lower fill volumes or HD bridging. (Clinical practice consideration.)\",\"\\ud83e\\udda0 <strong>Peritonitis-related ileus\\/diaphragmatic irritation:<\\/strong> Treat peritonitis promptly. \"],\"QUICK_REF_CARD_HTML\":\"<div class=\'row g-3\'>\\n  <div class=\'col-md-6\'>\\n    <div class=\'card shadow-sm\'>\\n      <div class=\'card-body\'>\\n        <h6 class=\'card-title\'>PD modalities<\\/h6>\\n        <ul class=\'mb-0\'>\\n          <li><strong>CAPD:<\\/strong> 3\\u20135 daytime exchanges.<\\/li>\\n          <li><strong>APD\\/CCPD:<\\/strong> Cycler overnight, day dwell optional.<\\/li>\\n          <li><strong>Incremental PD:<\\/strong> Leverage residual function initially. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'col-md-6\'>\\n    <div class=\'card shadow-sm\'>\\n      <div class=\'card-body\'>\\n        <h6 class=\'card-title\'>Solutions<\\/h6>\\n        <ul class=\'mb-0\'>\\n          <li><strong>Dextrose:<\\/strong> 1.5%, 2.5%, 4.25% (higher = more UF). <\\/li>\\n          <li><strong>Icodextrin:<\\/strong> Long dwell, no Na<sup>+<\\/sup> dip. <\\/li>\\n          <li><strong>Biocompatible (neutral pH\\/low GDP):<\\/strong> reduce exposure to GDP; outcome benefits mixed. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'col-md-6\'>\\n    <div class=\'card shadow-sm\'>\\n      <div class=\'card-body\'>\\n        <h6 class=\'card-title\'>Adequacy<\\/h6>\\n        <ul class=\'mb-0\'>\\n          <li><strong>Weekly Kt\\/V urea:<\\/strong> target <span class=\'hl-symbol\'>>=<\\/span>1.7 (includes residual).  <\\/li>\\n          <li><strong>PET:<\\/strong> Perform after starting PD; guides dwell time\\/volume. <\\/li>\\n          <li><strong>UFF rule of thumb:<\\/strong> UF <span class=\'hl-symbol\'><<\\/span>400 mL after 4 h 4.25% dextrose suggests UFF. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'col-md-6\'>\\n    <div class=\'card shadow-sm\'>\\n      <div class=\'card-body\'>\\n        <h6 class=\'card-title\'>Peritonitis (ISPD-aligned)<\\/h6>\\n        <ul class=\'mb-0\'>\\n          <li><strong>Diagnosis:<\\/strong> Symptoms + effluent WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with <span class=\'hl-symbol\'>><\\/span>50% PMNs after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell + positive culture. <\\/li>\\n          <li><strong>Empiric IP:<\\/strong> 1st-gen cephalosporin + ceftazidime\\/aminoglycoside; dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; consider antifungal prophylaxis.  <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Baseline pre-PD:<\\/strong> CBC, CMP, Ca\\/P\\/PTH, albumin, HbA1c (if diabetic), viral serology (HBV\\/HCV\\/HIV), ECG; abdominal wall exam for hernia.\",\"\\ud83e\\uddeb <strong>Peritonitis workup:<\\/strong> Effluent cell count\\/diff, Gram stain, culture (blood-culture bottles preferred) after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell; if no dwell, instill 1 L for 2 h before sampling. \",\"\\ud83e\\uddee <strong>Adequacy\\/Membrane:<\\/strong> Weekly Kt\\/V urea (include residual); PET (2 L 2.5% dextrose; samples 0, 2, 4 h) \\u00b1 sodium sieving.  \",\"\\ud83e\\ude7a <strong>UF failure check:<\\/strong> 4 h dwell with 3.86\\u20134.25% dextrose; UF <span class=\'hl-symbol\'><<\\/span>400 mL = UFF. \",\"\\ud83d\\uddbc\\ufe0f <strong>Mechanical issues:<\\/strong> CXR for hydrothorax; consider ultrasound\\/CT peritoneography for leaks; fluoroscopic\\/laparoscopic review for catheter malfunction. \"],\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'alert alert-danger\'><strong>Emergency algorithm (PD patient)<\\/strong><\\/div><ol class=\'mb-2\'>\\n  <li><strong>Suspected peritonitis:<\\/strong> Draw effluent (cell count\\/diff, Gram, culture) \\u279c start empiric IP antibiotics (1st-gen cephalosporin + ceftazidime\\/aminoglycoside) with dwell <span class=\'hl-symbol\'>>=<\\/span>6 h \\u279c add metronidazole if intra-abdominal source suspected \\u279c narrow when cultures return.  <\\/li>\\n  <li><strong>Sepsis\\/instability:<\\/strong> Give IV antibiotics and fluids; consider temporary HD if PD not feasible.<\\/li>\\n  <li><strong>Severe UF failure:<\\/strong> Confirm with 4.25% 4 h test (UF <span class=\'hl-symbol\'><<\\/span>400 mL) \\u279c optimize prescription (shorter dwells, higher osmolarity, icodextrin for long dwell) \\u279c assess PET\\/sodium sieving.  <\\/li>\\n  <li><strong>Fungal peritonitis:<\\/strong> Remove catheter urgently; start antifungal therapy. <\\/li>\\n  <li><strong>Respiratory compromise\\/hydrothorax:<\\/strong> Stop PD, drain, image; plan leak management.<\\/li>\\n<\\/ol>\",\"PILLAR_1\":\"Patient selection & access\",\"STEP_1_TITLE\":\"Who is a good PD candidate?\",\"STEP_1_LI\":[\"\\u2705 <strong>Strong indications:<\\/strong> Preference for home therapy\\/independence, difficult vascular access, frequent HD hypotension, refractory CHF\\/volume overload, long distance to HD unit, paediatrics. \",\"\\ud83e\\udded <strong>Favouring scenarios:<\\/strong> Seeking transplantation, bleeding disorders, cardiovascular instability, persistent volume-related HTN. \"],\"STEP_2_TITLE\":\"Access planning & initiation\",\"STEP_2_LI\":[\"\\ud83d\\udd27 <strong>Catheter timing:<\\/strong> Place <span class=\'hl-symbol\'>>=<\\/span>2 weeks before starting when possible; urgent-start PD feasible if needed. \",\"\\ud83e\\uddf5 <strong>Catheter position:<\\/strong> Tip in pelvis; assess\\/avoid adhesions; fluoroscopic\\/peritoneoscopic placement yields high early success.  \"],\"PILLAR_2\":\"Infection prevention, diagnosis & treatment\",\"STEP_3_TITLE\":\"Prevent peritonitis\",\"STEP_3_LI\":[\"\\ud83e\\uddfc <strong>Bundle:<\\/strong> Pre-insertion systemic antibiotics, disconnect systems with \'flush-before-fill\', robust training\\/retraining, daily exit-site gentamicin 0.1% (plus antifungal prophylaxis during antibiotics), dental\\/endo\\/colonoscopy prophylaxis as indicated. \",\"\\ud83c\\udff7\\ufe0f <strong>After any episode:<\\/strong> Retraining reduces recurrence. \"],\"STEP_4_TITLE\":\"Diagnose & treat peritonitis\",\"STEP_4_LI\":[\"\\ud83e\\uddeb <strong>Diagnosis:<\\/strong> Symptoms + WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L with <span class=\'hl-symbol\'>><\\/span>50% PMNs after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell + positive culture; adapt for short dwells (use %PMNs). \",\"\\ud83d\\udc8a <strong>Empiric IP:<\\/strong> 1st-gen cephalosporin + ceftazidime\\/aminoglycoside; dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; MRSA risk \\u2192 vancomycin; pathogen-specific durations (generally 2\\u20133 weeks).  \"],\"TOPIC_BLOCK_A_TITLE\":\"PD prescription & adequacy\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"\\ud83e\\uddee <strong>Weekly Kt\\/V urea:<\\/strong> Target <span class=\'hl-symbol\'>>=<\\/span>1.7 (total = peritoneal + residual) with shared decision-making focus beyond a single number. \",\"\\ud83e\\uddea <strong>PET:<\\/strong> 2 L 2.5% dextrose; samples 0, 2, 4 h; classify transport (high\\u2192shorter dwells; low\\u2192longer\\/high-dose regimens). \",\"\\ud83e\\uddc2 <strong>Sodium sieving (\'Na+ dip\'):<\\/strong> Present with dextrose (aquaporin function); absent with icodextrin. \",\"\\ud83d\\udcc9 <strong>UFF:<\\/strong> UF <span class=\'hl-symbol\'><<\\/span>400 mL at 4 h with 3.86\\u20134.25% dextrose indicates UF failure; adjust dwell\\/osmotic, check constipation\\/drainage.  \"],\"TOPIC_BLOCK_B_TITLE\":\"Complications & troubleshooting\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"\\ud83e\\uddf5 <strong>Catheter outflow failure:<\\/strong> Often due to omental \'flap-valve\'; repositioning has limited long-term success; replacement often needed.  \",\"\\ud83e\\udec1 <strong>Hydrothorax:<\\/strong> Suspect with dyspnea\\/effusion; hold PD and evaluate for pleuroperitoneal leak.\",\"\\ud83e\\uddb4 <strong>CKD-MBD & dialysate Ca:<\\/strong> Typical PD Ca 1.25\\u20131.75 mmol\\/L; 1.25 mmol\\/L helps achieve near calcium-neutral balance and avoid hypercalcemia. \",\"\\ud83e\\udda0 <strong>Fungal peritonitis:<\\/strong> Remove catheter; systemic antifungals per susceptibility. \"],\"TOPIC_BLOCK_C_TITLE\":\"Solutions & osmotic choices\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\ud83d\\udca7 <strong>Dextrose strengths & UF (per 2 L\\/60 min):<\\/strong> 1.5% \\u2192 40\\u2013150 mL, 2.5% \\u2192 100\\u2013300 mL, 4.25% \\u2192 300\\u2013400 mL. \",\"\\ud83c\\udf3f <strong>Icodextrin:<\\/strong> Colloid osmotic agent; ideal for long dwell; no Na<sup>+<\\/sup> dip. \",\"\\ud83e\\uddea <strong>Biocompatible, neutral pH\\/low GDP:<\\/strong> Lower GDP exposure; clinical outcome benefits remain mixed. \"],\"QUALITY_PROCESS_LI\":[\"\\ud83e\\uddfc <strong>Insertion bundle:<\\/strong> Pre-op systemic antibiotics and sterile technique.\",\"\\ud83c\\udf93 <strong>Training & retraining:<\\/strong> Structured program; retrain after any peritonitis. \",\"\\ud83e\\uddf4 <strong>Exit-site care:<\\/strong> Daily gentamicin 0.1% and antifungal prophylaxis when on antibiotics. \"],\"QUALITY_OUTCOME_LI\":[\"\\ud83d\\udcc9 <strong>Reduce infection burden:<\\/strong> Lower peritonitis episodes and catheter removals.\",\"\\ud83c\\udfe5 <strong>Fewer hospitalizations:<\\/strong> Optimize PET-based prescriptions; early treatment of infections. \"],\"QUALITY_SAFETY_LI\":[\"\\ud83d\\udc89 <strong>Antibiotic dwell:<\\/strong> Maintain IP antibiotic dwell <span class=\'hl-symbol\'>>=<\\/span>6 h for efficacy; avoid mixing vancomycin and gentamicin in the same bag. \",\"\\ud83e\\uddb5 <strong>Aminoglycosides:<\\/strong> Use cautiously if residual urine output <span class=\'hl-symbol\'>><\\/span>100 mL\\/day (ototoxicity risk). \"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>Always culture before antibiotics<\\/strong> when clinically safe; prefer IP route for PD peritonitis; give MRSA coverage if local prevalence\\/high-risk; remove catheter promptly in fungal peritonitis.  \",\"COMMUNICATION_LI\":\"\\ud83d\\udde3\\ufe0f <strong>Counsel on asepsis & lifestyle:<\\/strong> Hand hygiene, mask use during connections, travel planning with supplies, sick-day rules, and when to call the PD team.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'pdCases\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c1h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c1\'>Case 1: Cloudy morning bag on CCPD<\\/button><\\/h2>\\n    <div id=\'c1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Immediate steps:<\\/strong> Send effluent for cell count\\/diff, Gram, culture (blood-culture bottles), start empiric IP antibiotics; dwell <span class=\'hl-symbol\'>>=<\\/span>6 h.  <\\/li>\\n          <li><strong>Criteria:<\\/strong> WBC <span class=\'hl-symbol\'>><\\/span>100\\/\\u00b5L and <span class=\'hl-symbol\'>><\\/span>50% PMNs after <span class=\'hl-symbol\'>>=<\\/span>2 h dwell. <\\/li>\\n          <li><strong>Tailor therapy:<\\/strong> Narrow per culture; treat 2\\u20133 weeks depending on organism. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c2\'>Case 2: Weight gain & ankle edema despite APD<\\/button><\\/h2>\\n    <div id=\'c2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Assess:<\\/strong> Intake\\/adherence, prescription, PET; consider UFF (4.25% 4 h test; UF <span class=\'hl-symbol\'><<\\/span>400 mL).  <\\/li>\\n          <li><strong>Adjust:<\\/strong> Shorter dwells for high transporters; icodextrin for long dwell; higher dextrose strategically.  <\\/li>\\n          <li><strong>Rule out:<\\/strong> Constipation, leaks, heart failure. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'c3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#c3\'>Case 3: New exit-site erythema & tenderness<\\/button><\\/h2>\\n    <div id=\'c3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#pdCases\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Management:<\\/strong> Culture exit-site; start appropriate antibiotics; continue daily gentamicin 0.1% ointment; reassess for tunnel involvement. <\\/li>\\n          <li><strong>Prevent recurrence:<\\/strong> Retraining on technique; review prophylaxis for dental\\/GI procedures. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"List three strong indications and three relative indications for choosing PD over HD.\",\"a\":\"Strong: difficult vascular access, frequent HD hypotension, refractory CHF\\/volume overload. Relative: transplant-prep preference, bleeding disorders, cardiovascular instability\\/persistent volume-related HTN.  \"},{\"q\":\"Define peritonitis in PD and outline the specimen strategy.\",\"a\":\"Symptoms (pain\\/cloudy effluent) + effluent WBC >100\\/\\u00b5L with >50% PMNs after \\u22652 h dwell + positive culture; use blood-culture bottles; if no dwell, instill 1 L for 2 h before sampling. \"},{\"q\":\"State a typical empiric regimen and one key administration rule for PD peritonitis.\",\"a\":\"IP cefazolin\\/cephalothin plus ceftazidime or an aminoglycoside; allow antibiotics to dwell \\u22656 h (avoid mixing vanc+gent in same bag).  \"},{\"q\":\"What weekly Kt\\/V urea target is used for PD adequacy?\",\"a\":\"Total weekly Kt\\/V urea \\u22651.7 (includes residual kidney function).  \"},{\"q\":\"Summarize the standard PET protocol and its purpose.\",\"a\":\"2 L 2.5% dextrose, dialysate at 0, 2, 4 h with plasma sampling; classify transport to guide dwell time\\/volume and UF strategy. \"},{\"q\":\"What is the \'sodium dip\' and when is it absent?\",\"a\":\"A fall in dialysate Na+ early in dwell indicates aquaporin-mediated free water transport; absent with icodextrin long dwells. \"},{\"q\":\"Define ultrafiltration failure (UFF) in PD.\",\"a\":\"UF <400 mL after a 4-hour dwell with 3.86\\u20134.25% dextrose is consistent with UFF. \"},{\"q\":\"List absolute contraindications to PD.\",\"a\":\"Adhesions\\/malignancy, uncorrectable large hernias, loss of peritoneal function, ostomies, 3rd-trimester pregnancy, severe active psychiatric disease, lack of home support, pleuroperitoneal fistula not corrected. \"},{\"q\":\"List relative contraindications to PD.\",\"a\":\"Recent major abdominal surgery (prosthesis), severe malnutrition, abdominal wall cellulitis, severe respiratory failure, morbid obesity, severe diabetic gastroparesis, ventriculoperitoneal shunt, severe nephrotic syndrome. \"},{\"q\":\"When should the PD catheter be placed prior to starting PD?\",\"a\":\"Ideally \\u22652 weeks before initiation to reduce leaks; urgent-start PD is feasible when necessary. \"},{\"q\":\"What dialysate calcium range is typical in PD and why might 1.25 mmol\\/L be preferred?\",\"a\":\"Ca 1.25\\u20131.75 mmol\\/L; 1.25 mmol\\/L helps avoid positive Ca balance and hypercalcemia, aiming for \'calcium neutral\'. \"},{\"q\":\"Name two key peritonitis prevention measures.\",\"a\":\"Systemic antibiotics pre-catheter insertion; daily exit-site gentamicin 0.1% ointment with antifungal prophylaxis when on antibiotics; structured training and retraining. \"}],\"PITFALLS_LI\":[\"\\ud83d\\udd0e <strong>Short dwell sampling:<\\/strong> Relying on total WBC in very short dwells may miss peritonitis; use %PMNs and create a 2 h dwell for sampling. \",\"\\ud83e\\uddf4 <strong>Mixing antibiotics:<\\/strong> Inject vancomycin and gentamicin into different PD dwells; don\'t co-mix. \",\"\\ud83e\\uddc2 <strong>Ignoring sodium sieving:<\\/strong> Lack of early Na+ dip suggests aquaporin dysfunction\\/UF failure. \",\"\\ud83e\\udda0 <strong>Delayed catheter removal in fungal peritonitis:<\\/strong> Associated with worse outcomes\\u2014remove promptly. \"],\"ANSWER_STEPS_OL\":[\"Confirm indication and exclude contraindications; plan catheter and education.  \",\"Choose modality (CAPD\\/APD), fill volumes, and osmotic agents; prefer incremental start if residual function. \",\"Set adequacy targets (weekly Kt\\/V \\u22651.7), schedule PET (2\\u20136 weeks post-initiation), tailor dwell times to transport status.  \",\"Educate on infection prevention; exit-site care and prophylaxis. \",\"Establish peritonitis pathway: sampling, empiric IP therapy, dwell \\u22656 h, review at 72 h, adjust per culture.  \",\"Monitor UF and volume status; investigate UFF (<400 mL at 4 h with 4.25% dextrose) and address reversible factors. \"],\"TEACHING_CONCEPTS_LI\":[\"\\ud83e\\udde0 <strong>Three-pore model & Na+ sieving:<\\/strong> Explains free water vs solute transport; ties to PET and UFF. \",\"\\ud83d\\udcca <strong>CANUSA & adequacy:<\\/strong> Historical link between clearances\\/nutrition and outcomes\\u2014context for Kt\\/V 1.7. \",\"\\ud83e\\uddf4 <strong>Biocompatible solutions:<\\/strong> Neutral pH\\/low GDP\\u2014exposure reduced; outcome data mixed. \"],\"TEACHING_MISTAKES_LI\":[\"\\u274c <strong>Chasing Kt\\/V alone:<\\/strong> Ignoring symptoms\\/QoL and residual function contradicts modern PD practice. \",\"\\u274c <strong>Prolonged empiric therapy without cultures:<\\/strong> Always culture effluent first when safe. \",\"\\u274c <strong>High Ca bath by default:<\\/strong> Consider 1.25 mmol\\/L to avoid positive Ca balance. \"],\"ASCII_FLOWCHART_PRE\":\"SUSPECTED PD PERITONITIS\\n|\\n+--> Check symptoms (pain, cloudy bag, fever)\\n      |\\n      +--> Drain effluent if available\\n            |\\n            +--> Send cell count\\/diff + Gram + culture (blood-culture bottles)\\n            |\\n            +--> Start empiric IP antibiotics (1st-gen ceph + ceftaz\\/aminoglycoside); dwell >= 6 h\\n            |\\n            +--> Reassess at 48-72 h --> narrow per culture\\n                 |\\n                 +--> No improvement or fungal organism --> remove catheter and treat antifungal\\n\",\"EVIDENCE_STUDIES_LI\":[\"\\ud83d\\udcc8 <strong>CANUSA study:<\\/strong> Adequacy & nutrition association in CAPD; informed early adequacy targets. \",\"\\ud83e\\uddea <strong>PET methodology & outcomes:<\\/strong> Standard PET (D\\/P Cr; D\\/D0 glucose) informs modality choice; outcomes validation limited.  \",\"\\ud83e\\uddf4 <strong>Biocompatible solutions:<\\/strong> Neutral pH\\/low GDP reduce GDP exposure; mixed RCT\\/systematic review outcomes. \",\"\\ud83d\\udcc9 <strong>UFF criterion:<\\/strong> UF <400 mL at 4 h with 3.86\\u20134.25% dextrose consistent with UFF. \"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"\\u2705 <strong>Adequacy:<\\/strong> Aim weekly Kt\\/V urea <span class=\'hl-symbol\'>>=<\\/span>1.7 including residual, with patient-centred care beyond numeric targets. \",\"\\u2705 <strong>Peritonitis:<\\/strong> Diagnose per ISPD-aligned criteria; use IP empiric therapy and dwell <span class=\'hl-symbol\'>>=<\\/span>6 h; remove catheter for fungal infection.   \",\"\\u2705 <strong>Dialysate calcium:<\\/strong> Individualize within 1.25\\u20131.50 mmol\\/L; 1.25 mmol\\/L often preferred to avoid hypercalcemia. \"],\"GUIDELINE_ANCHORS_LI\":[\"\\ud83e\\uddee <strong>KDOQI\\/ISPD adequacy:<\\/strong> Use total weekly Kt\\/V urea targets as primary measure; include residual function. \",\"\\ud83e\\uddeb <strong>ISPD peritonitis (2016 update):<\\/strong> Prevention\\/treatment framework adapted in modern handbooks. \",\"\\ud83e\\uddea <strong>PET standardization:<\\/strong> 2 L 2.5% dextrose, sampling at 0\\/2\\/4 h to classify transport. \"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'5\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex1h\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex1\'>Unmapped pearls<\\/button><\\/h2>\\n    <div id=\'ex1\' class=\'accordion-collapse collapse show\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Assisted PD:<\\/strong> Caregiver-supported PD expands eligibility in frailty\\/cognitive barriers. <\\/li>\\n          <li><strong>COVID-19 context:<\\/strong> Home PD reduces exposure vs in-centre HD. <\\/li>\\n          <li><strong>Constipation management:<\\/strong> Prevents drain problems\\/outflow failure\\u2014cross-reference: <em>Complications & troubleshooting<\\/em>. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex2h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex2\'>Edge cases & special populations<\\/button><\\/h2>\\n    <div id=\'ex2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Pregnancy:<\\/strong> 3rd trimester cited as absolute contraindication in some sources; individualize with maternal\\u2013fetal team if considering PD\\u2014cross-reference: <em>Contraindications<\\/em>. <\\/li>\\n          <li><strong>Cardiorenal syndrome:<\\/strong> PD may aid volume control in selected non-ESKD patients. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex3h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex3\'>Drug dosing & adjustments<\\/button><\\/h2>\\n    <div id=\'ex3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Antibiotic specifics:<\\/strong> Example IP dosing: cefazolin\\/cephalothin per 2\\u20133 L bag daily plus ceftazidime or aminoglycoside; consider program MRSA epidemiology for vancomycin; avoid co-mixing vanc+gent.   <\\/li>\\n          <li><strong>Antifungal therapy:<\\/strong> Candida\\u2014fluconazole or amphotericin \\u00b1 flucytosine; IP route not preferred over systemic in fungi. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex4h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex4\'>Local policy & pathway notes<\\/button><\\/h2>\\n    <div id=\'ex4\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Urgent-start PD:<\\/strong> Ensure centre protocols for catheter insertion, flushes, and low-volume starts are in place\\u2014cross-reference: <em>Access planning & initiation<\\/em>. <\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\' id=\'ex5h\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ex5\'>Suggested schema extensions<\\/button><\\/h2>\\n    <div id=\'ex5\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li><strong>Catheter management fields:<\\/strong> Add keys for insertion technique, exit-site scoring, and constipation protocol.<\\/li>\\n          <li><strong>PD solution module:<\\/strong> Capture local availability (icodextrin, low-GDP, amino-acid bags) and funding constraints.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\"}', '{\"chips\":[\"Indications & patient selection\",\"Contraindications (absolute\\/relative)\",\"Peritonitis, PET & adequacy\"],\"section_counts\":{\"immediate_priorities\":6,\"investigations\":5,\"viva_items\":12,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(22, NULL, 3, 1, 1, 'post-transplant-aki-banff-2b', 'Post-Transplant Acute Kidney Injury: T-Cell Mediated Rejection (Banff IIB)', 'Post-KTX Week 1 • Creatinine 200 • Banff IIB Rejection', 'published', 'A rise in serum creatinine in a recent kidney transplant recipient constitutes a diagnostic emergency. The approach must be systematic to urgently differentiate between common non-rejection causes (e.g., hypoperfusion, CNI toxicity, urinary tract obstruction) and immunologic allograft injury. An urgent Doppler ultrasound is critical to rule out surgical or vascular complications, followed by a renal allograft biopsy, which remains the gold standard for diagnosing and grading acute rejection according to the Banff classification.', '{\"slug\":\"post-transplant-aki-banff-2b\",\"TOPIC\":\"Post-Transplant Acute Kidney Injury: T-Cell Mediated Rejection (Banff IIB)\",\"CHIP_1\":\"Post-KTX Week 1\",\"CHIP_2\":\"Creatinine 200\",\"CHIP_3\":\"Banff IIB Rejection\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"<p>A rise in serum creatinine in a recent kidney transplant recipient constitutes a diagnostic emergency. The approach must be systematic to urgently differentiate between common non-rejection causes (e.g., hypoperfusion, CNI toxicity, urinary tract obstruction) and immunologic allograft injury. An urgent Doppler ultrasound is critical to rule out surgical or vascular complications, followed by a renal allograft biopsy, which remains the gold standard for diagnosing and grading acute rejection according to the Banff classification.<\\/p>\",\"IMMEDIATE_PRIORITIES_LI\":[\"<strong>Assess hemodynamic stability:<\\/strong> Ensure adequate graft perfusion and rule out hypotension or shock.\",\"<strong>Rule out urgent urological\\/vascular issues:<\\/strong> Anuria or sudden oliguria requires immediate investigation to exclude obstruction or vascular thrombosis.\",\"<strong>Check for hyperkalemia:<\\/strong> A common and life-threatening complication of acute kidney injury.\",\"<strong>Review immunosuppressant levels:<\\/strong> Check for subtherapeutic or supratherapeutic calcineurin inhibitor (CNI) levels.\"],\"DDX_BUCKET_1_TITLE\":\"Common Non-Rejection Causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"<strong>Calcineurin Inhibitor (CNI) Toxicity:<\\/strong> Rising creatinine due to supratherapeutic levels of tacrolimus or cyclosporine.\",\"<strong>Hypoperfusion\\/Dehydration:<\\/strong> Pre-renal azotemia from decreased effective circulating volume.\",\"<strong>Urinary Tract Obstruction:<\\/strong> Can be caused by blood clots, ureteric stenosis, or external compression (e.g., lymphocele).\",\"<strong>Drug-Induced AKI:<\\/strong> Nephrotoxicity from other medications (e.g., NSAIDs, certain antibiotics).\"],\"DDX_BUCKET_2_TITLE\":\"Allograft-Specific Pathologies\",\"DDX_BUCKET_2_ITEMS_LI\":[\"<strong>Acute T-Cell Mediated Rejection (TCMR):<\\/strong> Infiltration of the allograft by recipient\'s T-lymphocytes.\",\"<strong>Acute Antibody-Mediated Rejection (AMR):<\\/strong> Injury caused by donor-specific antibodies (DSAs) targeting the graft.\",\"<strong>Transplant Renal Artery Stenosis (TRAS):<\\/strong> Narrowing of the transplant artery, typically presenting later but can occur early.\",\"<strong>BK Virus Nephropathy:<\\/strong> Reactivation of polyomavirus BK leading to tubulointerstitial nephritis, usually >1 month post-transplant.\"],\"DDX_BUCKET_3_TITLE\":\"Less Common Causes\",\"DDX_BUCKET_3_ITEMS_LI\":[\"<strong>Recurrence of Primary Disease:<\\/strong> The original glomerular disease recurring in the allograft.\",\"<strong>Thrombotic Microangiopathy (TMA):<\\/strong> Can be associated with CNIs, infections, or AMR.\",\"<strong>Pyelonephritis of the Allograft:<\\/strong> Bacterial infection of the kidney graft parenchyma.\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'table-responsive\'><table class=\'table table-bordered table-sm\'><thead><tr><th>Step<\\/th><th>Action<\\/th><th>Purpose<\\/th><\\/tr><\\/thead><tbody><tr><td>1<\\/td><td>History, Exam, Labs<\\/td><td>Assess stability, check drug levels<\\/td><\\/tr><tr><td>2<\\/td><td>Doppler Ultrasound<\\/td><td>Rule out obstruction\\/TRAS<\\/td><\\/tr><tr><td>3<\\/td><td>Allograft Biopsy<\\/td><td>Gold standard for diagnosis (Banff Score)<\\/td><\\/tr><tr><td>4<\\/td><td>Treat Rejection<\\/td><td>Pulse steroids +\\/- ATG<\\/td><\\/tr><\\/tbody><\\/table><\\/div>\",\"INVESTIGATIONS_LI\":[\"\\ud83e\\uddea <strong>Labs:<\\/strong> Complete blood count, urea & electrolytes, liver function tests, C-reactive protein.\",\"<strong>Immunosuppressant Levels:<\\/strong> Urgent tacrolimus or cyclosporine trough level.\",\"<strong>Virology:<\\/strong> BK virus and CMV PCR in blood to exclude viral reactivation as a cause or contributor.\",\"\\ud83d\\udd0e <strong>Imaging:<\\/strong> Urgent renal allograft Doppler ultrasound to assess perfusion, rule out hydronephrosis, check for collections, and measure resistive indices. Essential to exclude TRAS.\",\"<strong>Pathology:<\\/strong> Percutaneous renal allograft biopsy for light microscopy, immunofluorescence, and electron microscopy. Provides Banff classification.\",\"<strong>Immunology:<\\/strong> Donor-Specific Antibody (DSA) testing using a solid-phase immunoassay (e.g., Luminex Single Antigen Bead assay).\"],\"EMERGENCY_ALGORITHM_HTML\":\"Stable Patient with &uarr;Creatinine Post-KTX (1 week) --&gt; STAT Labs + Tacrolimus Level --&gt; Urgent Doppler US --&gt; If No Obstruction\\/Stenosis --&gt; Coordinate Urgent Renal Biopsy --&gt; Review Biopsy for Banff Score --&gt; Diagnosis Banff IIB TCMR --&gt; Initiate Pulse Steroids + ATG\",\"PILLAR_1\":\"Diagnosis & Workup\",\"STEP_1_TITLE\":\"Initial Bedside Assessment & Labs\",\"STEP_1_LI\":[\"<strong>History:<\\/strong> Ascertain source of transplant (living\\/deceased), baseline creatinine, immunosuppressive regimen, medication adherence, and any symptoms of infection or volume depletion.\",\"<strong>Examination:<\\/strong> Assess volume status (JVP, postural BP, edema), graft tenderness, and check surgical wound.\",\"<strong>Laboratory Tests:<\\/strong> Full blood count (for anemia, leukopenia), renal profile (for creatinine trend, hyperkalemia), and inflammatory markers.\",\"<strong>Drug Levels:<\\/strong> A sub-therapeutic CNI level increases suspicion for rejection, whereas a high level points towards CNI toxicity.\"],\"STEP_2_TITLE\":\"Imaging & Histopathology\",\"STEP_2_LI\":[\"\\ud83d\\udd0e <strong>Doppler Ultrasound:<\\/strong> A crucial first imaging step. It assesses graft perfusion, rules out hydronephrosis (obstruction) and fluid collections (lymphocele, hematoma). High resistive indices (<span class=\'hl-symbol\'>&gt;<\\/span>0.8) are nonspecific but suggest parenchymal pathology. Color and spectral Doppler are used to exclude TRAS and renal vein thrombosis.\",\"<strong>Renal Allograft Biopsy:<\\/strong> The gold standard. Provides definitive diagnosis and grades severity. The Banff classification is used to score tubulitis (t), interstitial inflammation (i), and endarteritis (v) for TCMR, as well as features of AMR.\"],\"PILLAR_2\":\"Management of Banff IIB TCMR\",\"STEP_3_TITLE\":\"First-Line Therapy: Pulse Corticosteroids\",\"STEP_3_LI\":[\"\\ud83d\\udc8a <strong>High-Dose IV Methylprednisolone:<\\/strong> This is the standard initial treatment for all grades of acute cellular rejection. A typical course is 500mg to 1g daily for 3 consecutive days.\",\"<strong>Rationale:<\\/strong> Provides broad anti-inflammatory and immunosuppressive effects to reduce the T-cell infiltration and inflammatory response within the graft.\"],\"STEP_4_TITLE\":\"Intensification Therapy for Severe Rejection\",\"STEP_4_LI\":[\"\\ud83d\\udc8a <strong>Lymphocyte-Depleting Agents:<\\/strong> For moderate-to-severe TCMR (Banff grade &ge;IIA, characterized by endarteritis) or steroid-resistant rejection, a T-cell depleting antibody is indicated.\",\"<strong>Agent of Choice:<\\/strong> Anti-thymocyte globulin (ATG, Thymoglobulin) is the most commonly used agent. It leads to profound depletion of circulating T-lymphocytes.\",\"<strong>Supportive Care:<\\/strong> Optimization of baseline immunosuppression (e.g., ensuring adequate CNI levels) is also essential.\"],\"TOPIC_BLOCK_A_TITLE\":\"Treatment of Banff Grade IIB Acute Cellular Rejection\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<strong>Indication for Intensification:<\\/strong> Banff grade IIB TCMR involves moderate to severe intimal arteritis (endarteritis, v2 lesion), signifying a more aggressive rejection process that is less likely to respond to steroids alone.\",\"\\u2705 <strong>Pulse Steroids:<\\/strong> Initiate with IV methylprednisolone 500mg-1g daily for 3 days.\",\"\\u2705 <strong>Anti-thymocyte Globulin (ATG):<\\/strong> Administer concurrently or immediately after steroids. The typical dose is 1.5 mg\\/kg\\/day intravenously.\",\"<strong>Duration of ATG:<\\/strong> Therapy usually lasts for 5-10 days, guided by clinical response (improvement in creatinine) and daily lymphocyte count monitoring.\",\"<strong>Monitoring during ATG:<\\/strong> A daily CBC is essential. The ATG dose is adjusted or held based on WBC, lymphocyte, and platelet counts to avoid profound myelosuppression.\",\"<strong>Prophylaxis:<\\/strong> Augmenting immunosuppression requires prophylaxis against opportunistic infections, typically for Pneumocystis jirovecii (PJP) and CMV.\"],\"TOPIC_BLOCK_B_TITLE\":\"Assessing for Donor-Specific Antibodies (DSA)\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<strong>Technology:<\\/strong> The Luminex Single Antigen Bead (SAB) assay is a solid-phase immunoassay used to detect and characterize HLA-specific antibodies.\",\"\\ud83e\\uddea <strong>Method:<\\/strong> The patient\'s serum is incubated with a panel of microscopic beads, where each bead is coated with a single, specific HLA molecule (e.g., HLA-A*02:01).\",\"<strong>Detection:<\\/strong> If DSAs are present, they bind to the corresponding bead. A secondary, fluorescent-labeled anti-human IgG antibody is added, which then binds to the DSA. A laser-based instrument quantifies the fluorescence on each bead.\",\"<strong>Quantification:<\\/strong> The strength of the antibody binding is reported as Mean Fluorescence Intensity (MFI). Higher MFI values generally correlate with higher antibody titers, though it is a semi-quantitative measure.\"],\"TOPIC_BLOCK_C_TITLE\":\"Differential Diagnosis: Calcineurin Inhibitor (CNI) Toxicity\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"\\u26a0\\ufe0f <strong>Clinical Overlap:<\\/strong> CNI toxicity is a key non-immunologic cause of rising creatinine and can be difficult to distinguish from rejection clinically.\",\"<strong>Key Differentiator:<\\/strong> A supratherapeutic CNI trough level (e.g., Tacrolimus >12-15 ng\\/mL in the early post-transplant phase) strongly suggests toxicity.\",\"<strong>Biopsy Findings:<\\/strong> Histology is definitive. CNI toxicity is characterized by isometric vacuolization of proximal tubular cells, arteriolar hyalinosis, and thrombotic microangiopathy, without the significant lymphocytic infiltrates (i, t, v lesions) seen in TCMR.\"],\"QUALITY_PROCESS_LI\":[\"Ensure renal biopsy is performed within 24 hours of the decision to investigate graft dysfunction.\",\"Multidisciplinary team discussion (nephrology, surgery, pathology) to confirm diagnosis and treatment plan.\",\"Implement a protocol for ATG administration, including premedication and daily lymphocyte count monitoring.\",\"Regularly review and document patient\'s response to therapy (creatinine, urine output).\"],\"QUALITY_OUTCOME_LI\":[\"Reversal of the acute rejection episode, defined by a significant and sustained decrease in serum creatinine.\",\"Return of serum creatinine to the patient\'s baseline level.\",\"Absence of subsequent rejection episodes.\",\"Prevention of chronic allograft injury and preservation of long-term graft function.\"],\"QUALITY_SAFETY_LI\":[\"Monitoring and management of pulse steroid side effects, such as hyperglycemia, hypertension, and mood changes.\",\"Prophylaxis against opportunistic infections (e.g., PJP, CMV, fungal) when intensifying immunosuppression.\",\"Close monitoring for ATG-related complications including cytokine release syndrome, serum sickness, leukopenia, and thrombocytopenia.\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f <strong>ATG Administration:<\\/strong> This is a potent immunosuppressant that requires administration by experienced staff. The first dose is often given slowly to monitor for infusion reactions (cytokine release syndrome). Premedication with corticosteroids, paracetamol, and an antihistamine is standard. Daily full blood count is mandatory to guide dosing and prevent life-threatening myelosuppression.\",\"COMMUNICATION_LI\":\"\\ud83d\\udcac <strong>Patient Communication:<\\/strong> It is crucial to clearly explain the diagnosis of \'rejection,\' distinguishing it from graft \'failure.\' Discuss the rationale for intensified treatment, including potential benefits (saving the kidney) and risks (infections, side effects). Reassure the patient while emphasizing the critical importance of lifelong medication adherence to prevent future episodes.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseScenariosAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseOne\' aria-expanded=\'true\' aria-controls=\'collapseOne\'><strong>Case 1:<\\/strong> 28yo Male, 1 week post-KTX, Creatinine rises from 120 to 200<\\/button><\\/h2><div id=\'collapseOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingOne\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Findings:<\\/strong> Stable, afebrile. Tacrolimus level 7 ng\\/mL. Doppler US is normal. Biopsy shows diffuse interstitial inflammation (i3), severe tubulitis (t3), and moderate endarteritis (v2). <strong>Diagnosis:<\\/strong> Banff Grade IIB Acute T-Cell Mediated Rejection. <strong>Action:<\\/strong> Admit for IV pulse methylprednisolone and initiate a course of ATG.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingTwo\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseTwo\' aria-expanded=\'false\' aria-controls=\'collapseTwo\'><strong>Case 2:<\\/strong> 55yo Female, 2 weeks post-KTX, Creatinine rises from 150 to 250<\\/button><\\/h2><div id=\'collapseTwo\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingTwo\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Findings:<\\/strong> Complaining of tremor. Tacrolimus level is high at 18 ng\\/mL. Doppler US is normal. Biopsy shows prominent isometric vacuolization of proximal tubules and arteriolar hyalinosis with minimal inflammation. <strong>Diagnosis:<\\/strong> Acute Calcineurin Inhibitor (CNI) Toxicity. <strong>Action:<\\/strong> Hold tacrolimus for 1-2 doses and restart at a significantly lower dose, monitoring levels closely.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingThree\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseThree\' aria-expanded=\'false\' aria-controls=\'collapseThree\'><strong>Case 3:<\\/strong> 40yo Male, 4 months post-KTX, Creatinine rises from 110 to 180 over 2 weeks<\\/button><\\/h2><div id=\'collapseThree\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingThree\' data-bs-parent=\'#caseScenariosAccordion\'><div class=\'accordion-body\'><strong>Findings:<\\/strong> Well, no symptoms. Tacrolimus level 8 ng\\/mL. Doppler US is normal. Blood BK virus PCR is high at 50,000 copies\\/mL. Biopsy shows interstitial inflammation, tubulitis, and positive SV40 staining in tubular nuclei. <strong>Diagnosis:<\\/strong> BK Virus Nephropathy. <strong>Action:<\\/strong> Reduce immunosuppression (typically by halving or stopping the antiproliferative agent first). Monitor BK viral load and creatinine closely.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the primary goal of the initial Doppler ultrasound in this patient?\",\"a\":\"To urgently exclude surgically correctable or vascular causes of graft dysfunction, such as urinary obstruction, fluid collection, or transplant renal artery\\/vein thrombosis.\"},{\"q\":\"What specific histologic feature defines a Banff Grade II acute T-cell mediated rejection?\",\"a\":\"The presence of intimal arteritis, also known as endarteritis (a \'v\' lesion), which is mononuclear cell infiltration beneath the arterial endothelium.\"},{\"q\":\"Why is anti-thymocyte globulin (ATG) used for Banff IIB rejection?\",\"a\":\"Banff IIB involves moderate to severe endarteritis, indicating a more aggressive rejection that is often resistant to treatment with corticosteroids alone. ATG provides potent T-cell depletion to control this vascular inflammation.\"},{\"q\":\"What is the standard starting dose for Thymoglobulin (ATG)?\",\"a\":\"The standard dose is typically 1.5 mg\\/kg of body weight, administered intravenously daily.\"},{\"q\":\"What parameters must be monitored daily when a patient is on ATG?\",\"a\":\"A complete blood count (CBC) is mandatory to monitor for leukopenia (especially lymphopenia) and thrombocytopenia, which require dose adjustment or temporary cessation.\"},{\"q\":\"What does a high MFI value on a Luminex DSA test signify?\",\"a\":\"A high Mean Fluorescence Intensity (MFI) value suggests a high level of a specific donor-specific antibody, which correlates with an increased risk of antibody-mediated rejection.\"},{\"q\":\"How do you distinguish CNI toxicity from acute rejection on a kidney biopsy?\",\"a\":\"CNI toxicity typically shows isometric tubular vacuolization and arteriolar hyalinosis with minimal inflammation, whereas acute cellular rejection is characterized by significant lymphocytic infiltration of the interstitium, tubules, and\\/or arteries.\"},{\"q\":\"What is the full name for the Banff \'t\' score?\",\"a\":\"The \'t\' score represents tubulitis, which is the infiltration of mononuclear cells into the tubular epithelium.\"},{\"q\":\"What is the mechanism of action of Calcineurin Inhibitors like Tacrolimus?\",\"a\":\"They inhibit calcineurin, a phosphatase that dephosphorylates NFAT, preventing its translocation to the nucleus and thereby blocking the transcription of IL-2 and subsequent T-cell activation and proliferation.\"},{\"q\":\"What is the most common cause of graft dysfunction in the first week post-transplant?\",\"a\":\"Delayed Graft Function (DGF), most often due to acute tubular necrosis (ATN) from ischemia-reperfusion injury, is the most common cause, followed by acute rejection.\"},{\"q\":\"What premedication is given before an ATG infusion?\",\"a\":\"Intravenous corticosteroids (e.g., hydrocortisone), an antihistamine (e.g., diphenhydramine), and an antipyretic (e.g., paracetamol) are given to prevent or mitigate cytokine release syndrome.\"},{\"q\":\"What is \'virtual crossmatch\'?\",\"a\":\"It is the process of comparing a recipient\'s known anti-HLA antibodies (from Luminex screening) against a potential donor\'s HLA typing in silico to predict the result of a laboratory crossmatch without physically mixing serum and cells.\"}],\"PITFALLS_LI\":[\"<strong>Delayed Biopsy:<\\/strong> Attributing a rising creatinine solely to CNI toxicity or dehydration without timely histologic confirmation can lead to irreversible graft damage from untreated rejection.\",\"<strong>Misinterpreting Doppler US:<\\/strong> High resistive indices are nonspecific. While they indicate a problem, they do not distinguish rejection from ATN or CNI toxicity.\",\"<strong>Inadequate ATG Dosing:<\\/strong> Failing to monitor lymphocyte counts and adjust ATG doses can lead to either ineffective treatment or profound, dangerous myelosuppression.\",\"<strong>Ignoring Concomitant AMR:<\\/strong> A biopsy may show features of both TCMR and AMR. Failing to check for DSAs and C4d staining can lead to undertreatment of a humoral component.\"],\"ANSWER_STEPS_OL\":[\"<strong>1. Initial Statement & Priorities:<\\/strong> \'I am presented with a patient one week post-kidney transplant with acute graft dysfunction. My immediate priorities are to ensure hemodynamic stability and rule out urgent surgical or vascular complications.\'\",\"<strong>2. History & Examination:<\\/strong> \'I would take a focused history covering immunosuppression adherence, symptoms of infection, and volume status. My examination would focus on volume assessment, graft tenderness, and vital signs.\'\",\"<strong>3. Initial Investigations:<\\/strong> \'I would order urgent labs including FBC, U&Es, and a stat tacrolimus level. The most critical first investigation is an urgent Doppler ultrasound of the allograft to exclude obstruction, vascular compromise, or a significant collection.\'\",\"<strong>4. Diagnosis Confirmation:<\\/strong> \'Assuming the ultrasound is unremarkable, the definitive diagnosis requires an urgent renal allograft biopsy. This will provide the Banff classification, which is essential for guiding therapy.\'\",\"<strong>5. Interpreting the Result:<\\/strong> \'The biopsy finding of Banff IIB T-cell mediated rejection indicates a severe form of acute cellular rejection with vascular involvement.\'\",\"<strong>6. Management Plan:<\\/strong> \'Based on this, my management plan would be to initiate high-dose pulse intravenous corticosteroids (e.g., methylprednisolone 500mg daily for 3 days) and, concurrently, a course of T-cell depleting therapy with anti-thymocyte globulin (ATG) for 5-10 days, with close monitoring of lymphocyte counts. I would also optimize their baseline immunosuppression and start appropriate antimicrobial prophylaxis.\'\"],\"TEACHING_CONCEPTS_LI\":[\"<strong>The Banff Classification:<\\/strong> This is the standardized, universal language for reporting renal allograft pathology, crucial for comparing data across centers and guiding evidence-based treatment.\",\"<strong>TCMR vs. AMR:<\\/strong> Understand the fundamental difference between T-cell mediated (cellular infiltration) and Antibody-mediated (humoral, involving DSAs and complement) rejection, as their treatments differ significantly.\",\"<strong>Solid-Phase Antibody Testing:<\\/strong> The Luminex platform has revolutionized HLA antibody detection, allowing for precise identification of DSAs and semi-quantitative assessment (MFI) to stratify immunologic risk.\"],\"TEACHING_MISTAKES_LI\":[\"<strong>\'Trial of Steroids\':<\\/strong> Giving a pulse of steroids \'just in case\' it is rejection without a biopsy is a common but poor practice. It can mask the true diagnosis, delay appropriate therapy for non-rejection causes, and expose the patient to unnecessary side effects.\",\"<strong>Relying on Drug Levels Alone:<\\/strong> Rejection can occur even with therapeutic CNI levels, and toxicity can occur even with levels that are not dramatically elevated. Biopsy remains paramount.\",\"<strong>Forgetting Infection Prophylaxis:<\\/strong> Intensifying immunosuppression with ATG significantly increases the risk of opportunistic infections. Failing to start PJP and CMV prophylaxis is a major patient safety error.\"],\"ASCII_FLOWCHART_PRE\":\"  Patient 1-wk Post-KTX with Creat > 200\\n           |\\n   [Assess Stability, Labs, Drug Levels]\\n           |\\n     [Doppler US]\\n           |          \\\\\\n    (Normal)       (Obstruction\\/TRAS)\\n       |                  |\\n  [Allograft Biopsy]     [Surgical\\/IR Intervention]\\n       | \\n [Banff IIB TCMR]\\n       |\\n [Pulse Steroids + ATG]\",\"EVIDENCE_STUDIES_LI\":[\"<strong>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009):<\\/strong> Provides the foundational evidence-based recommendations for managing rejection. It recommends treating Banff grade II rejection with lymphocyte-depleting antibodies in addition to corticosteroids.\",\"<strong>MENTOR Trial (Membranous Nephropathy Trial of Rituximab):<\\/strong> While not directly about TCMR, it highlights the importance of targeted immunologic therapies in transplant-related complications.\",\"<strong>Various Cohort Studies on ATG:<\\/strong> Multiple observational studies have established the efficacy of ATG in treating moderate-to-severe and steroid-resistant acute cellular rejection, forming the basis of current practice.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"\\u2705 <strong>KDIGO 2009 Guideline:<\\/strong> Recommends that moderate to severe acute rejection (Banff II or greater) should be treated with lymphocyte-depleting antibody therapy in addition to corticosteroids.\",\"\\u2705 <strong>Biopsy is Mandatory:<\\/strong> All major guidelines state that treatment for acute rejection should ideally be guided by a biopsy diagnosis to ensure the correct and most effective therapy is administered.\",\"\\u2705 <strong>Prophylaxis Recommended:<\\/strong> Consensus guidelines recommend antimicrobial prophylaxis for patients receiving T-cell depleting agents like ATG.\"],\"GUIDELINE_ANCHORS_LI\":[\"<strong>KDIGO Clinical Practice Guideline for the Care of Kidney Transplant Recipients (2009) - Recommendation 14.4.2:<\\/strong> \'We suggest that the first episode of acute T-cell-mediated rejection of Banff borderline, I or II type be treated initially with an increase in corticosteroid administration rather than with antibody therapy.\' - Note: This is often interpreted as initial pulse steroids, with antibody therapy added for grade II and above based on severity and local protocols.\",\"<strong>KDIGO Guideline - Recommendation 14.4.3:<\\/strong> \'We suggest that T-cell-depleting antibody therapy, in addition to corticosteroids, be used to treat corticosteroid-resistant rejection or severe vascular rejection (Banff grade IIB or higher).\'\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'3\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingExtraOne\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtraOne\' aria-expanded=\'true\' aria-controls=\'collapseExtraOne\'>Unmapped Pearls<\\/button><\\/h2><div id=\'collapseExtraOne\' class=\'accordion-collapse collapse show\' aria-labelledby=\'headingExtraOne\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>DSA MFI Interpretation:<\\/strong> While there is no universal cutoff, MFI values <span class=\'hl-symbol\'>&gt;<\\/span>3000-5000 are often considered clinically significant, especially if they are de novo post-transplant. However, clinical correlation with biopsy findings is paramount.<\\/li><li><strong>Subclinical Rejection:<\\/strong> Protocol biopsies sometimes reveal TCMR in patients with stable creatinine. The management of subclinical rejection is controversial but often involves optimization of baseline immunosuppression.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingExtraTwo\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtraTwo\' aria-expanded=\'false\' aria-controls=\'collapseExtraTwo\'>Drug Dosing & Adjustments<\\/button><\\/h2><div id=\'collapseExtraTwo\' class=\'accordion-collapse collapse\' aria-labelledby=\'headingExtraTwo\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><strong>ATG (Thymoglobulin) Dosing:<\\/strong> The standard dose is 1.5 mg\\/kg. This dose is typically adjusted based on daily absolute lymphocyte counts (ALC) or total white blood cell (WBC) count. For example: <ul><li>If ALC 0.2-0.5 x 10<sup>9<\\/sup>\\/L: Reduce dose by 50%.<\\/li><li>If ALC <span class=\'hl-symbol\'>&lt;<\\/span>0.2 x 10<sup>9<\\/sup>\\/L: Hold dose.<\\/li><li>If Platelets <span class=\'hl-symbol\'>&lt;<\\/span>50-75 x 10<sup>9<\\/sup>\\/L: Hold dose.<\\/li><\\/ul><\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'headingExtraThree\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapseExtraThree\' aria-expanded=\'false\' aria-controls=\'collapseExtraThree\'>Suggested Schema Extensions<\\/button><\\/h2><div id=\'accordion-body\'><ul><li>A dedicated key for \'<strong>Banff_Score_Details<\\/strong>\' could capture the specific i, t, v, g, ptc, C4d scores for more granular data representation.<\\/li><\\/ul><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Post-KTX Week 1\",\"Creatinine 200\",\"Banff IIB Rejection\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":4,\"investigations\":6,\"viva_items\":12,\"pitfalls\":4}}', NULL, NULL, '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 09:22:53');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(23, NULL, 4, 1, 1, 'renal-transplant-banff-2b-rejection', 'Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection', 'Post-KTX 1 week • Creatinine rise • Banff 2B rejection', 'published', 'A patient presents to the ER one week after kidney transplantation abroad, with rising serum creatinine (200 μmol/L) but clinically stable. The evaluation must systematically exclude surgical, vascular, infectious, and immunological causes. When biopsy confirms Banff 2B acute cellular rejection, urgent treatment with T-cell depleting therapy is required. This station explores the structured approach, including history, labs, imaging, biopsy, antibody testing, and therapeutic strategies.', '{\"slug\":\"renal-transplant-banff-2b-rejection\",\"TOPIC\":\"Kidney Transplant \\u2013 Early Allograft Dysfunction and Banff 2B Rejection\",\"CHIP_1\":\"Post-KTX 1 week\",\"CHIP_2\":\"Creatinine rise\",\"CHIP_3\":\"Banff 2B rejection\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"A patient presents to the ER one week after kidney transplantation abroad, with rising serum creatinine (200 \\u03bcmol\\/L) but clinically stable. The evaluation must systematically exclude surgical, vascular, infectious, and immunological causes. When biopsy confirms Banff 2B acute cellular rejection, urgent treatment with T-cell depleting therapy is required. This station explores the structured approach, including history, labs, imaging, biopsy, antibody testing, and therapeutic strategies.\",\"IMMEDIATE_PRIORITIES_LI\":[\"\\ud83e\\ude7a Detailed history: timing, donor\\/recipient profile, immunosuppressive regimen, adherence, infection risk.\",\"\\ud83d\\udd0e Focused examination: volume status, graft tenderness, urine output, fever\\/sepsis signs.\",\"\\ud83e\\uddea Baseline labs: CBC, renal panel, liver enzymes, coagulation, CRP\\/ESR.\",\"\\ud83d\\udc8a Drug monitoring: calcineurin inhibitor trough level (tacrolimus\\/cyclosporine).\",\"\\ud83d\\udda5\\ufe0f Renal ultrasound with Doppler: exclude obstruction, vascular thrombosis, or transplant renal artery stenosis (TRAS).\",\"\\ud83d\\udd2c Renal biopsy: gold standard for rejection diagnosis and grading (Banff criteria).\"],\"DDX_BUCKET_1_TITLE\":\"Vascular & Surgical Causes\",\"DDX_BUCKET_1_ITEMS_LI\":[\"Renal artery thrombosis\",\"Renal vein thrombosis\",\"Transplant renal artery stenosis (TRAS)\",\"Ureteric obstruction\\/leak\",\"Perinephric collection\\/hematoma\"],\"DDX_BUCKET_2_TITLE\":\"Immunological Causes\",\"DDX_BUCKET_2_ITEMS_LI\":[\"Acute cellular rejection (Banff 1\\u20133)\",\"Antibody-mediated rejection (AMR, C4d+, DSA+)\",\"Mixed rejection\"],\"DDX_BUCKET_3_TITLE\":\"Other Medical Causes\",\"DDX_BUCKET_3_ITEMS_LI\":[\"Calcineurin inhibitor toxicity\",\"Acute tubular necrosis (delayed graft function)\",\"Infection (BK virus, CMV, bacterial sepsis)\",\"Drug nephrotoxicity\"],\"QUICK_REF_CARD_HTML\":\"<div class=\'card p-2\'><ul><li><strong>Banff 2B rejection:<\\/strong> moderate-severe intimal arteritis (v2).<\\/li><li><strong>First-line therapy:<\\/strong> rATG (antithymocyte globulin).<\\/li><li><strong>ATG dose:<\\/strong> typically 1.5 mg\\/kg\\/day IV for 5\\u20137 days (monitor counts & infections).<\\/li><li><strong>Adjuncts:<\\/strong> steroids, optimize calcineurin inhibitor, infection prophylaxis.<\\/li><li><strong>DSA testing:<\\/strong> Luminex single-antigen bead assay, report MFI values.<\\/li><\\/ul><\\/div>\",\"INVESTIGATIONS_LI\":[\"Serum creatinine, urea, electrolytes\",\"CBC with differential\",\"Tacrolimus\\/cyclosporine trough level\",\"Viral PCR (CMV, BK virus)\",\"Urinalysis and culture\",\"Renal Doppler ultrasound\",\"Allograft biopsy (Banff classification)\",\"Donor-specific antibody (DSA) testing via Luminex\"],\"EMERGENCY_ALGORITHM_HTML\":\"<pre>Step 1: Rule out obstruction \\u2192 US with Doppler\\nStep 2: Check drug levels \\u2192 tacrolimus\\/cyclosporine\\nStep 3: Exclude infection \\u2192 labs, cultures, viral PCR\\nStep 4: Biopsy \\u2192 apply Banff criteria\\nIf Banff 2B:\\n  \\u2192 Start rATG (1.5 mg\\/kg\\/day IV \\u00d7 5\\u20137d)\\n  \\u2192 Add high-dose steroids\\n  \\u2192 Monitor WBC, platelets, CMV reactivation\\n  \\u2192 Adjust maintenance IS accordingly<\\/pre>\",\"PILLAR_1\":\"Diagnosis\",\"STEP_1_TITLE\":\"Clinical and Laboratory Assessment\",\"STEP_1_LI\":[\"History of immunosuppression adherence, infection exposure, graft pain\",\"Exam for fever, graft tenderness, edema, hypertension\",\"Labs: renal function, drug levels, viral PCRs\"],\"STEP_2_TITLE\":\"Imaging and Histology\",\"STEP_2_LI\":[\"Ultrasound with Doppler to rule out obstruction and TRAS\",\"Renal biopsy with Banff classification\",\"DSA testing by Luminex single-antigen bead assay\"],\"PILLAR_2\":\"Treatment\",\"STEP_3_TITLE\":\"Initial Therapy\",\"STEP_3_LI\":[\"High-dose IV methylprednisolone (500 mg \\u00d7 3 days)\",\"Escalate maintenance immunosuppression if subtherapeutic\"],\"STEP_4_TITLE\":\"Advanced Therapy\",\"STEP_4_LI\":[\"rATG (1.5 mg\\/kg\\/day IV \\u00d7 5\\u20137 days, max total 7.5\\u201310.5 mg\\/kg)\",\"Monitor for leukopenia, thrombocytopenia, infections\",\"Prophylaxis: CMV (valganciclovir), PCP (TMP-SMX), antifungal if prolonged\",\"Re-biopsy if poor response\"],\"TOPIC_BLOCK_A_TITLE\":\"Banff Classification Highlights\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"Banff 1: mild tubulitis\",\"Banff 2A: intimal arteritis (v1)\",\"Banff 2B: moderate-severe intimal arteritis (v2)\",\"Banff 3: transmural arteritis\\/fibrinoid necrosis\"],\"TOPIC_BLOCK_B_TITLE\":\"ATG Use in Rejection\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"Dose: 1.5 mg\\/kg\\/day IV for 5\\u20137 days\",\"Premedicate with steroids, antihistamines, antipyretics\",\"Monitor CBC, LFTs daily\",\"Prophylaxis for CMV, PCP, fungal infections\"],\"TOPIC_BLOCK_C_TITLE\":\"Donor-Specific Antibody Testing\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"Virtual crossmatch: compare recipient serum with donor HLA\",\"Luminex assay: single-antigen beads with fluorescence\",\"MFI cutoff varies (1000\\u20132000 considered weak, >5000 strong)\",\"C4d staining helps confirm AMR\"],\"QUALITY_PROCESS_LI\":[\"Ensure biopsy-proven diagnosis before escalating therapy\",\"Double-check drug dosing and interactions\",\"Document baseline infection screen before ATG\"],\"QUALITY_OUTCOME_LI\":[\"Prompt reversal of rejection improves graft survival\",\"Minimize infectious complications\",\"Preserve long-term allograft function\"],\"QUALITY_SAFETY_LI\":[\"Daily monitoring of CBC and LFT during ATG\",\"Strict infection prophylaxis\",\"Avoid over-immunosuppression if alternative causes identified\"],\"SAFETY_LI\":\"\\u26a0\\ufe0f ATG carries risks of cytokine release, cytopenias, and opportunistic infections\\u2014premedicate and monitor closely.\",\"COMMUNICATION_LI\":\"Explain biopsy results, rejection grade, and need for potent immunosuppression to patient and family; emphasize infection precautions.\",\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'caseAccordion\'>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case1\'>Case 1: Early Creatinine Rise Post-KTX<\\/button>\\n    <\\/h2>\\n    <div id=\'case1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>1 week post-KTX, creatinine 200.<\\/li>\\n          <li>Workup: drug levels, US Doppler, biopsy.<\\/li>\\n          <li>Biopsy: Banff 2B rejection.<\\/li>\\n          <li>Treatment: ATG with steroid pulses.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case2\'>Case 2: Doppler Suggests TRAS<\\/button>\\n    <\\/h2>\\n    <div id=\'case2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>Rising creatinine, bruit over graft.<\\/li>\\n          <li>Doppler: high velocity at anastomosis.<\\/li>\\n          <li>Plan: confirm with angiography, angioplasty\\/stenting.<\\/li>\\n          <li>Differentiate from rejection.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n  <div class=\'accordion-item\'>\\n    <h2 class=\'accordion-header\'>\\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case3\'>Case 3: AMR with DSA+<\\/button>\\n    <\\/h2>\\n    <div id=\'case3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\\n      <div class=\'accordion-body\'>\\n        <ul>\\n          <li>Biopsy: microvascular inflammation, C4d+.<\\/li>\\n          <li>DSA detected with high MFI on Luminex.<\\/li>\\n          <li>Treatment: plasmapheresis + IVIG \\u00b1 rituximab.<\\/li>\\n        <\\/ul>\\n      <\\/div>\\n    <\\/div>\\n  <\\/div>\\n<\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the differential diagnosis of rising creatinine 1 week post-transplant?\",\"a\":\"Vascular causes (thrombosis, TRAS), obstruction, rejection (cellular\\/AMR), drug toxicity, infection, ATN.\"},{\"q\":\"How do you investigate TRAS?\",\"a\":\"Start with Doppler US; confirm with CT angiography or MR angiography; gold standard is angiography with possible intervention.\"},{\"q\":\"What is Banff 2B rejection?\",\"a\":\"Moderate-to-severe intimal arteritis (v2) with tubulitis and interstitial inflammation.\"},{\"q\":\"What is first-line treatment for Banff 2B rejection?\",\"a\":\"Antithymocyte globulin (rATG), often combined with steroid pulses.\"},{\"q\":\"What is the ATG dose in acute rejection?\",\"a\":\"1.5 mg\\/kg\\/day IV for 5\\u20137 days, maximum total 7.5\\u201310.5 mg\\/kg, with monitoring of counts.\"},{\"q\":\"What precautions are required with ATG?\",\"a\":\"Premedication, daily CBC, infection prophylaxis (CMV, PCP), monitor for infusion reactions.\"},{\"q\":\"How is DSA testing performed?\",\"a\":\"Using Luminex single-antigen bead assay with fluorescence; reported as mean fluorescence intensity (MFI).\"},{\"q\":\"What is a virtual crossmatch?\",\"a\":\"Comparison of patient serum against donor HLA antigens using stored data, avoiding physical crossmatch.\"},{\"q\":\"What are treatment options for antibody-mediated rejection?\",\"a\":\"Plasmapheresis, IVIG, rituximab, bortezomib, complement blockade.\"},{\"q\":\"How do you monitor response to rejection therapy?\",\"a\":\"Serial creatinine, repeat biopsy if needed, trend DSA, monitor for infection.\"},{\"q\":\"What are common pitfalls in early transplant dysfunction?\",\"a\":\"Missing vascular obstruction, not checking drug levels, over-treating without biopsy confirmation.\"}],\"PITFALLS_LI\":[\"Treating empirically without biopsy confirmation\",\"Missing vascular complications (TRAS, thrombosis)\",\"Not checking calcineurin inhibitor levels\",\"Failure to provide infection prophylaxis during ATG\"],\"ANSWER_STEPS_OL\":[\"Stabilize and evaluate patient clinically.\",\"Order labs and drug levels.\",\"Perform renal Doppler US to exclude obstruction\\/TRAS.\",\"Proceed with renal biopsy for Banff grading.\",\"If Banff 2B: treat with rATG and steroids.\",\"Provide infection prophylaxis and monitoring.\"],\"TEACHING_CONCEPTS_LI\":[\"Importance of biopsy in transplant dysfunction\",\"Banff classification for rejection\",\"Mechanism of ATG and monitoring\",\"Principles of DSA detection and interpretation\"],\"TEACHING_MISTAKES_LI\":[\"Confusing TRAS with rejection\",\"Forgetting to check drug levels before biopsy\",\"Administering ATG without prophylaxis\",\"Assuming all rejection is AMR without DSA testing\"],\"ASCII_FLOWCHART_PRE\":\"Creatinine rise post-KTX (1 week)\\n   |\\n   +--> US Doppler \\u2192 Obstruction\\/TRAS? \\u2192 Treat accordingly\\n   |\\n   +--> Drug levels \\u2192 Toxicity? \\u2192 Adjust dose\\n   |\\n   +--> Infection screen \\u2192 Positive? \\u2192 Treat\\n   |\\n   +--> Biopsy \\u2192 Banff classification\\n           |\\n           +--> Banff 2B \\u2192 rATG + steroids\\n           +--> AMR \\u2192 PLEX + IVIG \\u00b1 rituximab\",\"EVIDENCE_STUDIES_LI\":[\"Banff 2019 update on criteria for rejection\",\"KDIGO transplant guidelines on acute rejection management\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"KDIGO: biopsy is mandatory before treating rejection\",\"rATG recommended for Banff 2B or higher rejection\",\"Luminex-based DSA testing is standard for AMR workup\"],\"GUIDELINE_ANCHORS_LI\":[\"KDIGO Kidney Transplant Guidelines (2020 update)\",\"Banff Classification (2019 consensus report)\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'audit\' data-unmapped-count=\'1\'><\\/div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#unmapped1\'>Unmapped pearls<\\/button><\\/h2><div id=\'unmapped1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li>Banff 2B carries high risk of graft loss if untreated; aggressive therapy is warranted.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\",\"template\":\"vivatemplate.html\"}', '{\"chips\":[\"Post-KTX 1 week\",\"Creatinine rise\",\"Banff 2B rejection\"],\"template\":\"vivatemplate.html\",\"section_counts\":{\"immediate_priorities\":6,\"investigations\":8,\"viva_items\":11,\"pitfalls\":4}}', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n      transition: opacity 0.3s ease;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n      transform: translateY(-2px);\r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .chip:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn,\r\n    section[id^=\"extra-note-\"] .delete-section-btn {\r\n      position: absolute;\r\n      top: 12px;\r\n      right: 12px;\r\n      z-index: 10;\r\n      opacity: 0.7;\r\n      transition: all 0.2s ease;\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      background: rgba(239, 68, 68, 0.1);\r\n      border: 1px solid rgba(239, 68, 68, 0.3);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn:hover,\r\n    section[id^=\"extra-note-\"] .delete-section-btn:hover {\r\n      opacity: 1;\r\n      background: rgba(239, 68, 68, 0.2);\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .additional-note .delete-section-btn i {\r\n      font-size: 14px;\r\n      color: #dc2626;\r\n    }\r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n      .additional-note .delete-section-btn {\r\n        display: none;\r\n      }\r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n      transition: box-shadow 0.2s ease;\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n      transform: translateY(-1px);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    /* Delete button styling */\r\n    .delete-section-btn {\r\n      opacity: 0;\r\n      transition: opacity 0.2s ease;\r\n    }\r\n    \r\n    .delete-section-btn:hover {\r\n      opacity: 1;\r\n      transform: scale(1.1);\r\n    }\r\n    \r\n    .nm-card:hover .delete-section-btn {\r\n      opacity: 1;\r\n    }\r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Post-KTX 1 week</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Creatinine rise</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">Banff 2B rejection</span>\r\n      </div>\r\n      <div class=\"small text-secondary\">A patient presents to the ER one week after kidney transplantation abroad, with rising serum creatinine (200 μmol/L) but clinically stable. The evaluation must systematically exclude surgical, vascular, infectious, and immunological causes. When biopsy confirms Banff 2B acute cellular rejection, urgent treatment with T-cell depleting therapy is required. This station explores the structured approach, including history, labs, imaging, biopsy, antibody testing, and therapeutic strategies.</div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li>🩺 Detailed history: timing, donor/recipient profile, immunosuppressive regimen, adherence, infection risk.</li><li>🔎 Focused examination: volume status, graft tenderness, urine output, fever/sepsis signs.</li><li>🧪 Baseline labs: CBC, renal panel, liver enzymes, coagulation, CRP/ESR.</li><li>💊 Drug monitoring: calcineurin inhibitor trough level (tacrolimus/cyclosporine).</li><li>🖥️ Renal ultrasound with Doppler: exclude obstruction, vascular thrombosis, or transplant renal artery stenosis (TRAS).</li><li>🔬 Renal biopsy: gold standard for rejection diagnosis and grading (Banff criteria).</li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Vascular & Surgical Causes</div><ul class=\"mb-0\"><li>Renal artery thrombosis</li><li>Renal vein thrombosis</li><li>Transplant renal artery stenosis (TRAS)</li><li>Ureteric obstruction/leak</li><li>Perinephric collection/hematoma</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Immunological Causes</div><ul class=\"mb-0\"><li>Acute cellular rejection (Banff 1–3)</li><li>Antibody-mediated rejection (AMR, C4d+, DSA+)</li><li>Mixed rejection</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Other Medical Causes</div><ul class=\"mb-0\"><li>Calcineurin inhibitor toxicity</li><li>Acute tubular necrosis (delayed graft function)</li><li>Infection (BK virus, CMV, bacterial sepsis)</li><li>Drug nephrotoxicity</li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div class=\'card p-2\'><ul><li><strong>Banff 2B rejection:</strong> moderate-severe intimal arteritis (v2).</li><li><strong>First-line therapy:</strong> rATG (antithymocyte globulin).</li><li><strong>ATG dose:</strong> typically 1.5 mg/kg/day IV for 5–7 days (monitor counts & infections).</li><li><strong>Adjuncts:</strong> steroids, optimize calcineurin inhibitor, infection prophylaxis.</li><li><strong>DSA testing:</strong> Luminex single-antigen bead assay, report MFI values.</li></ul></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li>Serum creatinine, urea, electrolytes</li><li>CBC with differential</li><li>Tacrolimus/cyclosporine trough level</li><li>Viral PCR (CMV, BK virus)</li><li>Urinalysis and culture</li><li>Renal Doppler ultrasound</li><li>Allograft biopsy (Banff classification)</li><li>Donor-specific antibody (DSA) testing via Luminex</li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\"><pre>Step 1: Rule out obstruction → US with Doppler\nStep 2: Check drug levels → tacrolimus/cyclosporine\nStep 3: Exclude infection → labs, cultures, viral PCR\nStep 4: Biopsy → apply Banff criteria\nIf Banff 2B:\n  → Start rATG (1.5 mg/kg/day IV × 5–7d)\n  → Add high-dose steroids\n  → Monitor WBC, platelets, CMV reactivation\n  → Adjust maintenance IS accordingly</pre></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Kidney Transplant – Early Allograft Dysfunction and Banff 2B Rejection</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Diagnosis</div>\r\n            <div class=\"fw-semibold\">Clinical and Laboratory Assessment</div>\r\n            <ul class=\"mb-3\"><li>History of immunosuppression adherence, infection exposure, graft pain</li><li>Exam for fever, graft tenderness, edema, hypertension</li><li>Labs: renal function, drug levels, viral PCRs</li></ul>\r\n            <div class=\"fw-semibold\">Imaging and Histology</div>\r\n            <ul class=\"mb-0\"><li>Ultrasound with Doppler to rule out obstruction and TRAS</li><li>Renal biopsy with Banff classification</li><li>DSA testing by Luminex single-antigen bead assay</li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Treatment</div>\r\n            <div class=\"fw-semibold\">Initial Therapy</div>\r\n            <ul class=\"mb-3\"><li>High-dose IV methylprednisolone (500 mg × 3 days)</li><li>Escalate maintenance immunosuppression if subtherapeutic</li></ul>\r\n            <div class=\"fw-semibold\">Advanced Therapy</div>\r\n            <ul class=\"mb-0\"><li>rATG (1.5 mg/kg/day IV × 5–7 days, max total 7.5–10.5 mg/kg)</li><li>Monitor for leukopenia, thrombocytopenia, infections</li><li>Prophylaxis: CMV (valganciclovir), PCP (TMP-SMX), antifungal if prolonged</li><li>Re-biopsy if poor response</li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Banff Classification Highlights</div><ul class=\"mb-0\"><li>Banff 1: mild tubulitis</li><li>Banff 2A: intimal arteritis (v1)</li><li>Banff 2B: moderate-severe intimal arteritis (v2)</li><li>Banff 3: transmural arteritis/fibrinoid necrosis</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">ATG Use in Rejection</div><ul class=\"mb-0\"><li>Dose: 1.5 mg/kg/day IV for 5–7 days</li><li>Premedicate with steroids, antihistamines, antipyretics</li><li>Monitor CBC, LFTs daily</li><li>Prophylaxis for CMV, PCP, fungal infections</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Donor-Specific Antibody Testing</div><ul class=\"mb-0\"><li>Virtual crossmatch: compare recipient serum with donor HLA</li><li>Luminex assay: single-antigen beads with fluorescence</li><li>MFI cutoff varies (1000–2000 considered weak, >5000 strong)</li><li>C4d staining helps confirm AMR</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li>Ensure biopsy-proven diagnosis before escalating therapy</li><li>Double-check drug dosing and interactions</li><li>Document baseline infection screen before ATG</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li>Prompt reversal of rejection improves graft survival</li><li>Minimize infectious complications</li><li>Preserve long-term allograft function</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li>Daily monitoring of CBC and LFT during ATG</li><li>Strict infection prophylaxis</li><li>Avoid over-immunosuppression if alternative causes identified</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              ⚠️ ATG carries risks of cytokine release, cytopenias, and opportunistic infections—premedicate and monitor closely.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              Explain biopsy results, rejection grade, and need for potent immunosuppression to patient and family; emphasize infection precautions.\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'caseAccordion\'>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case1\'>Case 1: Early Creatinine Rise Post-KTX</button>\n    </h2>\n    <div id=\'case1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li>1 week post-KTX, creatinine 200.</li>\n          <li>Workup: drug levels, US Doppler, biopsy.</li>\n          <li>Biopsy: Banff 2B rejection.</li>\n          <li>Treatment: ATG with steroid pulses.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case2\'>Case 2: Doppler Suggests TRAS</button>\n    </h2>\n    <div id=\'case2\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li>Rising creatinine, bruit over graft.</li>\n          <li>Doppler: high velocity at anastomosis.</li>\n          <li>Plan: confirm with angiography, angioplasty/stenting.</li>\n          <li>Differentiate from rejection.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n  <div class=\'accordion-item\'>\n    <h2 class=\'accordion-header\'>\n      <button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#case3\'>Case 3: AMR with DSA+</button>\n    </h2>\n    <div id=\'case3\' class=\'accordion-collapse collapse\' data-bs-parent=\'#caseAccordion\'>\n      <div class=\'accordion-body\'>\n        <ul>\n          <li>Biopsy: microvascular inflammation, C4d+.</li>\n          <li>DSA detected with high MFI on Luminex.</li>\n          <li>Treatment: plasmapheresis + IVIG ± rituximab.</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n</div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">What is the differential diagnosis of rising creatinine 1 week post-transplant?</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Vascular causes (thrombosis, TRAS), obstruction, rejection (cellular/AMR), drug toxicity, infection, ATN.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">How do you investigate TRAS?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Start with Doppler US; confirm with CT angiography or MR angiography; gold standard is angiography with possible intervention.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">What is Banff 2B rejection?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Moderate-to-severe intimal arteritis (v2) with tubulitis and interstitial inflammation.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">What is first-line treatment for Banff 2B rejection?</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Antithymocyte globulin (rATG), often combined with steroid pulses.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">What is the ATG dose in acute rejection?</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>1.5 mg/kg/day IV for 5–7 days, maximum total 7.5–10.5 mg/kg, with monitoring of counts.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">What precautions are required with ATG?</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Premedication, daily CBC, infection prophylaxis (CMV, PCP), monitor for infusion reactions.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">How is DSA testing performed?</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Using Luminex single-antigen bead assay with fluorescence; reported as mean fluorescence intensity (MFI).</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">What is a virtual crossmatch?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Comparison of patient serum against donor HLA antigens using stored data, avoiding physical crossmatch.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">What are treatment options for antibody-mediated rejection?</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Plasmapheresis, IVIG, rituximab, bortezomib, complement blockade.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">How do you monitor response to rejection therapy?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Serial creatinine, repeat biopsy if needed, trend DSA, monitor for infection.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah10\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac10\" aria-expanded=\"false\" aria-controls=\"vivac10\">What are common pitfalls in early transplant dysfunction?</button></h2><div id=\"vivac10\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Missing vascular obstruction, not checking drug levels, over-treating without biopsy confirmation.</p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'audit\' data-unmapped-count=\'1\'></div><div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#unmapped1\'>Unmapped pearls</button></h2><div id=\'unmapped1\' class=\'accordion-collapse collapse\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li>Banff 2B carries high risk of graft loss if untreated; aggressive therapy is warranted.</li></ul></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li>Treating empirically without biopsy confirmation</li><li>Missing vascular complications (TRAS, thrombosis)</li><li>Not checking calcineurin inhibitor levels</li><li>Failure to provide infection prophylaxis during ATG</li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li>Importance of biopsy in transplant dysfunction</li><li>Banff classification for rejection</li><li>Mechanism of ATG and monitoring</li><li>Principles of DSA detection and interpretation</li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li>Confusing TRAS with rejection</li><li>Forgetting to check drug levels before biopsy</li><li>Administering ATG without prophylaxis</li><li>Assuming all rejection is AMR without DSA testing</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li>Stabilize and evaluate patient clinically.</li><li>Order labs and drug levels.</li><li>Perform renal Doppler US to exclude obstruction/TRAS.</li><li>Proceed with renal biopsy for Banff grading.</li><li>If Banff 2B: treat with rATG and steroids.</li><li>Provide infection prophylaxis and monitoring.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        \r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\">Creatinine rise post-KTX (1 week)\n   |\n   +--> US Doppler → Obstruction/TRAS? → Treat accordingly\n   |\n   +--> Drug levels → Toxicity? → Adjust dose\n   |\n   +--> Infection screen → Positive? → Treat\n   |\n   +--> Biopsy → Banff classification\n           |\n           +--> Banff 2B → rATG + steroids\n           +--> AMR → PLEX + IVIG ± rituximab</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li>Banff 2019 update on criteria for rejection</li><li>KDIGO transplant guidelines on acute rejection management</li></ul>\r\n      <ul class=\"mb-0\"><li>KDIGO: biopsy is mandatory before treating rejection</li><li>rATG recommended for Banff 2B or higher rejection</li><li>Luminex-based DSA testing is standard for AMR workup</li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li>KDIGO Kidney Transplant Guidelines (2020 update)</li><li>Banff Classification (2019 consensus report)</li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                     <button class=\"btn btn-outline-danger btn-sm delete-section-btn\" title=\"Delete this section\">\r\n                       <i class=\"bi bi-trash\"></i>\r\n                     </button>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   // Add delete functionality to the new section\r\n                   const deleteBtn = newSection.querySelector(\'.delete-section-btn\');\r\n                   if (deleteBtn) {\r\n                     deleteBtn.addEventListener(\'click\', (e) => {\r\n                       e.preventDefault();\r\n                       e.stopPropagation();\r\n                       const sectionTitle = newSection.querySelector(\'.section-title span:last-child\')?.textContent?.trim() || \'Study Note\';\r\n                       if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n                         newSection.remove();\r\n                         showDeleteMessage(`Study Note deleted successfully`);\r\n                       }\r\n                     });\r\n                   }\r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          transition: opacity 0.3s ease;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      // Initialize delete buttons for sections\r\n      initializeDeleteButtons();\r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, delete, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // ================== SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n    // Initialize delete functionality for all sections\r\n    function initializeDeleteButtons() {\r\n      console.log(\'Initializing delete buttons for sections...\');\r\n      \r\n      // Add delete buttons to all sections\r\n      const sections = document.querySelectorAll(\'section.nm-card, section.additional-note\');\r\n      sections.forEach((section, index) => {\r\n        addDeleteButtonToSection(section, index);\r\n      });\r\n      \r\n      console.log(\'Delete buttons initialized for\', sections.length, \'sections\');\r\n    }\r\n    \r\n    // Add delete button to a section\r\n    function addDeleteButtonToSection(section, index) {\r\n      // Check if delete button already exists\r\n      if (section.querySelector(\'.delete-section-btn\')) {\r\n        return;\r\n      }\r\n      \r\n      // Create delete button\r\n      const deleteBtn = document.createElement(\'button\');\r\n      deleteBtn.className = \'btn btn-outline-danger btn-sm delete-section-btn\';\r\n      deleteBtn.innerHTML = \'<i class=\"bi bi-trash\"></i>\';\r\n      deleteBtn.title = \'Delete this section\';\r\n      deleteBtn.style.position = \'absolute\';\r\n      deleteBtn.style.top = \'10px\';\r\n      deleteBtn.style.right = \'10px\';\r\n      deleteBtn.style.zIndex = \'10\';\r\n      \r\n      // Add click handler\r\n      deleteBtn.addEventListener(\'click\', (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        deleteSection(section, index);\r\n      });\r\n      \r\n      // Make section position relative for absolute positioning of delete button\r\n      section.style.position = \'relative\';\r\n      \r\n      // Add delete button to section\r\n      section.appendChild(deleteBtn);\r\n    }\r\n    \r\n    // Delete a section\r\n    function deleteSection(section, index) {\r\n      const sectionTitle = section.querySelector(\'.section-title\')?.textContent?.trim() || \'Section\';\r\n      \r\n      // Show confirmation dialog\r\n      if (confirm(`Are you sure you want to delete \"${sectionTitle}\"?`)) {\r\n        console.log(\'Deleting section:\', sectionTitle);\r\n        \r\n        // Remove the section\r\n        section.remove();\r\n        \r\n        // Show success message\r\n        showDeleteMessage(`Section \"${sectionTitle}\" deleted successfully`);\r\n        \r\n        // Reinitialize delete buttons for remaining sections\r\n        setTimeout(() => {\r\n          initializeDeleteButtons();\r\n        }, 100);\r\n      }\r\n    }\r\n    \r\n    // Show delete confirmation message\r\n    function showDeleteMessage(message) {\r\n      // Create temporary message element\r\n      const messageEl = document.createElement(\'div\');\r\n      messageEl.className = \'alert alert-success alert-dismissible fade show\';\r\n      messageEl.style.position = \'fixed\';\r\n      messageEl.style.top = \'20px\';\r\n      messageEl.style.right = \'20px\';\r\n      messageEl.style.zIndex = \'9999\';\r\n      messageEl.innerHTML = `\r\n        ${message}\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\r\n      `;\r\n      \r\n      // Add to page\r\n      document.body.appendChild(messageEl);\r\n      \r\n      // Auto-remove after 3 seconds\r\n      setTimeout(() => {\r\n        if (messageEl.parentNode) {\r\n          messageEl.remove();\r\n        }\r\n      }, 3000);\r\n    }\r\n    \r\n    // ================== END SECTION DELETE FUNCTIONALITY ==================\r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for delete buttons\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-19 21:15:43', '2025-09-19 01:03:47', '2025-09-19 01:03:47', '2025-09-19 21:15:43');
INSERT INTO `topics` (`id`, `template_id`, `category_id`, `created_by`, `updated_by`, `slug`, `title`, `subtitle`, `status`, `summary`, `data`, `meta`, `rendered_html`, `rendered_at`, `published_at`, `created_at`, `updated_at`) VALUES
(24, NULL, 5, 1, 1, 'hypokalemia', 'Hypokalemia', NULL, 'published', 'Hypokalemia, defined as a serum potassium concentration <3.5 mmol/L, is a common electrolyte disturbance with potentially life-threatening consequences, primarily cardiac arrhythmias. Severity is classified as mild (3.0-3.5 mmol/L), moderate (2.5-2.9 mmol/L), or severe (<2.5 mmol/L). The diagnostic approach hinges on a systematic evaluation of the patient\'s blood pressure, acid-base status, and urinary potassium excretion, which effectively narrows the differential diagnosis between transcellular shifts, gastrointestinal losses, and renal wasting.', '{\"slug\":\"hypokalemia\",\"TOPIC\":\"Hypokalemia\",\"CHIP_1\":\"Emergency Management\",\"CHIP_2\":\"Diagnostic Workup\",\"CHIP_3\":\"Acid-Base & Blood Pressure\",\"OPENING_PARAGRAPH_HTML_SAFE\":\"Hypokalemia, defined as a serum potassium concentration <3.5 mmol\\/L, is a common electrolyte disturbance with potentially life-threatening consequences, primarily cardiac arrhythmias. Severity is classified as mild (3.0-3.5 mmol\\/L), moderate (2.5-2.9 mmol\\/L), or severe (<2.5 mmol\\/L). The diagnostic approach hinges on a systematic evaluation of the patient\'s blood pressure, acid-base status, and urinary potassium excretion, which effectively narrows the differential diagnosis between transcellular shifts, gastrointestinal losses, and renal wasting.\",\"IMMEDIATE_PRIORITIES_LI\":[\"Assess airway, breathing, and circulation (ABCDE approach), especially in cases of cardiac arrest or severe weakness.\",\"\\u2705 Secure cardiac monitoring immediately for any patient with K+ <3.0 mmol\\/L or with symptoms.\",\"\\u2705 Obtain a 12-lead ECG to assess for characteristic changes (T-wave flattening, U-waves, ST depression, arrhythmias).\",\"\\u2705 Establish large-bore intravenous access (minimum of two sites if K+ is <2.0 mmol\\/L or patient is unstable).\",\"\\ud83e\\uddea Obtain urgent venous or arterial blood gas to determine serum potassium, pH, bicarbonate, and lactate.\",\"\\ud83d\\udc8a Begin immediate potassium repletion. For severe hypokalemia (e.g., K+ 1.7 mmol\\/L), administer IV potassium chloride cautiously. Do not exceed 20 mmol\\/hour in a peripheral line (max concentration 40 mmol\\/L) or 40 mmol\\/hour in a central line.\",\"\\ud83e\\uddea Check serum magnesium urgently and replete as necessary, as hypomagnesemia prevents effective potassium correction.\",\"\\ud83d\\udd0e Obtain a focused history for potential causes: diuretics, vomiting, diarrhea, family history of periodic paralysis.\",\"\\ud83d\\udd0e Conduct a focused physical examination, assessing volume status, blood pressure (including orthostatics), and neurological status (power, reflexes).\",\"\\ud83e\\uddea Send urgent laboratory tests: full electrolytes (including calcium and phosphate), creatinine, and glucose.\",\"\\ud83d\\udc8a Consider causes of transcellular shift like thyrotoxic periodic paralysis in young adults; check thyroid function tests.\",\"\\ud83d\\udd0e Obtain a spot urine sample to measure urine potassium, creatinine, and electrolytes to calculate the Transtubular Potassium Gradient (TTKG) or fractional excretion of potassium.\",\"Consult Nephrology for severe or refractory cases.\",\"Determine the underlying cause to guide definitive management and prevent recurrence.\"],\"ANSWER_STEPS_OL\":[\"This is a case of severe, symptomatic hypokalemia, presenting as cardiac arrest with a potassium of 1.7 mmol\\/L in a young adult.\",\"My immediate priority is resuscitation following the ABCDE algorithm. I will ensure continuous cardiac monitoring and secure IV access.\",\"I will immediately obtain a 12-lead ECG to look for signs of hypokalemia such as T-wave flattening, prominent U waves, and ST depression, and to rule out any life-threatening arrhythmias.\",\"Simultaneously, I will obtain an urgent venous blood gas to confirm the potassium level and assess the acid-base status, which is critical for the differential diagnosis.\",\"I will commence IV potassium repletion with potassium chloride. Given the severity, I would use a central line if available, infusing at a rate no greater than 40 mmol\\/hour, with a maximum concentration of 60 mmol\\/L. I will also check and correct the serum magnesium level concurrently, as hypomagnesemia makes hypokalemia refractory to treatment.\",\"Once the patient is stabilized, I will proceed with a diagnostic workup. I will take a detailed history focusing on medications like diuretics, GI losses such as vomiting or diarrhea, and any family history of similar episodes.\",\"My physical examination will focus on assessing the patient\'s volume and blood pressure status, which categorizes the causes into hypertensive and normotensive groups.\",\"The acid-base status is the next key differentiator. I will classify the cause based on whether there is a metabolic acidosis or alkalosis.\",\"For a normotensive patient with metabolic alkalosis, the differential includes diuretic abuse, vomiting, Bartter, or Gitelman syndrome. I will assess urinary chloride; a low value (<20 mmol\\/L) suggests extra-renal losses like vomiting, while a high value suggests a renal cause.\",\"To differentiate between Bartter and Gitelman syndromes, I will check urinary calcium. High urinary calcium is typical of Bartter syndrome, while Gitelman syndrome is characterized by hypocalciuria.\",\"If the patient presents with hypertension and metabolic alkalosis, I will investigate for mineralocorticoid excess states like primary aldosteronism or Liddle\'s syndrome by measuring plasma renin and aldosterone levels.\",\"If metabolic acidosis is present, the differential includes diarrhea or renal tubular acidosis (RTA). A urine anion gap will help differentiate: a negative gap suggests diarrhea, while a positive gap points towards RTA.\"],\"DDX_BUCKET_1_TITLE\":\"Hypokalemia with Hypertension\",\"DDX_BUCKET_1_ITEMS_LI\":[\"<b>Primary Aldosteronism (Conn\'s Syndrome):<\\/b> Characterized by low renin and high aldosterone.\",\"<b>Liddle\'s Syndrome:<\\/b> A genetic disorder mimicking hyperaldosteronism with low renin and low aldosterone.\",\"<b>Renovascular Hypertension:<\\/b> High renin and high aldosterone due to renal artery stenosis.\",\"<b>Cushing\'s Syndrome:<\\/b> Excess cortisol with mineralocorticoid activity.\",\"<b>Apparent Mineralocorticoid Excess (AME):<\\/b> Deficiency of 11-beta-hydroxysteroid dehydrogenase type 2, leading to cortisol activating mineralocorticoid receptors.\",\"<b>Glucocorticoid-Remediable Aldosteronism (GRA):<\\/b> A familial form of hyperaldosteronism.\"],\"DDX_BUCKET_2_TITLE\":\"Hypokalemia with Normal\\/Low Blood Pressure & Alkalosis\",\"DDX_BUCKET_2_ITEMS_LI\":[\"<b>Vomiting\\/Nasogastric Suction:<\\/b> Extra-renal loss of HCl, leading to volume depletion and metabolic alkalosis. Urine chloride is typically low (<20 mmol\\/L).\",\"<b>Diuretic Abuse (Thiazide or Loop):<\\/b> Renal potassium and chloride wasting. Urine chloride is high (>40 mmol\\/L).\",\"<b>Bartter Syndrome:<\\/b> Inherited salt-losing tubulopathy affecting the thick ascending limb of the loop of Henle. Presents in childhood with polyuria, normotension, hypokalemic metabolic alkalosis, and hypercalciuria.\",\"<b>Gitelman Syndrome:<\\/b> Inherited tubulopathy affecting the distal convoluted tubule. Presents in adolescence\\/adulthood with fatigue, cramps, hypokalemic metabolic alkalosis, hypomagnesemia, and hypocalciuria.\"],\"DDX_BUCKET_3_TITLE\":\"Hypokalemia with Normal\\/Low Blood Pressure & Acidosis\",\"DDX_BUCKET_3_ITEMS_LI\":[\"<b>Diarrhea:<\\/b> Bicarbonate loss from the GI tract. Associated with a negative urine anion gap.\",\"<b>Distal (Type 1) Renal Tubular Acidosis:<\\/b> Impaired distal acidification. Characterized by inability to lower urine pH <5.5 and a positive urine anion gap.\",\"<b>Proximal (Type 2) Renal Tubular Acidosis:<\\/b> Impaired proximal bicarbonate reabsorption. Urine pH can be acidic (<5.5) once serum bicarbonate is low. Associated with Fanconi syndrome features (glycosuria, phosphaturia, aminoaciduria).\",\"<b>Toluene Inhalation (Glue Sniffing):<\\/b> Causes a distal RTA picture.\"],\"DIFFERENTIAL_FOCUS_HTML\":\"<div class=\'accordion\' id=\'ddx_focus_accordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ddx_focus_heading_1\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ddx_focus_collapse_1\' aria-expanded=\'true\' aria-controls=\'ddx_focus_collapse_1\'>Bartter Syndrome vs. Gitelman Syndrome<\\/button><\\/h2><div id=\'ddx_focus_collapse_1\' class=\'accordion-collapse collapse show\' aria-labelledby=\'ddx_focus_heading_1\' data-bs-parent=\'#ddx_focus_accordion\'><div class=\'accordion-body\'><table><thead><tr><th>Feature<\\/th><th>Bartter Syndrome<\\/th><th>Gitelman Syndrome<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Genetic Defect Location<\\/b><\\/td><td>Thick ascending limb of Loop of Henle (affecting Na-K-2Cl cotransporter, ROMK, or ClC-Kb channels)<\\/td><td>Distal convoluted tubule (affecting Na-Cl cotransporter)<\\/td><\\/tr><tr><td><b>Clinical Presentation<\\/b><\\/td><td>Usually presents in infancy or early childhood with failure to thrive, polyuria, and significant volume depletion.<\\/td><td>Typically presents in late childhood, adolescence, or adulthood with muscle weakness, cramps, fatigue, and salt craving.<\\/td><\\/tr><tr><td><b>Blood Pressure<\\/b><\\/td><td>Normal to low<\\/td><td>Normal to low<\\/td><\\/tr><tr><td><b>Serum Magnesium<\\/b><\\/td><td>May be low, but less consistently or severely than in Gitelman.<\\/td><td><b>Hypomagnesemia<\\/b> is a classic and consistent feature.<\\/td><\\/tr><tr><td><b>Urine Calcium<\\/b><\\/td><td><b>Hypercalciuria<\\/b> (or normocalciuria). Often associated with nephrocalcinosis.<\\/td><td><b>Hypocalciuria<\\/b> is a key distinguishing feature.<\\/td><\\/tr><tr><td><b>Prostaglandin E2<\\/b><\\/td><td>Urinary levels are typically very high.<\\/td><td>Urinary levels are normal or only slightly elevated.<\\/td><\\/tr><tr><td><b>Response to NSAIDs<\\/b><\\/td><td>Often improves with NSAIDs (e.g., indomethacin) due to prostaglandin inhibition.<\\/td><td>No significant response to NSAIDs.<\\/td><\\/tr><\\/tbody><\\/table><\\/div><\\/div><\\/div><\\/div>\",\"INVESTIGATIONS_LI\":[\"<b>Bedside:<\\/b> 12-lead ECG, Venous\\/Arterial Blood Gas (VBG\\/ABG).\",\"<b>Bloods:<\\/b> Urea & Electrolytes (including Mg, Ca, PO4), Glucose, Creatinine, Full Blood Count.\",\"<b>Urine:<\\/b> Spot urine for Na, K, Cl, Cr, Osmolality. Calculate Transtubular Potassium Gradient (TTKG) and Urine Anion Gap.\",\"<b>TTKG Formula:<\\/b> (Urine K \\/ Plasma K) \\/ (Urine Osm \\/ Plasma Osm). A TTKG > 7 suggests renal potassium wasting.\",\"<b>Urine Anion Gap Formula:<\\/b> (Urine Na + Urine K) - Urine Cl. A negative value suggests GI bicarbonate loss (diarrhea); a positive value suggests renal tubular acidosis.\",\"<b>Specialist Tests:<\\/b> Plasma Renin and Aldosterone, 24-hour urine cortisol or low-dose dexamethasone suppression test (for Cushing\'s), Thyroid Function Tests (for thyrotoxic periodic paralysis), urine diuretic screen.\"],\"PILLAR_1\":\"Emergency Repletion & Stabilization\",\"STEP_1_TITLE\":\"Assess Severity & Cardiac Risk\",\"STEP_1_LI\":[\"Triage immediately based on K+ level and clinical stability (arrhythmias, paralysis).\",\"A K+ < 2.5 mmol\\/L is a medical emergency requiring hospitalization and cardiac monitoring.\",\"Perform a 12-lead ECG on all symptomatic patients or those with K+ < 3.0 mmol\\/L.\"],\"STEP_2_TITLE\":\"Potassium & Magnesium Repletion\",\"STEP_2_LI\":[\"\\u26a0\\ufe0f <b>Oral Repletion:<\\/b> Preferred route for mild to moderate, asymptomatic hypokalemia (K+ 2.5-3.5 mmol\\/L). Use potassium chloride tablets or solution.\",\"\\u26a1 <b>Intravenous Repletion:<\\/b> Indicated for severe hypokalemia (<2.5 mmol\\/L), symptomatic patients, or those unable to take oral replacement.\",\"<b>Peripheral IV Line:<\\/b> Maximum concentration of 40 mmol\\/L. Maximum rate of 10-20 mmol\\/hour to avoid phlebitis.\",\"<b>Central IV Line:<\\/b> Required for faster repletion. Maximum concentration up to 60 mmol\\/L. Maximum rate of 20-40 mmol\\/hour with continuous cardiac monitoring.\",\"<b>Magnesium First:<\\/b> Always check and replete magnesium. Hypomagnesemia causes renal potassium wasting and makes hypokalemia refractory. Administer IV magnesium sulfate (e.g., 8-16 mmol over 1-2 hours) if levels are low.\",\"<b>Monitoring:<\\/b> Re-check serum K+ every 2-4 hours during IV repletion until K+ is > 3.0 mmol\\/L and stable.\"],\"PILLAR_2\":\"Diagnostic Evaluation & Definitive Treatment\",\"STEP_3_TITLE\":\"Differentiate Cause using BP and Acid-Base\",\"STEP_3_LI\":[\"<b>Step 1 - Blood Pressure:<\\/b> Is the patient hypertensive or normotensive?\",\"<b>Step 2 - Acid-Base Status:<\\/b> Is there a metabolic acidosis or alkalosis?\",\"<b>Step 3 - Urine Studies:<\\/b> Measure urine K+, Cl-, and calculate TTKG and urine anion gap to confirm renal vs extra-renal losses.\"],\"STEP_4_TITLE\":\"Treat Underlying Disorder\",\"STEP_4_LI\":[\"<b>GI Losses:<\\/b> Treat underlying cause of vomiting\\/diarrhea. Replete volume and electrolytes.\",\"<b>Diuretic-induced:<\\/b> Stop offending diuretic. Switch to a potassium-sparing diuretic if diuretic therapy is still needed.\",\"<b>Mineralocorticoid Excess:<\\/b> For primary aldosteronism, use mineralocorticoid receptor antagonists (Spironolactone, Eplerenone) or adrenalectomy for adenoma.\",\"<b>Liddle\'s Syndrome:<\\/b> Treat with Amiloride or Triamterene, which directly block the ENaC channel. Spironolactone is ineffective.\",\"<b>Bartter\\/Gitelman:<\\/b> Lifelong potassium and magnesium supplementation. NSAIDs (Indomethacin) may be effective in Bartter syndrome.\",\"<b>Renal Tubular Acidosis:<\\/b> Alkali therapy (potassium citrate or sodium bicarbonate) to correct acidosis, which will also help correct hypokalemia.\"],\"PHARMACOLOGY_TABLE_HTML\":\"<table class=\'table\'><thead><tr><th>Drug<\\/th><th>Mechanism of Action<\\/th><th>Dose<\\/th><th>Key Monitoring\\/Side Effects<\\/th><\\/tr><\\/thead><tbody><tr><td><b>Potassium Chloride (IV\\/PO)<\\/b><\\/td><td>Direct replacement of potassium and chloride<\\/td><td>PO: 20-40 mmol 2-4 times\\/day. IV: See repletion guidelines.<\\/td><td>Hyperkalemia, GI upset (PO), phlebitis (IV). Monitor serum K+ closely.<\\/td><\\/tr><tr><td><b>Potassium Citrate<\\/b><\\/td><td>Provides potassium and bicarbonate precursor (citrate)<\\/td><td>10-20 mEq 2-3 times\\/day<\\/td><td>Used for hypokalemia with metabolic acidosis (e.g., RTA). Less GI irritation than KCl.<\\/td><\\/tr><tr><td><b>Amiloride<\\/b><\\/td><td>Potassium-sparing diuretic; blocks ENaC in collecting duct<\\/td><td>5-10 mg daily<\\/td><td>Treatment for Liddle\'s Syndrome. Monitor for hyperkalemia, especially in CKD.<\\/td><\\/tr><tr><td><b>Spironolactone\\/ Eplerenone<\\/b><\\/td><td>Mineralocorticoid receptor antagonist<\\/td><td>Spironolactone: 25-100 mg daily. Eplerenone: 25-50 mg daily.<\\/td><td>Treatment for primary aldosteronism. Monitor for hyperkalemia. Spironolactone can cause gynecomastia.<\\/td><\\/tr><tr><td><b>Indomethacin<\\/b><\\/td><td>NSAID, reduces prostaglandin E2 production<\\/td><td>25-50 mg TID<\\/td><td>Used in Bartter syndrome to reduce polyuria and K+ wasting. Risk of NSAID-related nephrotoxicity.<\\/td><\\/tr><\\/tbody><\\/table>\",\"TOPIC_BLOCK_A_TITLE\":\"ECG Manifestations of Hypokalemia\",\"TOPIC_BLOCK_A_ITEMS_LI\":[\"<b>T-wave flattening or inversion:<\\/b> One of the earliest signs.\",\"<b>Prominent U-wave:<\\/b> A positive deflection after the T-wave, best seen in precordial leads V2-V4. A U-wave taller than the T-wave is highly suggestive.\",\"<b>ST-segment depression:<\\/b> Widespread ST depression may be seen.\",\"<b>Prolonged QT interval:<\\/b> The apparent QT prolongation is often due to fusion of the T-wave and U-wave (long QU interval). This increases the risk of Torsades de Pointes.\",\"<b>Arrhythmias:<\\/b> Increased risk of both atrial (AF, atrial flutter) and ventricular (VT, VF) arrhythmias, particularly in patients with underlying heart disease or on digoxin.\"],\"TOPIC_BLOCK_B_TITLE\":\"Pathophysiology and Treatment of Liddle\'s Syndrome\",\"TOPIC_BLOCK_B_ITEMS_LI\":[\"<b>Pathophysiology:<\\/b> Liddle\'s syndrome is a rare, autosomal dominant genetic disorder caused by a gain-of-function mutation in the genes encoding the subunits of the epithelial sodium channel (ENaC) in the distal nephron.\",\"This mutation leads to excessive sodium reabsorption and potassium secretion, independent of aldosterone.\",\"Clinically, it mimics primary hyperaldosteronism, presenting with early-onset hypertension, hypokalemic metabolic alkalosis, but with characteristically <b>low plasma renin and aldosterone<\\/b> levels.\",\"<b>Treatment:<\\/b> The cornerstone of treatment is blockade of the overactive ENaC. <b>Amiloride<\\/b> (5-20 mg\\/day) or <b>Triamterene<\\/b> (100-200 mg\\/day) are the drugs of choice.\",\"Mineralocorticoid receptor antagonists like <b>Spironolactone are ineffective<\\/b> as the channel\'s activity is aldosterone-independent.\",\"A low sodium diet is also a crucial part of management.\"],\"TOPIC_BLOCK_C_TITLE\":\"Differentiating Renal Tubular Acidosis (RTA)\",\"TOPIC_BLOCK_C_ITEMS_LI\":[\"<b>Distal (Type 1) RTA:<\\/b> Defect in H+ secretion in the collecting duct. Leads to hypokalemia, metabolic acidosis, and an inability to acidify urine (urine pH always > 5.5). Associated with a positive urine anion gap and high risk for calcium phosphate kidney stones.\",\"<b>Proximal (Type 2) RTA:<\\/b> Defect in HCO3- reabsorption in the proximal tubule. Leads to hypokalemia and metabolic acidosis. Initially, urine is alkaline, but once serum HCO3- drops below the reabsorptive threshold (~15-18 mmol\\/L), the distal nephron can acidify the urine (urine pH can be < 5.5). Often associated with other features of Fanconi syndrome.\",\"<b>Type 4 RTA:<\\/b> Caused by aldosterone deficiency or resistance. This is the only RTA that causes <b>hyperkalemia<\\/b>, not hypokalemia. It is associated with a mild, non-anion gap metabolic acidosis and an impaired renal response to acid load, but urine pH can still be acidic (<5.5).\"],\"QUICK_REF_CARD_HTML\":\"<div><h4>Potassium Repletion Guide<\\/h4><p><b>Severity:<\\/b> Mild (3.0-3.4), Moderate (2.5-2.9), Severe (<2.5)<\\/p><ul><li><b>Oral:<\\/b> Preferred for K+ > 2.5 and asymptomatic. 40-100 mmol\\/day in divided doses.<\\/li><li><b>IV (Peripheral):<\\/b> Max Rate <b>10-20 mmol\\/hr<\\/b>. Max Concentration <b>40 mmol\\/L<\\/b>.<\\/li><li><b>IV (Central):<\\/b> Max Rate <b>20-40 mmol\\/hr<\\/b>. Max Concentration <b>60 mmol\\/L<\\/b>. Requires cardiac monitoring.<\\/li><li><b>Rule of Thumb:<\\/b> For every 10 mmol of KCl given, expect serum K+ to rise by ~0.1 mmol\\/L (this is highly variable).<\\/li><li>\\ud83d\\udea8 <b>Always correct Hypomagnesemia first!<\\/b><\\/li><\\/ul><\\/div>\",\"EMERGENCY_ALGORITHM_HTML\":\"<div class=\'emergency-box\'><h3 class=\'emergency-title\'>Management of Severe Hypokalemia (K+ &lt;2.5 mmol\\/L)<\\/h3><pre class=\'ascii-art-box\'>Patient with severe weakness, ECG changes, or arrhythmia?\\n | \\n +--[ YES ]--> ABCDE, Call for help (Cardiology\\/ICU)\\n | \\n +--[ NO ]--> Hospitalize, Continuous Cardiac Monitoring\\n \\nIV Access (Central line preferred)\\n |\\nCheck Mg++, Ca++, PO4--. Replete Mg++ FIRST (e.g., 2g MgSO4 over 1 hr)\\n |\\nStart IV KCl infusion: 20-40 mmol\\/hr via central line\\n |\\nRecheck K+ and blood gas every 2 hours\\n |\\nOnce K+ > 3.0 mmol\\/L and stable:\\n | \\n +--> Switch to oral KCl supplementation\\n +--> Investigate underlying cause<\\/pre><\\/div>\",\"ASCII_FLOWCHART_PRE\":\" START: Serum K+ < 3.5 mmol\\/L\\n    |\\n    +--> Assess Blood Pressure\\n           |\\n           +--[ HYPERTENSION ]------------------------------------------------+\\n           |    |\\n           |    +--> Check Plasma Renin & Aldosterone                       |\\n           |         |\\n           |         +--[ Low Renin, High Aldo ]--> Primary Aldosteronism   |\\n           |         |\\n           |         +--[ Low Renin, Low Aldo ]--> Liddle\'s or AME         |\\n           |         |\\n           |         +--[ High Renin, High Aldo ]--> Renovascular HTN       |\\n           |\\n           +--[ NORMAL\\/LOW BP ]---------------------------------------------+\\n                |\\n                +--> Assess Acid-Base Status\\n                       |\\n                       +--[ METABOLIC ACIDOSIS ]--> Check Urine Anion Gap\\n                       |    |\\n                       |    +--[ Negative UAG ]--> Diarrhea\\n                       |    |\\n                       |    +--[ Positive UAG ]--> Renal Tubular Acidosis (Type 1 or 2)\\n                       |\\n                       +--[ METABOLIC ALKALOSIS ]--> Check Urine Chloride\\n                            |\\n                            +--[ Urine Cl- < 20 ]--> Vomiting \\/ GI Loss\\n                            |\\n                            +--[ Urine Cl- > 40 ]--> Diuretic Abuse \\/ Bartter \\/ Gitelman\\n                                 |\\n                                 +--> Check Urine Calcium\\n                                      |\\n                                      +--[ High Ca++ ]--> Bartter Syndrome\\n                                      |\\n                                      +--[ Low Ca++ ]--> Gitelman Syndrome\\n\",\"CONCEPT_DIAGRAM_HTML\":\"<div style=\'font-family: sans-serif; text-align: center;\'><h4>Tubular Defects in Hypokalemic Syndromes<\\/h4><div style=\'display: flex; justify-content: space-around; align-items: flex-start; margin-top: 20px;\'><div style=\'border: 2px solid #cce5ff; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #004085;\'>Bartter Syndrome<\\/h5><p><b>Location:<\\/b> Thick Ascending Limb<\\/p><p><b>Defect:<\\/b> Na-K-2Cl (NKCC2) or associated channels (ROMK, ClC-Kb)<\\/p><p><b>Result:<\\/b> Salt wasting, mimicking a loop diuretic. Leads to <b>hypercalciuria<\\/b>.<\\/p><\\/div><div style=\'border: 2px solid #d4edda; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #155724;\'>Gitelman Syndrome<\\/h5><p><b>Location:<\\/b> Distal Convoluted Tubule<\\/p><p><b>Defect:<\\/b> Na-Cl Cotransporter (NCC)<\\/p><p><b>Result:<\\/b> Salt wasting, mimicking a thiazide diuretic. Leads to <b>hypocalciuria<\\/b> and <b>hypomagnesemia<\\/b>.<\\/p><\\/div><div style=\'border: 2px solid #f8d7da; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #721c24;\'>Liddle\'s Syndrome<\\/h5><p><b>Location:<\\/b> Collecting Duct<\\/p><p><b>Defect:<\\/b> Epithelial Na+ Channel (ENaC) - Gain of function<\\/p><p><b>Result:<\\/b> Excessive Na+ reabsorption, mimicking hyperaldosteronism. Leads to <b>hypertension<\\/b>.<\\/p><\\/div><\\/div><\\/div>\",\"QUALITY_PROCESS_LI\":[\"\\u2705 Regular monitoring of serum potassium and magnesium during acute repletion.\",\"\\u2705 Ensuring a 12-lead ECG is performed for all patients with K+ < 3.0 mmol\\/L.\",\"\\u2705 Documentation of a clear diagnostic plan based on BP and acid-base status.\",\"\\u2705 Appropriate use of urine electrolytes to guide differential diagnosis before extensive endocrine testing.\"],\"QUALITY_OUTCOME_LI\":[\"\\ud83c\\udfaf Safe correction of serum potassium to >3.0 mmol\\/L within 6-12 hours for severe cases.\",\"\\ud83c\\udfaf Prevention of iatrogenic hyperkalemia during repletion.\",\"\\ud83c\\udfaf Identification and treatment of the underlying cause to prevent recurrence.\",\"\\ud83c\\udfaf Resolution of ECG abnormalities and symptoms.\"],\"QUALITY_SAFETY_LI\":[\"\\u26a0\\ufe0f Adherence to maximum infusion rates and concentrations for IV potassium.\",\"\\u26a0\\ufe0f Use of a central line for rapid potassium correction to avoid peripheral vein sclerosis.\",\"\\u26a0\\ufe0f Continuous cardiac monitoring during high-rate IV potassium infusion.\",\"\\u26a0\\ufe0f Recognition that failure to correct hypokalemia should prompt immediate measurement of serum magnesium.\"],\"PITFALLS_LI\":[\"\\u274c Forgetting to check and replete magnesium, leading to refractory hypokalemia.\",\"\\u274c Administering potassium in dextrose-containing fluids, which can stimulate insulin release and transiently worsen hypokalemia.\",\"\\u274c Overly rapid IV correction leading to hyperkalemia and cardiac arrest.\",\"\\u274c Failing to investigate the underlying cause, leading to recurrent episodes.\",\"\\u274c Misinterpreting the TTKG in patients with low urine osmolality (<300 mOsm\\/kg) or low distal sodium delivery.\"],\"SAFETY_LI\":[\"\\ud83d\\udea8 <b>Never<\\/b> administer undiluted IV potassium as a bolus.\",\"\\ud83d\\udea8 Ensure IV potassium infusions are clearly labeled and run through an infusion pump.\",\"\\ud83d\\udea8 Be cautious with potassium repletion in patients with any degree of renal impairment.\",\"\\ud83d\\udea8 Recognize that a patient with diabetic ketoacidosis and a \'normal\' potassium level has a significant total body potassium deficit and will require aggressive repletion as insulin therapy is initiated.\"],\"COMMUNICATION_LI\":[\"\\ud83d\\udde3\\ufe0f Explain the importance of cardiac monitoring and frequent blood tests to the patient.\",\"\\ud83d\\udde3\\ufe0f Clearly communicate the plan for potassium repletion, including rates and routes, with the nursing staff.\",\"\\ud83d\\udde3\\ufe0f Counsel patients on dietary sources of potassium and symptoms of hypokalemia upon discharge.\",\"\\ud83d\\udde3\\ufe0f If a genetic cause is identified (e.g., Liddle\'s, Bartter\'s, Gitelman\'s), arrange for genetic counseling for the patient and their family.\"],\"CASE_SCENARIOS_HTML\":\"<div class=\'accordion\' id=\'case_scenarios_accordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case1\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case1\' aria-expanded=\'false\' aria-controls=\'collapse_case1\'>Case 1: 17 y\\/o Male with Weakness<\\/button><\\/h2><div id=\'collapse_case1\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case1\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 17-year-old male presents with profound muscle weakness. BP is 110\\/70 mmHg. VBG shows pH 7.50, HCO3 32, K+ 2.4 mmol\\/L. Urine studies: UCl > 40 mmol\\/L, UCa < 2.0 mmol\\/24h. Serum Mg is 0.5 mmol\\/L. <b>Diagnosis: Gitelman Syndrome.<\\/b> The combination of normotension, metabolic alkalosis, hypomagnesemia, and hypocalciuria is classic.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case2\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case2\' aria-expanded=\'false\' aria-controls=\'collapse_case2\'>Case 2: 45 y\\/o Female with Hypertension<\\/button><\\/h2><div id=\'collapse_case2\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case2\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 45-year-old female is found to have a BP of 165\\/100 mmHg and a serum K+ of 2.9 mmol\\/L on routine bloods. She is asymptomatic. VBG shows pH 7.48, HCO3 30. Renin is suppressed, and aldosterone is elevated. <b>Diagnosis: Primary Aldosteronism (Conn\'s Syndrome).<\\/b> The triad of hypertension, hypokalemia, and metabolic alkalosis with a low renin\\/high aldosterone profile confirms the diagnosis. An adrenal CT scan is the next step.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case3\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case3\' aria-expanded=\'false\' aria-controls=\'collapse_case3\'>Case 3: 15 y\\/o Male with Resistant Hypertension<\\/button><\\/h2><div id=\'collapse_case3\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case3\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 15-year-old male presents with hypertension (170\\/105 mmHg) that is resistant to multiple agents. His serum K+ is 3.1 mmol\\/L. Plasma renin and aldosterone levels are both suppressed. A trial of spironolactone has no effect, but amiloride normalizes his BP and potassium. <b>Diagnosis: Liddle\'s Syndrome.<\\/b> The low renin, low aldosterone state in the face of hypertension and hypokalemia is the key clue. The response to amiloride (an ENaC blocker) but not spironolactone (an MR antagonist) is diagnostic.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case4\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case4\' aria-expanded=\'false\' aria-controls=\'collapse_case4\'>Case 4: 18 y\\/o with Cardiac Arrest<\\/button><\\/h2><div id=\'collapse_case4\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case4\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>An 18-year-old male collapses at home. Paramedics find him in ventricular fibrillation. After resuscitation, his initial blood gas shows a potassium of 1.7 mmol\\/L. ECG shows widespread ST depression and prominent U-waves. His thyroid function tests are normal. His parents report similar, milder episodes of weakness after large carbohydrate meals. <b>Diagnosis: Likely Familial Hypokalemic Periodic Paralysis.<\\/b> This is a diagnosis of exclusion after ruling out other causes like thyrotoxicosis. The history of episodic weakness triggered by specific events is suggestive of this channelopathy.<\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case5\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case5\' aria-expanded=\'false\' aria-controls=\'collapse_case5\'>Case 5: 30 y\\/o Female with Weakness and Acidosis<\\/button><\\/h2><div id=\'collapse_case5\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case5\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 30-year-old female presents with generalized weakness. BP is 105\\/65 mmHg. VBG shows pH 7.25, HCO3 14, K+ 2.8 mmol\\/L. Urine pH is 6.5. Urine anion gap is +25. An abdominal X-ray reveals bilateral nephrocalcinosis. <b>Diagnosis: Distal (Type 1) Renal Tubular Acidosis.<\\/b> The combination of hypokalemia, non-anion gap metabolic acidosis, an inappropriately high urine pH (>5.5), and a positive urine anion gap confirms distal RTA. Nephrocalcinosis is a common complication.<\\/div><\\/div><\\/div><\\/div>\",\"VIVA_ITEMS\":[{\"q\":\"What is the maximum safe rate of intravenous potassium infusion through a peripheral line?\",\"a\":\"The maximum recommended rate is generally 10-20 mmol per hour, with a maximum concentration of 40 mmol\\/L to prevent phlebitis and pain. Faster rates require a central line and cardiac monitoring.\"},{\"q\":\"Why is it critical to measure and correct serum magnesium in a patient with hypokalemia?\",\"a\":\"Magnesium is a cofactor for the Na+\\/K+-ATPase pump and is crucial for the function of the ROMK potassium channel in the kidney. Hypomagnesemia leads to increased renal potassium excretion via ROMK, making it impossible to correct potassium levels until magnesium is repleted.\"},{\"q\":\"A patient has hypertension, hypokalemia, and metabolic alkalosis. What is the first and most important blood test to differentiate the causes?\",\"a\":\"A paired plasma renin activity (or concentration) and plasma aldosterone concentration. The ratio and absolute values will differentiate primary aldosteronism (low renin, high aldo) from renovascular hypertension (high renin, high aldo) and other rarer causes like Liddle\'s syndrome (low renin, low aldo).\"},{\"q\":\"Describe the classic ECG changes of hypokalemia.\",\"a\":\"T-wave flattening or inversion, ST-segment depression, a prominent U-wave (which can merge with the T-wave causing apparent QT prolongation), and an increased risk of both atrial and ventricular arrhythmias.\"},{\"q\":\"What is the pathophysiology of Liddle\'s syndrome?\",\"a\":\"Liddle\'s syndrome is an autosomal dominant disorder caused by a gain-of-function mutation in the epithelial sodium channel (ENaC) in the collecting duct. This leads to excessive, aldosterone-independent sodium reabsorption and potassium secretion, resulting in hypertension and hypokalemia with suppressed renin and aldosterone.\"},{\"q\":\"How do you treat Liddle\'s syndrome, and why is spironolactone ineffective?\",\"a\":\"Liddle\'s is treated with direct ENaC blockers like amiloride or triamterene. Spironolactone is a mineralocorticoid receptor antagonist and is ineffective because the ENaC hyperactivity in Liddle\'s is independent of aldosterone stimulation.\"},{\"q\":\"A patient has hypokalemia and a non-anion gap metabolic acidosis. How does the urine anion gap help distinguish between diarrhea and RTA?\",\"a\":\"The urine anion gap (UAG = UNa + UK - UCl) estimates ammonium excretion. In diarrhea, the kidneys compensate by increasing ammonium (NH4Cl) excretion, resulting in a high urine chloride and a negative UAG. In distal RTA, ammonium excretion is impaired, leading to a low urine chloride and a positive UAG.\"},{\"q\":\"What are the key features that distinguish Gitelman syndrome from Bartter syndrome?\",\"a\":\"The key differentiator is urinary calcium excretion: Gitelman syndrome has low urinary calcium (hypocalciuria), whereas Bartter syndrome has high or normal urinary calcium (hypercalciuria). Additionally, hypomagnesemia is more pronounced and consistent in Gitelman syndrome, which also typically presents later in life than Bartter syndrome.\"},{\"q\":\"What is the Transtubular Potassium Gradient (TTKG) and how is it used?\",\"a\":\"TTKG is an index of renal potassium secretion by the collecting duct. A TTKG > 7-10 in the presence of hypokalemia suggests inappropriate renal potassium wasting. A TTKG < 3 suggests appropriate renal potassium conservation, pointing to an extra-renal cause or transcellular shift.\"},{\"q\":\"A patient with DKA presents with a serum K+ of 5.5 mmol\\/L. What does this imply about their total body potassium stores?\",\"a\":\"It implies a significant total body potassium deficit. Insulin deficiency and hyperosmolarity in DKA cause a shift of potassium out of cells, artificially raising the serum level. As insulin and fluids are given, potassium will rapidly shift back into cells, unmasking the underlying deficit and potentially leading to severe hypokalemia if not aggressively replaced.\"}],\"TEACHING_CONCEPTS_LI\":[\"The physiological relationship between blood pressure, the renin-angiotensin-aldosterone system, and potassium homeostasis.\",\"The stepwise diagnostic approach to hypokalemia: assess K+ level -> assess BP -> assess acid-base -> assess urine electrolytes.\",\"The pharmacology of diuretics and their distinct effects on different parts of the nephron, which are mirrored by inherited tubulopathies (Bartter ~ Loop, Gitelman ~ Thiazide).\",\"The importance of magnesium as the \'gatekeeper\' of potassium homeostasis.\",\"The interpretation of urine electrolytes (chloride, anion gap, TTKG) as functional tests of tubular physiology.\"],\"TEACHING_MISTAKES_LI\":[\"Failing to correct hypomagnesemia before or during potassium repletion.\",\"Prescribing dextrose-containing fluids for IV potassium replacement.\",\"Delaying ECG and cardiac monitoring in moderate-to-severe hypokalemia.\",\"Not considering diuretic abuse in a patient with unexplained hypokalemic metabolic alkalosis and high urine chloride.\",\"Diagnosing Liddle\'s syndrome as primary aldosteronism without checking renin and aldosterone levels.\"],\"EVIDENCE_STUDIES_LI\":[\"<b>Physiological studies by Giebisch and others:<\\/b> Foundational research elucidating the mechanisms of potassium transport in the renal tubules.\",\"<b>Clinical case series and genetic studies:<\\/b> Reports that first described and identified the mutations for Liddle\'s, Bartter\'s, and Gitelman\'s syndromes.\",\"<b>Observational studies on ECG changes:<\\/b> Correlated specific ECG abnormalities with varying degrees of hypokalemia.\",\"<b>Clinical trials on potassium binders (e.g., patiromer, SZC):<\\/b> While primarily for hyperkalemia, these studies provide insights into potassium homeostasis and management.\"],\"EVIDENCE_RECOMMENDATIONS_LI\":[\"<b>KDIGO Clinical Practice Guidelines for Acute Kidney Injury (2012):<\\/b> While not specific to hypokalemia, it provides recommendations on managing electrolyte disturbances in the context of AKI.\",\"<b>American Heart Association (AHA) Guidelines for CPR and Emergency Cardiovascular Care:<\\/b> Include protocols for managing cardiac arrest due to electrolyte abnormalities, including hypokalemia.\",\"Most recommendations for hypokalemia management are based on established physiological principles and expert consensus rather than large-scale randomized controlled trials.\"],\"GUIDELINE_ANCHORS_LI\":[\"<b>European Resuscitation Council Guidelines:<\\/b> Section on peri-arrest arrhythmias and electrolyte abnormalities.\",\"<b>UpToDate and other clinical decision support tools:<\\/b> Synthesize evidence and provide expert-authored recommendations on the diagnosis and management of hypokalemia.\"],\"ADDITIONAL_SECTIONS_HTML\":\"\",\"EXTRA_INFO_HTML\":\"<div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extra_heading1\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra_collapse1\' aria-expanded=\'false\' aria-controls=\'extra_collapse1\'>Drug-Induced Hypokalemia<\\/button><\\/h2><div id=\'extra_collapse1\' class=\'accordion-collapse collapse\' aria-labelledby=\'extra_heading1\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><b>Diuretics:<\\/b> Loop and thiazide diuretics are the most common cause.<\\/li><li><b>Beta-2 Agonists (e.g., Salbutamol):<\\/b> Cause transcellular shift of K+ into cells via Na\\/K ATPase stimulation.<\\/li><li><b>Insulin:<\\/b> Also causes transcellular shift.<\\/li><li><b>Amphotericin B:<\\/b> Causes renal tubular damage leading to potassium wasting.<\\/li><li><b>High-dose Penicillins:<\\/b> Act as a non-reabsorbable anion in the distal tubule, promoting potassium secretion.<\\/li><li><b>Licorice (Glycyrrhizic acid):<\\/b> Inhibits 11-beta-hydroxysteroid dehydrogenase, leading to apparent mineralocorticoid excess.<\\/li><\\/ul><\\/div><\\/div><\\/div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extra_heading2\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra_collapse2\' aria-expanded=\'false\' aria-controls=\'extra_collapse2\'>Schema Omission Log<\\/button><\\/h2><div id=\'extra_collapse2\' class=\'accordion-collapse collapse\' aria-labelledby=\'extra_heading2\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><b>ADDITIONAL_SECTIONS_HTML:<\\/b> Left blank as overflow content was suitable for the standard EXTRA_INFO_HTML structure.<\\/li><\\/ul><\\/div><\\/div><\\/div><\\/div>\"}', '[]', '﻿<!doctype html>\r\n<html lang=\"en\" data-bs-theme=\"light\">\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\r\n  <title>Nephromap! â€” Hypokalemia Viva</title>\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n  <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css\" rel=\"stylesheet\">\r\n  <script src=\"https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js\"></script>\r\n  <!-- Export Libraries -->\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\"></script>\r\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js\"></script>\r\n  <style>\r\n    :root{\r\n      --radius: 1rem;\r\n      --shadow-1: 0 4px 12px rgba(0,0,0,0.08);\r\n      --shadow-hover: 0 8px 20px rgba(0,0,0,0.12);\r\n      --grad-1: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.12) 100%);\r\n      --grad-2: linear-gradient(135deg, rgba(251, 113, 133, 0.15) 0%, rgba(245, 101, 101, 0.12) 100%);\r\n      --grad-3: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 197, 253, 0.12) 100%);\r\n      --grad-4: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(134, 239, 172, 0.12) 100%);\r\n      --grad-5: linear-gradient(135deg, rgba(251, 146, 60, 0.15) 0%, rgba(254, 215, 170, 0.12) 100%);\r\n      --grad-6: linear-gradient(135deg, rgba(168, 237, 234, 0.18) 0%, rgba(254, 214, 227, 0.15) 100%);\r\n      --grad-7: linear-gradient(135deg, rgba(255, 236, 210, 0.2) 0%, rgba(252, 182, 159, 0.15) 100%);\r\n      --grad-8: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.12) 100%);\r\n      --card-bg: rgba(255,255,255,0.85);\r\n      --text-primary: #1f2937;\r\n      --text-secondary: #4b5563;\r\n      --accent-blue: #3b82f6;\r\n      --accent-purple: #8b5cf6;\r\n      --accent-green: #10b981;\r\n      --accent-orange: #f59e0b;\r\n      --accent-pink: #ec4899;\r\n    }\r\n    body{\r\n      background: \r\n        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),\r\n        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.04) 0%, transparent 50%),\r\n        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.03) 0%, transparent 50%),\r\n        linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);\r\n      background-attachment: fixed;\r\n      color: var(--text-primary);\r\n      line-height: 1.6;\r\n      padding-bottom: 1rem;\r\n      min-height: 100vh;\r\n    }\r\n    .nm-card{\r\n      border-radius: var(--radius);\r\n      box-shadow: var(--shadow-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      background: var(--card-bg);\r\n      backdrop-filter: blur(10px);\r\n      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\r\n      position: relative;\r\n      overflow: hidden;\r\n    }\r\n    .nm-card::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 3px;\r\n      background: var(--grad-1);\r\n      opacity: 0;\r\n      transition: opacity 0.3s ease;\r\n    }\r\n    .nm-card:hover{ \r\n      box-shadow: var(--shadow-hover); \r\n      transform: translateY(-2px);\r\n    }\r\n    .nm-card:hover::before {\r\n      opacity: 1;\r\n    }\r\n    .chip{\r\n      display:inline-block; padding:.4rem .8rem; border-radius:999px; font-size:.8rem; font-weight:600;\r\n      box-shadow: 0 2px 6px rgba(0,0,0,.1);\r\n      color: var(--text-primary);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .chip:hover {\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 10px rgba(0,0,0,.15);\r\n    }\r\n    .quick-ref-content {\r\n      background: white;\r\n      border-radius: 0.75rem;\r\n      border: 1px solid rgba(99, 102, 241, 0.12);\r\n      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.05);\r\n      padding: 1.25rem;\r\n    }\r\n    .quick-ref-content > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .differential-focus {\r\n      background: rgba(59, 130, 246, 0.04);\r\n      border: 1px dashed rgba(59, 130, 246, 0.45);\r\n      border-radius: 0.85rem;\r\n      padding: 1.25rem;\r\n    }\r\n    .differential-focus .table {\r\n      background: white;\r\n      margin-bottom: 0;\r\n    }\r\n    .concept-diagram {\r\n      background: rgba(139, 92, 246, 0.08);\r\n      border-radius: 0.85rem;\r\n      border: 1px solid rgba(139, 92, 246, 0.25);\r\n      padding: 1.25rem;\r\n    }\r\n    .concept-diagram > :last-child {\r\n      margin-bottom: 0;\r\n    }\r\n    .safety-list li,\r\n    .communication-list li {\r\n      list-style: none;\r\n      padding: 0.5rem 0.75rem;\r\n      border-radius: 0.5rem;\r\n      margin-bottom: 0.35rem;\r\n      background: rgba(255, 255, 255, 0.8);\r\n      box-shadow: inset 0 1px 0 rgba(15, 23, 42, 0.04);\r\n    }\r\n    .safety-list li {\r\n      border-left: 3px solid #ef4444;\r\n    }\r\n    .communication-list li {\r\n      border-left: 3px solid #0ea5e9;\r\n    }\r\n    .tone-light{ \r\n      background: var(--grad-6); \r\n      color: var(--text-primary); \r\n    }\r\n    .tone-info{ \r\n      background: var(--grad-1); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Enhanced Additional Notes Styling */\r\n    .additional-note,\r\n    section[id^=\"extra-note-\"] {\r\n      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);\r\n      border: 2px solid #3b82f6;\r\n      border-radius: 12px;\r\n      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);\r\n      position: relative;\r\n      overflow: hidden;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .additional-note:hover,\r\n    section[id^=\"extra-note-\"]:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before,\r\n    section[id^=\"extra-note-\"]::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25);\r\n    }\r\n    \r\n    .additional-note::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n    }\r\n    \r\n    .additional-note .section-title,\r\n    section[id^=\"extra-note-\"] .section-title {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n      padding: 12px 16px;\r\n      margin: -12px -16px 16px -16px;\r\n      border-radius: 8px 8px 0 0;\r\n      font-weight: 600;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n    }\r\n    \r\n    .additional-note .section-title .icon-circle,\r\n    section[id^=\"extra-note-\"] .section-title .icon-circle {\r\n      background: rgba(255, 255, 255, 0.2);\r\n      border-radius: 50%;\r\n      width: 32px;\r\n      height: 32px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      backdrop-filter: blur(10px);\r\n    }\r\n    \r\n    .additional-note .content-container,\r\n    section[id^=\"extra-note-\"] .border.rounded.p-3.bg-white {\r\n      background: white;\r\n      border: 1px solid #e2e8f0;\r\n      border-radius: 8px;\r\n      padding: 20px;\r\n      margin: 0;\r\n      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);\r\n    }\r\n    \r\n    \r\n    /* Enhanced content styling within additional notes */\r\n    .additional-note h1,\r\n    section[id^=\"extra-note-\"] h1 {\r\n      color: #1e40af;\r\n      border-bottom: 2px solid #3b82f6;\r\n      padding-bottom: 8px;\r\n      margin-bottom: 16px;\r\n    }\r\n    \r\n        .additional-note h2,\r\n    section[id^=\"extra-note-\"] h2 {\r\n      color: #1e40af;\r\n      border-left: 4px solid #3b82f6;\r\n      padding-left: 12px;\r\n      margin: 20px 0 12px 0;\r\n    }\r\n\r\n    .additional-note h3,\r\n    section[id^=\"extra-note-\"] h3 {\r\n      color: #374151;\r\n      font-weight: 600;\r\n      margin: 16px 0 8px 0;\r\n    }\r\n    \r\n        .additional-note table,\r\n    section[id^=\"extra-note-\"] table {\r\n      border: 2px solid #e5e7eb;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n    }\r\n\r\n    .additional-note table thead,\r\n    section[id^=\"extra-note-\"] table thead {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note table th {\r\n      padding: 12px;\r\n      font-weight: 600;\r\n      text-align: left;\r\n    }\r\n    \r\n    .additional-note table td {\r\n      padding: 10px 12px;\r\n      border-top: 1px solid #e5e7eb;\r\n    }\r\n    \r\n    .additional-note table tbody tr:nth-child(even) {\r\n      background: #f8fafc;\r\n    }\r\n    \r\n    .additional-note table tbody tr:hover {\r\n      background: #eff6ff;\r\n    }\r\n    \r\n    .additional-note ul, .additional-note ol {\r\n      padding-left: 20px;\r\n    }\r\n    \r\n    .additional-note li {\r\n      margin-bottom: 6px;\r\n      line-height: 1.6;\r\n    }\r\n    \r\n    .additional-note strong {\r\n      color: #1e40af;\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion {\r\n      margin-top: 16px;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button {\r\n      background: linear-gradient(135deg, #f1f5f9, #e2e8f0);\r\n      border: 1px solid #cbd5e1;\r\n      font-weight: 600;\r\n      color: #374151;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      color: white;\r\n    }\r\n    \r\n    .additional-note .overflow-accordion .accordion-body {\r\n      background: #f8fafc;\r\n      border: 1px solid #e2e8f0;\r\n    }\r\n    \r\n    /* Print-friendly styles */\r\n    @media print {\r\n      .additional-note {\r\n        break-inside: avoid;\r\n        box-shadow: none;\r\n        border: 2px solid #000;\r\n      }\r\n      \r\n    }\r\n    .tone-warning{ \r\n      background: var(--grad-7); \r\n      color: var(--text-primary);\r\n    }\r\n    .tone-primary{ \r\n      background: var(--grad-3); \r\n      color: var(--text-secondary);\r\n    }\r\n    \r\n    /* Overflow Structure Styling */\r\n    .audit {\r\n      display: inline-block;\r\n      padding: 0.25rem 0.5rem;\r\n      background: var(--grad-7);\r\n      border-radius: 0.5rem;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      margin-bottom: 1rem;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    #extraInfoAccordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n    }\r\n    \r\n    /* Overflow accordion in chat responses */\r\n    .overflow-accordion .accordion-button {\r\n      background: var(--grad-6);\r\n      border: 1px solid rgba(99, 102, 241, 0.15);\r\n      font-weight: 600;\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    .overflow-accordion .accordion-button:not(.collapsed) {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .overflow-accordion .accordion-body {\r\n      background: rgba(255, 255, 255, 0.95);\r\n      border: 1px solid rgba(99, 102, 241, 0.1);\r\n      font-size: 0.9rem;\r\n    }\r\n    \r\n    /* Topic Header Styling */\r\n    #topic-header {\r\n      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 197, 253, 0.08) 100%);\r\n      border: 2px solid rgba(59, 130, 246, 0.2);\r\n      position: relative;\r\n    }\r\n    \r\n    #topic-header::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 4px;\r\n      background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);\r\n      border-radius: var(--radius) var(--radius) 0 0;\r\n    }\r\n    \r\n    .topic-title h1 {\r\n      background: linear-gradient(135deg, #3b82f6, #8b5cf6);\r\n      -webkit-background-clip: text;\r\n      -webkit-text-fill-color: transparent;\r\n      background-clip: text;\r\n      text-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    \r\n    .topic-author {\r\n      border-top: 1px solid rgba(59, 130, 246, 0.2);\r\n      padding-top: 1rem;\r\n      margin-top: 1rem;\r\n    }\r\n    \r\n    .topic-author .lead {\r\n      font-size: 1.1rem;\r\n      font-weight: 500;\r\n    }\r\n    \r\n    /* Large screen adjustments */\r\n    @media (min-width: 1200px) {\r\n      .display-5 {\r\n        font-size: 2rem;\r\n      }\r\n    }\r\n    \r\n    /* Print-specific styling */\r\n    @media print {\r\n      #topic-header {\r\n        background: white !important;\r\n        border: 2px solid #3b82f6 !important;\r\n        box-shadow: none !important;\r\n        page-break-inside: avoid;\r\n        margin-bottom: 2rem;\r\n      }\r\n      \r\n      .topic-title h1 {\r\n        color: #3b82f6 !important;\r\n        -webkit-text-fill-color: #3b82f6 !important;\r\n        font-size: 2rem !important;\r\n        margin-bottom: 1rem !important;\r\n      }\r\n      \r\n      .topic-author {\r\n        border-top: 1px solid #3b82f6 !important;\r\n        padding-top: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .lead {\r\n        color: #374151 !important;\r\n        font-size: 1rem !important;\r\n      }\r\n      \r\n      .topic-author .text-muted {\r\n        color: #6b7280 !important;\r\n        font-size: 0.9rem !important;\r\n      }\r\n    }\r\n    .tone-success{ \r\n      background: var(--grad-4); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-emphasis{ \r\n      background: var(--grad-2); \r\n      color: var(--text-secondary);\r\n    }\r\n    .tone-special{\r\n      background: var(--grad-8);\r\n      color: var(--text-primary);\r\n    }\r\n    .avoid-break{ break-inside: avoid; page-break-inside: avoid; }\r\n    .safety-critical { border-left: 4px solid rgba(239, 68, 68, 0.6) !important; }\r\n    .safety-warning { border-left: 4px solid rgba(245, 158, 11, 0.6) !important; }\r\n    .safety-info { border-left: 4px solid rgba(59, 130, 246, 0.6) !important; }\r\n    /* =============================================================================\r\n       PRINT & PDF EXPORT SETTINGS - CUSTOMIZE THESE FOR YOUR NEEDS\r\n       ============================================================================= */\r\n    @media print{ \r\n      /* Hide elements that shouldn\'t be printed */\r\n      .print-hide{ display:none !important; }\r\n      .scroll-to-top-btn{ display:none !important; } \r\n      \r\n      /* Card styling for print */\r\n      .nm-card{ \r\n        box-shadow:none !important; \r\n        background:#fff !important; \r\n        border: 1px solid #dee2e6 !important;\r\n        margin-bottom: 1rem !important;\r\n        padding: 1rem !important;\r\n      } \r\n      \r\n      /* ASCII Flowchart settings for print */\r\n      .ascii-flow{ \r\n        overflow: visible !important; \r\n        max-height: none !important; \r\n        height: auto !important; \r\n        page-break-inside: avoid !important;\r\n        background: #f8f9fa !important;\r\n        border: 1px solid #dee2e6 !important;\r\n        font-size: 12px !important;          /* â† FONT SIZE: Increased from 10px */\r\n        line-height: 1.3 !important;         /* â† LINE HEIGHT: Increased from 1.2 */\r\n        padding: 12px !important;            /* â† PADDING: Increased from 10px */\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        overflow-wrap: break-word !important;\r\n        max-width: 100% !important;\r\n        box-sizing: border-box !important;\r\n      }\r\n      \r\n      /* ASCII Flowchart without wrapping */\r\n      .ascii-flow.no-wrap {\r\n        white-space: pre-wrap !important;\r\n        word-break: break-all !important;\r\n        font-size: 11px !important;          /* â† SMALLER FONT for no-wrap: Increased from 9px */\r\n      }\r\n      \r\n      /* ASCII Flowchart label */\r\n      .ascii-flow::before {\r\n        font-size: 10px !important;\r\n        background: #e9ecef !important;\r\n        color: #495057 !important;\r\n        border: 1px solid #adb5bd !important;\r\n      }\r\n      \r\n      /* Page setup */\r\n      body { \r\n        background: white !important; \r\n        font-size: 18px !important;          /* â† BODY FONT SIZE: Increased for better readability */\r\n        line-height: 1.5 !important;         /* â† BODY LINE HEIGHT: Increased for better readability */\r\n      }\r\n      \r\n      /* Container settings */\r\n      .container, .container-fluid { \r\n        max-width: 100% !important; \r\n        margin: 0 !important; \r\n        padding: 0 15px !important;          /* â† SIDE MARGINS: Adjust this value */\r\n      }\r\n      \r\n      /* Page margins and size */\r\n      @page {\r\n        size: A4;                             /* â† PAGE SIZE: Change to \'letter\' for US */\r\n        margin: 0.5cm 0.5cm 1.5cm 0.5cm;     /* â† PAGE MARGINS: Added bottom margin for footer */\r\n      }\r\n      \r\n\r\n      \r\n      /* Minimize gaps between pages for 2-page printing */\r\n      \r\n      /* Overflow structure print styles */\r\n      #extraInfoAccordion .accordion-button {\r\n        background: #f8f9fa !important;\r\n        color: #000 !important;\r\n        border: 1px solid #dee2e6 !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-collapse {\r\n        display: block !important;\r\n      }\r\n      \r\n      #extraInfoAccordion .accordion-button::after {\r\n        display: none !important;\r\n      }\r\n      \r\n      .audit {\r\n        background: #fff3cd !important;\r\n        color: #856404 !important;\r\n        border: 1px solid #ffeaa7 !important;\r\n      }\r\n      .nm-card {\r\n        margin-bottom: 0.5rem !important;     /* â† SECTION SPACING: Minimized for 2-page printing */\r\n        page-break-inside: avoid !important;\r\n        padding: 1rem !important;             /* â† SECTION PADDING: Minimized for 2-page printing */\r\n      }\r\n      \r\n      /* Reduce spacing between sections for 2-page printing */\r\n      .section-title {\r\n        margin-bottom: 0.25rem !important;    /* â† SECTION TITLE MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Tighten list spacing for 2-page printing */\r\n      ul, ol {\r\n        margin-bottom: 0.25rem !important;    /* â† LIST MARGIN: Minimized */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.1rem !important;     /* â† LIST ITEM MARGIN: Minimized */\r\n      }\r\n      \r\n      /* Text sizing for different elements */\r\n      h1 { font-size: 2.5rem !important; }   /* â† H1 SIZE: Increased for better readability */\r\n      h2 { font-size: 2rem !important; }     /* â† H2 SIZE: Increased for better readability */\r\n      h3 { font-size: 1.7rem !important; }   /* â† H3 SIZE: Increased for better readability */\r\n      p { font-size: 18px !important; }      /* â† PARAGRAPH SIZE: Increased for readability */\r\n      li { font-size: 18px !important; }     /* â† LIST ITEM SIZE: Increased for readability */\r\n      \r\n      /* Table settings */\r\n      .table {\r\n        font-size: 17px !important;          /* â† TABLE FONT SIZE: Increased for readability */\r\n        margin-bottom: 0.5rem !important;    /* â† TABLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Chip/tag settings */\r\n      .chip {\r\n        font-size: 14px !important;          /* â† CHIP FONT SIZE: Increased for readability */\r\n        padding: 0.4rem 0.8rem !important;   /* â† CHIP PADDING: Increased for better spacing */\r\n        margin: 0.2rem 0.3rem 0.2rem 0 !important; /* â† CHIP MARGIN: Added for spacing */\r\n      }\r\n      \r\n      /* Section spacing */\r\n      .nm-card {\r\n        margin-bottom: 1rem !important;      /* â† SECTION SPACING: Reduced for tighter layout */\r\n        page-break-inside: avoid !important;\r\n        padding: 1.5rem !important;          /* â† SECTION PADDING: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Additional print improvements */\r\n      .section-title {\r\n        font-size: 1.6rem !important;        /* â† SECTION TITLE: Increased for better readability */\r\n        font-weight: bold !important;\r\n        margin-bottom: 0.5rem !important;    /* â† SECTION TITLE MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      .accordion-button {\r\n        font-size: 18px !important;          /* â† ACCORDION BUTTON: Increased for readability */\r\n        padding: 1rem 1.5rem !important;     /* â† ACCORDION BUTTON PADDING: Increased for spacing */\r\n      }\r\n      \r\n      .accordion-body {\r\n        font-size: 18px !important;          /* â† ACCORDION BODY: Increased for readability */\r\n        padding: 1.5rem !important;          /* â† ACCORDION BODY PADDING: Increased for spacing */\r\n      }\r\n      \r\n      /* List improvements for print */\r\n      ul, ol {\r\n        margin-bottom: 0.5rem !important;    /* â† LIST MARGIN: Reduced for tighter layout */\r\n        padding-left: 1.5rem !important;     /* â† LIST PADDING: Increased for better indentation */\r\n      }\r\n      \r\n      li {\r\n        margin-bottom: 0.25rem !important;   /* â† LIST ITEM MARGIN: Reduced for tighter layout */\r\n      }\r\n      \r\n      /* Ensure good contrast for print */\r\n      .text-muted {\r\n        color: #6c757d !important;\r\n      }\r\n      \r\n      .text-secondary {\r\n        color: #495057 !important;\r\n      }\r\n    }\r\n    .ascii-flow { \r\n      font-family: \'Courier New\', monospace; \r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.75rem; \r\n      padding: 1.5rem; \r\n      max-width: 100%; \r\n      overflow: auto; \r\n      -webkit-overflow-scrolling: touch;\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n    }\r\n    .ascii-flow::before {\r\n      content: \'Algorithm\';\r\n      position: absolute;\r\n      top: -12px;\r\n      left: 20px;\r\n      background: rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      padding: 4px 12px;\r\n      border-radius: 12px;\r\n      font-size: 0.75rem;\r\n      font-weight: 600;\r\n      font-family: system-ui, sans-serif;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ascii-flow.wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }\r\n    .ascii-flow.no-wrap { white-space: pre; }\r\n    header.header-gradient{\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.08);\r\n      position: relative;\r\n      overflow: hidden;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.15);\r\n    }\r\n    header.header-gradient::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: url(\'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1000 100\" fill=\"%23f3f4f6\" opacity=\"0.3\"><path d=\"M0,20 Q250,50 500,20 T1000,20 L1000,100 L0,100 Z\"/></svg>\');\r\n      background-size: cover;\r\n    }\r\n    header .fw-bold{ color: var(--text-primary); }\r\n    header .text-secondary{ color: var(--text-secondary) !important; }\r\n    .table thead th{ \r\n      position: sticky; \r\n      top: 0; \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      z-index: 1; \r\n      border: none;\r\n      font-weight: 600;\r\n    }\r\n    .section-title{ \r\n      display: flex; \r\n      align-items: center; \r\n      gap: 0.75rem; \r\n      font-weight: 700; \r\n      color: var(--text-primary);\r\n      font-size: 1.1rem;\r\n      margin-bottom: 1rem;\r\n    }\r\n    .icon-circle{ \r\n      width: 36px; \r\n      height: 36px; \r\n      display: inline-flex; \r\n      align-items: center; \r\n      justify-content: center; \r\n      border-radius: 50%; \r\n      background: var(--grad-1); \r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      box-shadow: 0 2px 6px rgba(99, 102, 241, 0.15);\r\n      color: var(--accent-blue);\r\n      font-size: 1rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    .icon-circle:hover {\r\n      transform: scale(1.1);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);\r\n    }\r\n    .accordion-button{ \r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      border-radius: 0.75rem !important;\r\n      font-weight: 600;\r\n      color: var(--text-primary);\r\n      transition: all 0.3s ease;\r\n    }\r\n    .accordion-button:not(.collapsed){ \r\n      background: var(--grad-1); \r\n      color: var(--text-primary);\r\n      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);\r\n      border-color: rgba(99, 102, 241, 0.3);\r\n    }\r\n    .accordion-button:focus {\r\n      box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.15);\r\n      border-color: var(--accent-blue);\r\n    }\r\n    .label-strong{ color: var(--accent-blue); font-weight: 700; }\r\n    .accent{ color: var(--accent-pink); font-weight: 700; }\r\n    .hl-symbol{ color: var(--accent-purple); font-weight: 700; padding: 0 0.2rem; background: rgba(139, 92, 246, 0.1); border-radius: 3px; }\r\n    \r\n    /* Enhanced AI Chat Message Styling */\r\n    .ai-message { \r\n      max-width: 100%; \r\n      overflow-wrap: break-word;\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));\r\n      border-radius: 1rem;\r\n      padding: 1.5rem;\r\n      margin: 1rem 0;\r\n      border: 1px solid rgba(99, 102, 241, 0.2);\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.06);\r\n      position: relative;\r\n    }\r\n    .ai-message::before {\r\n      content: \'\';\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      height: 2px;\r\n      background: var(--grad-3);\r\n      border-radius: 1rem 1rem 0 0;\r\n    }\r\n    .ai-message h1, .ai-message h2, .ai-message h3, .ai-message h4, .ai-message h5, .ai-message h6 { \r\n      margin-top: 1.5rem; \r\n      margin-bottom: 0.75rem; \r\n      font-weight: 700; \r\n      position: relative;\r\n    }\r\n    .ai-message h1 { \r\n      font-size: 1.4rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h2 { \r\n      font-size: 1.2rem; \r\n      color: var(--text-primary);\r\n    }\r\n    .ai-message h3 { \r\n      font-size: 1.1rem; \r\n      color: var(--text-secondary);\r\n    }\r\n    .ai-message p { margin-bottom: 0.75rem; line-height: 1.5; }\r\n    .ai-message ul, .ai-message ol { margin-bottom: 0.75rem; padding-left: 1.5rem; }\r\n    .ai-message li { margin-bottom: 0.25rem; }\r\n    .ai-message table { \r\n      width: 100%; border-collapse: collapse; margin: 1rem 0; \r\n      border: 1px solid var(--bs-border-color); border-radius: 0.375rem; overflow: hidden;\r\n    }\r\n    .ai-message th, .ai-message td { \r\n      padding: 0.5rem 0.75rem; border-bottom: 1px solid var(--bs-border-color); text-align: left; \r\n    }\r\n    .ai-message th { \r\n      background: var(--bs-light); font-weight: 600; color: var(--bs-dark); \r\n    }\r\n    .ai-message tr:last-child td { border-bottom: none; }\r\n    .ai-message code { \r\n      background: #f8f9fa; padding: 0.125rem 0.25rem; border-radius: 0.25rem; \r\n      font-family: \'Monaco\', \'Consolas\', monospace; font-size: 0.875em; color: var(--text-secondary);\r\n    }\r\n    .ai-message pre { \r\n      background: #f8f9fa; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; \r\n      margin: 1rem 0; border: 1px solid rgba(99, 102, 241, 0.2);\r\n    }\r\n    .ai-message pre code { background: none; padding: 0; }\r\n    .ai-message blockquote { \r\n      border-left: 3px solid rgba(99, 102, 241, 0.4); margin: 1rem 0; padding-left: 1rem; \r\n      color: var(--text-secondary); font-style: italic; \r\n    }\r\n    .ai-message strong { font-weight: 700; color: var(--text-primary); }\r\n    .ai-message em { font-style: italic; color: var(--text-secondary); }\r\n    \r\n    /* Enhanced Content Sections */\r\n    section {\r\n      margin-bottom: 2rem;\r\n    }\r\n    \r\n    /* Special styling for different content types */\r\n    .priorities-section .nm-card {\r\n      border-left: 3px solid var(--accent-orange);\r\n    }\r\n    .priorities-section .nm-card::before {\r\n      background: var(--grad-7);\r\n    }\r\n    \r\n    .diagnosis-section .nm-card {\r\n      border-left: 3px solid var(--accent-green);\r\n    }\r\n    .diagnosis-section .nm-card::before {\r\n      background: var(--grad-4);\r\n    }\r\n    \r\n    .management-section .nm-card {\r\n      border-left: 3px solid var(--accent-blue);\r\n    }\r\n    .management-section .nm-card::before {\r\n      background: var(--grad-1);\r\n    }\r\n    \r\n    .emergency-section .nm-card {\r\n      border-left: 3px solid var(--accent-pink);\r\n    }\r\n    .emergency-section .nm-card::before {\r\n      background: var(--grad-2);\r\n    }\r\n    \r\n    /* Enhanced navigation */\r\n    #pageNav {\r\n      background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8)) !important;\r\n      border-bottom: 1px solid rgba(99, 102, 241, 0.2) !important;\r\n      backdrop-filter: blur(8px);\r\n    }\r\n    \r\n    #pageNav .btn {\r\n      background: transparent;\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    #pageNav .btn:hover {\r\n      background: var(--grad-1);\r\n      color: var(--text-primary);\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n    }\r\n    \r\n    /* Enhanced form styling */\r\n    .form-control {\r\n      border: 1px solid rgba(99, 102, 241, 0.25);\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .form-control:focus {\r\n      border-color: var(--accent-blue);\r\n      box-shadow: 0 0 0 0.2rem rgba(99, 102, 241, 0.15);\r\n    }\r\n    \r\n    .btn-primary {\r\n      background: var(--grad-1);\r\n      border: 1px solid rgba(99, 102, 241, 0.3);\r\n      color: var(--text-primary);\r\n      font-weight: 600;\r\n      border-radius: 0.5rem;\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .btn-primary:hover {\r\n      background: var(--grad-1);\r\n      transform: translateY(-1px);\r\n      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    .btn-outline-secondary {\r\n      border-color: rgba(99, 102, 241, 0.4);\r\n      color: var(--accent-blue);\r\n      font-weight: 600;\r\n    }\r\n    \r\n    .btn-outline-secondary:hover {\r\n      background: var(--grad-1);\r\n      border-color: var(--accent-blue);\r\n      color: var(--text-primary);\r\n    }\r\n    \r\n    /* AI Chat Copy Button Styles */\r\n    .ai-message {\r\n      transition: box-shadow 0.2s ease;\r\n    }\r\n    .ai-message:hover {\r\n      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;\r\n    }\r\n    .copy-response-btn {\r\n      background: rgba(255, 255, 255, 0.9);\r\n      backdrop-filter: blur(4px);\r\n      border: 1px solid rgba(0,0,0,0.1);\r\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\r\n    }\r\n    .copy-response-btn:hover {\r\n      background: rgba(255, 255, 255, 1);\r\n      border-color: rgba(0,0,0,0.2);\r\n      box-shadow: 0 3px 6px rgba(0,0,0,0.15);\r\n      transform: translateY(-1px);\r\n    }\r\n    .copy-response-btn i {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    /* Search functionality styles */\r\n    .search-container {\r\n      position: relative;\r\n    }\r\n    \r\n    .search-highlight {\r\n      background-color: #fff3cd !important;\r\n      border: 1px solid #ffeaa7 !important;\r\n      border-radius: 2px;\r\n      padding: 1px 2px;\r\n    }\r\n    \r\n    .search-highlight.current {\r\n      background-color: #ffc107 !important;\r\n      border-color: #ffb300 !important;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    \r\n    /* Floating Scroll to Top Button */\r\n    .scroll-to-top-btn {\r\n      position: fixed;\r\n      bottom: 30px;\r\n      right: 30px;\r\n      z-index: 1000;\r\n      border-radius: 50%;\r\n      width: 50px;\r\n      height: 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n      transition: all 0.3s ease;\r\n    }\r\n    \r\n    .scroll-to-top-btn:hover {\r\n      transform: translateY(-2px);\r\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);\r\n    }\r\n    \r\n    .search-info {\r\n      white-space: nowrap;\r\n      min-width: 60px;\r\n    }\r\n    \r\n    /* Hide search in print */\r\n    @media print {\r\n      .search-container {\r\n        display: none !important;\r\n      }\r\n      .search-highlight {\r\n        background-color: transparent !important;\r\n        border: none !important;\r\n      }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <header class=\"header-gradient position-sticky top-0 print-hide\">\r\n    <div class=\"container py-2 d-flex align-items-center justify-content-between gap-3\">\r\n      <div class=\"d-flex align-items-center gap-3\">\r\n        <i class=\"bi bi-diagram-3 fs-4 text-primary\"></i>\r\n        <div>\r\n          <div class=\"fw-bold\">Nephromap! Hypokalemia Viva</div>\r\n          <small class=\"text-secondary\">Consultant-level viva guide &#8226; SCFHS</small>\r\n        </div>\r\n      </div>\r\n      <div class=\"d-flex align-items-center gap-2\">\r\n        <!-- Export Dropdown -->\r\n        <div class=\"btn-group\">\r\n          <button class=\"btn btn-light btn-sm dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" title=\"Export Options\">\r\n            <i class=\"bi bi-download me-1\"></i>Export\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><h6 class=\"dropdown-header\"><i class=\"bi bi-file-arrow-down me-2\"></i>Export Formats</h6></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaHTML\"><i class=\"bi bi-file-earmark-text me-2\"></i>HTML File</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPDF\"><i class=\"bi bi-file-earmark-pdf me-2\"></i>PDF Document</a></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaImage\"><i class=\"bi bi-image me-2\"></i>PNG Image</a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" id=\"exportVivaPrint\"><i class=\"bi bi-printer me-2\"></i>Print Preview</a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n\r\n  <!-- Quick Navigation moved to sidebar -->\r\n\r\n  <main class=\"container py-4 pb-3\">\r\n\r\n    <!-- Floating Scroll to Top Button -->\r\n    <button id=\"scrollToTop\" class=\"btn btn-outline-secondary btn-sm scroll-to-top-btn\">â†‘ Top</button>\r\n\r\n    <!-- Topic Header Section -->\r\n    <section id=\"topic-header\" class=\"nm-card p-4 p-md-5 mb-4 tone-primary avoid-break text-center\">\r\n      <div class=\"topic-title mb-3\">\r\n        <h1 class=\"display-5 fw-bold text-primary mb-0\">Hypokalemia</h1>\r\n      </div>\r\n      <div class=\"topic-author\">\r\n        <p class=\"lead mb-0 text-secondary\">\r\n          <i class=\"bi bi-person-circle me-2\"></i>\r\n          Prepared by: <strong>Dr. Hossam Abohassan</strong>\r\n          <span class=\"text-muted mx-2\">â€¢</span>\r\n          <i class=\"bi bi-heart-pulse me-1\"></i>\r\n          <span class=\"text-muted\">nephromap.com</span>\r\n        </p>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"overview\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"mb-2\">\r\n        <span class=\"chip bg-primary-subtle text-primary-emphasis me-1\">Emergency Management</span>\r\n        <span class=\"chip bg-success-subtle text-success-emphasis me-1\">Diagnostic Workup</span>\r\n        <span class=\"chip bg-warning-subtle text-warning-emphasis\">Acid-Base & Blood Pressure</span>\r\n      </div>\r\n      <div class=\"small text-secondary\">Hypokalemia, defined as a serum potassium concentration <3.5 mmol/L, is a common electrolyte disturbance with potentially life-threatening consequences, primarily cardiac arrhythmias. Severity is classified as mild (3.0-3.5 mmol/L), moderate (2.5-2.9 mmol/L), or severe (<2.5 mmol/L). The diagnostic approach hinges on a systematic evaluation of the patient\'s blood pressure, acid-base status, and urinary potassium excretion, which effectively narrows the differential diagnosis between transcellular shifts, gastrointestinal losses, and renal wasting.</div>\r\n    </section>\r\n\r\n    <section id=\"priorities\" class=\"priorities-section nm-card p-3 p-md-4 mb-3 tone-warning avoid-break safety-info\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-lightning-charge-fill\"></i></span><span>Immediate Priorities (first 5 minutes)</span></div>\r\n      <ul class=\"mb-0\"><li>Assess airway, breathing, and circulation (ABCDE approach), especially in cases of cardiac arrest or severe weakness.</li><li>✅ Secure cardiac monitoring immediately for any patient with K+ <3.0 mmol/L or with symptoms.</li><li>✅ Obtain a 12-lead ECG to assess for characteristic changes (T-wave flattening, U-waves, ST depression, arrhythmias).</li><li>✅ Establish large-bore intravenous access (minimum of two sites if K+ is <2.0 mmol/L or patient is unstable).</li><li>🧪 Obtain urgent venous or arterial blood gas to determine serum potassium, pH, bicarbonate, and lactate.</li><li>💊 Begin immediate potassium repletion. For severe hypokalemia (e.g., K+ 1.7 mmol/L), administer IV potassium chloride cautiously. Do not exceed 20 mmol/hour in a peripheral line (max concentration 40 mmol/L) or 40 mmol/hour in a central line.</li><li>🧪 Check serum magnesium urgently and replete as necessary, as hypomagnesemia prevents effective potassium correction.</li><li>🔎 Obtain a focused history for potential causes: diuretics, vomiting, diarrhea, family history of periodic paralysis.</li><li>🔎 Conduct a focused physical examination, assessing volume status, blood pressure (including orthostatics), and neurological status (power, reflexes).</li><li>🧪 Send urgent laboratory tests: full electrolytes (including calcium and phosphate), creatinine, and glucose.</li><li>💊 Consider causes of transcellular shift like thyrotoxic periodic paralysis in young adults; check thyroid function tests.</li><li>🔎 Obtain a spot urine sample to measure urine potassium, creatinine, and electrolytes to calculate the Transtubular Potassium Gradient (TTKG) or fractional excretion of potassium.</li><li>Consult Nephrology for severe or refractory cases.</li><li>Determine the underlying cause to guide definitive management and prevent recurrence.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"diagnosis\" class=\"diagnosis-section nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3\"></i></span><span>Differential Diagnosis &amp; Etiology</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Hypokalemia with Hypertension</div><ul class=\"mb-0\"><li><b>Primary Aldosteronism (Conn\'s Syndrome):</b> Characterized by low renin and high aldosterone.</li><li><b>Liddle\'s Syndrome:</b> A genetic disorder mimicking hyperaldosteronism with low renin and low aldosterone.</li><li><b>Renovascular Hypertension:</b> High renin and high aldosterone due to renal artery stenosis.</li><li><b>Cushing\'s Syndrome:</b> Excess cortisol with mineralocorticoid activity.</li><li><b>Apparent Mineralocorticoid Excess (AME):</b> Deficiency of 11-beta-hydroxysteroid dehydrogenase type 2, leading to cortisol activating mineralocorticoid receptors.</li><li><b>Glucocorticoid-Remediable Aldosteronism (GRA):</b> A familial form of hyperaldosteronism.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Hypokalemia with Normal/Low Blood Pressure & Alkalosis</div><ul class=\"mb-0\"><li><b>Vomiting/Nasogastric Suction:</b> Extra-renal loss of HCl, leading to volume depletion and metabolic alkalosis. Urine chloride is typically low (<20 mmol/L).</li><li><b>Diuretic Abuse (Thiazide or Loop):</b> Renal potassium and chloride wasting. Urine chloride is high (>40 mmol/L).</li><li><b>Bartter Syndrome:</b> Inherited salt-losing tubulopathy affecting the thick ascending limb of the loop of Henle. Presents in childhood with polyuria, normotension, hypokalemic metabolic alkalosis, and hypercalciuria.</li><li><b>Gitelman Syndrome:</b> Inherited tubulopathy affecting the distal convoluted tubule. Presents in adolescence/adulthood with fatigue, cramps, hypokalemic metabolic alkalosis, hypomagnesemia, and hypocalciuria.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Hypokalemia with Normal/Low Blood Pressure & Acidosis</div><ul class=\"mb-0\"><li><b>Diarrhea:</b> Bicarbonate loss from the GI tract. Associated with a negative urine anion gap.</li><li><b>Distal (Type 1) Renal Tubular Acidosis:</b> Impaired distal acidification. Characterized by inability to lower urine pH <5.5 and a positive urine anion gap.</li><li><b>Proximal (Type 2) Renal Tubular Acidosis:</b> Impaired proximal bicarbonate reabsorption. Urine pH can be acidic (<5.5) once serum bicarbonate is low. Associated with Fanconi syndrome features (glycosuria, phosphaturia, aminoaciduria).</li><li><b>Toluene Inhalation (Glue Sniffing):</b> Causes a distal RTA picture.</li></ul></div></div>\r\n      </div>\r\n      <div class=\"differential-focus mt-3\" data-optional-block>\r\n        <div class=\'accordion\' id=\'ddx_focus_accordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'ddx_focus_heading_1\'><button class=\'accordion-button\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#ddx_focus_collapse_1\' aria-expanded=\'true\' aria-controls=\'ddx_focus_collapse_1\'>Bartter Syndrome vs. Gitelman Syndrome</button></h2><div id=\'ddx_focus_collapse_1\' class=\'accordion-collapse collapse show\' aria-labelledby=\'ddx_focus_heading_1\' data-bs-parent=\'#ddx_focus_accordion\'><div class=\'accordion-body\'><table><thead><tr><th>Feature</th><th>Bartter Syndrome</th><th>Gitelman Syndrome</th></tr></thead><tbody><tr><td><b>Genetic Defect Location</b></td><td>Thick ascending limb of Loop of Henle (affecting Na-K-2Cl cotransporter, ROMK, or ClC-Kb channels)</td><td>Distal convoluted tubule (affecting Na-Cl cotransporter)</td></tr><tr><td><b>Clinical Presentation</b></td><td>Usually presents in infancy or early childhood with failure to thrive, polyuria, and significant volume depletion.</td><td>Typically presents in late childhood, adolescence, or adulthood with muscle weakness, cramps, fatigue, and salt craving.</td></tr><tr><td><b>Blood Pressure</b></td><td>Normal to low</td><td>Normal to low</td></tr><tr><td><b>Serum Magnesium</b></td><td>May be low, but less consistently or severely than in Gitelman.</td><td><b>Hypomagnesemia</b> is a classic and consistent feature.</td></tr><tr><td><b>Urine Calcium</b></td><td><b>Hypercalciuria</b> (or normocalciuria). Often associated with nephrocalcinosis.</td><td><b>Hypocalciuria</b> is a key distinguishing feature.</td></tr><tr><td><b>Prostaglandin E2</b></td><td>Urinary levels are typically very high.</td><td>Urinary levels are normal or only slightly elevated.</td></tr><tr><td><b>Response to NSAIDs</b></td><td>Often improves with NSAIDs (e.g., indomethacin) due to prostaglandin inhibition.</td><td>No significant response to NSAIDs.</td></tr></tbody></table></div></div></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quick-reference\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-checklist text-success\"></i></span><span>Quick Reference Card</span></div>\r\n      <div class=\"quick-ref-content\" data-optional-content>\r\n        <div><h4>Potassium Repletion Guide</h4><p><b>Severity:</b> Mild (3.0-3.4), Moderate (2.5-2.9), Severe (<2.5)</p><ul><li><b>Oral:</b> Preferred for K+ > 2.5 and asymptomatic. 40-100 mmol/day in divided doses.</li><li><b>IV (Peripheral):</b> Max Rate <b>10-20 mmol/hr</b>. Max Concentration <b>40 mmol/L</b>.</li><li><b>IV (Central):</b> Max Rate <b>20-40 mmol/hr</b>. Max Concentration <b>60 mmol/L</b>. Requires cardiac monitoring.</li><li><b>Rule of Thumb:</b> For every 10 mmol of KCl given, expect serum K+ to rise by ~0.1 mmol/L (this is highly variable).</li><li>🚨 <b>Always correct Hypomagnesemia first!</b></li></ul></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"investigations\" class=\"nm-card p-3 p-md-4 mb-3 tone-success avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-search text-success\"></i></span><span>Focused Investigations</span></div>\r\n      <ul class=\"mb-0\"><li><b>Bedside:</b> 12-lead ECG, Venous/Arterial Blood Gas (VBG/ABG).</li><li><b>Bloods:</b> Urea & Electrolytes (including Mg, Ca, PO4), Glucose, Creatinine, Full Blood Count.</li><li><b>Urine:</b> Spot urine for Na, K, Cl, Cr, Osmolality. Calculate Transtubular Potassium Gradient (TTKG) and Urine Anion Gap.</li><li><b>TTKG Formula:</b> (Urine K / Plasma K) / (Urine Osm / Plasma Osm). A TTKG > 7 suggests renal potassium wasting.</li><li><b>Urine Anion Gap Formula:</b> (Urine Na + Urine K) - Urine Cl. A negative value suggests GI bicarbonate loss (diarrhea); a positive value suggests renal tubular acidosis.</li><li><b>Specialist Tests:</b> Plasma Renin and Aldosterone, 24-hour urine cortisol or low-dose dexamethasone suppression test (for Cushing\'s), Thyroid Function Tests (for thyrotoxic periodic paralysis), urine diuretic screen.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"emergency\" class=\"emergency-section nm-card p-3 p-md-4 mb-3 tone-emphasis avoid-break safety-warning\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-triangle-fill\"></i></span><span>Emergency Algorithm</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'emergencyAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"emergencyAccordion\">\r\n        <div class=\"accordion-item\">\r\n          <h2 class=\"accordion-header\">\r\n            <button class=\"accordion-button\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#emergencyContent\" aria-expanded=\"true\" aria-controls=\"emergencyContent\">\r\n              Emergency Algorithm Steps\r\n            </button>\r\n          </h2>\r\n          <div id=\"emergencyContent\" class=\"accordion-collapse collapse show\" data-bs-parent=\"#emergencyAccordion\">\r\n            <div class=\"accordion-body\">\r\n              <div class=\"ascii-flow wrap\"><div class=\'emergency-box\'><h3 class=\'emergency-title\'>Management of Severe Hypokalemia (K+ &lt;2.5 mmol/L)</h3><pre class=\'ascii-art-box\'>Patient with severe weakness, ECG changes, or arrhythmia?\n | \n +--[ YES ]--> ABCDE, Call for help (Cardiology/ICU)\n | \n +--[ NO ]--> Hospitalize, Continuous Cardiac Monitoring\n \nIV Access (Central line preferred)\n |\nCheck Mg++, Ca++, PO4--. Replete Mg++ FIRST (e.g., 2g MgSO4 over 1 hr)\n |\nStart IV KCl infusion: 20-40 mmol/hr via central line\n |\nRecheck K+ and blood gas every 2 hours\n |\nOnce K+ > 3.0 mmol/L and stable:\n | \n +--> Switch to oral KCl supplementation\n +--> Investigate underlying cause</pre></div></div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"management\" class=\"management-section nm-card p-3 p-md-4 mb-3 tone-primary avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-list-check\"></i></span><span>Management Ladder â€” Hypokalemia</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Emergency Repletion & Stabilization</div>\r\n            <div class=\"fw-semibold\">Assess Severity & Cardiac Risk</div>\r\n            <ul class=\"mb-3\"><li>Triage immediately based on K+ level and clinical stability (arrhythmias, paralysis).</li><li>A K+ < 2.5 mmol/L is a medical emergency requiring hospitalization and cardiac monitoring.</li><li>Perform a 12-lead ECG on all symptomatic patients or those with K+ < 3.0 mmol/L.</li></ul>\r\n            <div class=\"fw-semibold\">Potassium & Magnesium Repletion</div>\r\n            <ul class=\"mb-0\"><li>⚠️ <b>Oral Repletion:</b> Preferred route for mild to moderate, asymptomatic hypokalemia (K+ 2.5-3.5 mmol/L). Use potassium chloride tablets or solution.</li><li>⚡ <b>Intravenous Repletion:</b> Indicated for severe hypokalemia (<2.5 mmol/L), symptomatic patients, or those unable to take oral replacement.</li><li><b>Peripheral IV Line:</b> Maximum concentration of 40 mmol/L. Maximum rate of 10-20 mmol/hour to avoid phlebitis.</li><li><b>Central IV Line:</b> Required for faster repletion. Maximum concentration up to 60 mmol/L. Maximum rate of 20-40 mmol/hour with continuous cardiac monitoring.</li><li><b>Magnesium First:</b> Always check and replete magnesium. Hypomagnesemia causes renal potassium wasting and makes hypokalemia refractory. Administer IV magnesium sulfate (e.g., 8-16 mmol over 1-2 hours) if levels are low.</li><li><b>Monitoring:</b> Re-check serum K+ every 2-4 hours during IV repletion until K+ is > 3.0 mmol/L and stable.</li></ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\">\r\n          <div class=\"border rounded p-3 h-100\">\r\n            <div class=\"fw-semibold mb-2\">Diagnostic Evaluation & Definitive Treatment</div>\r\n            <div class=\"fw-semibold\">Differentiate Cause using BP and Acid-Base</div>\r\n            <ul class=\"mb-3\"><li><b>Step 1 - Blood Pressure:</b> Is the patient hypertensive or normotensive?</li><li><b>Step 2 - Acid-Base Status:</b> Is there a metabolic acidosis or alkalosis?</li><li><b>Step 3 - Urine Studies:</b> Measure urine K+, Cl-, and calculate TTKG and urine anion gap to confirm renal vs extra-renal losses.</li></ul>\r\n            <div class=\"fw-semibold\">Treat Underlying Disorder</div>\r\n            <ul class=\"mb-0\"><li><b>GI Losses:</b> Treat underlying cause of vomiting/diarrhea. Replete volume and electrolytes.</li><li><b>Diuretic-induced:</b> Stop offending diuretic. Switch to a potassium-sparing diuretic if diuretic therapy is still needed.</li><li><b>Mineralocorticoid Excess:</b> For primary aldosteronism, use mineralocorticoid receptor antagonists (Spironolactone, Eplerenone) or adrenalectomy for adenoma.</li><li><b>Liddle\'s Syndrome:</b> Treat with Amiloride or Triamterene, which directly block the ENaC channel. Spironolactone is ineffective.</li><li><b>Bartter/Gitelman:</b> Lifelong potassium and magnesium supplementation. NSAIDs (Indomethacin) may be effective in Bartter syndrome.</li><li><b>Renal Tubular Acidosis:</b> Alkali therapy (potassium citrate or sodium bicarbonate) to correct acidosis, which will also help correct hypokalemia.</li></ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"small text-secondary mt-2\">Reassessment cadence and escalation criteria per KDIGO/local.</div>\r\n    </section>\r\n\r\n    <section id=\"pharmacology\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-capsule-pill text-danger\"></i></span><span>Therapeutics &amp; Pharmacology</span></div>\r\n      <div class=\"table-responsive\" data-optional-content>\r\n        <table class=\'table\'><thead><tr><th>Drug</th><th>Mechanism of Action</th><th>Dose</th><th>Key Monitoring/Side Effects</th></tr></thead><tbody><tr><td><b>Potassium Chloride (IV/PO)</b></td><td>Direct replacement of potassium and chloride</td><td>PO: 20-40 mmol 2-4 times/day. IV: See repletion guidelines.</td><td>Hyperkalemia, GI upset (PO), phlebitis (IV). Monitor serum K+ closely.</td></tr><tr><td><b>Potassium Citrate</b></td><td>Provides potassium and bicarbonate precursor (citrate)</td><td>10-20 mEq 2-3 times/day</td><td>Used for hypokalemia with metabolic acidosis (e.g., RTA). Less GI irritation than KCl.</td></tr><tr><td><b>Amiloride</b></td><td>Potassium-sparing diuretic; blocks ENaC in collecting duct</td><td>5-10 mg daily</td><td>Treatment for Liddle\'s Syndrome. Monitor for hyperkalemia, especially in CKD.</td></tr><tr><td><b>Spironolactone/ Eplerenone</b></td><td>Mineralocorticoid receptor antagonist</td><td>Spironolactone: 25-100 mg daily. Eplerenone: 25-50 mg daily.</td><td>Treatment for primary aldosteronism. Monitor for hyperkalemia. Spironolactone can cause gynecomastia.</td></tr><tr><td><b>Indomethacin</b></td><td>NSAID, reduces prostaglandin E2 production</td><td>25-50 mg TID</td><td>Used in Bartter syndrome to reduce polyuria and K+ wasting. Risk of NSAID-related nephrotoxicity.</td></tr></tbody></table>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"topic-blocks\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-grid-3x3-gap-fill text-info\"></i></span><span>Topic-Specific Blocks</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">ECG Manifestations of Hypokalemia</div><ul class=\"mb-0\"><li><b>T-wave flattening or inversion:</b> One of the earliest signs.</li><li><b>Prominent U-wave:</b> A positive deflection after the T-wave, best seen in precordial leads V2-V4. A U-wave taller than the T-wave is highly suggestive.</li><li><b>ST-segment depression:</b> Widespread ST depression may be seen.</li><li><b>Prolonged QT interval:</b> The apparent QT prolongation is often due to fusion of the T-wave and U-wave (long QU interval). This increases the risk of Torsades de Pointes.</li><li><b>Arrhythmias:</b> Increased risk of both atrial (AF, atrial flutter) and ventricular (VT, VF) arrhythmias, particularly in patients with underlying heart disease or on digoxin.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Pathophysiology and Treatment of Liddle\'s Syndrome</div><ul class=\"mb-0\"><li><b>Pathophysiology:</b> Liddle\'s syndrome is a rare, autosomal dominant genetic disorder caused by a gain-of-function mutation in the genes encoding the subunits of the epithelial sodium channel (ENaC) in the distal nephron.</li><li>This mutation leads to excessive sodium reabsorption and potassium secretion, independent of aldosterone.</li><li>Clinically, it mimics primary hyperaldosteronism, presenting with early-onset hypertension, hypokalemic metabolic alkalosis, but with characteristically <b>low plasma renin and aldosterone</b> levels.</li><li><b>Treatment:</b> The cornerstone of treatment is blockade of the overactive ENaC. <b>Amiloride</b> (5-20 mg/day) or <b>Triamterene</b> (100-200 mg/day) are the drugs of choice.</li><li>Mineralocorticoid receptor antagonists like <b>Spironolactone are ineffective</b> as the channel\'s activity is aldosterone-independent.</li><li>A low sodium diet is also a crucial part of management.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Differentiating Renal Tubular Acidosis (RTA)</div><ul class=\"mb-0\"><li><b>Distal (Type 1) RTA:</b> Defect in H+ secretion in the collecting duct. Leads to hypokalemia, metabolic acidosis, and an inability to acidify urine (urine pH always > 5.5). Associated with a positive urine anion gap and high risk for calcium phosphate kidney stones.</li><li><b>Proximal (Type 2) RTA:</b> Defect in HCO3- reabsorption in the proximal tubule. Leads to hypokalemia and metabolic acidosis. Initially, urine is alkaline, but once serum HCO3- drops below the reabsorptive threshold (~15-18 mmol/L), the distal nephron can acidify the urine (urine pH can be < 5.5). Often associated with other features of Fanconi syndrome.</li><li><b>Type 4 RTA:</b> Caused by aldosterone deficiency or resistance. This is the only RTA that causes <b>hyperkalemia</b>, not hypokalemia. It is associated with a mild, non-anion gap metabolic acidosis and an impaired renal response to acid load, but urine pH can still be acidic (<5.5).</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"quality-metrics\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-graph-up-arrow text-success\"></i></span><span>Quality Metrics &amp; Audit Points</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Process</div><ul class=\"mb-0\"><li>✅ Regular monitoring of serum potassium and magnesium during acute repletion.</li><li>✅ Ensuring a 12-lead ECG is performed for all patients with K+ < 3.0 mmol/L.</li><li>✅ Documentation of a clear diagnostic plan based on BP and acid-base status.</li><li>✅ Appropriate use of urine electrolytes to guide differential diagnosis before extensive endocrine testing.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Outcome</div><ul class=\"mb-0\"><li>🎯 Safe correction of serum potassium to >3.0 mmol/L within 6-12 hours for severe cases.</li><li>🎯 Prevention of iatrogenic hyperkalemia during repletion.</li><li>🎯 Identification and treatment of the underlying cause to prevent recurrence.</li><li>🎯 Resolution of ECG abnormalities and symptoms.</li></ul></div></div>\r\n        <div class=\"col-md-4\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold\">Safety</div><ul class=\"mb-0\"><li>⚠️ Adherence to maximum infusion rates and concentrations for IV potassium.</li><li>⚠️ Use of a central line for rapid potassium correction to avoid peripheral vein sclerosis.</li><li>⚠️ Continuous cardiac monitoring during high-rate IV potassium infusion.</li><li>⚠️ Recognition that failure to correct hypokalemia should prompt immediate measurement of serum magnesium.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"safety-leadership\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-shield-check text-info\"></i></span><span>Systems, Safety, Leadership</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-info\">Safety Criticals</div>\r\n            <ul class=\"mb-0 safety-list\" data-optional-content>\r\n              <li>🚨 <b>Never</b> administer undiluted IV potassium as a bolus.</li><li>🚨 Ensure IV potassium infusions are clearly labeled and run through an infusion pump.</li><li>🚨 Be cautious with potassium repletion in patients with any degree of renal impairment.</li><li>🚨 Recognize that a patient with diabetic ketoacidosis and a \'normal\' potassium level has a significant total body potassium deficit and will require aggressive repletion as insulin therapy is initiated.</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        <div class=\"col-md-6\" data-optional-section>\r\n          <div class=\"border rounded p-3 h-100 bg-white shadow-sm\">\r\n            <div class=\"fw-semibold mb-2 text-primary\">Communication Pearls</div>\r\n            <ul class=\"mb-0 communication-list\" data-optional-content>\r\n              <li>🗣️ Explain the importance of cardiac monitoring and frequent blood tests to the patient.</li><li>🗣️ Clearly communicate the plan for potassium repletion, including rates and routes, with the nursing staff.</li><li>🗣️ Counsel patients on dietary sources of potassium and symptoms of hypokalemia upon discharge.</li><li>🗣️ If a genetic cause is identified (e.g., Liddle\'s, Bartter\'s, Gitelman\'s), arrange for genetic counseling for the patient and their family.</li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"cases\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-collection text-primary\"></i></span><span>Case Scenarios (progressive disclosure)</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'cases\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"casesAccordion\"><div class=\'accordion\' id=\'case_scenarios_accordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case1\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case1\' aria-expanded=\'false\' aria-controls=\'collapse_case1\'>Case 1: 17 y/o Male with Weakness</button></h2><div id=\'collapse_case1\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case1\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 17-year-old male presents with profound muscle weakness. BP is 110/70 mmHg. VBG shows pH 7.50, HCO3 32, K+ 2.4 mmol/L. Urine studies: UCl > 40 mmol/L, UCa < 2.0 mmol/24h. Serum Mg is 0.5 mmol/L. <b>Diagnosis: Gitelman Syndrome.</b> The combination of normotension, metabolic alkalosis, hypomagnesemia, and hypocalciuria is classic.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case2\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case2\' aria-expanded=\'false\' aria-controls=\'collapse_case2\'>Case 2: 45 y/o Female with Hypertension</button></h2><div id=\'collapse_case2\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case2\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 45-year-old female is found to have a BP of 165/100 mmHg and a serum K+ of 2.9 mmol/L on routine bloods. She is asymptomatic. VBG shows pH 7.48, HCO3 30. Renin is suppressed, and aldosterone is elevated. <b>Diagnosis: Primary Aldosteronism (Conn\'s Syndrome).</b> The triad of hypertension, hypokalemia, and metabolic alkalosis with a low renin/high aldosterone profile confirms the diagnosis. An adrenal CT scan is the next step.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case3\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case3\' aria-expanded=\'false\' aria-controls=\'collapse_case3\'>Case 3: 15 y/o Male with Resistant Hypertension</button></h2><div id=\'collapse_case3\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case3\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 15-year-old male presents with hypertension (170/105 mmHg) that is resistant to multiple agents. His serum K+ is 3.1 mmol/L. Plasma renin and aldosterone levels are both suppressed. A trial of spironolactone has no effect, but amiloride normalizes his BP and potassium. <b>Diagnosis: Liddle\'s Syndrome.</b> The low renin, low aldosterone state in the face of hypertension and hypokalemia is the key clue. The response to amiloride (an ENaC blocker) but not spironolactone (an MR antagonist) is diagnostic.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case4\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case4\' aria-expanded=\'false\' aria-controls=\'collapse_case4\'>Case 4: 18 y/o with Cardiac Arrest</button></h2><div id=\'collapse_case4\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case4\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>An 18-year-old male collapses at home. Paramedics find him in ventricular fibrillation. After resuscitation, his initial blood gas shows a potassium of 1.7 mmol/L. ECG shows widespread ST depression and prominent U-waves. His thyroid function tests are normal. His parents report similar, milder episodes of weakness after large carbohydrate meals. <b>Diagnosis: Likely Familial Hypokalemic Periodic Paralysis.</b> This is a diagnosis of exclusion after ruling out other causes like thyrotoxicosis. The history of episodic weakness triggered by specific events is suggestive of this channelopathy.</div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'heading_case5\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#collapse_case5\' aria-expanded=\'false\' aria-controls=\'collapse_case5\'>Case 5: 30 y/o Female with Weakness and Acidosis</button></h2><div id=\'collapse_case5\' class=\'accordion-collapse collapse\' aria-labelledby=\'heading_case5\' data-bs-parent=\'#case_scenarios_accordion\'><div class=\'accordion-body\'>A 30-year-old female presents with generalized weakness. BP is 105/65 mmHg. VBG shows pH 7.25, HCO3 14, K+ 2.8 mmol/L. Urine pH is 6.5. Urine anion gap is +25. An abdominal X-ray reveals bilateral nephrocalcinosis. <b>Diagnosis: Distal (Type 1) Renal Tubular Acidosis.</b> The combination of hypokalemia, non-anion gap metabolic acidosis, an inappropriately high urine pH (>5.5), and a positive urine anion gap confirms distal RTA. Nephrocalcinosis is a common complication.</div></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"viva\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-2\">\r\n        <div class=\"section-title\"><span class=\"icon-circle\"><i class=\"bi bi-chat-dots-fill text-secondary\"></i></span><span>Mock Viva Bank</span></div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'vivaAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\"accordion\" id=\"vivaAccordion\"><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah0\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac0\" aria-expanded=\"false\" aria-controls=\"vivac0\">What is the maximum safe rate of intravenous potassium infusion through a peripheral line?</button></h2><div id=\"vivac0\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>The maximum recommended rate is generally 10-20 mmol per hour, with a maximum concentration of 40 mmol/L to prevent phlebitis and pain. Faster rates require a central line and cardiac monitoring.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah1\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac1\" aria-expanded=\"false\" aria-controls=\"vivac1\">Why is it critical to measure and correct serum magnesium in a patient with hypokalemia?</button></h2><div id=\"vivac1\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Magnesium is a cofactor for the Na+/K+-ATPase pump and is crucial for the function of the ROMK potassium channel in the kidney. Hypomagnesemia leads to increased renal potassium excretion via ROMK, making it impossible to correct potassium levels until magnesium is repleted.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah2\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac2\" aria-expanded=\"false\" aria-controls=\"vivac2\">A patient has hypertension, hypokalemia, and metabolic alkalosis. What is the first and most important blood test to differentiate the causes?</button></h2><div id=\"vivac2\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>A paired plasma renin activity (or concentration) and plasma aldosterone concentration. The ratio and absolute values will differentiate primary aldosteronism (low renin, high aldo) from renovascular hypertension (high renin, high aldo) and other rarer causes like Liddle&#039;s syndrome (low renin, low aldo).</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah3\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac3\" aria-expanded=\"false\" aria-controls=\"vivac3\">Describe the classic ECG changes of hypokalemia.</button></h2><div id=\"vivac3\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>T-wave flattening or inversion, ST-segment depression, a prominent U-wave (which can merge with the T-wave causing apparent QT prolongation), and an increased risk of both atrial and ventricular arrhythmias.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah4\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac4\" aria-expanded=\"false\" aria-controls=\"vivac4\">What is the pathophysiology of Liddle&#039;s syndrome?</button></h2><div id=\"vivac4\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Liddle&#039;s syndrome is an autosomal dominant disorder caused by a gain-of-function mutation in the epithelial sodium channel (ENaC) in the collecting duct. This leads to excessive, aldosterone-independent sodium reabsorption and potassium secretion, resulting in hypertension and hypokalemia with suppressed renin and aldosterone.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah5\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac5\" aria-expanded=\"false\" aria-controls=\"vivac5\">How do you treat Liddle&#039;s syndrome, and why is spironolactone ineffective?</button></h2><div id=\"vivac5\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>Liddle&#039;s is treated with direct ENaC blockers like amiloride or triamterene. Spironolactone is a mineralocorticoid receptor antagonist and is ineffective because the ENaC hyperactivity in Liddle&#039;s is independent of aldosterone stimulation.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah6\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac6\" aria-expanded=\"false\" aria-controls=\"vivac6\">A patient has hypokalemia and a non-anion gap metabolic acidosis. How does the urine anion gap help distinguish between diarrhea and RTA?</button></h2><div id=\"vivac6\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>The urine anion gap (UAG = UNa + UK - UCl) estimates ammonium excretion. In diarrhea, the kidneys compensate by increasing ammonium (NH4Cl) excretion, resulting in a high urine chloride and a negative UAG. In distal RTA, ammonium excretion is impaired, leading to a low urine chloride and a positive UAG.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah7\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac7\" aria-expanded=\"false\" aria-controls=\"vivac7\">What are the key features that distinguish Gitelman syndrome from Bartter syndrome?</button></h2><div id=\"vivac7\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>The key differentiator is urinary calcium excretion: Gitelman syndrome has low urinary calcium (hypocalciuria), whereas Bartter syndrome has high or normal urinary calcium (hypercalciuria). Additionally, hypomagnesemia is more pronounced and consistent in Gitelman syndrome, which also typically presents later in life than Bartter syndrome.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah8\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac8\" aria-expanded=\"false\" aria-controls=\"vivac8\">What is the Transtubular Potassium Gradient (TTKG) and how is it used?</button></h2><div id=\"vivac8\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>TTKG is an index of renal potassium secretion by the collecting duct. A TTKG &gt; 7-10 in the presence of hypokalemia suggests inappropriate renal potassium wasting. A TTKG &lt; 3 suggests appropriate renal potassium conservation, pointing to an extra-renal cause or transcellular shift.</p></div></div></div><div class=\"accordion-item\"><h2 class=\"accordion-header\" id=\"vivah9\"><button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#vivac9\" aria-expanded=\"false\" aria-controls=\"vivac9\">A patient with DKA presents with a serum K+ of 5.5 mmol/L. What does this imply about their total body potassium stores?</button></h2><div id=\"vivac9\" class=\"accordion-collapse collapse\" data-bs-parent=\"#viva\"><div class=\"accordion-body\"><p>It implies a significant total body potassium deficit. Insulin deficiency and hyperosmolarity in DKA cause a shift of potassium out of cells, artificially raising the serum level. As insulin and fluids are given, potassium will rapidly shift back into cells, unmasking the underlying deficit and potentially leading to severe hypokalemia if not aggressively replaced.</p></div></div></div></div>\r\n    </section>\r\n\r\n    <!-- Overflow Structure -->\r\n    <section id=\"additional-resources\" class=\"mt-4\">\r\n      <div class=\"d-flex align-items-center justify-content-between mb-3\">\r\n        <div class=\"section-title\">\r\n          <span class=\"icon-circle\">\r\n            <i class=\"bi bi-archive text-warning\"></i>\r\n          </span>\r\n          <span>Additional Resources & Extensions</span>\r\n        </div>\r\n        <div class=\"btn-group btn-group-sm print-hide\">\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', true)\">Expand all</button>\r\n          <button class=\"btn btn-outline-secondary\" onclick=\"toggleAccordion(\'extraInfoAccordion\', false)\">Collapse all</button>\r\n        </div>\r\n      </div>\r\n      <div class=\'accordion\' id=\'extraInfoAccordion\'><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extra_heading1\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra_collapse1\' aria-expanded=\'false\' aria-controls=\'extra_collapse1\'>Drug-Induced Hypokalemia</button></h2><div id=\'extra_collapse1\' class=\'accordion-collapse collapse\' aria-labelledby=\'extra_heading1\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><b>Diuretics:</b> Loop and thiazide diuretics are the most common cause.</li><li><b>Beta-2 Agonists (e.g., Salbutamol):</b> Cause transcellular shift of K+ into cells via Na/K ATPase stimulation.</li><li><b>Insulin:</b> Also causes transcellular shift.</li><li><b>Amphotericin B:</b> Causes renal tubular damage leading to potassium wasting.</li><li><b>High-dose Penicillins:</b> Act as a non-reabsorbable anion in the distal tubule, promoting potassium secretion.</li><li><b>Licorice (Glycyrrhizic acid):</b> Inhibits 11-beta-hydroxysteroid dehydrogenase, leading to apparent mineralocorticoid excess.</li></ul></div></div></div><div class=\'accordion-item\'><h2 class=\'accordion-header\' id=\'extra_heading2\'><button class=\'accordion-button collapsed\' type=\'button\' data-bs-toggle=\'collapse\' data-bs-target=\'#extra_collapse2\' aria-expanded=\'false\' aria-controls=\'extra_collapse2\'>Schema Omission Log</button></h2><div id=\'extra_collapse2\' class=\'accordion-collapse collapse\' aria-labelledby=\'extra_heading2\' data-bs-parent=\'#extraInfoAccordion\'><div class=\'accordion-body\'><ul><li><b>ADDITIONAL_SECTIONS_HTML:</b> Left blank as overflow content was suitable for the standard EXTRA_INFO_HTML structure.</li></ul></div></div></div></div>\r\n    </section>\r\n\r\n    <section id=\"pitfalls\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-exclamation-octagon-fill text-danger\"></i></span><span>Common Pitfalls</span></div>\r\n      <ul class=\"mb-0\"><li>❌ Forgetting to check and replete magnesium, leading to refractory hypokalemia.</li><li>❌ Administering potassium in dextrose-containing fluids, which can stimulate insulin release and transiently worsen hypokalemia.</li><li>❌ Overly rapid IV correction leading to hyperkalemia and cardiac arrest.</li><li>❌ Failing to investigate the underlying cause, leading to recurrent episodes.</li><li>❌ Misinterpreting the TTKG in patients with low urine osmolality (<300 mOsm/kg) or low distal sodium delivery.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"teaching-points\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-mortarboard-fill text-primary\"></i></span><span>Teaching Points (for juniors)</span></div>\r\n      <div class=\"row g-3\">\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Key concepts</div><ul class=\"mb-0\"><li>The physiological relationship between blood pressure, the renin-angiotensin-aldosterone system, and potassium homeostasis.</li><li>The stepwise diagnostic approach to hypokalemia: assess K+ level -> assess BP -> assess acid-base -> assess urine electrolytes.</li><li>The pharmacology of diuretics and their distinct effects on different parts of the nephron, which are mirrored by inherited tubulopathies (Bartter ~ Loop, Gitelman ~ Thiazide).</li><li>The importance of magnesium as the \'gatekeeper\' of potassium homeostasis.</li><li>The interpretation of urine electrolytes (chloride, anion gap, TTKG) as functional tests of tubular physiology.</li></ul></div></div>\r\n        <div class=\"col-md-6\"><div class=\"border rounded p-3 h-100\"><div class=\"fw-semibold mb-2\">Common mistakes</div><ul class=\"mb-0\"><li>Failing to correct hypomagnesemia before or during potassium repletion.</li><li>Prescribing dextrose-containing fluids for IV potassium replacement.</li><li>Delaying ECG and cardiac monitoring in moderate-to-severe hypokalemia.</li><li>Not considering diuretic abuse in a patient with unexplained hypokalemic metabolic alkalosis and high urine chloride.</li><li>Diagnosing Liddle\'s syndrome as primary aldosteronism without checking renin and aldosterone levels.</li></ul></div></div>\r\n      </div>\r\n    </section>\r\n\r\n    <section id=\"answer-structure\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-card-text text-secondary\"></i></span><span>Answer Structure Card (8 steps)</span></div>\r\n      <ol class=\"mb-0\"><li>This is a case of severe, symptomatic hypokalemia, presenting as cardiac arrest with a potassium of 1.7 mmol/L in a young adult.</li><li>My immediate priority is resuscitation following the ABCDE algorithm. I will ensure continuous cardiac monitoring and secure IV access.</li><li>I will immediately obtain a 12-lead ECG to look for signs of hypokalemia such as T-wave flattening, prominent U waves, and ST depression, and to rule out any life-threatening arrhythmias.</li><li>Simultaneously, I will obtain an urgent venous blood gas to confirm the potassium level and assess the acid-base status, which is critical for the differential diagnosis.</li><li>I will commence IV potassium repletion with potassium chloride. Given the severity, I would use a central line if available, infusing at a rate no greater than 40 mmol/hour, with a maximum concentration of 60 mmol/L. I will also check and correct the serum magnesium level concurrently, as hypomagnesemia makes hypokalemia refractory to treatment.</li><li>Once the patient is stabilized, I will proceed with a diagnostic workup. I will take a detailed history focusing on medications like diuretics, GI losses such as vomiting or diarrhea, and any family history of similar episodes.</li><li>My physical examination will focus on assessing the patient\'s volume and blood pressure status, which categorizes the causes into hypertensive and normotensive groups.</li><li>The acid-base status is the next key differentiator. I will classify the cause based on whether there is a metabolic acidosis or alkalosis.</li><li>For a normotensive patient with metabolic alkalosis, the differential includes diuretic abuse, vomiting, Bartter, or Gitelman syndrome. I will assess urinary chloride; a low value (<20 mmol/L) suggests extra-renal losses like vomiting, while a high value suggests a renal cause.</li><li>To differentiate between Bartter and Gitelman syndromes, I will check urinary calcium. High urinary calcium is typical of Bartter syndrome, while Gitelman syndrome is characterized by hypocalciuria.</li><li>If the patient presents with hypertension and metabolic alkalosis, I will investigate for mineralocorticoid excess states like primary aldosteronism or Liddle\'s syndrome by measuring plasma renin and aldosterone levels.</li><li>If metabolic acidosis is present, the differential includes diarrhea or renal tubular acidosis (RTA). A urine anion gap will help differentiate: a negative gap suggests diarrhea, while a positive gap points towards RTA.</li></ol>\r\n    </section>\r\n\r\n    <section id=\"concept-diagram\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\" data-optional-section>\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3 text-primary\"></i></span><span>Concept Diagram &amp; Visuals</span></div>\r\n      <div class=\"concept-diagram\" data-optional-content>\r\n        <div style=\'font-family: sans-serif; text-align: center;\'><h4>Tubular Defects in Hypokalemic Syndromes</h4><div style=\'display: flex; justify-content: space-around; align-items: flex-start; margin-top: 20px;\'><div style=\'border: 2px solid #cce5ff; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #004085;\'>Bartter Syndrome</h5><p><b>Location:</b> Thick Ascending Limb</p><p><b>Defect:</b> Na-K-2Cl (NKCC2) or associated channels (ROMK, ClC-Kb)</p><p><b>Result:</b> Salt wasting, mimicking a loop diuretic. Leads to <b>hypercalciuria</b>.</p></div><div style=\'border: 2px solid #d4edda; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #155724;\'>Gitelman Syndrome</h5><p><b>Location:</b> Distal Convoluted Tubule</p><p><b>Defect:</b> Na-Cl Cotransporter (NCC)</p><p><b>Result:</b> Salt wasting, mimicking a thiazide diuretic. Leads to <b>hypocalciuria</b> and <b>hypomagnesemia</b>.</p></div><div style=\'border: 2px solid #f8d7da; padding: 10px; border-radius: 8px; width: 30%;\'><h5 style=\'color: #721c24;\'>Liddle\'s Syndrome</h5><p><b>Location:</b> Collecting Duct</p><p><b>Defect:</b> Epithelial Na+ Channel (ENaC) - Gain of function</p><p><b>Result:</b> Excessive Na+ reabsorption, mimicking hyperaldosteronism. Leads to <b>hypertension</b>.</p></div></div></div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n    <section id=\"flowchart\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-diagram-3-fill text-info\"></i></span><span>ASCII Flowchart</span></div>\r\n      <div class=\"ascii-flow no-wrap\"> START: Serum K+ < 3.5 mmol/L\n    |\n    +--> Assess Blood Pressure\n           |\n           +--[ HYPERTENSION ]------------------------------------------------+\n           |    |\n           |    +--> Check Plasma Renin & Aldosterone                       |\n           |         |\n           |         +--[ Low Renin, High Aldo ]--> Primary Aldosteronism   |\n           |         |\n           |         +--[ Low Renin, Low Aldo ]--> Liddle\'s or AME         |\n           |         |\n           |         +--[ High Renin, High Aldo ]--> Renovascular HTN       |\n           |\n           +--[ NORMAL/LOW BP ]---------------------------------------------+\n                |\n                +--> Assess Acid-Base Status\n                       |\n                       +--[ METABOLIC ACIDOSIS ]--> Check Urine Anion Gap\n                       |    |\n                       |    +--[ Negative UAG ]--> Diarrhea\n                       |    |\n                       |    +--[ Positive UAG ]--> Renal Tubular Acidosis (Type 1 or 2)\n                       |\n                       +--[ METABOLIC ALKALOSIS ]--> Check Urine Chloride\n                            |\n                            +--[ Urine Cl- < 20 ]--> Vomiting / GI Loss\n                            |\n                            +--[ Urine Cl- > 40 ]--> Diuretic Abuse / Bartter / Gitelman\n                                 |\n                                 +--> Check Urine Calcium\n                                      |\n                                      +--[ High Ca++ ]--> Bartter Syndrome\n                                      |\n                                      +--[ Low Ca++ ]--> Gitelman Syndrome\n</div>\r\n    </section>\r\n\r\n    <section id=\"evidence\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-journal-text text-primary\"></i></span><span>Evidence Summary &amp; Key Studies</span></div>\r\n      <ul class=\"mb-2\"><li><b>Physiological studies by Giebisch and others:</b> Foundational research elucidating the mechanisms of potassium transport in the renal tubules.</li><li><b>Clinical case series and genetic studies:</b> Reports that first described and identified the mutations for Liddle\'s, Bartter\'s, and Gitelman\'s syndromes.</li><li><b>Observational studies on ECG changes:</b> Correlated specific ECG abnormalities with varying degrees of hypokalemia.</li><li><b>Clinical trials on potassium binders (e.g., patiromer, SZC):</b> While primarily for hyperkalemia, these studies provide insights into potassium homeostasis and management.</li></ul>\r\n      <ul class=\"mb-0\"><li><b>KDIGO Clinical Practice Guidelines for Acute Kidney Injury (2012):</b> While not specific to hypokalemia, it provides recommendations on managing electrolyte disturbances in the context of AKI.</li><li><b>American Heart Association (AHA) Guidelines for CPR and Emergency Cardiovascular Care:</b> Include protocols for managing cardiac arrest due to electrolyte abnormalities, including hypokalemia.</li><li>Most recommendations for hypokalemia management are based on established physiological principles and expert consensus rather than large-scale randomized controlled trials.</li></ul>\r\n    </section>\r\n\r\n    <section id=\"guidelines\" class=\"nm-card p-3 p-md-4 mb-3 avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-bookmarks-fill text-warning\"></i></span><span>Guideline Anchors</span></div>\r\n      <ul class=\"mb-0\"><li><b>European Resuscitation Council Guidelines:</b> Section on peri-arrest arrhythmias and electrolyte abnormalities.</li><li><b>UpToDate and other clinical decision support tools:</b> Synthesize evidence and provide expert-authored recommendations on the diagnosis and management of hypokalemia.</li></ul>\r\n    </section>\r\n\r\n    <!-- Additional content injected by AI assistant or user edits -->\r\n    <section id=\"additional\" class=\"nm-card p-3 p-md-4 mb-3 tone-light avoid-break\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-stars text-primary\"></i></span><span>Additional Sections</span></div>\r\n      <div id=\"additionalContent\"></div>\r\n    </section>\r\n\r\n    <section id=\"aiChat\" class=\"nm-card p-3 p-md-4 mb-3 tone-info avoid-break print-hide\">\r\n      <div class=\"section-title mb-2\"><span class=\"icon-circle\"><i class=\"bi bi-robot text-info\"></i></span><span>AI Chat Assistant â€” Interactive Support</span></div>\r\n      <div class=\"border rounded p-3\">\r\n        <div id=\"aiChatApp\" class=\"ai-chat small\">\r\n          <div class=\'border rounded p-2 mb-2 bg-white\'>\r\n            <div id=\'aiStatus\' class=\'small\'></div>\r\n          </div>\r\n          <div id=\'aiLogWrap\' class=\'border rounded p-2\'>\r\n            <div id=\'aiLog\' class=\'d-flex flex-column gap-2\'></div>\r\n          </div>\r\n          <div class=\'input-group input-group-sm mt-2\'>\r\n            <input id=\'aiInput\' class=\'form-control\' placeholder=\'Ask about this topic...\'/>\r\n            <button id=\'aiSend\' class=\'btn btn-primary\' type=\'button\'>Send</button>\r\n            <button id=\'aiClear\' class=\'btn btn-outline-secondary\' type=\'button\'>Clear</button>\r\n          </div>\r\n          <div class=\'form-text mt-1\'>Configured in template. For privacy, avoid embedding production tokens in public exports.</div>\r\n        </div>\r\n      </div>\r\n    </section>\r\n\r\n\r\n\r\n  </main>\r\n\r\n  <script>\r\n    console.log(\'Template script starting...\');\r\n    console.log(\'Document ready state:\', document.readyState);\r\n    console.log(\'Window loaded:\', typeof window !== \'undefined\');\r\n    \r\n\r\n    // Configure DeepSeek AI API here (edit this file)\r\n    // Get your API key from: https://platform.deepseek.com\r\n    const DEEPSEEK_BASE = \'https://api.deepseek.com/v1\';\r\n    const DEEPSEEK_MODEL = \'deepseek-chat\';\r\n    const DEEPSEEK_TOKEN = \'sk-d8774fcd926c4bcc8d4b88d67fd68f74\'; // Add your DeepSeek API key here\r\n    const searchInput = document.getElementById(\'searchInput\');\r\n    function clearHighlights(){ document.querySelectorAll(\'mark.search-highlight\').forEach(m=>{ const p=m.parentNode; p.replaceChild(document.createTextNode(m.textContent), m); p.normalize(); }); }\r\n    function doSearch(q){ clearHighlights(); if(!q) return; const walker=document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT, { acceptNode:(n)=>{ if(!n.parentElement||[\'SCRIPT\',\'STYLE\',\'INPUT\',\'TEXTAREA\'].includes(n.parentElement.tagName)) return NodeFilter.FILTER_REJECT; const t=n.nodeValue.trim(); return t&&t.toLowerCase().includes(q.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP; } }); const matches=[]; while(walker.nextNode()) matches.push(walker.currentNode); matches.forEach(n=>{ const span=document.createElement(\'span\'); const idx=n.nodeValue.toLowerCase().indexOf(q.toLowerCase()); const before=n.nodeValue.slice(0,idx); const mid=n.nodeValue.slice(idx, idx+q.length); const after=n.nodeValue.slice(idx+q.length); span.innerHTML=`${before}<mark class=\"search-highlight\">${mid}</mark>${after}`; n.parentNode.replaceChild(span,n); }); }\r\n    if (searchInput) { searchInput.addEventListener(\'input\',(e)=>{ const q=e.target.value.trim(); doSearch(q); }); }\r\n    window.addEventListener(\'keydown\',(e)=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()===\'f\'){ e.preventDefault(); if(searchInput){ searchInput.focus(); searchInput.select(); } }});\r\n    function toggleAccordion(id, expand){\r\n      const root = document.getElementById(id);\r\n      if (!root) return;\r\n      root.querySelectorAll(\'.accordion-collapse\').forEach(el=>{\r\n        if (expand) el.classList.add(\'show\'); else el.classList.remove(\'show\');\r\n      });\r\n      root.querySelectorAll(\'.accordion-button\').forEach(btn=>{\r\n        if (expand) btn.classList.remove(\'collapsed\'); else btn.classList.add(\'collapsed\');\r\n        btn.setAttribute(\'aria-expanded\', expand ? \'true\' : \'false\');\r\n      });\r\n    }\r\n\r\n    // Readability enhancements: bold leading labels ending with \':\' and accent key comparators\r\n    function enhanceReadability(){\r\n      const scope = document.querySelector(\'main\');\r\n      if (!scope) return;\r\n      const targets = scope.querySelectorAll(\'li, p, td\');\r\n      targets.forEach(el => {\r\n        // Bold leading label before the first colon\r\n        const html = el.innerHTML;\r\n        if (!html) return;\r\n        // Only if text starts immediately (avoid when starts with tag)\r\n        if (!/^\\s*[<]/.test(html)){\r\n          el.innerHTML = html.replace(/^(\\s*)([^:<]{1,60}?):\\s+/, (m, s, label) => `${s}<strong class=\"label-strong\">${label}:</strong> `);\r\n        } else {\r\n          // If starts with a tag, try to find first text node child\r\n          const firstChild = el.firstChild;\r\n          if (firstChild && firstChild.nodeType === Node.TEXT_NODE){\r\n            const txt = firstChild.nodeValue;\r\n            const m = txt.match(/^(\\s*)([^:<]{1,60}?):\\s+/);\r\n            if (m){\r\n              const rest = txt.slice(m.length);\r\n              const strong = document.createElement(\'strong\');\r\n              strong.className = \'label-strong\';\r\n              strong.textContent = m + \':\';\r\n              const prefix = document.createTextNode(m || \'\');\r\n              el.insertBefore(prefix, firstChild);\r\n              el.insertBefore(strong, firstChild);\r\n              firstChild.nodeValue = \' \' + rest;\r\n            }\r\n          }\r\n        }\r\n        // Accent comparators â‰¤ â‰¥ < >\r\n        Array.from(el.childNodes).forEach(node => {\r\n          if (node.nodeType === Node.TEXT_NODE){\r\n            const frag = document.createElement(\'span\');\r\n            const parts = node.nodeValue.split(/(â‰¤|â‰¥|<|>)/);\r\n            if (parts.length > 1){\r\n              parts.forEach(part =>{\r\n                if (/^(â‰¤|â‰¥|<|>)$/.test(part)){\r\n                  const b = document.createElement(\'span\');\r\n                  b.className = \'accent\';\r\n                  b.textContent = part;\r\n                  frag.appendChild(b);\r\n                } else {\r\n                  frag.appendChild(document.createTextNode(part));\r\n                }\r\n              });\r\n              el.replaceChild(frag, node);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    document.addEventListener(\'DOMContentLoaded\', enhanceReadability);\r\n\r\n    // Auto-convert Emergency Algorithm content to accordions when it contains <strong> tags\r\n    function convertEmergencyToAccordions() {\r\n      const emergencyContent = document.getElementById(\'emergencyContent\');\r\n      if (!emergencyContent) return;\r\n      \r\n      const content = emergencyContent.innerHTML;\r\n      \r\n      // Check if content contains <strong> tags that could be accordion headers\r\n      const strongPattern = /<strong[^>]*>([^<]+)<\\/strong>/g;\r\n      const strongMatches = [...content.matchAll(strongPattern)];\r\n      \r\n      // If we have multiple <strong> tags, convert to accordions\r\n      if (strongMatches.length > 1) {\r\n        console.log(\'Converting Emergency Algorithm to accordions...\');\r\n        \r\n        // Clear the existing content and replace with new accordion structure\r\n        emergencyContent.innerHTML = \'\';\r\n        \r\n        // Process each <li> element that contains <strong> tags\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = content;\r\n        \r\n        const listItems = tempDiv.querySelectorAll(\'li\');\r\n        let accordionCount = 0;\r\n        \r\n        listItems.forEach((li, index) => {\r\n          const strongElement = li.querySelector(\'strong\');\r\n          if (strongElement) {\r\n            // Extract the header text (remove the <strong> tags)\r\n            const headerText = strongElement.textContent;\r\n            \r\n            // Get the content after the <strong> tag\r\n            const contentAfterStrong = li.innerHTML.replace(/<strong[^>]*>.*?<\\/strong>/, \'\').trim();\r\n            \r\n            if (contentAfterStrong) {\r\n              const accordionId = `emergencyAccordion${accordionCount}`;\r\n              accordionCount++;\r\n              \r\n              const accordionItem = document.createElement(\'div\');\r\n              accordionItem.className = \'accordion-item\';\r\n              accordionItem.innerHTML = `\r\n                <h2 class=\"accordion-header\">\r\n                  <button class=\"accordion-button collapsed\" type=\"button\" data-bs-toggle=\"collapse\" data-bs-target=\"#${accordionId}\" aria-expanded=\"false\" aria-controls=\"${accordionId}\">\r\n                    ${headerText}\r\n                  </button>\r\n                </h2>\r\n                <div id=\"${accordionId}\" class=\"accordion-collapse collapse\" data-bs-parent=\"#emergencyAccordion\">\r\n                  <div class=\"accordion-body\">\r\n                    ${contentAfterStrong}\r\n                  </div>\r\n                </div>\r\n              `;\r\n              \r\n              emergencyContent.appendChild(accordionItem);\r\n            }\r\n          } else {\r\n            // If no <strong> tag, just add the content as-is\r\n            const contentDiv = document.createElement(\'div\');\r\n            contentDiv.innerHTML = li.innerHTML;\r\n            emergencyContent.appendChild(contentDiv);\r\n          }\r\n        });\r\n        \r\n        // Update the toggle buttons to work with the new structure\r\n        const expandBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"true\"]\');\r\n        const collapseBtn = document.querySelector(\'button[onclick*=\"emergencyAccordion\"][onclick*=\"false\"]\');\r\n        \r\n        if (expandBtn) {\r\n          expandBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', true);\r\n        }\r\n        if (collapseBtn) {\r\n          collapseBtn.onclick = () => toggleAccordion(\'emergencyAccordion\', false);\r\n        }\r\n        \r\n        console.log(`Created ${accordionCount} accordion items for Emergency Algorithm`);\r\n      }\r\n    }\r\n    \r\n    // Run the conversion when DOM is loaded\r\n    document.addEventListener(\'DOMContentLoaded\', convertEmergencyToAccordions);\r\n\r\n    // Lightweight AI chat â€” DeepSeek AI API (browser)\r\n    (function initAiChat(){\r\n      console.log(\'AI Chat initialization starting...\');\r\n      console.log(\'Document ready state in AI Chat:\', document.readyState);\r\n\r\n      console.log(\'AI Chat initialization started\');\r\n      const root = document.getElementById(\'aiChatApp\');\r\n      console.log(\'AI Chat root element:\', root);\r\n      if (!root) {\r\n        console.log(\'AI Chat root element not found, returning\');\r\n        return;\r\n      }\r\n      const statusEl = document.getElementById(\'aiStatus\');\r\n      const logEl = document.getElementById(\'aiLog\');\r\n      const inputEl = document.getElementById(\'aiInput\');\r\n      const sendBtn = document.getElementById(\'aiSend\');\r\n      const clearBtn = document.getElementById(\'aiClear\');\r\n\r\n      console.log(\'AI Chat elements found:\');\r\n      console.log(\'- statusEl:\', statusEl);\r\n      console.log(\'- logEl:\', logEl);\r\n      console.log(\'- inputEl:\', inputEl);\r\n      console.log(\'- sendBtn:\', sendBtn);\r\n      console.log(\'- clearBtn:\', clearBtn);\r\n\r\n      if (statusEl) statusEl.innerHTML = `Base: <code>${DEEPSEEK_BASE}</code> â€¢ Model: <code>${DEEPSEEK_MODEL}</code> â€¢ Token: <code>${DEEPSEEK_TOKEN ? \'set\' : \'not set\'}</code> (edit in template)`;\r\n      if (!logEl || !inputEl || !sendBtn || !clearBtn){\r\n        console.log(\'AI Chat UI init failed: controls missing\');\r\n        if (statusEl) statusEl.textContent += \' â€¢ UI init failed: controls missing\';\r\n        return;\r\n      }\r\n\r\n      // Test API connection on load\r\n      async function testConnection(){\r\n        if (!DEEPSEEK_TOKEN) return;\r\n        try {\r\n          const testRes = await fetch(DEEPSEEK_BASE.replace(/\\/$/, \'\') + \'/models\', {\r\n            headers: { \'Authorization\': \'Bearer \' + DEEPSEEK_TOKEN }\r\n          });\r\n          if (testRes.ok) {\r\n            console.log(\'API connection test: OK\');\r\n          } else {\r\n            console.log(\'API connection test failed:\', testRes.status);\r\n            if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:orange\">API test failed</span>\';\r\n          }\r\n        } catch(e) {\r\n          console.log(\'API connection test error:\', e);\r\n          if (statusEl) statusEl.innerHTML += \' â€¢ <span style=\"color:red\">Connection error</span>\';\r\n        }\r\n      }\r\n      testConnection();\r\n\r\n      const messages = [\r\n        { role:\'system\', content:`You are a nephrology viva coach. Provide comprehensive, well-formatted answers using markdown. Use tables, bullet points, and headings for clarity. Include specific thresholds, diagnostic criteria, and clinical values. Topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}.` }\r\n      ];\r\n      function append(role, text){\r\n        const d = document.createElement(\'div\');\r\n        d.className = role===\'user\' ? \'p-2 rounded bg-primary-subtle\' : \'p-2 rounded bg-light ai-message\';\r\n        \r\n        if (role === \'assistant\') {\r\n          // Make assistant messages relative positioned for copy button\r\n          d.style.position = \'relative\';\r\n          \r\n          // Store original text for copying\r\n          d.setAttribute(\'data-original-text\', text);\r\n          \r\n          // Add copy button for assistant messages\r\n          const copyBtn = document.createElement(\'button\');\r\n          copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n          copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n          copyBtn.title = \'Copy response\';\r\n          copyBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 8px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.7;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          \r\n          copyBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              // Get the rendered HTML content (for pasting into the WYSIWYG editor)\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              \r\n              // Use clipboard API to write both HTML and plain text\r\n              if (navigator.clipboard && navigator.clipboard.write) {\r\n                await navigator.clipboard.write([\r\n                  new ClipboardItem({\r\n                    \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                    \'text/plain\': new Blob([text], { type: \'text/plain\' })\r\n                  })\r\n                ]);\r\n              } else {\r\n                // Fallback to plain text if rich clipboard isn\'t supported\r\n                await navigator.clipboard.writeText(renderedHTML);\r\n              }\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied formatted content!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            } catch (err) {\r\n              console.error(\'Failed to copy formatted content: \', err);\r\n              // Fallback for older browsers - copy as HTML in a textarea\r\n              const textArea = document.createElement(\'textarea\');\r\n              const renderedHTML = d.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n              textArea.value = renderedHTML;\r\n              document.body.appendChild(textArea);\r\n              textArea.select();\r\n              document.execCommand(\'copy\');\r\n              document.body.removeChild(textArea);\r\n              \r\n              copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n              copyBtn.classList.remove(\'btn-outline-secondary\');\r\n              copyBtn.classList.add(\'btn-success\');\r\n              copyBtn.title = \'Copied as HTML!\';\r\n              setTimeout(() => {\r\n                copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                copyBtn.classList.remove(\'btn-success\');\r\n                copyBtn.classList.add(\'btn-outline-secondary\');\r\n                copyBtn.title = \'Copy response\';\r\n              }, 1500);\r\n            }\r\n          });\r\n          \r\n          // Show copy button on hover\r\n          d.addEventListener(\'mouseenter\', () => {\r\n            copyBtn.style.opacity = \'1\';\r\n          });\r\n          d.addEventListener(\'mouseleave\', () => {\r\n            copyBtn.style.opacity = \'0.7\';\r\n          });\r\n          \r\n          if (typeof marked !== \'undefined\') {\r\n            // Render markdown for assistant messages\r\n            try {\r\n              d.innerHTML = marked.parse(text);\r\n            } catch(e) {\r\n              console.log(\'Markdown parsing failed:\', e);\r\n              d.innerText = text;\r\n            }\r\n          } else {\r\n            d.innerText = text;\r\n          }\r\n          \r\n          // Insert button to add response into page and request save\r\n          const insertBtn = document.createElement(\'button\');\r\n          insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n          insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n          insertBtn.title = \'Insert into page and save JSON\';\r\n          insertBtn.style.cssText = `\r\n            position: absolute;\r\n            top: 8px;\r\n            right: 44px;\r\n            padding: 4px 8px;\r\n            font-size: 12px;\r\n            border-radius: 4px;\r\n            opacity: 0.85;\r\n            transition: opacity 0.2s ease;\r\n            z-index: 10;\r\n          `;\r\n          insertBtn.addEventListener(\'click\', async () => {\r\n            try {\r\n              const container = document.getElementById(\'additionalContent\');\r\n              const renderedHTML = d.innerHTML\r\n                .replace(copyBtn.outerHTML, \'\')\r\n                .replace(insertBtn.outerHTML, \'\')\r\n                .trim();\r\n              const block = document.createElement(\'div\');\r\n              block.className = \'border rounded p-3 mb-2 bg-white\';\r\n              block.innerHTML = renderedHTML;\r\n              if (container) container.appendChild(block);\r\n\r\n              // Notify parent renderer (if open) to persist into JSON\r\n              try {\r\n                const msg = { type: \'NM_INSERT_ADDITIONAL_SECTION\', html: block.outerHTML };\r\n                if (window.parent) window.parent.postMessage(msg, \'*\');\r\n              } catch(e){ /* ignore cross-origin */ }\r\n\r\n              insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n              insertBtn.classList.remove(\'btn-outline-primary\');\r\n              insertBtn.classList.add(\'btn-success\');\r\n              insertBtn.title = \'Inserted! Saved if connected to project.\';\r\n              setTimeout(() => {\r\n                insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                insertBtn.classList.remove(\'btn-success\');\r\n                insertBtn.classList.add(\'btn-outline-primary\');\r\n                insertBtn.title = \'Insert into page and save JSON\';\r\n              }, 1500);\r\n            } catch(err){ console.error(\'Insert failed:\', err); }\r\n          });\r\n\r\n          // Append action buttons\r\n          d.appendChild(insertBtn);\r\n          d.appendChild(copyBtn);\r\n        } else {\r\n          d.innerText = text;\r\n        }\r\n        \r\n        logEl.appendChild(d); \r\n        logEl.scrollTop = logEl.scrollHeight;\r\n        return d;\r\n      }\r\n      function getContextText(){\r\n        // Extract visible text from key sections; trim to ~4000 chars\r\n        const sel = [\r\n          \'header .fw-bold\',\r\n          \'section .fw-semibold\',\r\n          \'section ul\',\r\n          \'section .ascii-flow\'\r\n        ];\r\n        const texts = [];\r\n        sel.forEach(s=> document.querySelectorAll(s).forEach(el=>{ texts.push(el.innerText.trim()); }));\r\n        let ctx = texts.join(\'\\n\\n\');\r\n        if (ctx.length > 4000) ctx = ctx.slice(0, 4000) + \'\\n...\';\r\n        return ctx;\r\n      }\r\n      async function send(retryCount = 0){\r\n        console.log(\'Send function called with retryCount:\', retryCount);\r\n        const q = inputEl.value.trim();\r\n        console.log(\'Input value:\', JSON.stringify(q));\r\n        if(!q) {\r\n          console.log(\'Input is empty, returning\');\r\n          return;\r\n        }\r\n        append(\'user\', q); inputEl.value=\'\';\r\n        const model = DEEPSEEK_MODEL; const key = DEEPSEEK_TOKEN; const base = DEEPSEEK_BASE.replace(/\\/$/, \'\');\r\n                  if (!model || !key){ append(\'assistant\', \'DeepSeek model/token not set. Edit in template.\'); return; }\r\n        try{\r\n          sendBtn.disabled = true;\r\n          const statusMsg = append(\'assistant\', \'Contacting model...\');\r\n          const system = `You are a nephrology viva coach specializing in making complex medical concepts easy to study and remember. Your primary goal is to help students prepare for nephrology viva exams by providing answers that are:\r\n\r\n**STUDY-FRIENDLY FORMAT:**\r\n1. **Clear Structure**: Always start with a brief overview, then break down into digestible sections\r\n2. **Visual Learning**: Use tables, charts, and diagrams whenever possible\r\n3. **Memory Aids**: Include mnemonics, acronyms, and memory tricks\r\n4. **Clinical Relevance**: Connect everything to real clinical scenarios\r\n5. **Viva Focus**: Structure answers as you would explain them in a viva exam\r\n\r\n**REQUIRED ELEMENTS IN EVERY ANSWER:**\r\n- **ðŸ“Š Tables**: For classifications, criteria, drug dosing, lab values\r\n- **ðŸŽ¯ Mnemonics**: Create memorable acronyms for lists and processes\r\n- **ðŸ“ˆ Charts/Diagrams**: Use ASCII art or structured text for flowcharts\r\n- **ðŸ’¡ Key Points**: Highlight the most important facts to remember\r\n- **ðŸ¥ Clinical Pearls**: Include practical tips and common pitfalls\r\n- **ðŸ”— Topic Connection**: Always relate back to the current topic: ${document.title.replace(\'Nephromap! â€” \',\'\').replace(\' Viva\',\'\')}\r\n\r\n**FORMATTING GUIDELINES:**\r\n- Use markdown tables for structured data\r\n- Create ASCII flowcharts using characters like: â”Œâ”€â” â”œâ”€â”¤ â””â”€â”˜ â”‚\r\n- Use emojis and symbols to make content memorable\r\n- Include \"Viva Tips\" sections with examiner\'s likely questions\r\n- Add \"Memory Hooks\" for difficult concepts\r\n- Use color-coding suggestions (ðŸ”´ Red for critical, ðŸŸ¡ Yellow for important, ðŸŸ¢ Green for normal)\r\n\r\n**EXAMPLE STRUCTURE:**\r\n1. **Quick Overview** (2-3 sentences)\r\n2. **ðŸ“Š Classification Table** (if applicable)\r\n3. **ðŸŽ¯ Key Mnemonics** (memory aids)\r\n4. **ðŸ“ˆ Step-by-Step Process** (flowchart or numbered list)\r\n5. **ðŸ’¡ Clinical Pearls** (practical tips)\r\n6. **ðŸ¥ Viva Tips** (common exam questions)\r\n7. **ðŸ”— Connection to [Current Topic]**\r\n\r\n**SPECIAL INSTRUCTIONS:**\r\n- Keep explanations concise but comprehensive\r\n- Use analogies and real-world examples\r\n- Include normal ranges and critical values\r\n- Mention common mistakes and how to avoid them\r\n- Always end with a summary of key takeaway points\r\n\r\nRemember: Your goal is to make complex nephrology concepts stick in the student\'s memory through clear structure, visual aids, and memorable mnemonics.`;\r\n          const context = getContextText();\r\n          \r\n          console.log(\'Sending request to:\', base + \'/chat/completions\');\r\n          console.log(\'Model:\', model);\r\n          console.log(\'Request body:\', JSON.stringify({\r\n            model,\r\n            stream: false,\r\n            messages: [\r\n              { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n              { role:\'user\', content: q }\r\n            ],\r\n            max_tokens: 2048,\r\n            temperature: 0.1\r\n          }, null, 2));\r\n          \r\n          // Use non-streaming response\r\n          let res = await fetch(base + \'/chat/completions\', {\r\n            method: \'POST\',\r\n            headers:{ \'Content-Type\':\'application/json\', \'Authorization\':\'Bearer \' + key },\r\n            body: JSON.stringify({\r\n              model,\r\n              stream: false,\r\n              messages: [\r\n                { role:\'system\', content: system + `\\nContext:\\n` + context },\r\n                { role:\'user\', content: q }\r\n              ],\r\n              max_tokens: 2048,\r\n              temperature: 0.1\r\n            })\r\n          });\r\n          \r\n          // Remove the \"Contacting model...\" message\r\n          try {\r\n            if (statusMsg && statusMsg.parentNode === logEl) {\r\n              logEl.removeChild(statusMsg);\r\n            }\r\n          } catch(e) {\r\n            console.log(\'Could not remove status message:\', e);\r\n          }\r\n          \r\n          console.log(\'Response status:\', res.status);\r\n          console.log(\'Response headers:\', res.headers);\r\n          console.log(\'Content-Type:\', res.headers.get(\'content-type\'));\r\n          console.log(\'Transfer-Encoding:\', res.headers.get(\'transfer-encoding\'));\r\n          \r\n          if(!res.ok){\r\n            let errorMsg = \'\';\r\n            try{ \r\n              const errorText = await res.text(); \r\n              errorMsg = errorText;\r\n              console.log(\'Error response:\', errorText);\r\n            }catch(e){ console.log(\'Failed to read error:\', e); }\r\n            \r\n            // Retry once on 429 or 503 errors\r\n            if ((res.status === 429 || res.status === 503) && retryCount === 0) {\r\n              console.log(\'Retrying request...\');\r\n              setTimeout(() => send(1), 2000);\r\n              return;\r\n            }\r\n            \r\n            append(\'assistant\', `Error ${res.status}: ${res.statusText}${errorMsg ? \'\\nDetails: \' + errorMsg.slice(0, 200) : \'\'}`);\r\n            return;\r\n          }\r\n          \r\n          // Handle non-streaming response\r\n          console.log(\'Processing non-streaming response...\');\r\n          \r\n          const responseData = await res.json();\r\n          console.log(\'Response data:\', responseData);\r\n          console.log(\'Choices array:\', responseData.choices);\r\n                               // Try to get the message from the correct structure\r\n          const choice = responseData.choices && responseData.choices;\r\n          const choiceObj = choice && (choice[\'0\'] || choice || choice);\r\n          const message = choiceObj && choiceObj.message;\r\n          \r\n          if (message && message.content) {\r\n            const content = message.content;\r\n            console.log(\'Content received:\', content);\r\n            \r\n            // Create response message\r\n            const responseMessage = document.createElement(\'div\');\r\n            responseMessage.className = \'p-2 rounded bg-light ai-message\';\r\n            responseMessage.style.position = \'relative\';\r\n            \r\n            // Update the message with content\r\n            if (typeof marked !== \'undefined\') {\r\n              try {\r\n                responseMessage.innerHTML = marked.parse(content);\r\n              } catch(e) {\r\n                console.log(\'Markdown parsing failed:\', e);\r\n                responseMessage.innerText = content;\r\n              }\r\n            } else {\r\n              responseMessage.innerText = content;\r\n            }\r\n            \r\n            // Set the final text for buttons\r\n            responseMessage.setAttribute(\'data-original-text\', content);\r\n            \r\n            // Add to log\r\n            logEl.appendChild(responseMessage);\r\n            logEl.scrollTop = logEl.scrollHeight;\r\n            \r\n            // Add action buttons\r\n            const copyBtn = document.createElement(\'button\');\r\n            copyBtn.className = \'btn btn-outline-secondary btn-sm copy-response-btn\';\r\n            copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n            copyBtn.title = \'Copy response\';\r\n            copyBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 8px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.7;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n            copyBtn.addEventListener(\'click\', async () => {\r\n              try {\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                \r\n                if (navigator.clipboard && navigator.clipboard.write) {\r\n                  await navigator.clipboard.write([\r\n                    new ClipboardItem({\r\n                      \'text/html\': new Blob([renderedHTML], { type: \'text/html\' }),\r\n                      \'text/plain\': new Blob([content], { type: \'text/plain\' })\r\n                    })\r\n                  ]);\r\n              } else {\r\n                  await navigator.clipboard.writeText(renderedHTML);\r\n                }\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                copyBtn.title = \'Copied formatted content!\';\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                  copyBtn.title = \'Copy response\';\r\n                }, 1500);\r\n              } catch (err) {\r\n                console.error(\'Failed to copy formatted content: \', err);\r\n                const textArea = document.createElement(\'textarea\');\r\n                const renderedHTML = responseMessage.innerHTML.replace(copyBtn.outerHTML, \'\').trim();\r\n                textArea.value = renderedHTML;\r\n                document.body.appendChild(textArea);\r\n                textArea.select();\r\n                document.execCommand(\'copy\');\r\n                document.body.removeChild(textArea);\r\n                \r\n                copyBtn.innerHTML = \'<i class=\"bi bi-check\"></i>\';\r\n                copyBtn.classList.remove(\'btn-outline-secondary\');\r\n                copyBtn.classList.add(\'btn-success\');\r\n                setTimeout(() => {\r\n                  copyBtn.innerHTML = \'<i class=\"bi bi-clipboard\"></i>\';\r\n                  copyBtn.classList.remove(\'btn-success\');\r\n                  copyBtn.classList.add(\'btn-outline-secondary\');\r\n                }, 1500);\r\n              }\r\n            });\r\n            \r\n            // Add insert button\r\n            const insertBtn = document.createElement(\'button\');\r\n            insertBtn.className = \'btn btn-outline-primary btn-sm copy-response-btn\';\r\n            insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n            insertBtn.title = \'Insert into page and save JSON\';\r\n            insertBtn.style.cssText = `\r\n              position: absolute;\r\n              top: 8px;\r\n              right: 44px;\r\n              padding: 4px 8px;\r\n              font-size: 12px;\r\n              border-radius: 4px;\r\n              opacity: 0.85;\r\n              transition: opacity 0.2s ease;\r\n              z-index: 10;\r\n            `;\r\n            \r\n                         insertBtn.addEventListener(\'click\', async () => {\r\n               try {\r\n                 // Create a unique section ID\r\n                 const timestamp = Date.now();\r\n                 const sectionId = `extra-note-${timestamp}`;\r\n                 \r\n                 console.log(\'Insert button clicked\');\r\n                 console.log(\'Response message HTML:\', responseMessage.innerHTML);\r\n                 console.log(\'Copy button HTML:\', copyBtn.outerHTML);\r\n                 console.log(\'Insert button HTML:\', insertBtn.outerHTML);\r\n                 \r\n                 // Get the rendered HTML content (without the buttons)\r\n                 const renderedHTML = responseMessage.innerHTML\r\n                   .replace(copyBtn.outerHTML, \'\')\r\n                   .replace(insertBtn.outerHTML, \'\')\r\n                   .trim();\r\n                 \r\n                 console.log(\'Extracted rendered HTML:\', renderedHTML);\r\n                 console.log(\'HTML length:\', renderedHTML.length);\r\n                 \r\n                 // Find the Additional Sections container\r\n                 const additionalContentDiv = document.getElementById(\'additionalContent\');\r\n                 \r\n                 if (additionalContentDiv) {\r\n                   // Create the new section\r\n                   const newSection = document.createElement(\'section\');\r\n                   newSection.id = sectionId;\r\n                   newSection.className = \'additional-note p-3 p-md-4 mb-4 avoid-break\';\r\n                   newSection.style.position = \'relative\';\r\n                   newSection.innerHTML = `\r\n                     <div class=\"section-title\">\r\n                       <span class=\"icon-circle\"><i class=\"bi bi-sticky-fill\"></i></span>\r\n                       <span>Study Note #${Math.floor(timestamp / 1000)}</span>\r\n                     </div>\r\n                     <div class=\"content-container\">\r\n                       ${renderedHTML}\r\n                     </div>\r\n                   `;\r\n                   \r\n                   // Add to the Additional Sections container\r\n                   additionalContentDiv.appendChild(newSection);\r\n                   \r\n                   \r\n                   // Scroll to the new section\r\n                   newSection.scrollIntoView({ behavior: \'smooth\', block: \'start\' });\r\n                   \r\n                   // Update button to show success\r\n                   insertBtn.innerHTML = \'<i class=\"bi bi-check-square\"></i>\';\r\n                   insertBtn.classList.remove(\'btn-outline-primary\');\r\n                   insertBtn.classList.add(\'btn-success\');\r\n                   insertBtn.title = \'Content inserted! Use Save button to persist changes.\';\r\n                   \r\n                   // Show a helpful message\r\n                   const statusEl = document.getElementById(\'aiStatus\');\r\n                   if (statusEl) {\r\n                     statusEl.innerHTML = \'<span class=\"text-success\"><i class=\"bi bi-check-circle\"></i> Content added to page. Use the Save button to persist changes.</span>\';\r\n                     setTimeout(() => {\r\n                       statusEl.innerHTML = \'<span class=\"text-muted\">Ready</span>\';\r\n                     }, 3000);\r\n                   }\r\n                   \r\n                   setTimeout(() => {\r\n                     insertBtn.innerHTML = \'<i class=\"bi bi-plus-square\"></i>\';\r\n                     insertBtn.classList.remove(\'btn-success\');\r\n                     insertBtn.classList.add(\'btn-outline-primary\');\r\n                     insertBtn.title = \'Insert into page\';\r\n                   }, 2000);\r\n                 } else {\r\n                   console.error(\'Could not find Additional Sections container\');\r\n                 }\r\n               } catch(err) { \r\n                 console.error(\'Insert failed:\', err); \r\n                 alert(\'Failed to insert content. Please try again.\');\r\n               }\r\n             });\r\n            \r\n            // Append action buttons\r\n            responseMessage.appendChild(insertBtn);\r\n            responseMessage.appendChild(copyBtn);\r\n            \r\n            // Show copy button on hover\r\n            responseMessage.addEventListener(\'mouseenter\', () => {\r\n              copyBtn.style.opacity = \'1\';\r\n              insertBtn.style.opacity = \'1\';\r\n            });\r\n            responseMessage.addEventListener(\'mouseleave\', () => {\r\n              copyBtn.style.opacity = \'0.7\';\r\n              insertBtn.style.opacity = \'0.85\';\r\n            });\r\n          } else {\r\n            console.log(\'No content in response:\', responseData);\r\n            append(\'assistant\', \'(No content received from API.)\');\r\n          }\r\n        }catch(e){ \r\n          console.error(e); \r\n          // Retry once on network errors\r\n          if (retryCount === 0) {\r\n            console.log(\'Retrying due to network error...\');\r\n            setTimeout(() => send(1), 2000);\r\n            return;\r\n          }\r\n          append(\'assistant\', \'Request failed. Check CORS and network. Error: \' + e.message); \r\n        }\r\n        finally{ sendBtn.disabled = false; }\r\n      }\r\n      // Event listeners\r\n      console.log(\'Adding AI Chat event listeners...\');\r\n\r\n      // Simple test click handler\r\n      if (sendBtn) {\r\n        console.log(\'Setting up send button click handler\');\r\n        sendBtn.addEventListener(\'click\', function(e) {\r\n          console.log(\'Send button basic click handler triggered\');\r\n          console.log(\'Event target:\', e.target);\r\n          console.log(\'Button disabled:\', sendBtn.disabled);\r\n          send();\r\n        });\r\n      } else {\r\n        console.log(\'ERROR: sendBtn is null!\');\r\n      }\r\n      inputEl && inputEl.addEventListener(\'keydown\', (e)=>{ if(e.key===\'Enter\'&&!e.shiftKey){ e.preventDefault(); console.log(\'Enter key pressed!\'); send(); }});\r\n      clearBtn && clearBtn.addEventListener(\'click\', ()=>{ \r\n        logEl.innerHTML=\'\'; \r\n        messages.length=1; \r\n      });\r\n      console.log(\'AI Chat event listeners added successfully\');\r\n    })();\r\n\r\n    // In-page navigation functionality\r\n    (function initNavigation(){\r\n      // Smooth scrolling for navigation links\r\n      document.querySelectorAll(\'#pageNav a[href^=\"#\"]\').forEach(link => {\r\n        link.addEventListener(\'click\', function(e) {\r\n          e.preventDefault();\r\n          const targetId = this.getAttribute(\'href\').substring(1);\r\n          const targetElement = document.getElementById(targetId);\r\n          if (targetElement) {\r\n            targetElement.scrollIntoView({ \r\n              behavior: \'smooth\',\r\n              block: \'start\'\r\n            });\r\n            // Update active state\r\n            updateActiveNavItem(this);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Scroll to top functionality\r\n      const scrollToTopBtn = document.getElementById(\'scrollToTop\');\r\n      if (scrollToTopBtn) {\r\n        scrollToTopBtn.addEventListener(\'click\', () => {\r\n          window.scrollTo({ top: 0, behavior: \'smooth\' });\r\n          updateActiveNavItem(null);\r\n        });\r\n      }\r\n\r\n      // Update active navigation item\r\n      function updateActiveNavItem(activeLink) {\r\n        document.querySelectorAll(\'#pageNav a\').forEach(link => {\r\n          link.classList.remove(\'active\');\r\n          if (link.classList.contains(\'btn-primary\')) {\r\n            link.classList.remove(\'btn-primary\');\r\n            link.classList.add(\'btn-outline-primary\');\r\n          }\r\n        });\r\n        if (activeLink) {\r\n          activeLink.classList.add(\'active\');\r\n          activeLink.classList.remove(\'btn-outline-primary\');\r\n          activeLink.classList.add(\'btn-primary\');\r\n        }\r\n      }\r\n\r\n      // Auto-highlight navigation based on scroll position\r\n      let ticking = false;\r\n      function updateNavOnScroll() {\r\n        if (!ticking) {\r\n          requestAnimationFrame(() => {\r\n            const sections = [\'overview\', \'priorities\', \'diagnosis\', \'investigations\', \'emergency\', \'management\', \'cases\', \'viva\', \'aiChat\'];\r\n            let currentSection = \'\';\r\n            \r\n            sections.forEach(sectionId => {\r\n              const element = document.getElementById(sectionId);\r\n              if (element) {\r\n                const rect = element.getBoundingClientRect();\r\n                if (rect.top <= 100 && rect.bottom >= 100) {\r\n                  currentSection = sectionId;\r\n                }\r\n              }\r\n            });\r\n\r\n            if (currentSection) {\r\n              const activeLink = document.querySelector(`#pageNav a[href=\"#${currentSection}\"]`);\r\n              updateActiveNavItem(activeLink);\r\n            }\r\n            \r\n            ticking = false;\r\n          });\r\n          ticking = true;\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\'scroll\', updateNavOnScroll);\r\n    })();\r\n\r\n    // ================== EXPORT FUNCTIONALITY ==================\r\n    \r\n    // Export functionality for vivatemplate\r\n    function getVivaTitle() {\r\n      const titleEl = document.querySelector(\'title\');\r\n      if (titleEl) {\r\n        return titleEl.textContent.replace(/[^a-zA-Z0-9\\s-]/g, \'\').trim();\r\n      }\r\n      return \'nephromap-viva-guide\';\r\n    }\r\n    \r\n    // Export as HTML\r\n    function exportVivaAsHTML() {\r\n      const content = document.documentElement.outerHTML;\r\n      const filename = `${getVivaTitle()}.html`;\r\n      const blob = new Blob([content], {type: \'text/html\'});\r\n      const a = document.createElement(\'a\');\r\n      a.href = URL.createObjectURL(blob);\r\n      a.download = filename;\r\n      a.click();\r\n      URL.revokeObjectURL(a.href);\r\n      showVivaExportNotification(\'HTML file exported successfully!\', \'success\');\r\n    }\r\n    \r\n    // Export as PDF\r\n    // =============================================================================\r\n    // PDF EXPORT FUNCTION - CUSTOMIZE THESE SETTINGS FOR YOUR NEEDS\r\n    // =============================================================================\r\n    async function exportVivaAsPDF() {\r\n      try {\r\n        showVivaExportNotification(\'Generating PDF...\', \'info\');\r\n        \r\n        // Check if jsPDF is available\r\n        if (!window.jspdf) {\r\n          throw new Error(\'PDF library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        // Hide export buttons during capture\r\n        const exportBtns = document.querySelectorAll(\'.print-hide\');\r\n        exportBtns.forEach(btn => btn.style.display = \'none\');\r\n        \r\n        // Store original styles\r\n        const originalStyles = {\r\n          bodyWidth: document.body.style.width,\r\n          bodyMaxWidth: document.body.style.maxWidth,\r\n          containerMaxWidth: [],\r\n          containerWidth: []\r\n        };\r\n        \r\n        // Get all containers and store their original styles\r\n        const containers = document.querySelectorAll(\'.container, .container-fluid\');\r\n        containers.forEach((container, index) => {\r\n          originalStyles.containerMaxWidth[index] = container.style.maxWidth;\r\n          originalStyles.containerWidth[index] = container.style.width;\r\n        });\r\n        \r\n        // =============================================================================\r\n        // PDF CONTENT SIZE SETTINGS - ADJUST THESE VALUES\r\n        // =============================================================================\r\n        \r\n        // Page size settings\r\n        const PDF_SETTINGS = {\r\n          // Page format: \'a4\', \'letter\', \'legal\', or custom [width, height] in mm\r\n          pageFormat: \'A4\',                    // â† CHANGE PAGE SIZE HERE\r\n          \r\n          // Page orientation: \'portrait\' or \'landscape\'\r\n          orientation: \'portrait\',             // â† CHANGE ORIENTATION HERE\r\n          \r\n          // Content width in pixels - Set to A4 width for full-page usage\r\n          contentWidth: 794,                   // â† A4 width in pixels (794px = 210mm)\r\n          \r\n          // Side margins in pixels (reduced for full-width usage)\r\n          sideMargins: 10,                     // â† ADJUST SIDE MARGINS HERE\r\n          \r\n          // Canvas scale factor (higher = better quality, larger file)\r\n          canvasScale: 2,                      // â† ADJUST QUALITY HERE (1-3)\r\n          \r\n          // ASCII flowchart font size for PDF\r\n          asciiFontSize: \'10px\',               // â† ADJUST ASCII TEXT SIZE HERE\r\n          \r\n          // ASCII flowchart line height\r\n          asciiLineHeight: \'1.2\',              // â† ADJUST ASCII LINE SPACING HERE\r\n          \r\n          // ASCII flowchart padding\r\n          asciiPadding: \'10px\',                // â† ADJUST ASCII PADDING HERE\r\n        };\r\n        \r\n        // Set full width styles for PDF capture\r\n        document.body.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n        document.body.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n        \r\n        containers.forEach(container => {\r\n          container.style.maxWidth = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.width = PDF_SETTINGS.contentWidth + \'px\';\r\n          container.style.padding = PDF_SETTINGS.sideMargins + \'px\';\r\n          container.style.margin = \'0 auto\';\r\n        });\r\n        \r\n        // Handle ASCII flowcharts specifically\r\n        const asciiFlows = document.querySelectorAll(\'.ascii-flow\');\r\n        const originalAsciiStyles = [];\r\n        asciiFlows.forEach((ascii, index) => {\r\n          originalAsciiStyles[index] = {\r\n            fontSize: ascii.style.fontSize,\r\n            lineHeight: ascii.style.lineHeight,\r\n            whiteSpace: ascii.style.whiteSpace,\r\n            wordBreak: ascii.style.wordBreak,\r\n            maxWidth: ascii.style.maxWidth,\r\n            padding: ascii.style.padding\r\n          };\r\n          \r\n          // Apply PDF-optimized ASCII styles using settings\r\n          ascii.style.fontSize = PDF_SETTINGS.asciiFontSize;\r\n          ascii.style.lineHeight = PDF_SETTINGS.asciiLineHeight;\r\n          ascii.style.whiteSpace = \'pre-wrap\';\r\n          ascii.style.wordBreak = \'break-all\';\r\n          ascii.style.maxWidth = \'100%\';\r\n          ascii.style.padding = PDF_SETTINGS.asciiPadding;\r\n          ascii.style.boxSizing = \'border-box\';\r\n        });\r\n        \r\n        // Force layout recalculation\r\n        document.body.offsetHeight;\r\n        \r\n        // Create canvas from content using settings\r\n        const canvas = await html2canvas(content, {\r\n          scale: PDF_SETTINGS.canvasScale,           // â† QUALITY SETTING\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\',\r\n          width: PDF_SETTINGS.contentWidth,          // â† CONTENT WIDTH\r\n          windowWidth: PDF_SETTINGS.contentWidth,    // â† WINDOW WIDTH\r\n          scrollX: 0,\r\n          scrollY: 0\r\n        });\r\n        \r\n        // Restore original styles\r\n        exportBtns.forEach(btn => btn.style.display = \'\');\r\n        document.body.style.width = originalStyles.bodyWidth;\r\n        document.body.style.maxWidth = originalStyles.bodyMaxWidth;\r\n        \r\n        containers.forEach((container, index) => {\r\n          container.style.maxWidth = originalStyles.containerMaxWidth[index];\r\n          container.style.width = originalStyles.containerWidth[index];\r\n          container.style.padding = \'\';\r\n          container.style.margin = \'\';\r\n        });\r\n        \r\n        // Restore ASCII flowchart styles\r\n        asciiFlows.forEach((ascii, index) => {\r\n          if (originalAsciiStyles[index]) {\r\n            ascii.style.fontSize = originalAsciiStyles[index].fontSize;\r\n            ascii.style.lineHeight = originalAsciiStyles[index].lineHeight;\r\n            ascii.style.whiteSpace = originalAsciiStyles[index].whiteSpace;\r\n            ascii.style.wordBreak = originalAsciiStyles[index].wordBreak;\r\n            ascii.style.maxWidth = originalAsciiStyles[index].maxWidth;\r\n            ascii.style.padding = originalAsciiStyles[index].padding;\r\n            ascii.style.boxSizing = \'\';\r\n          }\r\n        });\r\n        \r\n        const imgData = canvas.toDataURL(\'image/png\');\r\n        const { jsPDF } = window.jspdf;\r\n        \r\n        // Create PDF with customizable settings\r\n        const pdf = new jsPDF({\r\n          orientation: PDF_SETTINGS.orientation,      // â† ORIENTATION SETTING\r\n          unit: \'mm\',\r\n          format: PDF_SETTINGS.pageFormat             // â† PAGE FORMAT SETTING\r\n        });\r\n        \r\n        const pdfWidth = pdf.internal.pageSize.getWidth();\r\n        const pdfHeight = pdf.internal.pageSize.getHeight();  \r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        \r\n        // Use full width of A4, calculate height proportionally\r\n        const finalWidth = pdfWidth;\r\n        const finalHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        \r\n        // Handle multi-page PDF if content is too long\r\n        if (finalHeight > pdfHeight) {\r\n          const totalPages = Math.ceil(finalHeight / pdfHeight);\r\n          for (let page = 0; page < totalPages; page++) {\r\n            if (page > 0) pdf.addPage();\r\n            const yOffset = -page * pdfHeight;\r\n            // Draw the same image, shifting it upward each page so it fills full width\r\n            pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n          }\r\n        } else {\r\n          // Content fits on one page - use full width, center vertically\r\n          const yOffset = Math.max(0, (pdfHeight - finalHeight) / 2);\r\n          pdf.addImage(imgData, \'PNG\', 0, yOffset, finalWidth, finalHeight);\r\n        }\r\n        \r\n        pdf.save(`${getVivaTitle()}.pdf`);\r\n        showVivaExportNotification(\'PDF exported successfully!\', \'success\');\r\n      } catch (error) {\r\n        console.error(\'PDF export failed:\', error);\r\n        showVivaExportNotification(\'PDF export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Export as Image\r\n    async function exportVivaAsImage() {\r\n      try {\r\n        showVivaExportNotification(\'Generating image...\', \'info\');\r\n        \r\n        // Check if html2canvas is available\r\n        if (!window.html2canvas) {\r\n          throw new Error(\'Image capture library not loaded. Please refresh the page and try again.\');\r\n        }\r\n        \r\n        const content = document.body;\r\n        \r\n        const canvas = await html2canvas(content, {\r\n          scale: 2,\r\n          useCORS: true,\r\n          allowTaint: true,\r\n          backgroundColor: \'#ffffff\'\r\n        });\r\n        \r\n        canvas.toBlob((blob) => {\r\n          const a = document.createElement(\'a\');\r\n          a.href = URL.createObjectURL(blob);\r\n          a.download = `${getVivaTitle()}.png`;\r\n          a.click();\r\n          URL.revokeObjectURL(a.href);\r\n          showVivaExportNotification(\'Image exported successfully!\', \'success\');\r\n        }, \'image/png\');\r\n        \r\n      } catch (error) {\r\n        console.error(\'Image export failed:\', error);\r\n        showVivaExportNotification(\'Image export failed. Please try again.\', \'error\');\r\n      }\r\n    }\r\n    \r\n    // Print function\r\n    function printVivaContent() {\r\n      window.print();\r\n      showVivaExportNotification(\'Print dialog opened!\', \'info\');\r\n    }\r\n    \r\n    // Add print footer function\r\n    function addPrintFooter() {\r\n      // Check if footer already exists\r\n      if (document.querySelector(\'.print-footer\')) {\r\n        return;\r\n      }\r\n      \r\n      const footer = document.createElement(\'div\');\r\n      footer.className = \'print-footer\';\r\n      footer.style.cssText = `\r\n        position: fixed;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        text-align: center;\r\n        font-size: 10px;\r\n        color: #666;\r\n        background: white;\r\n        padding: 5px;\r\n        border-top: 1px solid #ccc;\r\n        display: none;\r\n      `;\r\n      \r\n      // Add print-specific styles\r\n      const style = document.createElement(\'style\');\r\n      style.textContent = `\r\n        @media print {\r\n          .print-footer {\r\n            display: block !important;\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n      \r\n      footer.innerHTML = `\r\n        <p>Generated from NephroApp - ${window.location.origin}</p>\r\n        <p>Page {page} of {pages}</p>\r\n      `;\r\n      \r\n      document.body.appendChild(footer);\r\n    }\r\n    \r\n    // Show export notification\r\n    function showVivaExportNotification(message, type = \'info\') {\r\n      // Create or update notification\r\n      let notification = document.getElementById(\'vivaExportNotification\');\r\n      if (!notification) {\r\n        notification = document.createElement(\'div\');\r\n        notification.id = \'vivaExportNotification\';\r\n        notification.style.cssText = `\r\n          position: fixed;\r\n          top: 80px;\r\n          right: 20px;\r\n          padding: 12px 20px;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          font-weight: 500;\r\n          z-index: 1060;\r\n          box-shadow: 0 4px 20px rgba(0,0,0,0.15);\r\n          opacity: 0;\r\n          transition: opacity 0.3s ease;\r\n          pointer-events: none;\r\n          max-width: 300px;\r\n        `;\r\n        document.body.appendChild(notification);\r\n      }\r\n      \r\n      // Set color based on type\r\n      const colors = {\r\n        success: \'background: #28a745; color: white;\',\r\n        error: \'background: #dc3545; color: white;\',\r\n        info: \'background: #007bff; color: white;\'\r\n      };\r\n      \r\n      notification.style.cssText += colors[type] || colors.info;\r\n      notification.textContent = message;\r\n      notification.style.opacity = \'1\';\r\n      \r\n      setTimeout(() => {\r\n        notification.style.opacity = \'0\';\r\n      }, 3000);\r\n    }\r\n    \r\n    function pruneOptionalSections() {\r\n      const optionalSections = document.querySelectorAll(\'[data-optional-section]\');\r\n      optionalSections.forEach(section => {\r\n        const contentNodes = section.querySelectorAll(\'[data-optional-content]\');\r\n        const blockNodes = section.querySelectorAll(\'[data-optional-block]\');\r\n        let hasContent = false;\r\n        contentNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        blockNodes.forEach(node => {\r\n          if (!node.innerHTML.trim()) {\r\n            node.remove();\r\n          } else {\r\n            hasContent = true;\r\n          }\r\n        });\r\n        if (!hasContent && !section.matches(\'[id=\"topic-header\"]\')) {\r\n          section.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\'DOMContentLoaded\', pruneOptionalSections);\r\n    // Export event listeners\r\n    document.addEventListener(\'DOMContentLoaded\', function() {\r\n      // Debug library availability\r\n      console.log(\'Libraries loaded:\', {\r\n        jsPDF: !!window.jspdf,\r\n        html2canvas: !!window.html2canvas,\r\n        bootstrap: !!window.bootstrap\r\n      });\r\n      \r\n      const exportVivaHTML = document.getElementById(\'exportVivaHTML\');\r\n      const exportVivaPDF = document.getElementById(\'exportVivaPDF\');\r\n      const exportVivaImage = document.getElementById(\'exportVivaImage\');\r\n      const exportVivaPrint = document.getElementById(\'exportVivaPrint\');\r\n      \r\n      if (exportVivaHTML) exportVivaHTML.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsHTML(); });\r\n      if (exportVivaPDF) exportVivaPDF.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsPDF(); });\r\n      if (exportVivaImage) exportVivaImage.addEventListener(\'click\', (e) => { e.preventDefault(); exportVivaAsImage(); });\r\n      if (exportVivaPrint) exportVivaPrint.addEventListener(\'click\', (e) => { e.preventDefault(); printVivaContent(); });\r\n      \r\n      // Initialize page search functionality\r\n      initPageSearch();\r\n      \r\n      \r\n      // Add print footer\r\n      setTimeout(addPrintFooter, 1000);\r\n      \r\n      console.log(\'Viva export dropdown, search, delete, and print footer functionality initialized\');\r\n    });\r\n    \r\n    // ================== PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    // Global variables for page search\r\n    let searchTimeout = null;\r\n    let currentSearchIndex = 0;\r\n    let searchResults = [];\r\n    \r\n    // Initialize page search functionality\r\n    function initPageSearch() {\r\n      const searchInput = document.getElementById(\'pageSearchInput\');\r\n      const searchClear = document.getElementById(\'pageSearchClear\');\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      \r\n      if (!searchInput) return;\r\n      \r\n      // Search input event\r\n      searchInput.addEventListener(\'input\', (e) => {\r\n        const query = e.target.value.trim();\r\n        \r\n        // Clear previous timeout\r\n        if (searchTimeout) {\r\n          clearTimeout(searchTimeout);\r\n        }\r\n        \r\n        // Debounce search\r\n        searchTimeout = setTimeout(() => {\r\n          performPageSearch(query);\r\n        }, 300);\r\n      });\r\n      \r\n      // Clear search button\r\n      searchClear.addEventListener(\'click\', () => {\r\n        searchInput.value = \'\';\r\n        clearPageSearch();\r\n      });\r\n      \r\n      // Keyboard shortcuts\r\n      searchInput.addEventListener(\'keydown\', (e) => {\r\n        if (e.key === \'Escape\') {\r\n          searchInput.value = \'\';\r\n          clearPageSearch();\r\n        } else if (e.key === \'Enter\') {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        } else if (e.key === \'F3\' || (e.ctrlKey && e.key === \'g\')) {\r\n          e.preventDefault();\r\n          if (searchResults.length > 0) {\r\n            navigateToNextSearchResult();\r\n          }\r\n        }\r\n      });\r\n      \r\n      // Ctrl+F to focus search\r\n      document.addEventListener(\'keydown\', (e) => {\r\n        if (e.ctrlKey && e.key === \'f\') {\r\n          e.preventDefault();\r\n          searchInput.focus();\r\n          searchInput.select();\r\n        }\r\n      });\r\n    }\r\n    \r\n    // Perform search within the page\r\n    function performPageSearch(query) {\r\n      if (!query) {\r\n        clearPageSearch();\r\n        return;\r\n      }\r\n      \r\n      // Clear previous highlights\r\n      clearPageSearch();\r\n      \r\n      // Search in all text content\r\n      const walker = document.createTreeWalker(\r\n        document.body,\r\n        NodeFilter.SHOW_TEXT,\r\n        {\r\n          acceptNode: function(node) {\r\n            // Skip script and style tags\r\n            if (node.parentElement.tagName === \'SCRIPT\' || \r\n                node.parentElement.tagName === \'STYLE\' ||\r\n                node.parentElement.classList.contains(\'search-highlight\')) {\r\n              return NodeFilter.FILTER_REJECT;\r\n            }\r\n            return NodeFilter.FILTER_ACCEPT;\r\n          }\r\n        }\r\n      );\r\n      \r\n      const textNodes = [];\r\n      let node;\r\n      while (node = walker.nextNode()) {\r\n        textNodes.push(node);\r\n      }\r\n      \r\n      // Find matches\r\n      searchResults = [];\r\n      textNodes.forEach(textNode => {\r\n        const text = textNode.textContent;\r\n        const regex = new RegExp(`(${escapeRegex(query)})`, \'gi\');\r\n        let match;\r\n        \r\n        while ((match = regex.exec(text)) !== null) {\r\n          searchResults.push({\r\n            node: textNode,\r\n            start: match.index,\r\n            end: match.index + match.length,\r\n            text: match\r\n          });\r\n        }\r\n      });\r\n      \r\n      // Highlight matches\r\n      highlightSearchResults();\r\n      \r\n      // Update search info\r\n      updateSearchInfo();\r\n      \r\n      // Navigate to first result\r\n      if (searchResults.length > 0) {\r\n        currentSearchIndex = 0;\r\n        navigateToSearchResult(0);\r\n      }\r\n    }\r\n    \r\n    // Highlight search results\r\n    function highlightSearchResults() {\r\n      searchResults.forEach((result, index) => {\r\n        const textNode = result.node;\r\n        const parent = textNode.parentNode;\r\n        const text = textNode.textContent;\r\n        \r\n        // Create highlighted span\r\n        const highlightedText = text.substring(0, result.start) +\r\n          `<span class=\"search-highlight\" data-search-index=\"${index}\">` +\r\n          text.substring(result.start, result.end) +\r\n          \'</span>\' +\r\n          text.substring(result.end);\r\n        \r\n        // Replace text node with highlighted HTML\r\n        const tempDiv = document.createElement(\'div\');\r\n        tempDiv.innerHTML = highlightedText;\r\n        \r\n        // Replace the text node with the highlighted content\r\n        while (tempDiv.firstChild) {\r\n          parent.insertBefore(tempDiv.firstChild, textNode);\r\n        }\r\n        parent.removeChild(textNode);\r\n      });\r\n    }\r\n    \r\n    // Navigate to specific search result\r\n    function navigateToSearchResult(index) {\r\n      if (index < 0 || index >= searchResults.length) return;\r\n      \r\n      // Remove current highlight\r\n      const currentHighlight = document.querySelector(\'.search-highlight.current\');\r\n      if (currentHighlight) {\r\n        currentHighlight.classList.remove(\'current\');\r\n      }\r\n      \r\n      // Add current highlight\r\n      const targetHighlight = document.querySelector(`[data-search-index=\"${index}\"]`);\r\n      if (targetHighlight) {\r\n        targetHighlight.classList.add(\'current\');\r\n        targetHighlight.scrollIntoView({ \r\n          behavior: \'smooth\', \r\n          block: \'center\',\r\n          inline: \'nearest\'\r\n        });\r\n      }\r\n      \r\n      currentSearchIndex = index;\r\n      updateSearchInfo();\r\n    }\r\n    \r\n    // Navigate to next search result\r\n    function navigateToNextSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const nextIndex = (currentSearchIndex + 1) % searchResults.length;\r\n      navigateToSearchResult(nextIndex);\r\n    }\r\n    \r\n    // Navigate to previous search result\r\n    function navigateToPreviousSearchResult() {\r\n      if (searchResults.length === 0) return;\r\n      const prevIndex = currentSearchIndex <= 0 ? searchResults.length - 1 : currentSearchIndex - 1;\r\n      navigateToSearchResult(prevIndex);\r\n    }\r\n    \r\n    // Clear page search\r\n    function clearPageSearch() {\r\n      // Remove all search highlights\r\n      const highlights = document.querySelectorAll(\'.search-highlight\');\r\n      highlights.forEach(highlight => {\r\n        const parent = highlight.parentNode;\r\n        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);\r\n        parent.normalize(); // Merge adjacent text nodes\r\n      });\r\n      \r\n      // Reset search state\r\n      searchResults = [];\r\n      currentSearchIndex = 0;\r\n      \r\n      // Hide search info\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      if (searchInfo) {\r\n        searchInfo.style.display = \'none\';\r\n      }\r\n    }\r\n    \r\n    // Update search info display\r\n    function updateSearchInfo() {\r\n      const searchInfo = document.getElementById(\'searchInfo\');\r\n      const searchCount = document.getElementById(\'searchCount\');\r\n      \r\n      if (searchInfo && searchCount) {\r\n        if (searchResults.length > 0) {\r\n          searchCount.textContent = `${currentSearchIndex + 1} of ${searchResults.length}`;\r\n          searchInfo.style.display = \'block\';\r\n        } else {\r\n          searchInfo.style.display = \'none\';\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Escape regex special characters\r\n    function escapeRegex(string) {\r\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \'\\\\$&\');\r\n    }\r\n    \r\n    // ================== END PAGE SEARCH FUNCTIONALITY ==================\r\n    \r\n    \r\n    \r\n    \r\n\r\n    \r\n    // ================== END EXPORT FUNCTIONALITY ==================\r\n    \r\n    // ================== ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n    // Apply enhanced styling to existing additional notes\r\n    function enhanceExistingAdditionalNotes() {\r\n      console.log(\'Enhancing existing additional notes...\');\r\n      \r\n      // Find all existing additional notes\r\n      const existingNotes = document.querySelectorAll(\'section[id^=\"extra-note-\"]\');\r\n      \r\n      existingNotes.forEach(note => {\r\n        // Add the additional-note class for consistency\r\n        note.classList.add(\'additional-note\');\r\n        \r\n        // Ensure proper positioning for delete buttons\r\n        note.style.position = \'relative\';\r\n        \r\n        // Update the content container class if needed\r\n        const contentContainer = note.querySelector(\'.border.rounded.p-3.bg-white\');\r\n        if (contentContainer) {\r\n          contentContainer.classList.add(\'content-container\');\r\n        }\r\n        \r\n        console.log(\'Enhanced note:\', note.id);\r\n      });\r\n      \r\n      console.log(\'Enhanced\', existingNotes.length, \'existing additional notes\');\r\n    }\r\n    \r\n    // Run enhancement when DOM is loaded\r\n    if (document.readyState === \'loading\') {\r\n      document.addEventListener(\'DOMContentLoaded\', enhanceExistingAdditionalNotes);\r\n    } else {\r\n      enhanceExistingAdditionalNotes();\r\n    }\r\n    \r\n    // ================== END ENHANCE EXISTING ADDITIONAL NOTES ==================\r\n  </script>\r\n  <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js\"></script>\r\n</body>\r\n</html>\r\n\r\n\r\n\r\n\r\n\r\n', '2025-09-19 23:02:32', '2025-09-19 01:28:18', '2025-09-19 01:28:18', '2025-09-19 23:02:32');

-- --------------------------------------------------------

--
-- Table structure for table `users`
--

DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL,
  `mobile_number` varchar(255) DEFAULT NULL,
  `email_verified_at` timestamp NULL DEFAULT NULL,
  `password` varchar(255) NOT NULL,
  `remember_token` varchar(100) DEFAULT NULL,
  `provider` varchar(255) DEFAULT NULL,
  `provider_id` varchar(255) DEFAULT NULL,
  `avatar` varchar(255) DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  `role` varchar(32) NOT NULL DEFAULT 'member',
  `is_active` tinyint(1) NOT NULL DEFAULT 1,
  `last_login_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `users`
--

INSERT INTO `users` (`id`, `name`, `email`, `mobile_number`, `email_verified_at`, `password`, `remember_token`, `provider`, `provider_id`, `avatar`, `created_at`, `updated_at`, `role`, `is_active`, `last_login_at`) VALUES
(1, 'Administrator', 'admin@example.com', NULL, '2025-09-18 19:49:00', '$2y$12$JTB/whOXoSCK0KFIdhPpTOxHC3gcC2h5We9FFx88OKHWasO6YgXKe', 'l6xi7ptorvtyeHYFGLvcSLzLo1r2BMbzlnJucO2W46EDvVAAmCV3elR1X0ah', NULL, NULL, NULL, '2025-09-18 12:55:57', '2025-09-20 04:20:15', 'admin', 1, '2025-09-20 04:20:15'),
(3, 'test', 'test@test.com', NULL, NULL, '$2y$12$t3xxX5OHUiyCSlzyYuq5/.9us9qPXROGsGmzpBk9uEI/H6Tj5wNlu', NULL, NULL, NULL, NULL, '2025-09-18 21:19:08', '2025-09-19 08:19:16', 'member', 1, '2025-09-19 08:19:16'),
(4, 'KKUMC', 'kkumc2025@gmail.com', NULL, '2025-09-19 16:10:13', '$2y$12$hU4nWlY3.6JnDooz4.p41.STJVg1wS8tLvcI.oCtDTfv/xYmse7Zq', '065aQroaybhp5QADliQJo9cLvcMLot21pss7sP80AEb1CLjmFNNxeDOQ120h', 'google', '117725594682563290564', 'https://lh3.googleusercontent.com/a/ACg8ocIWcql8V2lbjt_w_9ZIGSRrzqlMspA0oGBNT6pCOI9ORSA0Yw=s96-c', '2025-09-19 16:10:13', '2025-09-19 16:14:47', 'member', 1, '2025-09-19 16:14:47');

-- --------------------------------------------------------

--
-- Table structure for table `user_completed`
--

DROP TABLE IF EXISTS `user_completed`;
CREATE TABLE `user_completed` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `user_id` bigint(20) UNSIGNED NOT NULL,
  `topic_id` bigint(20) UNSIGNED NOT NULL,
  `completed_at` timestamp NOT NULL DEFAULT current_timestamp() ON UPDATE current_timestamp(),
  `notes` text DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `user_completed`
--

INSERT INTO `user_completed` (`id`, `user_id`, `topic_id`, `completed_at`, `notes`, `created_at`, `updated_at`) VALUES
(3, 1, 17, '2025-09-19 01:58:24', NULL, '2025-09-19 01:58:24', '2025-09-19 01:58:24'),
(6, 1, 7, '2025-09-19 02:12:43', NULL, '2025-09-19 02:12:43', '2025-09-19 02:12:43'),
(10, 1, 8, '2025-09-19 02:58:03', NULL, '2025-09-19 02:58:03', '2025-09-19 02:58:03'),
(11, 1, 4, '2025-09-19 02:59:59', NULL, '2025-09-19 02:59:59', '2025-09-19 02:59:59'),
(12, 1, 13, '2025-09-19 03:00:03', NULL, '2025-09-19 03:00:03', '2025-09-19 03:00:03'),
(14, 3, 6, '2025-09-19 08:21:26', NULL, '2025-09-19 08:21:26', '2025-09-19 08:21:26'),
(15, 4, 24, '2025-09-19 21:13:08', NULL, '2025-09-19 21:13:08', '2025-09-19 21:13:08');

-- --------------------------------------------------------

--
-- Table structure for table `user_favorites`
--

DROP TABLE IF EXISTS `user_favorites`;
CREATE TABLE `user_favorites` (
  `id` bigint(20) UNSIGNED NOT NULL,
  `user_id` bigint(20) UNSIGNED NOT NULL,
  `topic_id` bigint(20) UNSIGNED NOT NULL,
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

--
-- Dumping data for table `user_favorites`
--

INSERT INTO `user_favorites` (`id`, `user_id`, `topic_id`, `created_at`, `updated_at`) VALUES
(12, 1, 5, '2025-09-19 02:51:24', '2025-09-19 02:51:24'),
(13, 1, 7, '2025-09-19 02:51:46', '2025-09-19 02:51:46'),
(17, 1, 24, '2025-09-19 02:58:41', '2025-09-19 02:58:41'),
(18, 1, 6, '2025-09-19 03:07:06', '2025-09-19 03:07:06'),
(19, 3, 6, '2025-09-19 08:19:43', '2025-09-19 08:19:43'),
(21, 4, 4, '2025-09-19 16:10:40', '2025-09-19 16:10:40'),
(22, 4, 24, '2025-09-19 21:13:43', '2025-09-19 21:13:43');

--
-- Indexes for dumped tables
--

--
-- Indexes for table `activity_logs`
--
ALTER TABLE `activity_logs`
  ADD PRIMARY KEY (`id`),
  ADD KEY `activity_logs_user_id_foreign` (`user_id`),
  ADD KEY `activity_logs_subject_type_subject_id_index` (`subject_type`,`subject_id`);

--
-- Indexes for table `auth_settings`
--
ALTER TABLE `auth_settings`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `cache`
--
ALTER TABLE `cache`
  ADD PRIMARY KEY (`key`);

--
-- Indexes for table `cache_locks`
--
ALTER TABLE `cache_locks`
  ADD PRIMARY KEY (`key`);

--
-- Indexes for table `categories`
--
ALTER TABLE `categories`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `categories_slug_unique` (`slug`);

--
-- Indexes for table `failed_jobs`
--
ALTER TABLE `failed_jobs`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `failed_jobs_uuid_unique` (`uuid`);

--
-- Indexes for table `jobs`
--
ALTER TABLE `jobs`
  ADD PRIMARY KEY (`id`),
  ADD KEY `jobs_queue_index` (`queue`);

--
-- Indexes for table `job_batches`
--
ALTER TABLE `job_batches`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `layout_templates`
--
ALTER TABLE `layout_templates`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `layout_templates_slug_unique` (`slug`);

--
-- Indexes for table `menu_items`
--
ALTER TABLE `menu_items`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `migrations`
--
ALTER TABLE `migrations`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `navigation_header_buttons`
--
ALTER TABLE `navigation_header_buttons`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `navigation_menu_items`
--
ALTER TABLE `navigation_menu_items`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `navigation_sections`
--
ALTER TABLE `navigation_sections`
  ADD PRIMARY KEY (`id`);

--
-- Indexes for table `page_contents`
--
ALTER TABLE `page_contents`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `page_contents_key_unique` (`key`);

--
-- Indexes for table `password_reset_tokens`
--
ALTER TABLE `password_reset_tokens`
  ADD PRIMARY KEY (`email`);

--
-- Indexes for table `sessions`
--
ALTER TABLE `sessions`
  ADD PRIMARY KEY (`id`),
  ADD KEY `sessions_user_id_index` (`user_id`),
  ADD KEY `sessions_last_activity_index` (`last_activity`);

--
-- Indexes for table `settings`
--
ALTER TABLE `settings`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `settings_key_unique` (`key`);

--
-- Indexes for table `templates`
--
ALTER TABLE `templates`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `templates_slug_unique` (`slug`);

--
-- Indexes for table `topics`
--
ALTER TABLE `topics`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `topics_slug_unique` (`slug`),
  ADD KEY `topics_template_id_foreign` (`template_id`),
  ADD KEY `topics_created_by_foreign` (`created_by`),
  ADD KEY `topics_updated_by_foreign` (`updated_by`),
  ADD KEY `topics_status_index` (`status`),
  ADD KEY `topics_published_at_index` (`published_at`),
  ADD KEY `topics_category_id_foreign` (`category_id`);

--
-- Indexes for table `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `users_email_unique` (`email`),
  ADD KEY `users_provider_index` (`provider`),
  ADD KEY `users_provider_id_index` (`provider_id`);

--
-- Indexes for table `user_completed`
--
ALTER TABLE `user_completed`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `user_completed_user_id_topic_id_unique` (`user_id`,`topic_id`),
  ADD KEY `user_completed_user_id_completed_at_index` (`user_id`,`completed_at`),
  ADD KEY `user_completed_topic_id_completed_at_index` (`topic_id`,`completed_at`);

--
-- Indexes for table `user_favorites`
--
ALTER TABLE `user_favorites`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `user_favorites_user_id_topic_id_unique` (`user_id`,`topic_id`),
  ADD KEY `user_favorites_user_id_created_at_index` (`user_id`,`created_at`),
  ADD KEY `user_favorites_topic_id_created_at_index` (`topic_id`,`created_at`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `activity_logs`
--
ALTER TABLE `activity_logs`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=45;

--
-- AUTO_INCREMENT for table `auth_settings`
--
ALTER TABLE `auth_settings`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `categories`
--
ALTER TABLE `categories`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- AUTO_INCREMENT for table `failed_jobs`
--
ALTER TABLE `failed_jobs`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `jobs`
--
ALTER TABLE `jobs`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT for table `layout_templates`
--
ALTER TABLE `layout_templates`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=11;

--
-- AUTO_INCREMENT for table `menu_items`
--
ALTER TABLE `menu_items`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=8;

--
-- AUTO_INCREMENT for table `migrations`
--
ALTER TABLE `migrations`
  MODIFY `id` int(10) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=29;

--
-- AUTO_INCREMENT for table `navigation_header_buttons`
--
ALTER TABLE `navigation_header_buttons`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;

--
-- AUTO_INCREMENT for table `navigation_menu_items`
--
ALTER TABLE `navigation_menu_items`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=6;

--
-- AUTO_INCREMENT for table `page_contents`
--
ALTER TABLE `page_contents`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=40;

--
-- AUTO_INCREMENT for table `settings`
--
ALTER TABLE `settings`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=14;

--
-- AUTO_INCREMENT for table `templates`
--
ALTER TABLE `templates`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=2;

--
-- AUTO_INCREMENT for table `topics`
--
ALTER TABLE `topics`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=25;

--
-- AUTO_INCREMENT for table `users`
--
ALTER TABLE `users`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=5;

--
-- AUTO_INCREMENT for table `user_completed`
--
ALTER TABLE `user_completed`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=16;

--
-- AUTO_INCREMENT for table `user_favorites`
--
ALTER TABLE `user_favorites`
  MODIFY `id` bigint(20) UNSIGNED NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=23;

--
-- Constraints for dumped tables
--

--
-- Constraints for table `activity_logs`
--
ALTER TABLE `activity_logs`
  ADD CONSTRAINT `activity_logs_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL;

--
-- Constraints for table `topics`
--
ALTER TABLE `topics`
  ADD CONSTRAINT `topics_category_id_foreign` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `topics_created_by_foreign` FOREIGN KEY (`created_by`) REFERENCES `users` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `topics_template_id_foreign` FOREIGN KEY (`template_id`) REFERENCES `templates` (`id`) ON DELETE SET NULL,
  ADD CONSTRAINT `topics_updated_by_foreign` FOREIGN KEY (`updated_by`) REFERENCES `users` (`id`) ON DELETE SET NULL;

--
-- Constraints for table `user_completed`
--
ALTER TABLE `user_completed`
  ADD CONSTRAINT `user_completed_topic_id_foreign` FOREIGN KEY (`topic_id`) REFERENCES `topics` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `user_completed_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;

--
-- Constraints for table `user_favorites`
--
ALTER TABLE `user_favorites`
  ADD CONSTRAINT `user_favorites_topic_id_foreign` FOREIGN KEY (`topic_id`) REFERENCES `topics` (`id`) ON DELETE CASCADE,
  ADD CONSTRAINT `user_favorites_user_id_foreign` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
